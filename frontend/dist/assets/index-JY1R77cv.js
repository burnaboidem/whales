var Tg=Object.defineProperty;var Rg=(n,e,t)=>e in n?Tg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Et=(n,e,t)=>Rg(n,typeof e!="symbol"?e+"":e,t);import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();class du{constructor(e,t,r){this.x=e,this.y=200,this.name=r,this.score=0,this.speed=5,this.isFishing=!1,this.hookPosition={x:0,y:0},this.lineLength=0,this.maxLineLength=600,this.fishingSpeed=2,this.retractionSpeed=4,this.isRetracting=!1,this.targetAngle=Math.PI/2,this.isAiming=!1,this.aimLineLength=100}update(){this.isFishing?(this.isRetracting?(this.lineLength=Math.max(0,this.lineLength-this.retractionSpeed),this.lineLength===0&&(this.isFishing=!1,this.isRetracting=!1)):this.lineLength<this.maxLineLength&&(this.lineLength+=this.fishingSpeed),this.updateHookPosition()):(this.lineLength=0,this.isRetracting=!1)}render(e){if(e.fillStyle="#8B4513",e.fillRect(this.x-25,this.y,50,20),e.fillStyle="#000000",e.fillRect(this.x-10,this.y-20,20,20),e.strokeStyle="#000000",e.beginPath(),e.moveTo(this.x,this.y-10),e.lineTo(this.x+30,this.y-30),e.stroke(),this.isFishing&&(e.beginPath(),e.moveTo(this.x+30,this.y-30),e.lineTo(this.hookPosition.x,this.hookPosition.y),e.stroke(),e.beginPath(),e.arc(this.hookPosition.x,this.hookPosition.y,5,0,Math.PI*2),e.stroke()),!this.isFishing){e.strokeStyle="rgba(255, 255, 255, 0.5)",e.setLineDash([5,5]),e.beginPath(),e.moveTo(this.x+30,this.y-30);const t=this.x+30+Math.cos(this.targetAngle)*this.aimLineLength,r=this.y-30+Math.sin(this.targetAngle)*this.aimLineLength;e.lineTo(t,r),e.stroke(),e.setLineDash([])}}moveLeft(){this.isFishing||(this.x=Math.max(50,this.x-this.speed))}moveRight(){this.isFishing||(this.x=Math.min(750,this.x+this.speed))}toggleFishing(){this.isFishing?this.isRetracting=!0:(this.isFishing=!0,this.isRetracting=!1,this.lineLength=0)}updateHookPosition(){this.hookPosition.x=this.x+30+Math.cos(this.targetAngle)*this.lineLength,this.hookPosition.y=this.y-30+Math.sin(this.targetAngle)*this.lineLength}updateTargetAngle(e,t){if(!this.isFishing){const r=e-(this.x+30),i=t-(this.y-30);this.targetAngle=Math.atan2(i,r);const s=Math.PI/4,o=Math.PI*3/4;this.targetAngle=Math.max(s,Math.min(o,this.targetAngle))}}updateScore(e){return this.score=Math.max(0,this.score+e),console.log(`Score updated: ${this.score} (${e>0?"+":""}${e})`),this.score}}class _a{constructor(e="regular"){switch(this.type=e,this.reset(),this.setInitialSpeed(),e){case"whale":this.size=100,this.value=-5;break;case"rainbow":this.size=40,this.value=5,this.zigzagAmplitude=50,this.zigzagFrequency=.02,this.timeOffset=Math.random()*Math.PI*2;break;default:this.size=30,this.value=1}}setInitialSpeed(){switch(this.type){case"whale":this.baseSpeed=2;break;case"rainbow":this.baseSpeed=4;break;default:this.baseSpeed=3}this.speed=this.baseSpeed}increaseSpeed(e){this.speed=this.baseSpeed*e}resetSpeed(){this.speed=this.baseSpeed}reset(){this.x=Math.random()<.5?-this.size:850,this.y=Math.random()*300+250,this.direction=this.x<0?1:-1,this.active=!0,this.startTime=Date.now()}update(){if(this.type==="rainbow"){const e=(Date.now()-this.startTime)*this.zigzagFrequency;this.x+=this.speed*this.direction,this.y=this.y+Math.sin(e+this.timeOffset)*this.zigzagAmplitude*.1,this.y=Math.max(250,Math.min(500,this.y))}else this.x+=this.speed*this.direction;(this.x>850||this.x<-50)&&this.reset()}render(e){if(!this.active)return;switch(e.save(),this.type){case"whale":e.fillStyle="#4A4A4A";break;case"rainbow":const r=e.createLinearGradient(this.x,this.y,this.x+this.size,this.y);r.addColorStop(0,"#FF0000"),r.addColorStop(.2,"#FFA500"),r.addColorStop(.4,"#FFFF00"),r.addColorStop(.6,"#00FF00"),r.addColorStop(.8,"#0000FF"),r.addColorStop(1,"#9400D3"),e.fillStyle=r;break;default:e.fillStyle="#FFD700"}e.fillRect(this.x,this.y,this.size,this.size/2),e.fillStyle="#000000";const t=this.direction>0?this.x+this.size*.8:this.x+this.size*.2;e.beginPath(),e.arc(t,this.y+this.size*.25,3,0,Math.PI*2),e.fill(),e.restore()}}class Mg{constructor(){this.fishes=[],this.whales=[],this.rainbowFish=null,this.rainbowFishSpawned=!1,this.minSpacing=80,this.baseWhaleCount=2,this.currentSpeedMultiplier=1}addWhale(){const e=new _a("whale");this.ensureNoOverlap(e),this.whales.push(e),console.log("New whale added! Total whales:",this.whales.length)}increaseWhaleCount(){this.addWhale()}init(){for(let e=0;e<10;e++){const t=new _a("regular");this.ensureNoOverlap(t),this.fishes.push(t)}for(let e=0;e<this.baseWhaleCount;e++)this.addWhale();this.scheduleRainbowFish()}ensureNoOverlap(e){let t=0;const r=10;let i=!0;for(;i&&t<r;){e.reset(),i=!1;const s=[...this.fishes,...this.whales];for(const o of s)if(this.checkOverlap(e,o)){i=!0;break}t++}}checkOverlap(e,t){const r=this.minSpacing+(e.size+t.size)/2,i=this.minSpacing*1.5;return Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<i}scheduleRainbowFish(){setTimeout(()=>{this.rainbowFishSpawned||(this.rainbowFish=new _a("rainbow"),this.rainbowFishSpawned=!0)},Math.random()*3e4+3e4)}update(){[...this.fishes,...this.whales].forEach(e=>{e.update(),(e.x>850||e.x<-50)&&this.ensureNoOverlap(e)}),this.rainbowFish&&this.rainbowFish.active&&this.rainbowFish.update()}render(e){[...this.fishes,...this.whales].forEach(t=>t.render(e)),this.rainbowFish&&this.rainbowFish.active&&this.rainbowFish.render(e)}checkFishingCollision(e){if(this.rainbowFish&&this.rainbowFish.active&&this.isColliding(e,this.rainbowFish))return console.log("Rainbow fish caught!"),this.rainbowFish.active=!1,"rainbow";for(const t of this.whales)if(this.isColliding(e,t))return console.log("Whale hit!"),"whale";for(const t of this.fishes)if(t.active&&this.isColliding(e,t))return console.log("Regular fish caught!"),t.active=!1,setTimeout(()=>{t.reset(),t.active=!0},1e3),"regular";return!1}isColliding(e,t){return e.x>t.x&&e.x<t.x+t.size&&e.y>t.y&&e.y<t.y+t.size/2}increaseSpeeds(){this.currentSpeedMultiplier++,console.log(`Increasing all fish speeds to ${this.currentSpeedMultiplier}x!`),[...this.fishes,...this.whales].forEach(e=>e.increaseSpeed(this.currentSpeedMultiplier)),this.rainbowFish&&this.rainbowFish.increaseSpeed(this.currentSpeedMultiplier)}resetSpeeds(){[...this.fishes,...this.whales].forEach(e=>e.resetSpeed()),this.rainbowFish&&this.rainbowFish.resetSpeed(),this.currentSpeedMultiplier=1}}class Jh{static async load(){const e={boat:"assets/sprites/boat.png",fisherman:"assets/sprites/fisherman.png",fish:"assets/sprites/fish.png",whale:"assets/sprites/whale.png",hook:"assets/sprites/hook.png"},t={splash:"assets/sounds/splash.mp3",catch:"assets/sounds/catch.mp3",whale:"assets/sounds/whale.mp3"},r=Object.entries(e).map(([s,o])=>new Promise((a,c)=>{const h=new Image;h.onload=()=>{this.assets.images[s]=h,a()},h.onerror=c,h.src=o})),i=Object.entries(t).map(([s,o])=>new Promise((a,c)=>{const h=new Audio;h.oncanplaythrough=()=>{this.assets.sounds[s]=h,a()},h.onerror=c,h.src=o}));try{await Promise.all([...r,...i]),console.log("All assets loaded successfully")}catch(s){console.error("Error loading assets:",s)}}static getImage(e){return this.assets.images[e]}static playSound(e){const t=this.assets.sounds[e];t&&(t.currentTime=0,t.play())}}Et(Jh,"assets",{images:{},sounds:{}});var fu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zh={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z=function(n,e){if(!n)throw _i(e)},_i=function(n){return new Error("Firebase Database ("+Zh.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Ng=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],o=n[t++],a=n[t++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Oc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,h=c?n[i+2]:0,g=s>>2,y=(s&3)<<4|a>>4;let E=(a&15)<<2|h>>6,x=h&63;c||(x=64,o||(E=64)),r.push(t[g],t[y],t[E],t[x])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Xh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Ng(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const y=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||h==null||y==null)throw new Bg;const E=s<<2|a>>4;if(r.push(E),h!==64){const x=a<<4&240|h>>2;if(r.push(x),y!==64){const T=h<<6&192|y;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Bg extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Qh=function(n){const e=Xh(n);return Oc.encodeByteArray(e,!0)},Ws=function(n){return Qh(n).replace(/\./g,"")},Hs=function(n){try{return Oc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pg(n){return ed(void 0,n)}function ed(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Lg(t)||(n[t]=ed(n[t],e[t]));return n}function Lg(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Og(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dg=()=>Og().__FIREBASE_DEFAULTS__,Fg=()=>{if(typeof process>"u"||typeof fu>"u")return;const n=fu.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ug=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Hs(n[1]);return e&&JSON.parse(e)},Dc=()=>{try{return Dg()||Fg()||Ug()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},td=n=>{var e,t;return(t=(e=Dc())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},nd=n=>{const e=td(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},rd=()=>{var n;return(n=Dc())===null||n===void 0?void 0:n.config},id=n=>{var e;return(e=Dc())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wg(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ws(JSON.stringify(t)),Ws(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Fc(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Vt())}function Hg(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function zg(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function sd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function $g(){const n=Vt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function qg(){return Zh.NODE_ADMIN===!0}function Vg(){try{return typeof indexedDB=="object"}catch{return!1}}function Gg(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jg="FirebaseError";class Gn extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=jg,Object.setPrototypeOf(this,Gn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,os.prototype.create)}}class os{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Kg(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Gn(i,a,r)}}function Kg(n,e){return n.replace(Yg,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Yg=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $i(n){return JSON.parse(n)}function It(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const od=function(n){let e={},t={},r={},i="";try{const s=n.split(".");e=$i(Hs(s[0])||""),t=$i(Hs(s[1])||""),i=s[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:i}},Jg=function(n){const e=od(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Zg=function(n){const e=od(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function An(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ai(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function ec(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function zs(n,e,t){const r={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=e.call(t,n[i],i,n));return r}function $s(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(pu(s)&&pu(o)){if(!$s(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function pu(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wi(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let y=0;y<16;y++)r[y]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let y=0;y<16;y++)r[y]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let y=16;y<80;y++){const E=r[y-3]^r[y-8]^r[y-14]^r[y-16];r[y]=(E<<1|E>>>31)&4294967295}let i=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],h,g;for(let y=0;y<80;y++){y<40?y<20?(h=a^s&(o^a),g=1518500249):(h=s^o^a,g=1859775393):y<60?(h=s&o|a&(s|o),g=2400959708):(h=s^o^a,g=3395469782);const E=(i<<5|i>>>27)+h+c+g+r[y]&4294967295;c=a,a=o,o=(s<<30|s>>>2)&4294967295,s=i,i=E}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let i=0;const s=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(s[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}else for(;i<t;)if(s[o]=e[i],++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let s=24;s>=0;s-=8)e[r]=this.chain_[i]>>s&255,++r;return e}}function Qg(n,e){const t=new em(n,e);return t.subscribe.bind(t)}class em{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");tm(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=wa),i.error===void 0&&(i.error=wa),i.complete===void 0&&(i.complete=wa);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function tm(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function wa(){}function vo(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i>=55296&&i<=56319){const s=i-55296;r++,z(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;i=65536+(s<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Eo=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(n){return n&&n._delegate?n._delegate:n}class fr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _r="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new ss;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(sm(e))try{this.getOrInitializeService({instanceIdentifier:_r})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=_r){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=_r){return this.instances.has(e)}getOptions(e=_r){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:im(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=_r){return this.component?this.component.multipleInstances?e:_r:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function im(n){return n===_r?void 0:n}function sm(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new rm(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Pe||(Pe={}));const am={debug:Pe.DEBUG,verbose:Pe.VERBOSE,info:Pe.INFO,warn:Pe.WARN,error:Pe.ERROR,silent:Pe.SILENT},cm=Pe.INFO,lm={[Pe.DEBUG]:"log",[Pe.VERBOSE]:"log",[Pe.INFO]:"info",[Pe.WARN]:"warn",[Pe.ERROR]:"error"},um=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=lm[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Uc{constructor(e){this.name=e,this._logLevel=cm,this._logHandler=um,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Pe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?am[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Pe.DEBUG,...e),this._logHandler(this,Pe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Pe.VERBOSE,...e),this._logHandler(this,Pe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Pe.INFO,...e),this._logHandler(this,Pe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Pe.WARN,...e),this._logHandler(this,Pe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Pe.ERROR,...e),this._logHandler(this,Pe.ERROR,...e)}}const hm=(n,e)=>e.some(t=>n instanceof t);let gu,mu;function dm(){return gu||(gu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fm(){return mu||(mu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ad=new WeakMap,tc=new WeakMap,cd=new WeakMap,ba=new WeakMap,Wc=new WeakMap;function pm(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(cr(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ad.set(t,n)}).catch(()=>{}),Wc.set(e,n),e}function gm(n){if(tc.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});tc.set(n,e)}let nc={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return tc.get(n);if(e==="objectStoreNames")return n.objectStoreNames||cd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return cr(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function mm(n){nc=n(nc)}function ym(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(va(this),e,...t);return cd.set(r,e.sort?e.sort():[e]),cr(r)}:fm().includes(n)?function(...e){return n.apply(va(this),e),cr(ad.get(this))}:function(...e){return cr(n.apply(va(this),e))}}function _m(n){return typeof n=="function"?ym(n):(n instanceof IDBTransaction&&gm(n),hm(n,dm())?new Proxy(n,nc):n)}function cr(n){if(n instanceof IDBRequest)return pm(n);if(ba.has(n))return ba.get(n);const e=_m(n);return e!==n&&(ba.set(n,e),Wc.set(e,n)),e}const va=n=>Wc.get(n);function wm(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=cr(o);return r&&o.addEventListener("upgradeneeded",c=>{r(cr(o.result),c.oldVersion,c.newVersion,cr(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),a}const bm=["get","getKey","getAll","getAllKeys","count"],vm=["put","add","delete","clear"],Ea=new Map;function yu(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ea.get(e))return Ea.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=vm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||bm.includes(t)))return;const s=async function(o,...a){const c=this.transaction(o,i?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(a.shift())),(await Promise.all([h[t](...a),i&&c.done]))[0]};return Ea.set(e,s),s}mm(n=>({...n,get:(e,t,r)=>yu(e,t)||n.get(e,t,r),has:(e,t)=>!!yu(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Sm(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Sm(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const rc="@firebase/app",_u="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zn=new Uc("@firebase/app"),Im="@firebase/app-compat",xm="@firebase/analytics-compat",km="@firebase/analytics",Am="@firebase/app-check-compat",Cm="@firebase/app-check",Tm="@firebase/auth",Rm="@firebase/auth-compat",Mm="@firebase/database",Nm="@firebase/data-connect",Bm="@firebase/database-compat",Pm="@firebase/functions",Lm="@firebase/functions-compat",Om="@firebase/installations",Dm="@firebase/installations-compat",Fm="@firebase/messaging",Um="@firebase/messaging-compat",Wm="@firebase/performance",Hm="@firebase/performance-compat",zm="@firebase/remote-config",$m="@firebase/remote-config-compat",qm="@firebase/storage",Vm="@firebase/storage-compat",Gm="@firebase/firestore",jm="@firebase/vertexai-preview",Km="@firebase/firestore-compat",Ym="firebase",Jm="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ic="[DEFAULT]",Zm={[rc]:"fire-core",[Im]:"fire-core-compat",[km]:"fire-analytics",[xm]:"fire-analytics-compat",[Cm]:"fire-app-check",[Am]:"fire-app-check-compat",[Tm]:"fire-auth",[Rm]:"fire-auth-compat",[Mm]:"fire-rtdb",[Nm]:"fire-data-connect",[Bm]:"fire-rtdb-compat",[Pm]:"fire-fn",[Lm]:"fire-fn-compat",[Om]:"fire-iid",[Dm]:"fire-iid-compat",[Fm]:"fire-fcm",[Um]:"fire-fcm-compat",[Wm]:"fire-perf",[Hm]:"fire-perf-compat",[zm]:"fire-rc",[$m]:"fire-rc-compat",[qm]:"fire-gcs",[Vm]:"fire-gcs-compat",[Gm]:"fire-fst",[Km]:"fire-fst-compat",[jm]:"fire-vertex","fire-js":"fire-js",[Ym]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs=new Map,Xm=new Map,sc=new Map;function wu(n,e){try{n.container.addComponent(e)}catch(t){zn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ar(n){const e=n.name;if(sc.has(e))return zn.debug(`There were multiple attempts to register component ${e}.`),!1;sc.set(e,n);for(const t of qs.values())wu(t,n);for(const t of Xm.values())wu(t,n);return!0}function So(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ir(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},lr=new os("app","Firebase",Qm);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw lr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bi=Jm;function Hc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ic,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw lr.create("bad-app-name",{appName:String(i)});if(t||(t=rd()),!t)throw lr.create("no-options");const s=qs.get(i);if(s){if($s(t,s.options)&&$s(r,s.config))return s;throw lr.create("duplicate-app",{appName:i})}const o=new om(i);for(const c of sc.values())o.addComponent(c);const a=new e0(t,r,o);return qs.set(i,a),a}function zc(n=ic){const e=qs.get(n);if(!e&&n===ic&&rd())return Hc();if(!e)throw lr.create("no-app",{appName:n});return e}function Sn(n,e,t){var r;let i=(r=Zm[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),zn.warn(a.join(" "));return}Ar(new fr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t0="firebase-heartbeat-database",n0=1,qi="firebase-heartbeat-store";let Sa=null;function ld(){return Sa||(Sa=wm(t0,n0,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(qi)}catch(t){console.warn(t)}}}}).catch(n=>{throw lr.create("idb-open",{originalErrorMessage:n.message})})),Sa}async function r0(n){try{const t=(await ld()).transaction(qi),r=await t.objectStore(qi).get(ud(n));return await t.done,r}catch(e){if(e instanceof Gn)zn.warn(e.message);else{const t=lr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});zn.warn(t.message)}}}async function bu(n,e){try{const r=(await ld()).transaction(qi,"readwrite");await r.objectStore(qi).put(e,ud(n)),await r.done}catch(t){if(t instanceof Gn)zn.warn(t.message);else{const r=lr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});zn.warn(r.message)}}}function ud(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i0=1024,s0=30*24*60*60*1e3;class o0{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new c0(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=vu();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=s0}),this._storage.overwrite(this._heartbeatsCache))}catch(r){zn.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=vu(),{heartbeatsToSend:r,unsentEntries:i}=a0(this._heartbeatsCache.heartbeats),s=Ws(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return zn.warn(t),""}}}function vu(){return new Date().toISOString().substring(0,10)}function a0(n,e=i0){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Eu(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Eu(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class c0{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Vg()?Gg().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await r0(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return bu(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return bu(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Eu(n){return Ws(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l0(n){Ar(new fr("platform-logger",e=>new Em(e),"PRIVATE")),Ar(new fr("heartbeat",e=>new o0(e),"PRIVATE")),Sn(rc,_u,n),Sn(rc,_u,"esm2017"),Sn("fire-js","")}l0("");var u0="firebase",h0="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sn(u0,h0,"app");var Su={};const Iu="@firebase/database",xu="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hd="";function d0(n){hd=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),It(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:$i(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return An(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dd=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new f0(e)}}catch{}return new p0},Sr=dd("localStorage"),g0=dd("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xr=new Uc("@firebase/database"),m0=function(){let n=1;return function(){return n++}}(),fd=function(n){const e=nm(n),t=new Xg;t.update(e);const r=t.digest();return Oc.encodeByteArray(r)},as=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=as.apply(null,r):typeof r=="object"?e+=It(r):e+=r,e+=" "}return e};let Di=null,ku=!0;const y0=function(n,e){z(!0,"Can't turn on custom loggers persistently."),Xr.logLevel=Pe.VERBOSE,Di=Xr.log.bind(Xr)},Pt=function(...n){if(ku===!0&&(ku=!1,Di===null&&g0.get("logging_enabled")===!0&&y0()),Di){const e=as.apply(null,n);Di(e)}},cs=function(n){return function(...e){Pt(n,...e)}},oc=function(...n){const e="FIREBASE INTERNAL ERROR: "+as(...n);Xr.error(e)},$n=function(...n){const e=`FIREBASE FATAL ERROR: ${as(...n)}`;throw Xr.error(e),new Error(e)},qt=function(...n){const e="FIREBASE WARNING: "+as(...n);Xr.warn(e)},_0=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&qt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$c=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},w0=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},ci="[MIN_NAME]",Cr="[MAX_NAME]",Lr=function(n,e){if(n===e)return 0;if(n===ci||e===Cr)return-1;if(e===ci||n===Cr)return 1;{const t=Au(n),r=Au(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},b0=function(n,e){return n===e?0:n<e?-1:1},Ri=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+It(e))},qc=function(n){if(typeof n!="object"||n===null)return It(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=It(e[r]),t+=":",t+=qc(n[e[r]]);return t+="}",t},pd=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function Ot(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const gd=function(n){z(!$c(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let i,s,o,a,c;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));const h=[];for(c=t;c;c-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)h.push(s%2?1:0),s=Math.floor(s/2);h.push(i?1:0),h.reverse();const g=h.join("");let y="";for(c=0;c<64;c+=8){let E=parseInt(g.substr(c,8),2).toString(16);E.length===1&&(E="0"+E),y=y+E}return y.toLowerCase()},v0=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},E0=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function S0(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const I0=new RegExp("^-?(0*)\\d{1,10}$"),x0=-2147483648,k0=2147483647,Au=function(n){if(I0.test(n)){const e=Number(n);if(e>=x0&&e<=k0)return e}return null},vi=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw qt("Exception was thrown by user callback.",t),e},Math.floor(0))}},A0=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Fi=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){qt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Pt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',qt(e)}}class Ps{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ps.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vc="5",md="v",yd="s",_d="r",wd="f",bd=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,vd="ls",Ed="p",ac="ac",Sd="websocket",Id="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xd{constructor(e,t,r,i,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Sr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Sr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function R0(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function kd(n,e,t){z(typeof e=="string","typeof type must == string"),z(typeof t=="object","typeof params must == object");let r;if(e===Sd)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Id)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);R0(n)&&(t.ns=n.namespace);const i=[];return Ot(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(){this.counters_={}}incrementCounter(e,t=1){An(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Pg(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ia={},xa={};function Gc(n){const e=n.toString();return Ia[e]||(Ia[e]=new M0),Ia[e]}function N0(n,e){const t=n.toString();return xa[t]||(xa[t]=e()),xa[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&vi(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cu="start",P0="close",L0="pLPCommand",O0="pRTLPCB",Ad="id",Cd="pw",Td="ser",D0="cb",F0="seg",U0="ts",W0="d",H0="dframe",Rd=1870,Md=30,z0=Rd-Md,$0=25e3,q0=3e4;class Kr{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=cs(e),this.stats_=Gc(t),this.urlFn=c=>(this.appCheckToken&&(c[ac]=this.appCheckToken),kd(t,Id,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new B0(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(q0)),w0(()=>{if(this.isClosed_)return;this.scriptTagHolder=new jc((...s)=>{const[o,a,c,h,g]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Cu)this.id=a,this.password=c;else if(o===P0)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[Cu]="t",r[Td]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[D0]=this.scriptTagHolder.uniqueCallbackIdentifier),r[md]=Vc,this.transportSessionId&&(r[yd]=this.transportSessionId),this.lastSessionId&&(r[vd]=this.lastSessionId),this.applicationId&&(r[Ed]=this.applicationId),this.appCheckToken&&(r[ac]=this.appCheckToken),typeof location<"u"&&location.hostname&&bd.test(location.hostname)&&(r[_d]=wd);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Kr.forceAllow_=!0}static forceDisallow(){Kr.forceDisallow_=!0}static isAvailable(){return Kr.forceAllow_?!0:!Kr.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!v0()&&!E0()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=It(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=Qh(t),i=pd(r,z0);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[H0]="t",r[Ad]=e,r[Cd]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=It(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class jc{constructor(e,t,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=m0(),window[L0+this.uniqueCallbackIdentifier]=e,window[O0+this.uniqueCallbackIdentifier]=t,this.myIFrame=jc.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Pt("frame writing exception"),a.stack&&Pt(a.stack),Pt(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Pt("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Ad]=this.myID,e[Cd]=this.myPW,e[Td]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Md+r.length<=Rd;){const o=this.pendingSegs.shift();r=r+"&"+F0+i+"="+o.seg+"&"+U0+i+"="+o.ts+"&"+W0+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor($0)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Pt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0=16384,G0=45e3;let Vs=null;typeof MozWebSocket<"u"?Vs=MozWebSocket:typeof WebSocket<"u"&&(Vs=WebSocket);class pn{constructor(e,t,r,i,s,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=cs(this.connId),this.stats_=Gc(t),this.connURL=pn.connectionURL_(t,o,a,i,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,i,s){const o={};return o[md]=Vc,typeof location<"u"&&location.hostname&&bd.test(location.hostname)&&(o[_d]=wd),t&&(o[yd]=t),r&&(o[vd]=r),i&&(o[ac]=i),s&&(o[Ed]=s),kd(e,Sd,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Sr.set("previous_websocket_failure",!0);try{let r;qg(),this.mySock=new Vs(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){pn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Vs!==null&&!pn.forceDisallow_}static previouslyFailed(){return Sr.isInMemoryStorage||Sr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Sr.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=$i(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(z(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=It(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=pd(t,V0);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(G0))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}pn.responsesRequiredToBeHealthy=2;pn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Kr,pn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=pn&&pn.isAvailable();let r=t&&!pn.previouslyFailed();if(e.webSocketOnly&&(t||qt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[pn];else{const i=this.transports_=[];for(const s of Vi.ALL_TRANSPORTS)s&&s.isAvailable()&&i.push(s);Vi.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Vi.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j0=6e4,K0=5e3,Y0=10*1024,J0=100*1024,ka="t",Tu="d",Z0="s",Ru="r",X0="e",Mu="o",Nu="a",Bu="n",Pu="p",Q0="h";let ey=class{constructor(e,t,r,i,s,o,a,c,h,g){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=g,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=cs("c:"+this.id+":"),this.transportManager_=new Vi(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Fi(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>J0?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Y0?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ka in e){const t=e[ka];t===Nu?this.upgradeIfSecondaryHealthy_():t===Ru?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Mu&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ri("t",e),r=Ri("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Pu,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Nu,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Bu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ri("t",e),r=Ri("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ri(ka,e);if(Tu in e){const r=e[Tu];if(t===Q0){const i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Bu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Z0?this.onConnectionShutdown_(r):t===Ru?this.onReset_(r):t===X0?oc("Server Error: "+r):t===Mu?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):oc("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Vc!==r&&qt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Fi(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(j0))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Fi(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(K0))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Pu,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Sr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bd=class{constructor(e){this.allowedEvents_=e,this.listeners_={},z(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){z(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs extends Bd{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Fc()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Gs}getInitialEvent(e){return z(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu=32,Ou=768;class Le{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Te(){return new Le("")}function ve(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function pr(n){return n.pieces_.length-n.pieceNum_}function He(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Le(n.pieces_,e)}function Kc(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function ty(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Gi(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Pd(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Le(e,0)}function Qe(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Le)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new Le(t,0)}function xe(n){return n.pieceNum_>=n.pieces_.length}function Ht(n,e){const t=ve(n),r=ve(e);if(t===null)return e;if(t===r)return Ht(He(n),He(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function ny(n,e){const t=Gi(n,0),r=Gi(e,0);for(let i=0;i<t.length&&i<r.length;i++){const s=Lr(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Yc(n,e){if(pr(n)!==pr(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function ln(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(pr(n)>pr(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class ry{constructor(e,t){this.errorPrefix_=t,this.parts_=Gi(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Eo(this.parts_[r]);Ld(this)}}function iy(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Eo(e),Ld(n)}function sy(n){const e=n.parts_.pop();n.byteLength_-=Eo(e),n.parts_.length>0&&(n.byteLength_-=1)}function Ld(n){if(n.byteLength_>Ou)throw new Error(n.errorPrefix_+"has a key path longer than "+Ou+" bytes ("+n.byteLength_+").");if(n.parts_.length>Lu)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Lu+") or object contains a cycle "+wr(n))}function wr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc extends Bd{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new Jc}getInitialEvent(e){return z(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mi=1e3,oy=60*5*1e3,Du=30*1e3,ay=1.3,cy=3e4,ly="server_kill",Fu=3;class Wn extends Nd{constructor(e,t,r,i,s,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Wn.nextPersistentConnectionId_++,this.log_=cs("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Mi,this.maxReconnectDelay_=oy,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Jc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Gs.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_(It(s)),z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new ss,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),t.promise}listen(e,t,r,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),z(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:r};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r},o="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const c=a.d,h=a.s;Wn.warnOnListenWarnings_(c,t),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",a),h!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&An(e,"w")){const r=ai(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();qt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Zg(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Du)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Jg(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,i=>{const s=i.s,o=i.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,t)}sendUnlisten_(e,t,r,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e},o="n";i&&(s.q=r,s.t=i),this.sendRequest(o,s)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,i){const s={p:t,d:r};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,r,i){this.putInternal("p",e,t,r,i)}merge(e,t,r,i){this.putInternal("m",e,t,r,i)}putInternal(e,t,r,i,s){this.initConnection_();const o={p:t,d:r};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const s=r.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+It(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):oc("Unrecognized action received from server: "+It(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Mi,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Mi,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>cy&&(this.reconnectDelay_=Mi),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*ay)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Wn.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},h=function(y){z(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(y)};this.realtime_={close:c,sendRequest:h};const g=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[y,E]=await Promise.all([this.authTokenProvider_.getToken(g),this.appCheckTokenProvider_.getToken(g)]);o?Pt("getToken() completed but was canceled"):(Pt("getToken() completed. Creating connection."),this.authToken_=y&&y.accessToken,this.appCheckToken_=E&&E.token,a=new ey(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,x=>{qt(x+" ("+this.repoInfo_.toString()+")"),this.interrupt(ly)},s))}catch(y){this.log_("Failed to get token: "+y),o||(this.repoInfo_.nodeAdmin&&qt(y),c())}}}interrupt(e){Pt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Pt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ec(this.interruptReasons_)&&(this.reconnectDelay_=Mi,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(s=>qc(s)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const r=new Le(e).toString();let i;if(this.listens.has(r)){const s=this.listens.get(r);i=s.get(t),s.delete(t),s.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,t){Pt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Fu&&(this.reconnectDelay_=Du,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Pt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Fu&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+hd.replace(/\./g,"-")]=1,Fc()?e["framework.cordova"]=1:sd()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Gs.getInstance().currentlyOnline();return ec(this.interruptReasons_)&&e}}Wn.nextPersistentConnectionId_=0;Wn.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ee(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new Ee(ci,e),i=new Ee(ci,t);return this.compare(r,i)!==0}minPost(){return Ee.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vs;class Od extends Io{static get __EMPTY_NODE(){return vs}static set __EMPTY_NODE(e){vs=e}compare(e,t){return Lr(e.name,t.name)}isDefinedOn(e){throw _i("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ee.MIN}maxPost(){return new Ee(Cr,vs)}makePost(e,t){return z(typeof e=="string","KeyIndex indexValue must always be a string."),new Ee(e,vs)}toString(){return".key"}}const Qr=new Od;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class At{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??At.RED,this.left=i??Zt.EMPTY_NODE,this.right=s??Zt.EMPTY_NODE}copy(e,t,r,i,s){return new At(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return s<0?i=i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Zt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,i;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Zt.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,At.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,At.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}At.RED=!0;At.BLACK=!1;class uy{copy(e,t,r,i,s){return this}insert(e,t,r){return new At(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Zt{constructor(e,t=Zt.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Zt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,At.BLACK,null,null))}remove(e){return new Zt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,At.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Es(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Es(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Es(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Es(this.root_,null,this.comparator_,!0,e)}}Zt.EMPTY_NODE=new uy;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hy(n,e){return Lr(n.name,e.name)}function Zc(n,e){return Lr(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cc;function dy(n){cc=n}const Dd=function(n){return typeof n=="number"?"number:"+gd(n):"string:"+n},Fd=function(n){if(n.isLeafNode()){const e=n.val();z(typeof e=="string"||typeof e=="number"||typeof e=="object"&&An(e,".sv"),"Priority must be a string or number.")}else z(n===cc||n.isEmpty(),"priority of unexpected type.");z(n===cc||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uu;class kt{constructor(e,t=kt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,z(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Fd(this.priorityNode_)}static set __childrenNodeConstructor(e){Uu=e}static get __childrenNodeConstructor(){return Uu}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new kt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:kt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return xe(e)?this:ve(e)===".priority"?this.priorityNode_:kt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:kt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=ve(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(z(r!==".priority"||pr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,kt.__childrenNodeConstructor.EMPTY_NODE.updateChild(He(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Dd(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=gd(this.value_):e+=this.value_,this.lazyHash_=fd(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===kt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof kt.__childrenNodeConstructor?-1:(z(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,i=kt.VALUE_TYPE_ORDER.indexOf(t),s=kt.VALUE_TYPE_ORDER.indexOf(r);return z(i>=0,"Unknown leaf type: "+t),z(s>=0,"Unknown leaf type: "+r),i===s?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}kt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ud,Wd;function fy(n){Ud=n}function py(n){Wd=n}class gy extends Io{compare(e,t){const r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?Lr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ee.MIN}maxPost(){return new Ee(Cr,new kt("[PRIORITY-POST]",Wd))}makePost(e,t){const r=Ud(e);return new Ee(t,new kt("[PRIORITY-POST]",r))}toString(){return".priority"}}const et=new gy;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const my=Math.log(2);class yy{constructor(e){const t=s=>parseInt(Math.log(s)/my,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const js=function(n,e,t,r){n.sort(e);const i=function(c,h){const g=h-c;let y,E;if(g===0)return null;if(g===1)return y=n[c],E=t?t(y):y,new At(E,y.node,At.BLACK,null,null);{const x=parseInt(g/2,10)+c,T=i(c,x),R=i(x+1,h);return y=n[x],E=t?t(y):y,new At(E,y.node,At.BLACK,T,R)}},s=function(c){let h=null,g=null,y=n.length;const E=function(T,R){const A=y-T,D=y;y-=T;const U=i(A+1,D),L=n[A],q=t?t(L):L;x(new At(q,L.node,R,null,U))},x=function(T){h?(h.left=T,h=T):(g=T,h=T)};for(let T=0;T<c.count;++T){const R=c.nextBitIsOne(),A=Math.pow(2,c.count-(T+1));R?E(A,At.BLACK):(E(A,At.BLACK),E(A,At.RED))}return g},o=new yy(n.length),a=s(o);return new Zt(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Aa;const $r={};class On{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return z($r&&et,"ChildrenNode.ts has not been loaded"),Aa=Aa||new On({".priority":$r},{".priority":et}),Aa}get(e){const t=ai(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Zt?t:null}hasIndex(e){return An(this.indexSet_,e.toString())}addIndex(e,t){z(e!==Qr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const s=t.getIterator(Ee.Wrap);let o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=js(r,e.getCompare()):a=$r;const c=e.toString(),h=Object.assign({},this.indexSet_);h[c]=e;const g=Object.assign({},this.indexes_);return g[c]=a,new On(g,h)}addToIndexes(e,t){const r=zs(this.indexes_,(i,s)=>{const o=ai(this.indexSet_,s);if(z(o,"Missing index implementation for "+s),i===$r)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(Ee.Wrap);let h=c.getNext();for(;h;)h.name!==e.name&&a.push(h),h=c.getNext();return a.push(e),js(a,o.getCompare())}else return $r;else{const a=t.get(e.name);let c=i;return a&&(c=c.remove(new Ee(e.name,a))),c.insert(e,e.node)}});return new On(r,this.indexSet_)}removeFromIndexes(e,t){const r=zs(this.indexes_,i=>{if(i===$r)return i;{const s=t.get(e.name);return s?i.remove(new Ee(e.name,s)):i}});return new On(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ni;class ae{constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Fd(this.priorityNode_),this.children_.isEmpty()&&z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ni||(Ni=new ae(new Zt(Zc),null,On.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ni}updatePriority(e){return this.children_.isEmpty()?this:new ae(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Ni:t}}getChild(e){const t=ve(e);return t===null?this:this.getImmediateChild(t).getChild(He(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(z(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new Ee(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?Ni:this.priorityNode_;return new ae(i,o,s)}}updateChild(e,t){const r=ve(e);if(r===null)return t;{z(ve(e)!==".priority"||pr(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(He(e),t);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,i=0,s=!0;if(this.forEachChild(et,(o,a)=>{t[o]=a.val(e),r++,s&&ae.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!e&&s&&i<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Dd(this.getPriority().val())+":"),this.forEachChild(et,(t,r)=>{const i=r.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":fd(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const i=this.resolveIndex_(r);if(i){const s=i.getPredecessorKey(new Ee(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ee(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ee(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ee.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)<0;)i.getNext(),s=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ee.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)>0;)i.getNext(),s=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ls?-1:0}withIndex(e){if(e===Qr||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ae(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Qr||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(et),i=t.getIterator(et);let s=r.getNext(),o=i.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=r.getNext(),o=i.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Qr?null:this.indexMap_.get(e.toString())}}ae.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class _y extends ae{constructor(){super(new Zt(Zc),ae.EMPTY_NODE,On.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ae.EMPTY_NODE}isEmpty(){return!1}}const ls=new _y;Object.defineProperties(Ee,{MIN:{value:new Ee(ci,ae.EMPTY_NODE)},MAX:{value:new Ee(Cr,ls)}});Od.__EMPTY_NODE=ae.EMPTY_NODE;kt.__childrenNodeConstructor=ae;dy(ls);py(ls);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wy=!0;function St(n,e=null){if(n===null)return ae.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),z(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new kt(t,St(e))}if(!(n instanceof Array)&&wy){const t=[];let r=!1;if(Ot(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=St(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new Ee(o,c)))}}),t.length===0)return ae.EMPTY_NODE;const s=js(t,hy,o=>o.name,Zc);if(r){const o=js(t,et.getCompare());return new ae(s,St(e),new On({".priority":o},{".priority":et}))}else return new ae(s,St(e),On.Default)}else{let t=ae.EMPTY_NODE;return Ot(n,(r,i)=>{if(An(n,r)&&r.substring(0,1)!=="."){const s=St(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(St(e))}}fy(St);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by extends Io{constructor(e){super(),this.indexPath_=e,z(!xe(e)&&ve(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?Lr(e.name,t.name):s}makePost(e,t){const r=St(e),i=ae.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ee(t,i)}maxPost(){const e=ae.EMPTY_NODE.updateChild(this.indexPath_,ls);return new Ee(Cr,e)}toString(){return Gi(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vy extends Io{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Lr(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ee.MIN}maxPost(){return Ee.MAX}makePost(e,t){const r=St(e);return new Ee(t,r)}toString(){return".value"}}const Ey=new vy;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(n){return{type:"value",snapshotNode:n}}function li(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ji(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ki(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Sy(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){z(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(ji(t,a)):z(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(li(t,r)):o.trackChildChange(Ki(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(et,(i,s)=>{t.hasChild(i)||r.trackChildChange(ji(i,s))}),t.isLeafNode()||t.forEachChild(et,(i,s)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Ki(i,s,o))}else r.trackChildChange(li(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ae.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e){this.indexedFilter_=new Xc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Yi.getStartPost_(e),this.endPost_=Yi.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new Ee(t,r))||(r=ae.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=ae.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(ae.EMPTY_NODE);const s=this;return t.forEachChild(et,(o,a)=>{s.matches(new Ee(o,a))||(i=i.updateImmediateChild(o,ae.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Yi(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new Ee(t,r))||(r=ae.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=ae.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=ae.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(ae.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,ae.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){const y=this.index_.getCompare();o=(E,x)=>y(x,E)}else o=this.index_.getCompare();const a=e;z(a.numChildren()===this.limit_,"");const c=new Ee(t,r),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),g=this.rangedFilter_.matches(c);if(a.hasChild(t)){const y=a.getImmediateChild(t);let E=i.getChildAfterChild(this.index_,h,this.reverse_);for(;E!=null&&(E.name===t||a.hasChild(E.name));)E=i.getChildAfterChild(this.index_,E,this.reverse_);const x=E==null?1:o(E,c);if(g&&!r.isEmpty()&&x>=0)return s!=null&&s.trackChildChange(Ki(t,r,y)),a.updateImmediateChild(t,r);{s!=null&&s.trackChildChange(ji(t,y));const R=a.updateImmediateChild(t,ae.EMPTY_NODE);return E!=null&&this.rangedFilter_.matches(E)?(s!=null&&s.trackChildChange(li(E.name,E.node)),R.updateImmediateChild(E.name,E.node)):R}}else return r.isEmpty()?e:g&&o(h,c)>=0?(s!=null&&(s.trackChildChange(ji(h.name,h.node)),s.trackChildChange(li(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(h.name,ae.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=et}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return z(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ci}hasEnd(){return this.endSet_}getIndexEndValue(){return z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return z(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Cr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===et}copy(){const e=new Qc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function xy(n){return n.loadsAllData()?new Xc(n.getIndex()):n.hasLimit()?new Iy(n):new Yi(n)}function Wu(n){const e={};if(n.isDefault())return e;let t;if(n.index_===et?t="$priority":n.index_===Ey?t="$value":n.index_===Qr?t="$key":(z(n.index_ instanceof by,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=It(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=It(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+It(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=It(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+It(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Hu(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==et&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks extends Nd{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=cs("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(z(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=Ks.getListenId_(e,r),a={};this.listens_[o]=a;const c=Wu(e._queryParams);this.restRequest_(s+".json",c,(h,g)=>{let y=g;if(h===404&&(y=null,h=null),h===null&&this.onDataUpdate_(s,y,!1,r),ai(this.listens_,o)===a){let E;h?h===401?E="permission_denied":E="rest_error:"+h:E="ok",i(E,null)}})}unlisten(e,t){const r=Ks.getListenId_(e,t);delete this.listens_[r]}get(e){const t=Wu(e._queryParams),r=e._path.toString(),i=new ss;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+wi(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=$i(a.responseText)}catch{qt("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&qt("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(){this.rootNode_=ae.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ys(){return{value:null,children:new Map}}function zd(n,e,t){if(xe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=ve(e);n.children.has(r)||n.children.set(r,Ys());const i=n.children.get(r);e=He(e),zd(i,e,t)}}function lc(n,e,t){n.value!==null?t(e,n.value):Ay(n,(r,i)=>{const s=new Le(e.toString()+"/"+r);lc(i,s,t)})}function Ay(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ot(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zu=10*1e3,Ty=30*1e3,Ry=5*60*1e3;class My{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Cy(e);const r=zu+(Ty-zu)*Math.random();Fi(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Ot(e,(i,s)=>{s>0&&An(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Fi(this.reportStats_.bind(this),Math.floor(Math.random()*2*Ry))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gn;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(gn||(gn={}));function el(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tl(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function nl(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=gn.ACK_USER_WRITE,this.source=el()}operationForChild(e){if(xe(this.path)){if(this.affectedTree.value!=null)return z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Le(e));return new Js(Te(),t,this.revert)}}else return z(ve(this.path)===e,"operationForChild called for unrelated child."),new Js(He(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e,t){this.source=e,this.path=t,this.type=gn.LISTEN_COMPLETE}operationForChild(e){return xe(this.path)?new Ji(this.source,Te()):new Ji(this.source,He(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=gn.OVERWRITE}operationForChild(e){return xe(this.path)?new Tr(this.source,Te(),this.snap.getImmediateChild(e)):new Tr(this.source,He(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=gn.MERGE}operationForChild(e){if(xe(this.path)){const t=this.children.subtree(new Le(e));return t.isEmpty()?null:t.value?new Tr(this.source,Te(),t.value):new ui(this.source,Te(),t)}else return z(ve(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ui(this.source,He(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(xe(e))return this.isFullyInitialized()&&!this.filtered_;const t=ve(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ny{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function By(n,e,t,r){const i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Sy(o.childName,o.snapshotNode))}),Bi(n,i,"child_removed",e,r,t),Bi(n,i,"child_added",e,r,t),Bi(n,i,"child_moved",s,r,t),Bi(n,i,"child_changed",e,r,t),Bi(n,i,"value",e,r,t),i}function Bi(n,e,t,r,i,s){const o=r.filter(a=>a.type===t);o.sort((a,c)=>Ly(n,a,c)),o.forEach(a=>{const c=Py(n,a,s);i.forEach(h=>{h.respondsTo(a.type)&&e.push(h.createEvent(c,n.query_))})})}function Py(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Ly(n,e,t){if(e.childName==null||t.childName==null)throw _i("Should only compare child_ events.");const r=new Ee(e.childName,e.snapshotNode),i=new Ee(t.childName,t.snapshotNode);return n.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(n,e){return{eventCache:n,serverCache:e}}function Ui(n,e,t,r){return xo(new gr(e,t,r),n.serverCache)}function $d(n,e,t,r){return xo(n.eventCache,new gr(e,t,r))}function Zs(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Rr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ca;const Oy=()=>(Ca||(Ca=new Zt(b0)),Ca);class We{constructor(e,t=Oy()){this.value=e,this.children=t}static fromObject(e){let t=new We(null);return Ot(e,(r,i)=>{t=t.set(new Le(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Te(),value:this.value};if(xe(e))return null;{const r=ve(e),i=this.children.get(r);if(i!==null){const s=i.findRootMostMatchingPathAndValue(He(e),t);return s!=null?{path:Qe(new Le(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(xe(e))return this;{const t=ve(e),r=this.children.get(t);return r!==null?r.subtree(He(e)):new We(null)}}set(e,t){if(xe(e))return new We(t,this.children);{const r=ve(e),s=(this.children.get(r)||new We(null)).set(He(e),t),o=this.children.insert(r,s);return new We(this.value,o)}}remove(e){if(xe(e))return this.children.isEmpty()?new We(null):new We(null,this.children);{const t=ve(e),r=this.children.get(t);if(r){const i=r.remove(He(e));let s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new We(null):new We(this.value,s)}else return this}}get(e){if(xe(e))return this.value;{const t=ve(e),r=this.children.get(t);return r?r.get(He(e)):null}}setTree(e,t){if(xe(e))return t;{const r=ve(e),s=(this.children.get(r)||new We(null)).setTree(He(e),t);let o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new We(this.value,o)}}fold(e){return this.fold_(Te(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(Qe(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Te(),t)}findOnPath_(e,t,r){const i=this.value?r(t,this.value):!1;if(i)return i;if(xe(e))return null;{const s=ve(e),o=this.children.get(s);return o?o.findOnPath_(He(e),Qe(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Te(),t)}foreachOnPath_(e,t,r){if(xe(e))return this;{this.value&&r(t,this.value);const i=ve(e),s=this.children.get(i);return s?s.foreachOnPath_(He(e),Qe(t,i),r):new We(null)}}foreach(e){this.foreach_(Te(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(Qe(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e){this.writeTree_=e}static empty(){return new mn(new We(null))}}function Wi(n,e,t){if(xe(e))return new mn(new We(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let s=r.value;const o=Ht(i,e);return s=s.updateChild(o,t),new mn(n.writeTree_.set(i,s))}else{const i=new We(t),s=n.writeTree_.setTree(e,i);return new mn(s)}}}function uc(n,e,t){let r=n;return Ot(t,(i,s)=>{r=Wi(r,Qe(e,i),s)}),r}function $u(n,e){if(xe(e))return mn.empty();{const t=n.writeTree_.setTree(e,new We(null));return new mn(t)}}function hc(n,e){return Or(n,e)!=null}function Or(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Ht(t.path,e)):null}function qu(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(et,(r,i)=>{e.push(new Ee(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new Ee(r,i.value))}),e}function ur(n,e){if(xe(e))return n;{const t=Or(n,e);return t!=null?new mn(new We(t)):new mn(n.writeTree_.subtree(e))}}function dc(n){return n.writeTree_.isEmpty()}function hi(n,e){return qd(Te(),n.writeTree_,e)}function qd(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(z(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=qd(Qe(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Qe(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ko(n,e){return Kd(e,n)}function Dy(n,e,t,r,i){z(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Wi(n.visibleWrites,e,t)),n.lastWriteId=r}function Fy(n,e,t,r){z(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=uc(n.visibleWrites,e,t),n.lastWriteId=r}function Uy(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function Wy(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);z(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Hy(a,r.path)?i=!1:ln(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return zy(n),!0;if(r.snap)n.visibleWrites=$u(n.visibleWrites,r.path);else{const a=r.children;Ot(a,c=>{n.visibleWrites=$u(n.visibleWrites,Qe(r.path,c))})}return!0}else return!1}function Hy(n,e){if(n.snap)return ln(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&ln(Qe(n.path,t),e))return!0;return!1}function zy(n){n.visibleWrites=Vd(n.allWrites,$y,Te()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function $y(n){return n.visible}function Vd(n,e,t){let r=mn.empty();for(let i=0;i<n.length;++i){const s=n[i];if(e(s)){const o=s.path;let a;if(s.snap)ln(t,o)?(a=Ht(t,o),r=Wi(r,a,s.snap)):ln(o,t)&&(a=Ht(o,t),r=Wi(r,Te(),s.snap.getChild(a)));else if(s.children){if(ln(t,o))a=Ht(t,o),r=uc(r,a,s.children);else if(ln(o,t))if(a=Ht(o,t),xe(a))r=uc(r,Te(),s.children);else{const c=ai(s.children,ve(a));if(c){const h=c.getChild(He(a));r=Wi(r,Te(),h)}}}else throw _i("WriteRecord should have .snap or .children")}}return r}function Gd(n,e,t,r,i){if(!r&&!i){const s=Or(n.visibleWrites,e);if(s!=null)return s;{const o=ur(n.visibleWrites,e);if(dc(o))return t;if(t==null&&!hc(o,Te()))return null;{const a=t||ae.EMPTY_NODE;return hi(o,a)}}}else{const s=ur(n.visibleWrites,e);if(!i&&dc(s))return t;if(!i&&t==null&&!hc(s,Te()))return null;{const o=function(h){return(h.visible||i)&&(!r||!~r.indexOf(h.writeId))&&(ln(h.path,e)||ln(e,h.path))},a=Vd(n.allWrites,o,e),c=t||ae.EMPTY_NODE;return hi(a,c)}}}function qy(n,e,t){let r=ae.EMPTY_NODE;const i=Or(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(et,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){const s=ur(n.visibleWrites,e);return t.forEachChild(et,(o,a)=>{const c=hi(ur(s,new Le(o)),a);r=r.updateImmediateChild(o,c)}),qu(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const s=ur(n.visibleWrites,e);return qu(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function Vy(n,e,t,r,i){z(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=Qe(e,t);if(hc(n.visibleWrites,s))return null;{const o=ur(n.visibleWrites,s);return dc(o)?i.getChild(t):hi(o,i.getChild(t))}}function Gy(n,e,t,r){const i=Qe(e,t),s=Or(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){const o=ur(n.visibleWrites,i);return hi(o,r.getNode().getImmediateChild(t))}else return null}function jy(n,e){return Or(n.visibleWrites,e)}function Ky(n,e,t,r,i,s,o){let a;const c=ur(n.visibleWrites,e),h=Or(c,Te());if(h!=null)a=h;else if(t!=null)a=hi(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const g=[],y=o.getCompare(),E=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let x=E.getNext();for(;x&&g.length<i;)y(x,r)!==0&&g.push(x),x=E.getNext();return g}else return[]}function Yy(){return{visibleWrites:mn.empty(),allWrites:[],lastWriteId:-1}}function Xs(n,e,t,r){return Gd(n.writeTree,n.treePath,e,t,r)}function rl(n,e){return qy(n.writeTree,n.treePath,e)}function Vu(n,e,t,r){return Vy(n.writeTree,n.treePath,e,t,r)}function Qs(n,e){return jy(n.writeTree,Qe(n.treePath,e))}function Jy(n,e,t,r,i,s){return Ky(n.writeTree,n.treePath,e,t,r,i,s)}function il(n,e,t){return Gy(n.writeTree,n.treePath,e,t)}function jd(n,e){return Kd(Qe(n.treePath,e),n.writeTree)}function Kd(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;z(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),z(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Ki(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,ji(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,li(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Ki(r,e.snapshotNode,i.oldSnap));else throw _i("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const Yd=new Xy;class sl{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new gr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return il(this.writes_,e,r)}}getChildAfterChild(e,t,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Rr(this.viewCache_),s=Jy(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(n){return{filter:n}}function e_(n,e){z(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),z(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function t_(n,e,t,r,i){const s=new Zy;let o,a;if(t.type===gn.OVERWRITE){const h=t;h.source.fromUser?o=fc(n,e,h.path,h.snap,r,i,s):(z(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered()&&!xe(h.path),o=eo(n,e,h.path,h.snap,r,i,a,s))}else if(t.type===gn.MERGE){const h=t;h.source.fromUser?o=r_(n,e,h.path,h.children,r,i,s):(z(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),o=pc(n,e,h.path,h.children,r,i,a,s))}else if(t.type===gn.ACK_USER_WRITE){const h=t;h.revert?o=o_(n,e,h.path,r,i,s):o=i_(n,e,h.path,h.affectedTree,r,i,s)}else if(t.type===gn.LISTEN_COMPLETE)o=s_(n,e,t.path,r,s);else throw _i("Unknown operation type: "+t.type);const c=s.getChanges();return n_(e,o,c),{viewCache:o,changes:c}}function n_(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Zs(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(Hd(Zs(e)))}}function Jd(n,e,t,r,i,s){const o=e.eventCache;if(Qs(r,t)!=null)return e;{let a,c;if(xe(t))if(z(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=Rr(e),g=h instanceof ae?h:ae.EMPTY_NODE,y=rl(r,g);a=n.filter.updateFullNode(e.eventCache.getNode(),y,s)}else{const h=Xs(r,Rr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{const h=ve(t);if(h===".priority"){z(pr(t)===1,"Can't have a priority with additional path components");const g=o.getNode();c=e.serverCache.getNode();const y=Vu(r,t,g,c);y!=null?a=n.filter.updatePriority(g,y):a=o.getNode()}else{const g=He(t);let y;if(o.isCompleteForChild(h)){c=e.serverCache.getNode();const E=Vu(r,t,o.getNode(),c);E!=null?y=o.getNode().getImmediateChild(h).updateChild(g,E):y=o.getNode().getImmediateChild(h)}else y=il(r,h,e.serverCache);y!=null?a=n.filter.updateChild(o.getNode(),h,y,g,i,s):a=o.getNode()}}return Ui(e,a,o.isFullyInitialized()||xe(t),n.filter.filtersNodes())}}function eo(n,e,t,r,i,s,o,a){const c=e.serverCache;let h;const g=o?n.filter:n.filter.getIndexedFilter();if(xe(t))h=g.updateFullNode(c.getNode(),r,null);else if(g.filtersNodes()&&!c.isFiltered()){const x=c.getNode().updateChild(t,r);h=g.updateFullNode(c.getNode(),x,null)}else{const x=ve(t);if(!c.isCompleteForPath(t)&&pr(t)>1)return e;const T=He(t),A=c.getNode().getImmediateChild(x).updateChild(T,r);x===".priority"?h=g.updatePriority(c.getNode(),A):h=g.updateChild(c.getNode(),x,A,T,Yd,null)}const y=$d(e,h,c.isFullyInitialized()||xe(t),g.filtersNodes()),E=new sl(i,y,s);return Jd(n,y,t,i,E,a)}function fc(n,e,t,r,i,s,o){const a=e.eventCache;let c,h;const g=new sl(i,e,s);if(xe(t))h=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Ui(e,h,!0,n.filter.filtersNodes());else{const y=ve(t);if(y===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),r),c=Ui(e,h,a.isFullyInitialized(),a.isFiltered());else{const E=He(t),x=a.getNode().getImmediateChild(y);let T;if(xe(E))T=r;else{const R=g.getCompleteChild(y);R!=null?Kc(E)===".priority"&&R.getChild(Pd(E)).isEmpty()?T=R:T=R.updateChild(E,r):T=ae.EMPTY_NODE}if(x.equals(T))c=e;else{const R=n.filter.updateChild(a.getNode(),y,T,E,g,o);c=Ui(e,R,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Gu(n,e){return n.eventCache.isCompleteForChild(e)}function r_(n,e,t,r,i,s,o){let a=e;return r.foreach((c,h)=>{const g=Qe(t,c);Gu(e,ve(g))&&(a=fc(n,a,g,h,i,s,o))}),r.foreach((c,h)=>{const g=Qe(t,c);Gu(e,ve(g))||(a=fc(n,a,g,h,i,s,o))}),a}function ju(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function pc(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,h;xe(t)?h=r:h=new We(null).setTree(t,r);const g=e.serverCache.getNode();return h.children.inorderTraversal((y,E)=>{if(g.hasChild(y)){const x=e.serverCache.getNode().getImmediateChild(y),T=ju(n,x,E);c=eo(n,c,new Le(y),T,i,s,o,a)}}),h.children.inorderTraversal((y,E)=>{const x=!e.serverCache.isCompleteForChild(y)&&E.value===null;if(!g.hasChild(y)&&!x){const T=e.serverCache.getNode().getImmediateChild(y),R=ju(n,T,E);c=eo(n,c,new Le(y),R,i,s,o,a)}}),c}function i_(n,e,t,r,i,s,o){if(Qs(i,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(xe(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return eo(n,e,t,c.getNode().getChild(t),i,s,a,o);if(xe(t)){let h=new We(null);return c.getNode().forEachChild(Qr,(g,y)=>{h=h.set(new Le(g),y)}),pc(n,e,t,h,i,s,a,o)}else return e}else{let h=new We(null);return r.foreach((g,y)=>{const E=Qe(t,g);c.isCompleteForPath(E)&&(h=h.set(g,c.getNode().getChild(E)))}),pc(n,e,t,h,i,s,a,o)}}function s_(n,e,t,r,i){const s=e.serverCache,o=$d(e,s.getNode(),s.isFullyInitialized()||xe(t),s.isFiltered());return Jd(n,o,t,r,Yd,i)}function o_(n,e,t,r,i,s){let o;if(Qs(r,t)!=null)return e;{const a=new sl(r,e,i),c=e.eventCache.getNode();let h;if(xe(t)||ve(t)===".priority"){let g;if(e.serverCache.isFullyInitialized())g=Xs(r,Rr(e));else{const y=e.serverCache.getNode();z(y instanceof ae,"serverChildren would be complete if leaf node"),g=rl(r,y)}g=g,h=n.filter.updateFullNode(c,g,s)}else{const g=ve(t);let y=il(r,g,e.serverCache);y==null&&e.serverCache.isCompleteForChild(g)&&(y=c.getImmediateChild(g)),y!=null?h=n.filter.updateChild(c,g,y,He(t),a,s):e.eventCache.getNode().hasChild(g)?h=n.filter.updateChild(c,g,ae.EMPTY_NODE,He(t),a,s):h=c,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Xs(r,Rr(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,s)))}return o=e.serverCache.isFullyInitialized()||Qs(r,Te())!=null,Ui(e,h,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new Xc(r.getIndex()),s=xy(r);this.processor_=Qy(s);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(ae.EMPTY_NODE,o.getNode(),null),h=s.updateFullNode(ae.EMPTY_NODE,a.getNode(),null),g=new gr(c,o.isFullyInitialized(),i.filtersNodes()),y=new gr(h,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=xo(y,g),this.eventGenerator_=new Ny(this.query_)}get query(){return this.query_}}function c_(n){return n.viewCache_.serverCache.getNode()}function l_(n){return Zs(n.viewCache_)}function u_(n,e){const t=Rr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!xe(e)&&!t.getImmediateChild(ve(e)).isEmpty())?t.getChild(e):null}function Ku(n){return n.eventRegistrations_.length===0}function h_(n,e){n.eventRegistrations_.push(e)}function Yu(n,e,t){const r=[];if(t){z(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){const o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function Ju(n,e,t,r){e.type===gn.MERGE&&e.source.queryId!==null&&(z(Rr(n.viewCache_),"We should always have a full cache before handling merges"),z(Zs(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,s=t_(n.processor_,i,e,t,r);return e_(n.processor_,s.viewCache),z(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,Zd(n,s.changes,s.viewCache.eventCache.getNode(),null)}function d_(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(et,(s,o)=>{r.push(li(s,o))}),t.isFullyInitialized()&&r.push(Hd(t.getNode())),Zd(n,r,t.getNode(),e)}function Zd(n,e,t,r){const i=r?[r]:n.eventRegistrations_;return By(n.eventGenerator_,e,t,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let to;class Xd{constructor(){this.views=new Map}}function f_(n){z(!to,"__referenceConstructor has already been defined"),to=n}function p_(){return z(to,"Reference.ts has not been loaded"),to}function g_(n){return n.views.size===0}function ol(n,e,t,r){const i=e.source.queryId;if(i!==null){const s=n.views.get(i);return z(s!=null,"SyncTree gave us an op for an invalid query."),Ju(s,e,t,r)}else{let s=[];for(const o of n.views.values())s=s.concat(Ju(o,e,t,r));return s}}function Qd(n,e,t,r,i){const s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Xs(t,i?r:null),c=!1;a?c=!0:r instanceof ae?(a=rl(t,r),c=!1):(a=ae.EMPTY_NODE,c=!1);const h=xo(new gr(a,c,!1),new gr(r,i,!1));return new a_(e,h)}return o}function m_(n,e,t,r,i,s){const o=Qd(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),h_(o,t),d_(o,t)}function y_(n,e,t,r){const i=e._queryIdentifier,s=[];let o=[];const a=mr(n);if(i==="default")for(const[c,h]of n.views.entries())o=o.concat(Yu(h,t,r)),Ku(h)&&(n.views.delete(c),h.query._queryParams.loadsAllData()||s.push(h.query));else{const c=n.views.get(i);c&&(o=o.concat(Yu(c,t,r)),Ku(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!mr(n)&&s.push(new(p_())(e._repo,e._path)),{removed:s,events:o}}function ef(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function hr(n,e){let t=null;for(const r of n.views.values())t=t||u_(r,e);return t}function tf(n,e){if(e._queryParams.loadsAllData())return Ao(n);{const r=e._queryIdentifier;return n.views.get(r)}}function nf(n,e){return tf(n,e)!=null}function mr(n){return Ao(n)!=null}function Ao(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let no;function __(n){z(!no,"__referenceConstructor has already been defined"),no=n}function w_(){return z(no,"Reference.ts has not been loaded"),no}let b_=1;class Zu{constructor(e){this.listenProvider_=e,this.syncPointTree_=new We(null),this.pendingWriteTree_=Yy(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function rf(n,e,t,r,i){return Dy(n.pendingWriteTree_,e,t,r,i),i?Ei(n,new Tr(el(),e,t)):[]}function v_(n,e,t,r){Fy(n.pendingWriteTree_,e,t,r);const i=We.fromObject(t);return Ei(n,new ui(el(),e,i))}function sr(n,e,t=!1){const r=Uy(n.pendingWriteTree_,e);if(Wy(n.pendingWriteTree_,e)){let s=new We(null);return r.snap!=null?s=s.set(Te(),!0):Ot(r.children,o=>{s=s.set(new Le(o),!0)}),Ei(n,new Js(r.path,s,t))}else return[]}function us(n,e,t){return Ei(n,new Tr(tl(),e,t))}function E_(n,e,t){const r=We.fromObject(t);return Ei(n,new ui(tl(),e,r))}function S_(n,e){return Ei(n,new Ji(tl(),e))}function I_(n,e,t){const r=cl(n,t);if(r){const i=ll(r),s=i.path,o=i.queryId,a=Ht(s,e),c=new Ji(nl(o),a);return ul(n,s,c)}else return[]}function ro(n,e,t,r,i=!1){const s=e._path,o=n.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||nf(o,e))){const c=y_(o,e,t,r);g_(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));const h=c.removed;if(a=c.events,!i){const g=h.findIndex(E=>E._queryParams.loadsAllData())!==-1,y=n.syncPointTree_.findOnPath(s,(E,x)=>mr(x));if(g&&!y){const E=n.syncPointTree_.subtree(s);if(!E.isEmpty()){const x=A_(E);for(let T=0;T<x.length;++T){const R=x[T],A=R.query,D=cf(n,R);n.listenProvider_.startListening(Hi(A),Zi(n,A),D.hashFn,D.onComplete)}}}!y&&h.length>0&&!r&&(g?n.listenProvider_.stopListening(Hi(e),null):h.forEach(E=>{const x=n.queryToTagMap.get(Co(E));n.listenProvider_.stopListening(Hi(E),x)}))}C_(n,h)}return a}function sf(n,e,t,r){const i=cl(n,r);if(i!=null){const s=ll(i),o=s.path,a=s.queryId,c=Ht(o,e),h=new Tr(nl(a),c,t);return ul(n,o,h)}else return[]}function x_(n,e,t,r){const i=cl(n,r);if(i){const s=ll(i),o=s.path,a=s.queryId,c=Ht(o,e),h=We.fromObject(t),g=new ui(nl(a),c,h);return ul(n,o,g)}else return[]}function gc(n,e,t,r=!1){const i=e._path;let s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(E,x)=>{const T=Ht(E,i);s=s||hr(x,T),o=o||mr(x)});let a=n.syncPointTree_.get(i);a?(o=o||mr(a),s=s||hr(a,Te())):(a=new Xd,n.syncPointTree_=n.syncPointTree_.set(i,a));let c;s!=null?c=!0:(c=!1,s=ae.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((x,T)=>{const R=hr(T,Te());R&&(s=s.updateImmediateChild(x,R))}));const h=nf(a,e);if(!h&&!e._queryParams.loadsAllData()){const E=Co(e);z(!n.queryToTagMap.has(E),"View does not exist, but we have a tag");const x=T_();n.queryToTagMap.set(E,x),n.tagToQueryMap.set(x,E)}const g=ko(n.pendingWriteTree_,i);let y=m_(a,e,t,g,s,c);if(!h&&!o&&!r){const E=tf(a,e);y=y.concat(R_(n,e,E))}return y}function al(n,e,t){const i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=Ht(o,e),h=hr(a,c);if(h)return h});return Gd(i,e,s,t,!0)}function k_(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(h,g)=>{const y=Ht(h,t);r=r||hr(g,y)});let i=n.syncPointTree_.get(t);i?r=r||hr(i,Te()):(i=new Xd,n.syncPointTree_=n.syncPointTree_.set(t,i));const s=r!=null,o=s?new gr(r,!0,!1):null,a=ko(n.pendingWriteTree_,e._path),c=Qd(i,e,a,s?o.getNode():ae.EMPTY_NODE,s);return l_(c)}function Ei(n,e){return of(e,n.syncPointTree_,null,ko(n.pendingWriteTree_,Te()))}function of(n,e,t,r){if(xe(n.path))return af(n,e,t,r);{const i=e.get(Te());t==null&&i!=null&&(t=hr(i,Te()));let s=[];const o=ve(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const h=t?t.getImmediateChild(o):null,g=jd(r,o);s=s.concat(of(a,c,h,g))}return i&&(s=s.concat(ol(i,n,r,t))),s}}function af(n,e,t,r){const i=e.get(Te());t==null&&i!=null&&(t=hr(i,Te()));let s=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,h=jd(r,o),g=n.operationForChild(o);g&&(s=s.concat(af(g,a,c,h)))}),i&&(s=s.concat(ol(i,n,r,t))),s}function cf(n,e){const t=e.query,r=Zi(n,t);return{hashFn:()=>(c_(e)||ae.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?I_(n,t._path,r):S_(n,t._path);{const s=S0(i,t);return ro(n,t,null,s)}}}}function Zi(n,e){const t=Co(e);return n.queryToTagMap.get(t)}function Co(n){return n._path.toString()+"$"+n._queryIdentifier}function cl(n,e){return n.tagToQueryMap.get(e)}function ll(n){const e=n.indexOf("$");return z(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Le(n.substr(0,e))}}function ul(n,e,t){const r=n.syncPointTree_.get(e);z(r,"Missing sync point for query tag that we're tracking");const i=ko(n.pendingWriteTree_,e);return ol(r,t,i,null)}function A_(n){return n.fold((e,t,r)=>{if(t&&mr(t))return[Ao(t)];{let i=[];return t&&(i=ef(t)),Ot(r,(s,o)=>{i=i.concat(o)}),i}})}function Hi(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(w_())(n._repo,n._path):n}function C_(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const i=Co(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function T_(){return b_++}function R_(n,e,t){const r=e._path,i=Zi(n,e),s=cf(n,t),o=n.listenProvider_.startListening(Hi(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)z(!mr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((h,g,y)=>{if(!xe(h)&&g&&mr(g))return[Ao(g).query];{let E=[];return g&&(E=E.concat(ef(g).map(x=>x.query))),Ot(y,(x,T)=>{E=E.concat(T)}),E}});for(let h=0;h<c.length;++h){const g=c[h];n.listenProvider_.stopListening(Hi(g),Zi(n,g))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new hl(t)}node(){return this.node_}}class dl{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Qe(this.path_,e);return new dl(this.syncTree_,t)}node(){return al(this.syncTree_,this.path_)}}const M_=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Xu=function(n,e,t){if(!n||typeof n!="object")return n;if(z(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return N_(n[".sv"],e,t);if(typeof n[".sv"]=="object")return B_(n[".sv"],e);z(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},N_=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:z(!1,"Unexpected server value: "+n)}},B_=function(n,e,t){n.hasOwnProperty("increment")||z(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&z(!1,"Unexpected increment value: "+r);const i=e.node();if(z(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return typeof o!="number"?r:o+r},lf=function(n,e,t,r){return fl(e,new dl(t,n),r)},uf=function(n,e,t){return fl(n,new hl(e),t)};function fl(n,e,t){const r=n.getPriority().val(),i=Xu(r,e.getImmediateChild(".priority"),t);let s;if(n.isLeafNode()){const o=n,a=Xu(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new kt(a,St(i)):n}else{const o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new kt(i))),o.forEachChild(et,(a,c)=>{const h=fl(c,e.getImmediateChild(a),t);h!==c&&(s=s.updateImmediateChild(a,h))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function gl(n,e){let t=e instanceof Le?e:new Le(e),r=n,i=ve(t);for(;i!==null;){const s=ai(r.node.children,i)||{children:{},childCount:0};r=new pl(i,r,s),t=He(t),i=ve(t)}return r}function Si(n){return n.node.value}function hf(n,e){n.node.value=e,mc(n)}function df(n){return n.node.childCount>0}function P_(n){return Si(n)===void 0&&!df(n)}function To(n,e){Ot(n.node.children,(t,r)=>{e(new pl(t,n,r))})}function ff(n,e,t,r){t&&e(n),To(n,i=>{ff(i,e,!0)})}function L_(n,e,t){let r=n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function hs(n){return new Le(n.parent===null?n.name:hs(n.parent)+"/"+n.name)}function mc(n){n.parent!==null&&O_(n.parent,n.name,n)}function O_(n,e,t){const r=P_(t),i=An(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,mc(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,mc(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D_=/[\[\].#$\/\u0000-\u001F\u007F]/,F_=/[\[\].#$\u0000-\u001F\u007F]/,Ta=10*1024*1024,ml=function(n){return typeof n=="string"&&n.length!==0&&!D_.test(n)},pf=function(n){return typeof n=="string"&&n.length!==0&&!F_.test(n)},U_=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),pf(n)},W_=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!$c(n)||n&&typeof n=="object"&&An(n,".sv")},H_=function(n,e,t,r){Ro(vo(n,"value"),e,t)},Ro=function(n,e,t){const r=t instanceof Le?new ry(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+wr(r));if(typeof e=="function")throw new Error(n+"contains a function "+wr(r)+" with contents = "+e.toString());if($c(e))throw new Error(n+"contains "+e.toString()+" "+wr(r));if(typeof e=="string"&&e.length>Ta/3&&Eo(e)>Ta)throw new Error(n+"contains a string greater than "+Ta+" utf8 bytes "+wr(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ot(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!ml(o)))throw new Error(n+" contains an invalid key ("+o+") "+wr(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);iy(r,o),Ro(n,a,r),sy(r)}),i&&s)throw new Error(n+' contains ".value" child '+wr(r)+" in addition to actual children.")}},z_=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const s=Gi(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!ml(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(ny);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&ln(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},$_=function(n,e,t,r){const i=vo(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const s=[];Ot(e,(o,a)=>{const c=new Le(o);if(Ro(i,a,Qe(t,c)),Kc(c)===".priority"&&!W_(a))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),z_(i,s)},gf=function(n,e,t,r){if(!pf(t))throw new Error(vo(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},q_=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),gf(n,e,t)},mf=function(n,e){if(ve(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},V_=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ml(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!U_(t))throw new Error(vo(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Mo(n,e){let t=null;for(let r=0;r<e.length;r++){const i=e[r],s=i.getPath();t!==null&&!Yc(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function yf(n,e,t){Mo(n,t),_f(n,r=>Yc(r,e))}function hn(n,e,t){Mo(n,t),_f(n,r=>ln(r,e)||ln(e,r))}function _f(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const i=n.eventLists_[r];if(i){const s=i.path;e(s)?(j_(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function j_(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Di&&Pt("event: "+t.toString()),vi(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K_="repo_interrupt",Y_=25;class J_{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new G_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ys(),this.transactionQueueTree_=new pl,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Z_(n,e,t){if(n.stats_=Gc(n.repoInfo_),n.forceRestClient_||A0())n.server_=new Ks(n.repoInfo_,(r,i,s,o)=>{Qu(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>eh(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{It(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Wn(n.repoInfo_,e,(r,i,s,o)=>{Qu(n,r,i,s,o)},r=>{eh(n,r)},r=>{Q_(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=N0(n.repoInfo_,()=>new My(n.stats_,n.server_)),n.infoData_=new ky,n.infoSyncTree_=new Zu({startListening:(r,i,s,o)=>{let a=[];const c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=us(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),yl(n,"connected",!1),n.serverSyncTree_=new Zu({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,c)=>{const h=o(a,c);hn(n.eventQueue_,r._path,h)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function X_(n){const t=n.infoData_.getNode(new Le(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function No(n){return M_({timestamp:X_(n)})}function Qu(n,e,t,r,i){n.dataUpdateCount++;const s=new Le(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){const c=zs(t,h=>St(h));o=x_(n.serverSyncTree_,s,c,i)}else{const c=St(t);o=sf(n.serverSyncTree_,s,c,i)}else if(r){const c=zs(t,h=>St(h));o=E_(n.serverSyncTree_,s,c)}else{const c=St(t);o=us(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=di(n,s)),hn(n.eventQueue_,a,o)}function eh(n,e){yl(n,"connected",e),e===!1&&rw(n)}function Q_(n,e){Ot(e,(t,r)=>{yl(n,t,r)})}function yl(n,e,t){const r=new Le("/.info/"+e),i=St(t);n.infoData_.updateSnapshot(r,i);const s=us(n.infoSyncTree_,r,i);hn(n.eventQueue_,r,s)}function _l(n){return n.nextWriteId_++}function ew(n,e,t){const r=k_(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{const s=St(i).withIndex(e._queryParams.getIndex());gc(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=us(n.serverSyncTree_,e._path,s);else{const a=Zi(n.serverSyncTree_,e);o=sf(n.serverSyncTree_,e._path,s,a)}return hn(n.eventQueue_,e._path,o),ro(n.serverSyncTree_,e,t,null,!0),s},i=>(ds(n,"get for query "+It(e)+" failed: "+i),Promise.reject(new Error(i))))}function tw(n,e,t,r,i){ds(n,"set",{path:e.toString(),value:t,priority:r});const s=No(n),o=St(t,r),a=al(n.serverSyncTree_,e),c=uf(o,a,s),h=_l(n),g=rf(n.serverSyncTree_,e,c,h,!0);Mo(n.eventQueue_,g),n.server_.put(e.toString(),o.val(!0),(E,x)=>{const T=E==="ok";T||qt("set at "+e+" failed: "+E);const R=sr(n.serverSyncTree_,h,!T);hn(n.eventQueue_,e,R),yc(n,i,E,x)});const y=bl(n,e);di(n,y),hn(n.eventQueue_,y,[])}function nw(n,e,t,r){ds(n,"update",{path:e.toString(),value:t});let i=!0;const s=No(n),o={};if(Ot(t,(a,c)=>{i=!1,o[a]=lf(Qe(e,a),St(c),n.serverSyncTree_,s)}),i)Pt("update() called with empty data.  Don't do anything."),yc(n,r,"ok",void 0);else{const a=_l(n),c=v_(n.serverSyncTree_,e,o,a);Mo(n.eventQueue_,c),n.server_.merge(e.toString(),t,(h,g)=>{const y=h==="ok";y||qt("update at "+e+" failed: "+h);const E=sr(n.serverSyncTree_,a,!y),x=E.length>0?di(n,e):e;hn(n.eventQueue_,x,E),yc(n,r,h,g)}),Ot(t,h=>{const g=bl(n,Qe(e,h));di(n,g)}),hn(n.eventQueue_,e,[])}}function rw(n){ds(n,"onDisconnectEvents");const e=No(n),t=Ys();lc(n.onDisconnect_,Te(),(i,s)=>{const o=lf(i,s,n.serverSyncTree_,e);zd(t,i,o)});let r=[];lc(t,Te(),(i,s)=>{r=r.concat(us(n.serverSyncTree_,i,s));const o=bl(n,i);di(n,o)}),n.onDisconnect_=Ys(),hn(n.eventQueue_,Te(),r)}function iw(n,e,t){let r;ve(e._path)===".info"?r=gc(n.infoSyncTree_,e,t):r=gc(n.serverSyncTree_,e,t),yf(n.eventQueue_,e._path,r)}function sw(n,e,t){let r;ve(e._path)===".info"?r=ro(n.infoSyncTree_,e,t):r=ro(n.serverSyncTree_,e,t),yf(n.eventQueue_,e._path,r)}function ow(n){n.persistentConnection_&&n.persistentConnection_.interrupt(K_)}function ds(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Pt(t,...e)}function yc(n,e,t,r){e&&vi(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let s=i;r&&(s+=": "+r);const o=new Error(s);o.code=i,e(o)}})}function wf(n,e,t){return al(n.serverSyncTree_,e,t)||ae.EMPTY_NODE}function wl(n,e=n.transactionQueueTree_){if(e||Bo(n,e),Si(e)){const t=vf(n,e);z(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&aw(n,hs(e),t)}else df(e)&&To(e,t=>{wl(n,t)})}function aw(n,e,t){const r=t.map(h=>h.currentWriteId),i=wf(n,e,r);let s=i;const o=i.hash();for(let h=0;h<t.length;h++){const g=t[h];z(g.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),g.status=1,g.retryCount++;const y=Ht(e,g.path);s=s.updateChild(y,g.currentOutputSnapshotRaw)}const a=s.val(!0),c=e;n.server_.put(c.toString(),a,h=>{ds(n,"transaction put response",{path:c.toString(),status:h});let g=[];if(h==="ok"){const y=[];for(let E=0;E<t.length;E++)t[E].status=2,g=g.concat(sr(n.serverSyncTree_,t[E].currentWriteId)),t[E].onComplete&&y.push(()=>t[E].onComplete(null,!0,t[E].currentOutputSnapshotResolved)),t[E].unwatcher();Bo(n,gl(n.transactionQueueTree_,e)),wl(n,n.transactionQueueTree_),hn(n.eventQueue_,e,g);for(let E=0;E<y.length;E++)vi(y[E])}else{if(h==="datastale")for(let y=0;y<t.length;y++)t[y].status===3?t[y].status=4:t[y].status=0;else{qt("transaction at "+c.toString()+" failed: "+h);for(let y=0;y<t.length;y++)t[y].status=4,t[y].abortReason=h}di(n,e)}},o)}function di(n,e){const t=bf(n,e),r=hs(t),i=vf(n,t);return cw(n,i,r),r}function cw(n,e,t){if(e.length===0)return;const r=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],h=Ht(t,c.path);let g=!1,y;if(z(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)g=!0,y=c.abortReason,i=i.concat(sr(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=Y_)g=!0,y="maxretry",i=i.concat(sr(n.serverSyncTree_,c.currentWriteId,!0));else{const E=wf(n,c.path,o);c.currentInputSnapshot=E;const x=e[a].update(E.val());if(x!==void 0){Ro("transaction failed: Data returned ",x,c.path);let T=St(x);typeof x=="object"&&x!=null&&An(x,".priority")||(T=T.updatePriority(E.getPriority()));const A=c.currentWriteId,D=No(n),U=uf(T,E,D);c.currentOutputSnapshotRaw=T,c.currentOutputSnapshotResolved=U,c.currentWriteId=_l(n),o.splice(o.indexOf(A),1),i=i.concat(rf(n.serverSyncTree_,c.path,U,c.currentWriteId,c.applyLocally)),i=i.concat(sr(n.serverSyncTree_,A,!0))}else g=!0,y="nodata",i=i.concat(sr(n.serverSyncTree_,c.currentWriteId,!0))}hn(n.eventQueue_,t,i),i=[],g&&(e[a].status=2,function(E){setTimeout(E,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(y==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(y),!1,null))))}Bo(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)vi(r[a]);wl(n,n.transactionQueueTree_)}function bf(n,e){let t,r=n.transactionQueueTree_;for(t=ve(e);t!==null&&Si(r)===void 0;)r=gl(r,t),e=He(e),t=ve(e);return r}function vf(n,e){const t=[];return Ef(n,e,t),t.sort((r,i)=>r.order-i.order),t}function Ef(n,e,t){const r=Si(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);To(e,i=>{Ef(n,i,t)})}function Bo(n,e){const t=Si(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,hf(e,t.length>0?t:void 0)}To(e,r=>{Bo(n,r)})}function bl(n,e){const t=hs(bf(n,e)),r=gl(n.transactionQueueTree_,e);return L_(r,i=>{Ra(n,i)}),Ra(n,r),ff(r,i=>{Ra(n,i)}),t}function Ra(n,e){const t=Si(e);if(t){const r=[];let i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(z(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(z(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(sr(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?hf(e,void 0):t.length=s+1,hn(n.eventQueue_,hs(e),i);for(let o=0;o<r.length;o++)vi(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lw(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function uw(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):qt(`Invalid query segment '${t}' in query '${n}'`)}return e}const th=function(n,e){const t=hw(n),r=t.namespace;t.domain==="firebase.com"&&$n(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&$n("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||_0();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new xd(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new Le(t.pathString)}},hw=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(a=n.substring(0,h-1),n=n.substring(h+2));let g=n.indexOf("/");g===-1&&(g=n.length);let y=n.indexOf("?");y===-1&&(y=n.length),e=n.substring(0,Math.min(g,y)),g<y&&(i=lw(n.substring(g,y)));const E=uw(n.substring(Math.min(n.length,y)));h=e.indexOf(":"),h>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(h+1),10)):h=e.length;const x=e.slice(0,h);if(x.toLowerCase()==="localhost")t="localhost";else if(x.split(".").length<=2)t=x;else{const T=e.indexOf(".");r=e.substring(0,T).toLowerCase(),t=e.substring(T+1),s=r}"ns"in E&&(s=E.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+It(this.snapshot.exportVal())}}class fw{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return z(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return xe(this._path)?null:Kc(this._path)}get ref(){return new jn(this._repo,this._path)}get _queryIdentifier(){const e=Hu(this._queryParams),t=qc(e);return t==="{}"?"default":t}get _queryObject(){return Hu(this._queryParams)}isEqual(e){if(e=jt(e),!(e instanceof vl))return!1;const t=this._repo===e._repo,r=Yc(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+ty(this._path)}}class jn extends vl{constructor(e,t){super(e,t,new Qc,!1)}get parent(){const e=Pd(this._path);return e===null?null:new jn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Xi{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Le(e),r=_c(this.ref,e);return new Xi(this._node.getChild(t),r,et)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new Xi(i,_c(this.ref,r),et)))}hasChild(e){const t=new Le(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ss(n,e){return n=jt(n),n._checkNotDeleted("ref"),e!==void 0?_c(n._root,e):n._root}function _c(n,e){return n=jt(n),ve(n._path)===null?q_("child","path",e):gf("child","path",e),new jn(n._repo,Qe(n._path,e))}function pw(n){return mf("remove",n._path),gw(n,null)}function gw(n,e){n=jt(n),mf("set",n._path),H_("set",e,n._path);const t=new ss;return tw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Pi(n,e){$_("update",e,n._path);const t=new ss;return nw(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function mw(n){n=jt(n);const e=new Sf(()=>{}),t=new Po(e);return ew(n._repo,n,t).then(r=>new Xi(r,new jn(n._repo,n._path),n._queryParams.getIndex()))}class Po{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new dw("value",this,new Xi(e.snapshotNode,new jn(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new fw(this,e,t):null}matches(e){return e instanceof Po?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function yw(n,e,t,r,i){const s=new Sf(t,void 0),o=new Po(s);return iw(n._repo,n,o),()=>sw(n._repo,n,o)}function Ma(n,e,t,r){return yw(n,"value",e)}f_(jn);__(jn);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _w="FIREBASE_DATABASE_EMULATOR_HOST",wc={};let ww=!1;function bw(n,e,t,r){n.repoInfo_=new xd(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function vw(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||$n("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Pt("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=th(s,i),a=o.repoInfo,c;typeof process<"u"&&Su&&(c=Su[_w]),c?(s=`http://${c}?ns=${a.namespace}`,o=th(s,i),a=o.repoInfo):o.repoInfo.secure;const h=new T0(n.name,n.options,e);V_("Invalid Firebase Database URL",o),xe(o.path)||$n("Database URL must point to the root of a Firebase Database (not including a child path).");const g=Sw(a,n,h,new C0(n.name,t));return new Iw(g,n)}function Ew(n,e){const t=wc[e];(!t||t[n.key]!==n)&&$n(`Database ${e}(${n.repoInfo_}) has already been deleted.`),ow(n),delete t[n.key]}function Sw(n,e,t,r){let i=wc[e.name];i||(i={},wc[e.name]=i);let s=i[n.toURLString()];return s&&$n("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new J_(n,ww,t,r),i[n.toURLString()]=s,s}class Iw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Z_(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new jn(this._repo,Te())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Ew(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&$n("Cannot call "+e+" on a deleted database.")}}function xw(n=zc(),e){const t=So(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=nd("database");r&&kw(t,...r)}return t}function kw(n,e,t,r={}){n=jt(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&$n("Cannot call useEmulator() after instance has already been initialized.");const i=n._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&$n('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Ps(Ps.OWNER);else if(r.mockUserToken){const o=typeof r.mockUserToken=="string"?r.mockUserToken:Wg(r.mockUserToken,n.app.options.projectId);s=new Ps(o)}bw(i,e,t,s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aw(n){d0(bi),Ar(new fr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return vw(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Sn(Iu,xu,n),Sn(Iu,xu,"esm2017")}Wn.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Wn.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Aw();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cw="type.googleapis.com/google.protobuf.Int64Value",Tw="type.googleapis.com/google.protobuf.UInt64Value";function If(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function bc(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>bc(e));if(typeof n=="function"||typeof n=="object")return If(n,e=>bc(e));throw new Error("Data cannot be encoded in JSON: "+n)}function io(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case Cw:case Tw:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>io(e)):typeof n=="function"||typeof n=="object"?If(n,e=>io(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ei extends Gn{constructor(e,t,r){super(`${El}/${e}`,t||""),this.details=r}}function Rw(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Mw(n,e){let t=Rw(n),r=t,i;try{const s=e&&e.error;if(s){const o=s.status;if(typeof o=="string"){if(!nh[o])return new ei("internal","internal");t=nh[o],r=o}const a=s.message;typeof a=="string"&&(r=a),i=s.details,i!==void 0&&(i=io(i))}}catch{}return t==="ok"?null:new ei(t,r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e,t,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(i=>this.auth=i,()=>{}),this.messaging||t.get().then(i=>this.messaging=i,()=>{}),this.appCheck||r.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vc="us-central1";function Bw(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new ei("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class Pw{constructor(e,t,r,i,s=vc,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new Nw(t,r,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(s);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=vc}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function Lw(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}function Ow(n,e,t){return r=>Fw(n,e,r,{})}async function Dw(n,e,t,r){t["Content-Type"]="application/json";let i;try{i=await r(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let s=null;try{s=await i.json()}catch{}return{status:i.status,json:s}}function Fw(n,e,t,r){const i=n._url(e);return Uw(n,i,t,r)}async function Uw(n,e,t,r){t=bc(t);const i={data:t},s={},o=await n.contextProvider.getContext(r.limitedUseAppCheckTokens);o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=r.timeout||7e4,c=Bw(a),h=await Promise.race([Dw(e,i,s,n.fetchImpl),c.promise,n.cancelAllRequests]);if(c.cancel(),!h)throw new ei("cancelled","Firebase Functions instance was deleted.");const g=Mw(h.status,h.json);if(g)throw g;if(!h.json)throw new ei("internal","Response is not valid JSON object.");let y=h.json.data;if(typeof y>"u"&&(y=h.json.result),typeof y>"u")throw new ei("internal","Response is missing data field.");return{data:io(y)}}const rh="@firebase/functions",ih="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ww="auth-internal",Hw="app-check-internal",zw="messaging-internal";function $w(n,e){const t=(r,{instanceIdentifier:i})=>{const s=r.getProvider("app").getImmediate(),o=r.getProvider(Ww),a=r.getProvider(zw),c=r.getProvider(Hw);return new Pw(s,o,a,c,i,n)};Ar(new fr(El,t,"PUBLIC").setMultipleInstances(!0)),Sn(rh,ih,e),Sn(rh,ih,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xf(n=zc(),e=vc){const r=So(jt(n),El).getImmediate({identifier:e}),i=nd("functions");return i&&kf(r,...i),r}function kf(n,e,t){Lw(jt(n),e,t)}function Is(n,e,t){return Ow(jt(n),e)}$w(fetch.bind(self));function Sl(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Af(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const qw=Af,Cf=new os("auth","Firebase",Af());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const so=new Uc("@firebase/auth");function Vw(n,...e){so.logLevel<=Pe.WARN&&so.warn(`Auth (${bi}): ${n}`,...e)}function Ls(n,...e){so.logLevel<=Pe.ERROR&&so.error(`Auth (${bi}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n,...e){throw Il(n,...e)}function In(n,...e){return Il(n,...e)}function Tf(n,e,t){const r=Object.assign(Object.assign({},qw()),{[e]:t});return new os("auth","Firebase",r).create(e,{appName:n.name})}function Ir(n){return Tf(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Il(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Cf.create(n,...e)}function ue(n,e,...t){if(!n)throw Il(e,...t)}function Dn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ls(e),new Error(e)}function Vn(n,e){n||Dn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Gw(){return sh()==="http:"||sh()==="https:"}function sh(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jw(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Gw()||zg()||"connection"in navigator)?navigator.onLine:!0}function Kw(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e,t){this.shortDelay=e,this.longDelay=t,Vn(t>e,"Short delay should be less than long delay!"),this.isMobile=Fc()||sd()}get(){return jw()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xl(n,e){Vn(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Dn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Dn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Dn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jw=new fs(3e4,6e4);function kl(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ii(n,e,t,r,i={}){return Mf(n,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=wi(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const h=Object.assign({method:e,headers:c},s);return Hg()||(h.referrerPolicy="no-referrer"),Rf.fetch()(Nf(n,n.config.apiHost,t,a),h)})}async function Mf(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},Yw),e);try{const i=new Xw(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw xs(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,h]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw xs(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw xs(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw xs(n,"user-disabled",o);const g=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Tf(n,g,h);qn(n,g)}}catch(i){if(i instanceof Gn)throw i;qn(n,"network-request-failed",{message:String(i)})}}async function Zw(n,e,t,r,i={}){const s=await Ii(n,e,t,r,i);return"mfaPendingCredential"in s&&qn(n,"multi-factor-auth-required",{_serverResponse:s}),s}function Nf(n,e,t,r){const i=`${e}${t}?${r}`;return n.config.emulator?xl(n.config,i):`${n.config.apiScheme}://${i}`}class Xw{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(In(this.auth,"network-request-failed")),Jw.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function xs(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=In(n,e,r);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qw(n,e){return Ii(n,"POST","/v1/accounts:delete",e)}async function Bf(n,e){return Ii(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function eb(n,e=!1){const t=jt(n),r=await t.getIdToken(e),i=Al(r);ue(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:zi(Na(i.auth_time)),issuedAtTime:zi(Na(i.iat)),expirationTime:zi(Na(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function Na(n){return Number(n)*1e3}function Al(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ls("JWT malformed, contained fewer than 3 sections"),null;try{const i=Hs(t);return i?JSON.parse(i):(Ls("Failed to decode base64 JWT payload"),null)}catch(i){return Ls("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function oh(n){const e=Al(n);return ue(e,"internal-error"),ue(typeof e.exp<"u","internal-error"),ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qi(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Gn&&tb(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function tb({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=zi(this.lastLoginAt),this.creationTime=zi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oo(n){var e;const t=n.auth,r=await n.getIdToken(),i=await Qi(n,Bf(t,{idToken:r}));ue(i==null?void 0:i.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Pf(s.providerUserInfo):[],a=ib(n.providerData,o),c=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!(a!=null&&a.length),g=c?h:!1,y={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Sc(s.createdAt,s.lastLoginAt),isAnonymous:g};Object.assign(n,y)}async function rb(n){const e=jt(n);await oo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function ib(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Pf(n){return n.map(e=>{var{providerId:t}=e,r=Sl(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sb(n,e){const t=await Mf(n,{},async()=>{const r=wi({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=Nf(n,i,"/v1/token",`key=${s}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Rf.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function ob(n,e){return Ii(n,"POST","/v2/accounts:revokeToken",kl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ue(e.idToken,"internal-error"),ue(typeof e.idToken<"u","internal-error"),ue(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):oh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ue(e.length!==0,"internal-error");const t=oh(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await sb(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new ti;return r&&(ue(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(ue(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(ue(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ti,this.toJSON())}_performRefresh(){return Dn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(n,e){ue(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Fn{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=Sl(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new nb(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Sc(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Qi(this,this.stsTokenManager.getToken(this.auth,e));return ue(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return eb(this,e)}reload(){return rb(this)}_assign(e){this!==e&&(ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Fn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await oo(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ir(this.auth.app))return Promise.reject(Ir(this.auth));const e=await this.getIdToken();return await Qi(this,Qw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,a,c,h,g;const y=(r=t.displayName)!==null&&r!==void 0?r:void 0,E=(i=t.email)!==null&&i!==void 0?i:void 0,x=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,T=(o=t.photoURL)!==null&&o!==void 0?o:void 0,R=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,D=(h=t.createdAt)!==null&&h!==void 0?h:void 0,U=(g=t.lastLoginAt)!==null&&g!==void 0?g:void 0,{uid:L,emailVerified:q,isAnonymous:Z,providerData:j,stsTokenManager:X}=t;ue(L&&X,e,"internal-error");const ee=ti.fromJSON(this.name,X);ue(typeof L=="string",e,"internal-error"),Kn(y,e.name),Kn(E,e.name),ue(typeof q=="boolean",e,"internal-error"),ue(typeof Z=="boolean",e,"internal-error"),Kn(x,e.name),Kn(T,e.name),Kn(R,e.name),Kn(A,e.name),Kn(D,e.name),Kn(U,e.name);const Q=new Fn({uid:L,auth:e,email:E,emailVerified:q,displayName:y,isAnonymous:Z,photoURL:T,phoneNumber:x,tenantId:R,stsTokenManager:ee,createdAt:D,lastLoginAt:U});return j&&Array.isArray(j)&&(Q.providerData=j.map(Ae=>Object.assign({},Ae))),A&&(Q._redirectEventId=A),Q}static async _fromIdTokenResponse(e,t,r=!1){const i=new ti;i.updateFromServerResponse(t);const s=new Fn({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await oo(s),s}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];ue(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?Pf(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),a=new ti;a.updateFromIdToken(r);const c=new Fn({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Sc(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(c,h),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah=new Map;function Un(n){Vn(n instanceof Function,"Expected a class definition");let e=ah.get(n);return e?(Vn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ah.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Lf.type="NONE";const ch=Lf;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Os(n,e,t){return`firebase:${n}:${e}:${t}`}class ni{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=Os(this.userKey,i.apiKey,s),this.fullPersistenceKey=Os("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Fn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ni(Un(ch),e,r);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let s=i[0]||Un(ch);const o=Os(r,e.config.apiKey,e.name);let a=null;for(const h of t)try{const g=await h._get(o);if(g){const y=Fn._fromJSON(e,g);h!==s&&(a=y),s=h;break}}catch{}const c=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new ni(s,e,r):(s=c[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async h=>{if(h!==s)try{await h._remove(o)}catch{}})),new ni(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lh(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Uf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Of(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Hf(e))return"Blackberry";if(zf(e))return"Webos";if(Df(e))return"Safari";if((e.includes("chrome/")||Ff(e))&&!e.includes("edge/"))return"Chrome";if(Wf(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Of(n=Vt()){return/firefox\//i.test(n)}function Df(n=Vt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ff(n=Vt()){return/crios\//i.test(n)}function Uf(n=Vt()){return/iemobile/i.test(n)}function Wf(n=Vt()){return/android/i.test(n)}function Hf(n=Vt()){return/blackberry/i.test(n)}function zf(n=Vt()){return/webos/i.test(n)}function Cl(n=Vt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function ab(n=Vt()){var e;return Cl(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function cb(){return $g()&&document.documentMode===10}function $f(n=Vt()){return Cl(n)||Wf(n)||zf(n)||Hf(n)||/windows phone/i.test(n)||Uf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(n,e=[]){let t;switch(n){case"Browser":t=lh(Vt());break;case"Worker":t=`${lh(Vt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${bi}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((o,a)=>{try{const c=e(s);o(c)}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ub(n,e={}){return Ii(n,"GET","/v2/passwordPolicy",kl(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hb=6;class db{constructor(e){var t,r,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:hb,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new uh(this),this.idTokenSubscription=new uh(this),this.beforeStateQueue=new lb(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Cf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Un(t)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await ni.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Bf(this,{idToken:e}),r=await Fn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ir(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await oo(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Kw()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ir(this.app))return Promise.reject(Ir(this));const t=e?jt(e):null;return t&&ue(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ir(this.app)?Promise.reject(Ir(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ir(this.app)?Promise.reject(Ir(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Un(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ub(this),t=new db(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new os("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await ob(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Un(e)||this._popupRedirectResolver;ue(t,this,"argument-error"),this.redirectPersistenceManager=await ni.create(this,[Un(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ue(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Vw(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Tl(n){return jt(n)}class uh{constructor(e){this.auth=e,this.observer=null,this.addObserver=Qg(t=>this.observer=t)}get next(){return ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rl={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pb(n){Rl=n}function gb(n){return Rl.loadJS(n)}function mb(){return Rl.gapiScript}function yb(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b(n,e){const t=So(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if($s(s,e??{}))return i;qn(i,"already-initialized")}return t.initialize({options:e})}function wb(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Un);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function bb(n,e,t){const r=Tl(n);ue(r._canInitEmulator,r,"emulator-config-failed"),ue(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=Vf(e),{host:o,port:a}=vb(e),c=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),Eb()}function Vf(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function vb(n){const e=Vf(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:hh(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:hh(o)}}}function hh(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Eb(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Dn("not implemented")}_getIdTokenResponse(e){return Dn("not implemented")}_linkToIdToken(e,t){return Dn("not implemented")}_getReauthenticationResolver(e){return Dn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ri(n,e){return Zw(n,"POST","/v1/accounts:signInWithIdp",kl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sb="http://localhost";class Mr extends Gf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Mr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):qn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=Sl(t,["providerId","signInMethod"]);if(!r||!i)return null;const o=new Mr(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return ri(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ri(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ri(e,t)}buildRequest(){const e={requestUri:Sb,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=wi(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps extends jf{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er extends ps{constructor(){super("facebook.com")}static credential(e){return Mr._fromParams({providerId:er.PROVIDER_ID,signInMethod:er.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return er.credentialFromTaggedObject(e)}static credentialFromError(e){return er.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return er.credential(e.oauthAccessToken)}catch{return null}}}er.FACEBOOK_SIGN_IN_METHOD="facebook.com";er.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr extends ps{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Mr._fromParams({providerId:tr.PROVIDER_ID,signInMethod:tr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return tr.credentialFromTaggedObject(e)}static credentialFromError(e){return tr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return tr.credential(t,r)}catch{return null}}}tr.GOOGLE_SIGN_IN_METHOD="google.com";tr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr extends ps{constructor(){super("github.com")}static credential(e){return Mr._fromParams({providerId:nr.PROVIDER_ID,signInMethod:nr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nr.credentialFromTaggedObject(e)}static credentialFromError(e){return nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nr.credential(e.oauthAccessToken)}catch{return null}}}nr.GITHUB_SIGN_IN_METHOD="github.com";nr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr extends ps{constructor(){super("twitter.com")}static credential(e,t){return Mr._fromParams({providerId:rr.PROVIDER_ID,signInMethod:rr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rr.credentialFromTaggedObject(e)}static credentialFromError(e){return rr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return rr.credential(t,r)}catch{return null}}}rr.TWITTER_SIGN_IN_METHOD="twitter.com";rr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await Fn._fromIdTokenResponse(e,r,i),o=dh(r);return new fi({user:s,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=dh(r);return new fi({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function dh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao extends Gn{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,ao.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new ao(e,t,r,i)}}function Kf(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?ao._fromErrorAndOperation(n,s,e,r):s})}async function Ib(n,e,t=!1){const r=await Qi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return fi._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xb(n,e,t=!1){const{auth:r}=n;if(ir(r.app))return Promise.reject(Ir(r));const i="reauthenticate";try{const s=await Qi(n,Kf(r,i,e,n),t);ue(s.idToken,r,"internal-error");const o=Al(s.idToken);ue(o,r,"internal-error");const{sub:a}=o;return ue(n.uid===a,r,"user-mismatch"),fi._forOperation(n,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&qn(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kb(n,e,t=!1){if(ir(n.app))return Promise.reject(Ir(n));const r="signIn",i=await Kf(n,r,e),s=await fi._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}function Ab(n,e,t,r){return jt(n).onIdTokenChanged(e,t,r)}function Cb(n,e,t){return jt(n).beforeAuthStateChanged(e,t)}const co="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(co,"1"),this.storage.removeItem(co),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tb=1e3,Rb=10;class Jf extends Yf{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$f(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);cb()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Rb):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Tb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Jf.type="LOCAL";const Mb=Jf;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf extends Yf{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Zf.type="SESSION";const Xf=Zf;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nb(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new Lo(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async h=>h(t.origin,s)),c=await Nb(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Lo.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ml(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const h=Ml("",20);i.port1.start();const g=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(y){const E=y;if(E.data.eventId===h)switch(E.data.status){case"ack":clearTimeout(g),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(E.data.response);break;default:clearTimeout(g),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(){return window}function Pb(n){xn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qf(){return typeof xn().WorkerGlobalScope<"u"&&typeof xn().importScripts=="function"}async function Lb(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ob(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Db(){return Qf()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ep="firebaseLocalStorageDb",Fb=1,lo="firebaseLocalStorage",tp="fbase_key";class gs{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Oo(n,e){return n.transaction([lo],e?"readwrite":"readonly").objectStore(lo)}function Ub(){const n=indexedDB.deleteDatabase(ep);return new gs(n).toPromise()}function Ic(){const n=indexedDB.open(ep,Fb);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(lo,{keyPath:tp})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(lo)?e(r):(r.close(),await Ub(),e(await Ic()))})})}async function fh(n,e,t){const r=Oo(n,!0).put({[tp]:e,value:t});return new gs(r).toPromise()}async function Wb(n,e){const t=Oo(n,!1).get(e),r=await new gs(t).toPromise();return r===void 0?null:r.value}function ph(n,e){const t=Oo(n,!0).delete(e);return new gs(t).toPromise()}const Hb=800,zb=3;class np{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ic(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>zb)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Lo._getInstance(Db()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Lb(),!this.activeServiceWorker)return;this.sender=new Bb(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ob()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ic();return await fh(e,co,"1"),await ph(e,co),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>fh(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Wb(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ph(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Oo(i,!1).getAll();return new gs(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Hb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}np.type="LOCAL";const $b=np;new fs(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qb(n,e){return e?Un(e):(ue(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl extends Gf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ri(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ri(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ri(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Vb(n){return kb(n.auth,new Nl(n),n.bypassAuthState)}function Gb(n){const{auth:e,user:t}=n;return ue(t,e,"internal-error"),xb(t,new Nl(n),n.bypassAuthState)}async function jb(n){const{auth:e,user:t}=n;return ue(t,e,"internal-error"),Ib(t,new Nl(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Vb;case"linkViaPopup":case"linkViaRedirect":return jb;case"reauthViaPopup":case"reauthViaRedirect":return Gb;default:qn(this.auth,"internal-error")}}resolve(e){Vn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Vn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kb=new fs(2e3,1e4);class Yr extends rp{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,Yr.currentPopupAction&&Yr.currentPopupAction.cancel(),Yr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ue(e,this.auth,"internal-error"),e}async onExecution(){Vn(this.filter.length===1,"Popup operations only handle one event");const e=Ml();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(In(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(In(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(In(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Kb.get())};e()}}Yr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb="pendingRedirect",Ds=new Map;class Jb extends rp{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ds.get(this.auth._key());if(!e){try{const r=await Zb(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ds.set(this.auth._key(),e)}return this.bypassAuthState||Ds.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Zb(n,e){const t=ev(e),r=Qb(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function Xb(n,e){Ds.set(n._key(),e)}function Qb(n){return Un(n._redirectPersistence)}function ev(n){return Os(Yb,n.config.apiKey,n.name)}async function tv(n,e,t=!1){if(ir(n.app))return Promise.reject(Ir(n));const r=Tl(n),i=qb(r,e),o=await new Jb(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nv=10*60*1e3;class rv{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!iv(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!ip(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(In(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=nv&&this.cachedEventUids.clear(),this.cachedEventUids.has(gh(e))}saveEventToCache(e){this.cachedEventUids.add(gh(e)),this.lastProcessedEventTime=Date.now()}}function gh(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ip({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function iv(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ip(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sv(n,e={}){return Ii(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ov=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,av=/^https?/;async function cv(n){if(n.config.emulator)return;const{authorizedDomains:e}=await sv(n);for(const t of e)try{if(lv(t))return}catch{}qn(n,"unauthorized-domain")}function lv(n){const e=Ec(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!av.test(t))return!1;if(ov.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uv=new fs(3e4,6e4);function mh(){const n=xn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function hv(n){return new Promise((e,t)=>{var r,i,s;function o(){mh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{mh(),t(In(n,"network-request-failed"))},timeout:uv.get()})}if(!((i=(r=xn().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=xn().gapi)===null||s===void 0)&&s.load)o();else{const a=yb("iframefcb");return xn()[a]=()=>{gapi.load?o():t(In(n,"network-request-failed"))},gb(`${mb()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Fs=null,e})}let Fs=null;function dv(n){return Fs=Fs||hv(n),Fs}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fv=new fs(5e3,15e3),pv="__/auth/iframe",gv="emulator/auth/iframe",mv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},yv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _v(n){const e=n.config;ue(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?xl(e,gv):`https://${n.config.authDomain}/${pv}`,r={apiKey:e.apiKey,appName:n.name,v:bi},i=yv.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${wi(r).slice(1)}`}async function wv(n){const e=await dv(n),t=xn().gapi;return ue(t,n,"internal-error"),e.open({where:document.body,url:_v(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mv,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=In(n,"network-request-failed"),a=xn().setTimeout(()=>{s(o)},fv.get());function c(){xn().clearTimeout(a),i(r)}r.ping(c).then(c,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},vv=500,Ev=600,Sv="_blank",Iv="http://localhost";class yh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function xv(n,e,t,r=vv,i=Ev){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},bv),{width:r.toString(),height:i.toString(),top:s,left:o}),h=Vt().toLowerCase();t&&(a=Ff(h)?Sv:t),Of(h)&&(e=e||Iv,c.scrollbars="yes");const g=Object.entries(c).reduce((E,[x,T])=>`${E}${x}=${T},`,"");if(ab(h)&&a!=="_self")return kv(e||"",a),new yh(null);const y=window.open(e||"",a,g);ue(y,n,"popup-blocked");try{y.focus()}catch{}return new yh(y)}function kv(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Av="__/auth/handler",Cv="emulator/auth/handler",Tv=encodeURIComponent("fac");async function _h(n,e,t,r,i,s){ue(n.config.authDomain,n,"auth-domain-config-required"),ue(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:bi,eventId:i};if(e instanceof jf){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",ec(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,y]of Object.entries({}))o[g]=y}if(e instanceof ps){const g=e.getScopes().filter(y=>y!=="");g.length>0&&(o.scopes=g.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const g of Object.keys(a))a[g]===void 0&&delete a[g];const c=await n._getAppCheckToken(),h=c?`#${Tv}=${encodeURIComponent(c)}`:"";return`${Rv(n)}?${wi(a).slice(1)}${h}`}function Rv({config:n}){return n.emulator?xl(n,Cv):`https://${n.authDomain}/${Av}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ba="webStorageSupport";class Mv{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xf,this._completeRedirectFn=tv,this._overrideRedirectResult=Xb}async _openPopup(e,t,r,i){var s;Vn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await _h(e,t,r,Ec(),i);return xv(e,o,Ml())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await _h(e,t,r,Ec(),i);return Pb(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Vn(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await wv(e),r=new rv(e);return t.register("authEvent",i=>(ue(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ba,{type:Ba},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[Ba];o!==void 0&&t(!!o),qn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=cv(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return $f()||Df()||Cl()}}const Nv=Mv;var wh="@firebase/auth",bh="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pv(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Lv(n){Ar(new fr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ue(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qf(n)},h=new fb(r,i,s,c);return wb(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ar(new fr("auth-internal",e=>{const t=Tl(e.getProvider("auth").getImmediate());return(r=>new Bv(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Sn(wh,bh,Pv(n)),Sn(wh,bh,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ov=5*60,Dv=id("authIdTokenMaxAge")||Ov;let vh=null;const Fv=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Dv)return;const i=t==null?void 0:t.token;vh!==i&&(vh=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Uv(n=zc()){const e=So(n,"auth");if(e.isInitialized())return e.getImmediate();const t=_b(n,{popupRedirectResolver:Nv,persistence:[$b,Mb,Xf]}),r=id("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=Fv(s.toString());Cb(t,o,()=>o(t.currentUser)),Ab(t,a=>o(a))}}const i=td("auth");return i&&bb(t,`http://${i}`),t}function Wv(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}pb({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=In("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",Wv().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Lv("Browser");const sp={apiKey:"your-api-key",authDomain:"whales-d0eeb.firebaseapp.com",databaseURL:"https://whales-d0eeb-default-rtdb.firebaseio.com",projectId:"whales-d0eeb",storageBucket:"whales-d0eeb.appspot.com",messagingSenderId:"your-messaging-sender-id",appId:"your-app-id"},op=Hc(sp);Uv(op);const Hv=xf(op);location.hostname==="localhost"&&kf(Hv,"localhost",5001);const ap=Hc(sp),ks=xw(ap),As=xf(ap);class cp{constructor(){this.gameRef=null,this.gameId=null,this.lobbyRef=null,this.lobbyListener=null,this.wallet=null}setWallet(e){this.wallet=e.wallet}async createGame(e,t){const i=await Is(As,"createGame")({player1:e,player2:t});return this.gameId=i.data.gameId,this.gameRef=Ss(ks,`games/${this.gameId}`),this.gameId}subscribeToGameUpdates(e){if(!this.gameRef)throw new Error("No active game");return Ma(this.gameRef,t=>{const r=t.val();e(r)})}async updateGameState(e){if(!this.gameRef)throw new Error("No active game");await e(this.gameRef,e)}async updatePlayerScore(e,t){if(!this.gameRef)throw new Error("No active game");await Pi(this.gameRef,{[`scores/${e}`]:t})}async endGame(e){if(!this.gameRef)throw new Error("No active game");await Pi(this.gameRef,{status:"completed",winner:e,endTime:Date.now()})}async joinLobby(){if(!this.wallet)throw new Error("Wallet not initialized");try{console.log("Attempting to join lobby with wallet:",this.wallet.publicKey.toString());const t=await Is(As,"joinLobby")({playerId:this.wallet.publicKey.toString()});console.log("Join lobby result:",t.data);const r=t.data.lobbyId;if(!r)throw new Error("No lobby ID returned from server");return this.lobbyRef=Ss(ks,`lobbies/${r}`),Ma(this.lobbyRef,i=>{const s=i.val();console.log("Real-time lobby update:",s)}),{lobbyId:r}}catch(e){throw console.error("Detailed error joining lobby:",e),e}}subscribeLobbyUpdates(e,t){this.lobbyListener&&off(this.lobbyListener),console.log("Setting up lobby listener for:",e),this.lobbyRef=Ss(ks,`lobbies/${e}`),this.lobbyListener=Ma(this.lobbyRef,r=>{const i=r.val();console.log("Lobby update received:",i),i&&t(i)})}async leaveLobby(e){try{if(this.lobbyListener&&(off(this.lobbyListener),this.lobbyListener=null),this.lobbyRef){const r=(await mw(this.lobbyRef)).val();if(r){const i=r.players.filter(s=>s.id!==this.wallet.publicKey.toString());i.length===0?await pw(this.lobbyRef):await Pi(this.lobbyRef,{players:i,status:"waiting"})}this.lobbyRef=null}}catch(t){throw console.error("Error leaving lobby:",t),t}}async startMultiplayerGame(e){try{const r=await Is(As,"createMultiplayerGame")({lobbyId:e});return this.gameId=r.data.gameId,this.gameRef=Ss(ks,`games/${this.gameId}`),await Pi(this.lobbyRef,{status:"in_game",gameId:this.gameId}),this.gameId}catch(t){throw console.error("Error starting multiplayer game:",t),t}}async updateMultiplayerScore(e,t){if(!this.gameRef)throw new Error("No active game");await Pi(this.gameRef,{[`scores/${e}`]:t,lastUpdated:Date.now()})}async updatePaymentStatus(e,t,r){try{await Is(As,"updatePaymentStatus")({lobbyId:e,playerId:t,status:r})}catch(i){throw console.error("Error updating payment status:",i),i}}}class ii{static show(e,t,r=null){const i=document.createElement("div");i.className="modal-overlay";const s=document.createElement("div");s.className="modal-content";const o=document.createElement("h2");o.textContent=e;const a=document.createElement("div");a.className="modal-body",r?a.innerHTML=r:a.innerHTML=`
                <p>Welcome to Solana Fishing Game v1.0!</p>
                <div class="instructions-box">
                    <p>CONTROLS:</p>
                    <ul>
                        <li>← → or A/D - Move boat</li>
                        <li>Mouse - Aim fishing line</li>
                        <li>Click - Cast/Retract line</li>
                    </ul>
                    <p>SCORING:</p>
                    <ul>
                        <li>Fish = +1 point</li>
                        <li>Rainbow Fish = +5 points</li>
                        <li>Whale = -5 points</li>
                    </ul>
                </div>
            `;const c=document.createElement("button");c.textContent=r?"Play Again":"START.EXE",c.className="win95-button",s.appendChild(o),s.appendChild(a),s.appendChild(c),i.appendChild(s),document.body.appendChild(i),s.style.cssText=`
            padding: 2rem;
            max-width: 500px;
            position: relative;
        `;const h=document.createElement("button");h.className="stop-button",h.style.position="absolute",h.style.right="4px",h.style.top="4px",o.appendChild(h),c.onclick=()=>{i.remove(),t&&t()}}}class zv{constructor(e,t,r,i=!1){this.x=e,this.y=t,this.amount=r,this.isRainbow=i,this.startTime=Date.now(),this.yOffset=0}update(e){const t=(e-this.startTime)/1500;this.yOffset=-40*Math.pow(t,.7),this.opacity=Math.max(0,1-t)}render(e,t){if(!this.opacity)return;if(e.save(),e.imageSmoothingEnabled=!1,e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=0,e.shadowOffsetX=2,e.shadowOffsetY=2,this.isRainbow){const i=e.createLinearGradient(this.x-20,this.y+this.yOffset,this.x+20,this.y+this.yOffset);i.addColorStop(0,`rgba(255, 0, 0, ${this.opacity})`),i.addColorStop(.2,`rgba(255, 165, 0, ${this.opacity})`),i.addColorStop(.4,`rgba(255, 255, 0, ${this.opacity})`),i.addColorStop(.6,`rgba(0, 255, 0, ${this.opacity})`),i.addColorStop(.8,`rgba(0, 0, 255, ${this.opacity})`),i.addColorStop(1,`rgba(148, 0, 211, ${this.opacity})`),e.fillStyle=i,e.strokeStyle=`rgba(255, 255, 255, ${this.opacity})`}else this.amount>0?(e.fillStyle=`rgba(0, 255, 0, ${this.opacity})`,e.strokeStyle=`rgba(0, 128, 0, ${this.opacity})`):(e.fillStyle=`rgba(255, 0, 0, ${this.opacity})`,e.strokeStyle=`rgba(139, 0, 0, ${this.opacity})`);e.font="bold 24px 'VT323'",e.textAlign="center";const r=this.amount>0?`+${this.amount}`:this.amount;e.lineWidth=3,e.strokeText(r,this.x,this.y+this.yOffset),e.fillText(r,this.x,this.y+this.yOffset),e.restore()}}class $v{constructor(){this.animations=new Set}createAnimation(e,t,r,i){const s=new zv(e,t,r,i);this.animations.add(s),setTimeout(()=>{this.animations.delete(s)},1500),console.log("Created animation:",r,"at",e,t)}update(e){for(const t of this.animations)t.update(e)}render(e,t){for(const r of this.animations)r.render(e,t)}}class qv{constructor(){console.log("Game constructor called"),this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=800,this.canvas.height=600,this.players=[],this.fishManager=new Mg,this.timeRemaining=150,this.isRunning=!1,this.gameService=new cp,this.mouseX=0,this.mouseY=0,this.activePlayer=null,this.player=null,this.animationManager=new $v,this.notification=null,this.notificationTimeout=null,this.setupStopButton()}async init(){console.log("Game initialization started");try{await Jh.load(),this.player=new du(400,200,"Player 1"),this.fishManager.init(),console.log("Fish manager initialized"),this.setupControls(),console.log("Controls setup");try{await this.gameService.createGame("Player 1","Player 2"),console.log("Firebase game created"),this.gameService.subscribeToGameUpdates(e=>{console.log("Game state update received:",e),this.handleGameStateUpdate(e)})}catch(e){console.error("Firebase initialization failed:",e)}ii.show("Welcome to Solana Fishing!",()=>{this.start()}),console.log("Game initialization completed")}catch(e){throw console.error("Error during game initialization:",e),e}this.testRender(),this.updateScoreDisplay()}handleGameStateUpdate(e){try{if(e.status==="completed"){this.endGame(e.winner);return}this.players.forEach((t,r)=>{const i=`Player ${r+1}`;t.score=e.scores[i]||0}),this.updateScoreDisplay()}catch(t){console.error("Error in handleGameStateUpdate:",t)}}async updatePlayerScore(e){try{const t=e.name;await this.gameService.updatePlayerScore(t,e.score)}catch(t){console.error("Error in updatePlayerScore:",t)}}start(){console.log("Game starting"),this.isRunning=!0,this.gameLoop(),this.startTimer(),console.log("Game started")}gameLoop(){if(!this.isRunning){console.log("Game loop stopped");return}try{this.update(),this.render(),requestAnimationFrame(()=>this.gameLoop())}catch(e){console.error("Error in game loop:",e),requestAnimationFrame(()=>this.gameLoop())}}update(){try{this.player.update(),this.fishManager.update(),this.checkCollisions(),this.animationManager.update(Date.now())}catch(e){console.error("Error in update:",e)}}render(){if(!this.ctx){console.error("Canvas context is not initialized");return}this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#87CEEB",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#1E90FF",this.ctx.fillRect(0,200,this.canvas.width,this.canvas.height-200),this.player.render(this.ctx),this.fishManager.render(this.ctx),this.animationManager.render(this.ctx,Date.now())}checkCollisions(){if(this.player.isFishing){const e=this.fishManager.checkFishingCollision(this.player.hookPosition);if(e){let t=0,r=!1;switch(e){case"rainbow":t=5,r=!0;break;case"whale":t=-5;break;case"regular":t=1;break}this.animationManager.createAnimation(this.player.hookPosition.x,this.player.hookPosition.y,t,r),this.player.updateScore(t),this.updateScoreDisplay(),this.player.toggleFishing()}}}startTimer(){const e=document.getElementById("timer"),t=setInterval(()=>{this.timeRemaining--;const r=Math.floor(this.timeRemaining/60),i=this.timeRemaining%60;if(e.textContent=`${r}:${i.toString().padStart(2,"0")}`,this.timeRemaining%30===0&&this.timeRemaining>0&&(this.fishManager.increaseWhaleCount(),this.showNotification("WARNING: New Whale Appeared! 🐋"),this.timeRemaining<150)){this.fishManager.increaseSpeeds();const s=this.fishManager.currentSpeedMultiplier;this.showNotification(`SPEED INCREASED TO ${s}x! 🐟💨`,3e3)}this.timeRemaining<=0&&(clearInterval(t),this.endGame())},1e3)}async endGame(){this.isRunning=!1,this.fishManager.resetSpeeds();const e=`
            <p class="end-score">Final Score: ${this.player.score} fish</p>
            <div class="score-breakdown">
                <p>Game Over!</p>
                ${this.player.score>10?'<p class="bonus-message">Great job!</p>':""}
            </div>
        `;try{await this.gameService.endGame(this.player.name)}catch(t){console.error("Error ending game:",t)}ii.show("Game Over",()=>{this.player.score=0,this.timeRemaining=150,this.updateScoreDisplay(),this.start()},e)}setupControls(){window.addEventListener("keydown",e=>{(e.key==="a"||e.key==="ArrowLeft")&&this.player.moveLeft(),(e.key==="d"||e.key==="ArrowRight")&&this.player.moveRight()}),this.canvas.addEventListener("mousemove",e=>{const t=this.canvas.getBoundingClientRect();this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top,this.player.isFishing||this.player.updateTargetAngle(this.mouseX,this.mouseY)}),this.canvas.addEventListener("click",()=>{this.player.toggleFishing()})}updateScoreDisplay(){const e=document.getElementById("player1-score");e&&(e.textContent=`Score: ${this.player.score} fish`)}testRender(){if(console.log("Testing canvas render"),!this.ctx){console.error("Canvas context is not initialized");return}this.ctx.fillStyle="red",this.ctx.fillRect(0,0,100,100),this.ctx.fillStyle="blue",this.ctx.fillRect(100,100,100,100),console.log("Test render completed")}setupStopButton(){const e=document.getElementById("stop-game");e&&e.addEventListener("click",()=>{const t=`
                    <p class="confirm-message">Are you sure you want to stop the game?</p>
                    <div class="button-container">
                        <button class="win95-button" id="confirm-stop">Yes</button>
                        <button class="win95-button" id="cancel-stop">No</button>
                    </div>
                `,r=document.createElement("div");r.className="modal-overlay";const i=document.createElement("div");i.className="modal-content confirm-modal";const s=document.createElement("h2");s.textContent="Confirm Stop";const o=document.createElement("div");o.className="modal-body",o.innerHTML=t,i.appendChild(s),i.appendChild(o),r.appendChild(i),document.body.appendChild(r),document.getElementById("confirm-stop").onclick=()=>{r.remove(),this.stopGame()},document.getElementById("cancel-stop").onclick=()=>{r.remove()}})}stopGame(){this.isRunning=!1,this.fishManager.resetSpeeds();const e=`
            <p class="end-score">Final Score: ${this.player.score} fish</p>
            <p>Game stopped</p>
        `;ii.show("Game Stopped",()=>{this.player.score=0,this.timeRemaining=150,this.updateScoreDisplay(),this.start()},e)}showNotification(e,t=2e3){this.notificationTimeout&&clearTimeout(this.notificationTimeout),this.notification||(this.notification=document.createElement("div"),this.notification.className="game-notification",document.getElementById("game-container").appendChild(this.notification)),this.notification.textContent=e,this.notification.classList.add("show"),this.notificationTimeout=setTimeout(()=>{this.notification.classList.remove("show")},t)}async initMultiplayer(){this.isMatchmaking=!0,this.showNotification("Waiting in lobby...",1e4);try{await this.gameService.joinLobby({wallet:this.playerWallet,timestamp:Date.now(),status:"waiting"}),this.gameService.onLobbyUpdate(t=>{this.updateLobbyPlayers(t)});const e=await this.gameService.findMatch(this.playerWallet);this.gameService.leaveLobby(this.playerWallet)}catch(e){throw console.error("Lobby error:",e),this.showNotification("Failed to join lobby. Please try again.",3e3),e}}updateLobbyPlayers(e){this.players=[],e.forEach((t,r)=>{const i=2*Math.PI*r/e.length,s=150,o=this.canvas.width/2,a=this.canvas.height/2,c=o+s*Math.cos(i),h=a+s*Math.sin(i),g=new du(c,h,t.wallet);g.isLocal=t.wallet===this.playerWallet,this.players.push(g),g.isLocal&&(this.localPlayer=g)})}}var _n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Do(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Bl(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var pe={},Fo={};Fo.byteLength=jv;Fo.toByteArray=Yv;Fo.fromByteArray=Xv;var vn=[],nn=[],Vv=typeof Uint8Array<"u"?Uint8Array:Array,Pa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var qr=0,Gv=Pa.length;qr<Gv;++qr)vn[qr]=Pa[qr],nn[Pa.charCodeAt(qr)]=qr;nn[45]=62;nn[95]=63;function lp(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function jv(n){var e=lp(n),t=e[0],r=e[1];return(t+r)*3/4-r}function Kv(n,e,t){return(e+t)*3/4-t}function Yv(n){var e,t=lp(n),r=t[0],i=t[1],s=new Vv(Kv(n,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=nn[n.charCodeAt(c)]<<18|nn[n.charCodeAt(c+1)]<<12|nn[n.charCodeAt(c+2)]<<6|nn[n.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=nn[n.charCodeAt(c)]<<2|nn[n.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=nn[n.charCodeAt(c)]<<10|nn[n.charCodeAt(c+1)]<<4|nn[n.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Jv(n){return vn[n>>18&63]+vn[n>>12&63]+vn[n>>6&63]+vn[n&63]}function Zv(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(Jv(r));return i.join("")}function Xv(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(Zv(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(vn[e>>2]+vn[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(vn[e>>10]+vn[e>>4&63]+vn[e<<2&63]+"=")),i.join("")}var Pl={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Pl.read=function(n,e,t,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,h=c>>1,g=-7,y=t?i-1:0,E=t?-1:1,x=n[e+y];for(y+=E,s=x&(1<<-g)-1,x>>=-g,g+=a;g>0;s=s*256+n[e+y],y+=E,g-=8);for(o=s&(1<<-g)-1,s>>=-g,g+=r;g>0;o=o*256+n[e+y],y+=E,g-=8);if(s===0)s=1-h;else{if(s===c)return o?NaN:(x?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-h}return(x?-1:1)*o*Math.pow(2,s-r)};Pl.write=function(n,e,t,r,i,s){var o,a,c,h=s*8-i-1,g=(1<<h)-1,y=g>>1,E=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=r?0:s-1,T=r?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=g):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+y>=1?e+=E/c:e+=E*Math.pow(2,1-y),e*c>=2&&(o++,c/=2),o+y>=g?(a=0,o=g):o+y>=1?(a=(e*c-1)*Math.pow(2,i),o=o+y):(a=e*Math.pow(2,y-1)*Math.pow(2,i),o=0));i>=8;n[t+x]=a&255,x+=T,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;n[t+x]=o&255,x+=T,o/=256,h-=8);n[t+x-T]|=R*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=Fo,t=Pl,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=a,n.SlowBuffer=U,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const _=new Uint8Array(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,Uint8Array.prototype),Object.setPrototypeOf(_,u),_.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(_){if(_>i)throw new RangeError('The value "'+_+'" is invalid for option "size"');const u=new Uint8Array(_);return Object.setPrototypeOf(u,a.prototype),u}function a(_,u,f){if(typeof _=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(_)}return c(_,u,f)}a.poolSize=8192;function c(_,u,f){if(typeof _=="string")return E(_,u);if(ArrayBuffer.isView(_))return T(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(Tt(_,ArrayBuffer)||_&&Tt(_.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Tt(_,SharedArrayBuffer)||_&&Tt(_.buffer,SharedArrayBuffer)))return R(_,u,f);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const S=_.valueOf&&_.valueOf();if(S!=null&&S!==_)return a.from(S,u,f);const N=A(_);if(N)return N;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return a.from(_[Symbol.toPrimitive]("string"),u,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}a.from=function(_,u,f){return c(_,u,f)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function h(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function g(_,u,f){return h(_),_<=0?o(_):u!==void 0?typeof f=="string"?o(_).fill(u,f):o(_).fill(u):o(_)}a.alloc=function(_,u,f){return g(_,u,f)};function y(_){return h(_),o(_<0?0:D(_)|0)}a.allocUnsafe=function(_){return y(_)},a.allocUnsafeSlow=function(_){return y(_)};function E(_,u){if((typeof u!="string"||u==="")&&(u="utf8"),!a.isEncoding(u))throw new TypeError("Unknown encoding: "+u);const f=L(_,u)|0;let S=o(f);const N=S.write(_,u);return N!==f&&(S=S.slice(0,N)),S}function x(_){const u=_.length<0?0:D(_.length)|0,f=o(u);for(let S=0;S<u;S+=1)f[S]=_[S]&255;return f}function T(_){if(Tt(_,Uint8Array)){const u=new Uint8Array(_);return R(u.buffer,u.byteOffset,u.byteLength)}return x(_)}function R(_,u,f){if(u<0||_.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<u+(f||0))throw new RangeError('"length" is outside of buffer bounds');let S;return u===void 0&&f===void 0?S=new Uint8Array(_):f===void 0?S=new Uint8Array(_,u):S=new Uint8Array(_,u,f),Object.setPrototypeOf(S,a.prototype),S}function A(_){if(a.isBuffer(_)){const u=D(_.length)|0,f=o(u);return f.length===0||_.copy(f,0,0,u),f}if(_.length!==void 0)return typeof _.length!="number"||Oe(_.length)?o(0):x(_);if(_.type==="Buffer"&&Array.isArray(_.data))return x(_.data)}function D(_){if(_>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return _|0}function U(_){return+_!=_&&(_=0),a.alloc(+_)}a.isBuffer=function(u){return u!=null&&u._isBuffer===!0&&u!==a.prototype},a.compare=function(u,f){if(Tt(u,Uint8Array)&&(u=a.from(u,u.offset,u.byteLength)),Tt(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),!a.isBuffer(u)||!a.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(u===f)return 0;let S=u.length,N=f.length;for(let B=0,F=Math.min(S,N);B<F;++B)if(u[B]!==f[B]){S=u[B],N=f[B];break}return S<N?-1:N<S?1:0},a.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(u,f){if(!Array.isArray(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return a.alloc(0);let S;if(f===void 0)for(f=0,S=0;S<u.length;++S)f+=u[S].length;const N=a.allocUnsafe(f);let B=0;for(S=0;S<u.length;++S){let F=u[S];if(Tt(F,Uint8Array))B+F.length>N.length?(a.isBuffer(F)||(F=a.from(F)),F.copy(N,B)):Uint8Array.prototype.set.call(N,F,B);else if(a.isBuffer(F))F.copy(N,B);else throw new TypeError('"list" argument must be an Array of Buffers');B+=F.length}return N};function L(_,u){if(a.isBuffer(_))return _.length;if(ArrayBuffer.isView(_)||Tt(_,ArrayBuffer))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);const f=_.length,S=arguments.length>2&&arguments[2]===!0;if(!S&&f===0)return 0;let N=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return De(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f*2;case"hex":return f>>>1;case"base64":return Fe(_).length;default:if(N)return S?-1:De(_).length;u=(""+u).toLowerCase(),N=!0}}a.byteLength=L;function q(_,u,f){let S=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((f===void 0||f>this.length)&&(f=this.length),f<=0)||(f>>>=0,u>>>=0,f<=u))return"";for(_||(_="utf8");;)switch(_){case"hex":return k(this,u,f);case"utf8":case"utf-8":return l(this,u,f);case"ascii":return w(this,u,f);case"latin1":case"binary":return v(this,u,f);case"base64":return C(this,u,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,u,f);default:if(S)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),S=!0}}a.prototype._isBuffer=!0;function Z(_,u,f){const S=_[u];_[u]=_[f],_[f]=S}a.prototype.swap16=function(){const u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let f=0;f<u;f+=2)Z(this,f,f+1);return this},a.prototype.swap32=function(){const u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let f=0;f<u;f+=4)Z(this,f,f+3),Z(this,f+1,f+2);return this},a.prototype.swap64=function(){const u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let f=0;f<u;f+=8)Z(this,f,f+7),Z(this,f+1,f+6),Z(this,f+2,f+5),Z(this,f+3,f+4);return this},a.prototype.toString=function(){const u=this.length;return u===0?"":arguments.length===0?l(this,0,u):q.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(u){if(!a.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:a.compare(this,u)===0},a.prototype.inspect=function(){let u="";const f=n.INSPECT_MAX_BYTES;return u=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(u+=" ... "),"<Buffer "+u+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(u,f,S,N,B){if(Tt(u,Uint8Array)&&(u=a.from(u,u.offset,u.byteLength)),!a.isBuffer(u))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof u);if(f===void 0&&(f=0),S===void 0&&(S=u?u.length:0),N===void 0&&(N=0),B===void 0&&(B=this.length),f<0||S>u.length||N<0||B>this.length)throw new RangeError("out of range index");if(N>=B&&f>=S)return 0;if(N>=B)return-1;if(f>=S)return 1;if(f>>>=0,S>>>=0,N>>>=0,B>>>=0,this===u)return 0;let F=B-N,me=S-f;const ge=Math.min(F,me),fe=this.slice(N,B),qe=u.slice(f,S);for(let le=0;le<ge;++le)if(fe[le]!==qe[le]){F=fe[le],me=qe[le];break}return F<me?-1:me<F?1:0};function j(_,u,f,S,N){if(_.length===0)return-1;if(typeof f=="string"?(S=f,f=0):f>2147483647?f=2147483647:f<-2147483648&&(f=-2147483648),f=+f,Oe(f)&&(f=N?0:_.length-1),f<0&&(f=_.length+f),f>=_.length){if(N)return-1;f=_.length-1}else if(f<0)if(N)f=0;else return-1;if(typeof u=="string"&&(u=a.from(u,S)),a.isBuffer(u))return u.length===0?-1:X(_,u,f,S,N);if(typeof u=="number")return u=u&255,typeof Uint8Array.prototype.indexOf=="function"?N?Uint8Array.prototype.indexOf.call(_,u,f):Uint8Array.prototype.lastIndexOf.call(_,u,f):X(_,[u],f,S,N);throw new TypeError("val must be string, number or Buffer")}function X(_,u,f,S,N){let B=1,F=_.length,me=u.length;if(S!==void 0&&(S=String(S).toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(_.length<2||u.length<2)return-1;B=2,F/=2,me/=2,f/=2}function ge(qe,le){return B===1?qe[le]:qe.readUInt16BE(le*B)}let fe;if(N){let qe=-1;for(fe=f;fe<F;fe++)if(ge(_,fe)===ge(u,qe===-1?0:fe-qe)){if(qe===-1&&(qe=fe),fe-qe+1===me)return qe*B}else qe!==-1&&(fe-=fe-qe),qe=-1}else for(f+me>F&&(f=F-me),fe=f;fe>=0;fe--){let qe=!0;for(let le=0;le<me;le++)if(ge(_,fe+le)!==ge(u,le)){qe=!1;break}if(qe)return fe}return-1}a.prototype.includes=function(u,f,S){return this.indexOf(u,f,S)!==-1},a.prototype.indexOf=function(u,f,S){return j(this,u,f,S,!0)},a.prototype.lastIndexOf=function(u,f,S){return j(this,u,f,S,!1)};function ee(_,u,f,S){f=Number(f)||0;const N=_.length-f;S?(S=Number(S),S>N&&(S=N)):S=N;const B=u.length;S>B/2&&(S=B/2);let F;for(F=0;F<S;++F){const me=parseInt(u.substr(F*2,2),16);if(Oe(me))return F;_[f+F]=me}return F}function Q(_,u,f,S){return Be(De(u,_.length-f),_,f,S)}function Ae(_,u,f,S){return Be(Ve(u),_,f,S)}function re(_,u,f,S){return Be(Fe(u),_,f,S)}function he(_,u,f,S){return Be(zr(u,_.length-f),_,f,S)}a.prototype.write=function(u,f,S,N){if(f===void 0)N="utf8",S=this.length,f=0;else if(S===void 0&&typeof f=="string")N=f,S=this.length,f=0;else if(isFinite(f))f=f>>>0,isFinite(S)?(S=S>>>0,N===void 0&&(N="utf8")):(N=S,S=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const B=this.length-f;if((S===void 0||S>B)&&(S=B),u.length>0&&(S<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");N||(N="utf8");let F=!1;for(;;)switch(N){case"hex":return ee(this,u,f,S);case"utf8":case"utf-8":return Q(this,u,f,S);case"ascii":case"latin1":case"binary":return Ae(this,u,f,S);case"base64":return re(this,u,f,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,u,f,S);default:if(F)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),F=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function C(_,u,f){return u===0&&f===_.length?e.fromByteArray(_):e.fromByteArray(_.slice(u,f))}function l(_,u,f){f=Math.min(_.length,f);const S=[];let N=u;for(;N<f;){const B=_[N];let F=null,me=B>239?4:B>223?3:B>191?2:1;if(N+me<=f){let ge,fe,qe,le;switch(me){case 1:B<128&&(F=B);break;case 2:ge=_[N+1],(ge&192)===128&&(le=(B&31)<<6|ge&63,le>127&&(F=le));break;case 3:ge=_[N+1],fe=_[N+2],(ge&192)===128&&(fe&192)===128&&(le=(B&15)<<12|(ge&63)<<6|fe&63,le>2047&&(le<55296||le>57343)&&(F=le));break;case 4:ge=_[N+1],fe=_[N+2],qe=_[N+3],(ge&192)===128&&(fe&192)===128&&(qe&192)===128&&(le=(B&15)<<18|(ge&63)<<12|(fe&63)<<6|qe&63,le>65535&&le<1114112&&(F=le))}}F===null?(F=65533,me=1):F>65535&&(F-=65536,S.push(F>>>10&1023|55296),F=56320|F&1023),S.push(F),N+=me}return m(S)}const p=4096;function m(_){const u=_.length;if(u<=p)return String.fromCharCode.apply(String,_);let f="",S=0;for(;S<u;)f+=String.fromCharCode.apply(String,_.slice(S,S+=p));return f}function w(_,u,f){let S="";f=Math.min(_.length,f);for(let N=u;N<f;++N)S+=String.fromCharCode(_[N]&127);return S}function v(_,u,f){let S="";f=Math.min(_.length,f);for(let N=u;N<f;++N)S+=String.fromCharCode(_[N]);return S}function k(_,u,f){const S=_.length;(!u||u<0)&&(u=0),(!f||f<0||f>S)&&(f=S);let N="";for(let B=u;B<f;++B)N+=ze[_[B]];return N}function M(_,u,f){const S=_.slice(u,f);let N="";for(let B=0;B<S.length-1;B+=2)N+=String.fromCharCode(S[B]+S[B+1]*256);return N}a.prototype.slice=function(u,f){const S=this.length;u=~~u,f=f===void 0?S:~~f,u<0?(u+=S,u<0&&(u=0)):u>S&&(u=S),f<0?(f+=S,f<0&&(f=0)):f>S&&(f=S),f<u&&(f=u);const N=this.subarray(u,f);return Object.setPrototypeOf(N,a.prototype),N};function b(_,u,f){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+u>f)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(u,f,S){u=u>>>0,f=f>>>0,S||b(u,f,this.length);let N=this[u],B=1,F=0;for(;++F<f&&(B*=256);)N+=this[u+F]*B;return N},a.prototype.readUintBE=a.prototype.readUIntBE=function(u,f,S){u=u>>>0,f=f>>>0,S||b(u,f,this.length);let N=this[u+--f],B=1;for(;f>0&&(B*=256);)N+=this[u+--f]*B;return N},a.prototype.readUint8=a.prototype.readUInt8=function(u,f){return u=u>>>0,f||b(u,1,this.length),this[u]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(u,f){return u=u>>>0,f||b(u,2,this.length),this[u]|this[u+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(u,f){return u=u>>>0,f||b(u,2,this.length),this[u]<<8|this[u+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(u,f){return u=u>>>0,f||b(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(u,f){return u=u>>>0,f||b(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},a.prototype.readBigUInt64LE=Kt(function(u){u=u>>>0,nt(u,"offset");const f=this[u],S=this[u+7];(f===void 0||S===void 0)&&ke(u,this.length-8);const N=f+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24,B=this[++u]+this[++u]*2**8+this[++u]*2**16+S*2**24;return BigInt(N)+(BigInt(B)<<BigInt(32))}),a.prototype.readBigUInt64BE=Kt(function(u){u=u>>>0,nt(u,"offset");const f=this[u],S=this[u+7];(f===void 0||S===void 0)&&ke(u,this.length-8);const N=f*2**24+this[++u]*2**16+this[++u]*2**8+this[++u],B=this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+S;return(BigInt(N)<<BigInt(32))+BigInt(B)}),a.prototype.readIntLE=function(u,f,S){u=u>>>0,f=f>>>0,S||b(u,f,this.length);let N=this[u],B=1,F=0;for(;++F<f&&(B*=256);)N+=this[u+F]*B;return B*=128,N>=B&&(N-=Math.pow(2,8*f)),N},a.prototype.readIntBE=function(u,f,S){u=u>>>0,f=f>>>0,S||b(u,f,this.length);let N=f,B=1,F=this[u+--N];for(;N>0&&(B*=256);)F+=this[u+--N]*B;return B*=128,F>=B&&(F-=Math.pow(2,8*f)),F},a.prototype.readInt8=function(u,f){return u=u>>>0,f||b(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},a.prototype.readInt16LE=function(u,f){u=u>>>0,f||b(u,2,this.length);const S=this[u]|this[u+1]<<8;return S&32768?S|4294901760:S},a.prototype.readInt16BE=function(u,f){u=u>>>0,f||b(u,2,this.length);const S=this[u+1]|this[u]<<8;return S&32768?S|4294901760:S},a.prototype.readInt32LE=function(u,f){return u=u>>>0,f||b(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},a.prototype.readInt32BE=function(u,f){return u=u>>>0,f||b(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},a.prototype.readBigInt64LE=Kt(function(u){u=u>>>0,nt(u,"offset");const f=this[u],S=this[u+7];(f===void 0||S===void 0)&&ke(u,this.length-8);const N=this[u+4]+this[u+5]*2**8+this[u+6]*2**16+(S<<24);return(BigInt(N)<<BigInt(32))+BigInt(f+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24)}),a.prototype.readBigInt64BE=Kt(function(u){u=u>>>0,nt(u,"offset");const f=this[u],S=this[u+7];(f===void 0||S===void 0)&&ke(u,this.length-8);const N=(f<<24)+this[++u]*2**16+this[++u]*2**8+this[++u];return(BigInt(N)<<BigInt(32))+BigInt(this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+S)}),a.prototype.readFloatLE=function(u,f){return u=u>>>0,f||b(u,4,this.length),t.read(this,u,!0,23,4)},a.prototype.readFloatBE=function(u,f){return u=u>>>0,f||b(u,4,this.length),t.read(this,u,!1,23,4)},a.prototype.readDoubleLE=function(u,f){return u=u>>>0,f||b(u,8,this.length),t.read(this,u,!0,52,8)},a.prototype.readDoubleBE=function(u,f){return u=u>>>0,f||b(u,8,this.length),t.read(this,u,!1,52,8)};function d(_,u,f,S,N,B){if(!a.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>N||u<B)throw new RangeError('"value" argument is out of bounds');if(f+S>_.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(u,f,S,N){if(u=+u,f=f>>>0,S=S>>>0,!N){const me=Math.pow(2,8*S)-1;d(this,u,f,S,me,0)}let B=1,F=0;for(this[f]=u&255;++F<S&&(B*=256);)this[f+F]=u/B&255;return f+S},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(u,f,S,N){if(u=+u,f=f>>>0,S=S>>>0,!N){const me=Math.pow(2,8*S)-1;d(this,u,f,S,me,0)}let B=S-1,F=1;for(this[f+B]=u&255;--B>=0&&(F*=256);)this[f+B]=u/F&255;return f+S},a.prototype.writeUint8=a.prototype.writeUInt8=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,1,255,0),this[f]=u&255,f+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,2,65535,0),this[f]=u&255,this[f+1]=u>>>8,f+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,2,65535,0),this[f]=u>>>8,this[f+1]=u&255,f+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,4,4294967295,0),this[f+3]=u>>>24,this[f+2]=u>>>16,this[f+1]=u>>>8,this[f]=u&255,f+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,4,4294967295,0),this[f]=u>>>24,this[f+1]=u>>>16,this[f+2]=u>>>8,this[f+3]=u&255,f+4};function I(_,u,f,S,N){we(u,S,N,_,f,7);let B=Number(u&BigInt(4294967295));_[f++]=B,B=B>>8,_[f++]=B,B=B>>8,_[f++]=B,B=B>>8,_[f++]=B;let F=Number(u>>BigInt(32)&BigInt(4294967295));return _[f++]=F,F=F>>8,_[f++]=F,F=F>>8,_[f++]=F,F=F>>8,_[f++]=F,f}function H(_,u,f,S,N){we(u,S,N,_,f,7);let B=Number(u&BigInt(4294967295));_[f+7]=B,B=B>>8,_[f+6]=B,B=B>>8,_[f+5]=B,B=B>>8,_[f+4]=B;let F=Number(u>>BigInt(32)&BigInt(4294967295));return _[f+3]=F,F=F>>8,_[f+2]=F,F=F>>8,_[f+1]=F,F=F>>8,_[f]=F,f+8}a.prototype.writeBigUInt64LE=Kt(function(u,f=0){return I(this,u,f,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Kt(function(u,f=0){return H(this,u,f,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(u,f,S,N){if(u=+u,f=f>>>0,!N){const ge=Math.pow(2,8*S-1);d(this,u,f,S,ge-1,-ge)}let B=0,F=1,me=0;for(this[f]=u&255;++B<S&&(F*=256);)u<0&&me===0&&this[f+B-1]!==0&&(me=1),this[f+B]=(u/F>>0)-me&255;return f+S},a.prototype.writeIntBE=function(u,f,S,N){if(u=+u,f=f>>>0,!N){const ge=Math.pow(2,8*S-1);d(this,u,f,S,ge-1,-ge)}let B=S-1,F=1,me=0;for(this[f+B]=u&255;--B>=0&&(F*=256);)u<0&&me===0&&this[f+B+1]!==0&&(me=1),this[f+B]=(u/F>>0)-me&255;return f+S},a.prototype.writeInt8=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,1,127,-128),u<0&&(u=255+u+1),this[f]=u&255,f+1},a.prototype.writeInt16LE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,2,32767,-32768),this[f]=u&255,this[f+1]=u>>>8,f+2},a.prototype.writeInt16BE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,2,32767,-32768),this[f]=u>>>8,this[f+1]=u&255,f+2},a.prototype.writeInt32LE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,4,2147483647,-2147483648),this[f]=u&255,this[f+1]=u>>>8,this[f+2]=u>>>16,this[f+3]=u>>>24,f+4},a.prototype.writeInt32BE=function(u,f,S){return u=+u,f=f>>>0,S||d(this,u,f,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),this[f]=u>>>24,this[f+1]=u>>>16,this[f+2]=u>>>8,this[f+3]=u&255,f+4},a.prototype.writeBigInt64LE=Kt(function(u,f=0){return I(this,u,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Kt(function(u,f=0){return H(this,u,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function V(_,u,f,S,N,B){if(f+S>_.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("Index out of range")}function Y(_,u,f,S,N){return u=+u,f=f>>>0,N||V(_,u,f,4),t.write(_,u,f,S,23,4),f+4}a.prototype.writeFloatLE=function(u,f,S){return Y(this,u,f,!0,S)},a.prototype.writeFloatBE=function(u,f,S){return Y(this,u,f,!1,S)};function be(_,u,f,S,N){return u=+u,f=f>>>0,N||V(_,u,f,8),t.write(_,u,f,S,52,8),f+8}a.prototype.writeDoubleLE=function(u,f,S){return be(this,u,f,!0,S)},a.prototype.writeDoubleBE=function(u,f,S){return be(this,u,f,!1,S)},a.prototype.copy=function(u,f,S,N){if(!a.isBuffer(u))throw new TypeError("argument should be a Buffer");if(S||(S=0),!N&&N!==0&&(N=this.length),f>=u.length&&(f=u.length),f||(f=0),N>0&&N<S&&(N=S),N===S||u.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(S<0||S>=this.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length),u.length-f<N-S&&(N=u.length-f+S);const B=N-S;return this===u&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(f,S,N):Uint8Array.prototype.set.call(u,this.subarray(S,N),f),B},a.prototype.fill=function(u,f,S,N){if(typeof u=="string"){if(typeof f=="string"?(N=f,f=0,S=this.length):typeof S=="string"&&(N=S,S=this.length),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!a.isEncoding(N))throw new TypeError("Unknown encoding: "+N);if(u.length===1){const F=u.charCodeAt(0);(N==="utf8"&&F<128||N==="latin1")&&(u=F)}}else typeof u=="number"?u=u&255:typeof u=="boolean"&&(u=Number(u));if(f<0||this.length<f||this.length<S)throw new RangeError("Out of range index");if(S<=f)return this;f=f>>>0,S=S===void 0?this.length:S>>>0,u||(u=0);let B;if(typeof u=="number")for(B=f;B<S;++B)this[B]=u;else{const F=a.isBuffer(u)?u:a.from(u,N),me=F.length;if(me===0)throw new TypeError('The value "'+u+'" is invalid for argument "value"');for(B=0;B<S-f;++B)this[B+f]=F[B%me]}return this};const oe={};function de(_,u,f){oe[_]=class extends f{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${_}]`,this.stack,delete this.name}get code(){return _}set code(N){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:N,writable:!0})}toString(){return`${this.name} [${_}]: ${this.message}`}}}de("ERR_BUFFER_OUT_OF_BOUNDS",function(_){return _?`${_} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),de("ERR_INVALID_ARG_TYPE",function(_,u){return`The "${_}" argument must be of type number. Received type ${typeof u}`},TypeError),de("ERR_OUT_OF_RANGE",function(_,u,f){let S=`The value of "${_}" is out of range.`,N=f;return Number.isInteger(f)&&Math.abs(f)>2**32?N=Je(String(f)):typeof f=="bigint"&&(N=String(f),(f>BigInt(2)**BigInt(32)||f<-(BigInt(2)**BigInt(32)))&&(N=Je(N)),N+="n"),S+=` It must be ${u}. Received ${N}`,S},RangeError);function Je(_){let u="",f=_.length;const S=_[0]==="-"?1:0;for(;f>=S+4;f-=3)u=`_${_.slice(f-3,f)}${u}`;return`${_.slice(0,f)}${u}`}function Se(_,u,f){nt(u,"offset"),(_[u]===void 0||_[u+f]===void 0)&&ke(u,_.length-(f+1))}function we(_,u,f,S,N,B){if(_>f||_<u){const F=typeof u=="bigint"?"n":"";let me;throw u===0||u===BigInt(0)?me=`>= 0${F} and < 2${F} ** ${(B+1)*8}${F}`:me=`>= -(2${F} ** ${(B+1)*8-1}${F}) and < 2 ** ${(B+1)*8-1}${F}`,new oe.ERR_OUT_OF_RANGE("value",me,_)}Se(S,N,B)}function nt(_,u){if(typeof _!="number")throw new oe.ERR_INVALID_ARG_TYPE(u,"number",_)}function ke(_,u,f){throw Math.floor(_)!==_?(nt(_,f),new oe.ERR_OUT_OF_RANGE("offset","an integer",_)):u<0?new oe.ERR_BUFFER_OUT_OF_BOUNDS:new oe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${u}`,_)}const Ce=/[^+/0-9A-Za-z-_]/g;function Hr(_){if(_=_.split("=")[0],_=_.trim().replace(Ce,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function De(_,u){u=u||1/0;let f;const S=_.length;let N=null;const B=[];for(let F=0;F<S;++F){if(f=_.charCodeAt(F),f>55295&&f<57344){if(!N){if(f>56319){(u-=3)>-1&&B.push(239,191,189);continue}else if(F+1===S){(u-=3)>-1&&B.push(239,191,189);continue}N=f;continue}if(f<56320){(u-=3)>-1&&B.push(239,191,189),N=f;continue}f=(N-55296<<10|f-56320)+65536}else N&&(u-=3)>-1&&B.push(239,191,189);if(N=null,f<128){if((u-=1)<0)break;B.push(f)}else if(f<2048){if((u-=2)<0)break;B.push(f>>6|192,f&63|128)}else if(f<65536){if((u-=3)<0)break;B.push(f>>12|224,f>>6&63|128,f&63|128)}else if(f<1114112){if((u-=4)<0)break;B.push(f>>18|240,f>>12&63|128,f>>6&63|128,f&63|128)}else throw new Error("Invalid code point")}return B}function Ve(_){const u=[];for(let f=0;f<_.length;++f)u.push(_.charCodeAt(f)&255);return u}function zr(_,u){let f,S,N;const B=[];for(let F=0;F<_.length&&!((u-=2)<0);++F)f=_.charCodeAt(F),S=f>>8,N=f%256,B.push(N),B.push(S);return B}function Fe(_){return e.toByteArray(Hr(_))}function Be(_,u,f,S){let N;for(N=0;N<S&&!(N+f>=u.length||N>=_.length);++N)u[N+f]=_[N];return N}function Tt(_,u){return _ instanceof u||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===u.name}function Oe(_){return _!==_}const ze=function(){const _="0123456789abcdef",u=new Array(256);for(let f=0;f<16;++f){const S=f*16;for(let N=0;N<16;++N)u[S+N]=_[f]+_[N]}return u}();function Kt(_){return typeof BigInt>"u"?$e:_}function $e(){throw new Error("BigInt not supported")}})(pe);function Eh(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function Qv(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Uo(n,...e){if(!Qv(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function e1(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Eh(n.outputLen),Eh(n.blockLen)}function uo(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function t1(n,e){Uo(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Vr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function La(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function bn(n,e){return n<<32-e|n>>>e}function n1(n){if(typeof n!="string")throw new Error("utf8ToBytes expected string, got "+typeof n);return new Uint8Array(new TextEncoder().encode(n))}function Ll(n){return typeof n=="string"&&(n=n1(n)),Uo(n),n}function r1(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];Uo(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}class up{clone(){return this._cloneInto()}}function hp(n){const e=r=>n().update(Ll(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function dp(n=32){if(Vr&&typeof Vr.getRandomValues=="function")return Vr.getRandomValues(new Uint8Array(n));if(Vr&&typeof Vr.randomBytes=="function")return Vr.randomBytes(n);throw new Error("crypto.getRandomValues must be defined")}function i1(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=r?4:0,h=r?0:4;n.setUint32(e+c,o,r),n.setUint32(e+h,a,r)}function s1(n,e,t){return n&e^~n&t}function o1(n,e,t){return n&e^n&t^e&t}class fp extends up{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=La(this.buffer)}update(e){uo(this);const{view:t,buffer:r,blockLen:i}=this;e=Ll(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=La(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){uo(this),t1(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let y=o;y<i;y++)t[y]=0;i1(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=La(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,g=this.get();if(h>g.length)throw new Error("_sha2: outputLen bigger than state");for(let y=0;y<h;y++)a.setUint32(4*y,g[y],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(r),e}}const Cs=BigInt(2**32-1),xc=BigInt(32);function pp(n,e=!1){return e?{h:Number(n&Cs),l:Number(n>>xc&Cs)}:{h:Number(n>>xc&Cs)|0,l:Number(n&Cs)|0}}function a1(n,e=!1){let t=new Uint32Array(n.length),r=new Uint32Array(n.length);for(let i=0;i<n.length;i++){const{h:s,l:o}=pp(n[i],e);[t[i],r[i]]=[s,o]}return[t,r]}const c1=(n,e)=>BigInt(n>>>0)<<xc|BigInt(e>>>0),l1=(n,e,t)=>n>>>t,u1=(n,e,t)=>n<<32-t|e>>>t,h1=(n,e,t)=>n>>>t|e<<32-t,d1=(n,e,t)=>n<<32-t|e>>>t,f1=(n,e,t)=>n<<64-t|e>>>t-32,p1=(n,e,t)=>n>>>t-32|e<<64-t,g1=(n,e)=>e,m1=(n,e)=>n,y1=(n,e,t)=>n<<t|e>>>32-t,_1=(n,e,t)=>e<<t|n>>>32-t,w1=(n,e,t)=>e<<t-32|n>>>64-t,b1=(n,e,t)=>n<<t-32|e>>>64-t;function v1(n,e,t,r){const i=(e>>>0)+(r>>>0);return{h:n+t+(i/2**32|0)|0,l:i|0}}const E1=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),S1=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,I1=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),x1=(n,e,t,r,i)=>e+t+r+i+(n/2**32|0)|0,k1=(n,e,t,r,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),A1=(n,e,t,r,i,s)=>e+t+r+i+s+(n/2**32|0)|0,ye={fromBig:pp,split:a1,toBig:c1,shrSH:l1,shrSL:u1,rotrSH:h1,rotrSL:d1,rotrBH:f1,rotrBL:p1,rotr32H:g1,rotr32L:m1,rotlSH:y1,rotlSL:_1,rotlBH:w1,rotlBL:b1,add:v1,add3L:E1,add3H:S1,add4L:I1,add4H:x1,add5H:A1,add5L:k1},[C1,T1]=ye.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),Yn=new Uint32Array(80),Jn=new Uint32Array(80);class R1 extends fp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:h,El:g,Fh:y,Fl:E,Gh:x,Gl:T,Hh:R,Hl:A}=this;return[e,t,r,i,s,o,a,c,h,g,y,E,x,T,R,A]}set(e,t,r,i,s,o,a,c,h,g,y,E,x,T,R,A){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=h|0,this.El=g|0,this.Fh=y|0,this.Fl=E|0,this.Gh=x|0,this.Gl=T|0,this.Hh=R|0,this.Hl=A|0}process(e,t){for(let L=0;L<16;L++,t+=4)Yn[L]=e.getUint32(t),Jn[L]=e.getUint32(t+=4);for(let L=16;L<80;L++){const q=Yn[L-15]|0,Z=Jn[L-15]|0,j=ye.rotrSH(q,Z,1)^ye.rotrSH(q,Z,8)^ye.shrSH(q,Z,7),X=ye.rotrSL(q,Z,1)^ye.rotrSL(q,Z,8)^ye.shrSL(q,Z,7),ee=Yn[L-2]|0,Q=Jn[L-2]|0,Ae=ye.rotrSH(ee,Q,19)^ye.rotrBH(ee,Q,61)^ye.shrSH(ee,Q,6),re=ye.rotrSL(ee,Q,19)^ye.rotrBL(ee,Q,61)^ye.shrSL(ee,Q,6),he=ye.add4L(X,re,Jn[L-7],Jn[L-16]),C=ye.add4H(he,j,Ae,Yn[L-7],Yn[L-16]);Yn[L]=C|0,Jn[L]=he|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:h,Dl:g,Eh:y,El:E,Fh:x,Fl:T,Gh:R,Gl:A,Hh:D,Hl:U}=this;for(let L=0;L<80;L++){const q=ye.rotrSH(y,E,14)^ye.rotrSH(y,E,18)^ye.rotrBH(y,E,41),Z=ye.rotrSL(y,E,14)^ye.rotrSL(y,E,18)^ye.rotrBL(y,E,41),j=y&x^~y&R,X=E&T^~E&A,ee=ye.add5L(U,Z,X,T1[L],Jn[L]),Q=ye.add5H(ee,D,q,j,C1[L],Yn[L]),Ae=ee|0,re=ye.rotrSH(r,i,28)^ye.rotrBH(r,i,34)^ye.rotrBH(r,i,39),he=ye.rotrSL(r,i,28)^ye.rotrBL(r,i,34)^ye.rotrBL(r,i,39),C=r&s^r&a^s&a,l=i&o^i&c^o&c;D=R|0,U=A|0,R=x|0,A=T|0,x=y|0,T=E|0,{h:y,l:E}=ye.add(h|0,g|0,Q|0,Ae|0),h=a|0,g=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const p=ye.add3L(Ae,he,l);r=ye.add3H(p,Q,re,C),i=p|0}({h:r,l:i}=ye.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=ye.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ye.add(this.Ch|0,this.Cl|0,a|0,c|0),{h,l:g}=ye.add(this.Dh|0,this.Dl|0,h|0,g|0),{h:y,l:E}=ye.add(this.Eh|0,this.El|0,y|0,E|0),{h:x,l:T}=ye.add(this.Fh|0,this.Fl|0,x|0,T|0),{h:R,l:A}=ye.add(this.Gh|0,this.Gl|0,R|0,A|0),{h:D,l:U}=ye.add(this.Hh|0,this.Hl|0,D|0,U|0),this.set(r,i,s,o,a,c,h,g,y,E,x,T,R,A,D,U)}roundClean(){Yn.fill(0),Jn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const M1=hp(()=>new R1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Wo=BigInt(0),Ho=BigInt(1),N1=BigInt(2);function Nr(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function ms(n){if(!Nr(n))throw new Error("Uint8Array expected")}function Hn(n,e){if(typeof e!="boolean")throw new Error(n+" boolean expected, got "+e)}const B1=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Br(n){ms(n);let e="";for(let t=0;t<n.length;t++)e+=B1[n[t]];return e}function Jr(n){const e=n.toString(16);return e.length&1?"0"+e:e}function Ol(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?Wo:BigInt("0x"+n)}const Mn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Sh(n){if(n>=Mn._0&&n<=Mn._9)return n-Mn._0;if(n>=Mn.A&&n<=Mn.F)return n-(Mn.A-10);if(n>=Mn.a&&n<=Mn.f)return n-(Mn.a-10)}function pi(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=Sh(n.charCodeAt(s)),a=Sh(n.charCodeAt(s+1));if(o===void 0||a===void 0){const c=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function xr(n){return Ol(Br(n))}function si(n){return ms(n),Ol(Br(Uint8Array.from(n).reverse()))}function gi(n,e){return pi(n.toString(16).padStart(e*2,"0"))}function es(n,e){return gi(n,e).reverse()}function P1(n){return pi(Jr(n))}function bt(n,e,t){let r;if(typeof e=="string")try{r=pi(e)}catch(s){throw new Error(n+" must be hex string or Uint8Array, cause: "+s)}else if(Nr(e))r=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const i=r.length;if(typeof t=="number"&&i!==t)throw new Error(n+" of length "+t+" expected, got "+i);return r}function Pr(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];ms(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}function L1(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}function O1(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}const Oa=n=>typeof n=="bigint"&&Wo<=n;function zo(n,e,t){return Oa(n)&&Oa(e)&&Oa(t)&&e<=n&&n<t}function cn(n,e,t,r){if(!zo(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function gp(n){let e;for(e=0;n>Wo;n>>=Ho,e+=1);return e}function D1(n,e){return n>>BigInt(e)&Ho}function F1(n,e,t){return n|(t?Ho:Wo)<<BigInt(e)}const Dl=n=>(N1<<BigInt(n-1))-Ho,Da=n=>new Uint8Array(n),Ih=n=>Uint8Array.from(n);function mp(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=Da(n),i=Da(n),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...y)=>t(i,r,...y),c=(y=Da())=>{i=a(Ih([0]),y),r=a(),y.length!==0&&(i=a(Ih([1]),y),r=a())},h=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let y=0;const E=[];for(;y<e;){r=a();const x=r.slice();E.push(x),y+=r.length}return Pr(...E)};return(y,E)=>{o(),c(y);let x;for(;!(x=E(h()));)c();return o(),x}}const U1={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||Nr(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function xi(n,e,t={}){const r=(i,s,o)=>{const a=U1[s];if(typeof a!="function")throw new Error("invalid validator function");const c=n[i];if(!(o&&c===void 0)&&!a(c,n))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(t))r(i,s,!0);return n}const W1=()=>{throw new Error("not implemented")};function ts(n){const e=new WeakMap;return(t,...r)=>{const i=e.get(t);if(i!==void 0)return i;const s=n(t,...r);return e.set(t,s),s}}const H1=Object.freeze(Object.defineProperty({__proto__:null,aInRange:cn,abool:Hn,abytes:ms,bitGet:D1,bitLen:gp,bitMask:Dl,bitSet:F1,bytesToHex:Br,bytesToNumberBE:xr,bytesToNumberLE:si,concatBytes:Pr,createHmacDrbg:mp,ensureBytes:bt,equalBytes:L1,hexToBytes:pi,hexToNumber:Ol,inRange:zo,isBytes:Nr,memoized:ts,notImplemented:W1,numberToBytesBE:gi,numberToBytesLE:es,numberToHexUnpadded:Jr,numberToVarBytesBE:P1,utf8ToBytes:O1,validateObject:xi},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ct=BigInt(0),Ke=BigInt(1),br=BigInt(2),z1=BigInt(3),kc=BigInt(4),xh=BigInt(5),kh=BigInt(8);function Ge(n,e){const t=n%e;return t>=Ct?t:e+t}function $1(n,e,t){if(e<Ct)throw new Error("invalid exponent, negatives unsupported");if(t<=Ct)throw new Error("invalid modulus");if(t===Ke)return Ct;let r=Ke;for(;e>Ct;)e&Ke&&(r=r*n%t),n=n*n%t,e>>=Ke;return r}function Ze(n,e,t){let r=n;for(;e-- >Ct;)r*=r,r%=t;return r}function Ac(n,e){if(n===Ct)throw new Error("invert: expected non-zero number");if(e<=Ct)throw new Error("invert: expected positive modulus, got "+e);let t=Ge(n,e),r=e,i=Ct,s=Ke;for(;t!==Ct;){const a=r/t,c=r%t,h=i-s*a;r=t,t=c,i=s,s=h}if(r!==Ke)throw new Error("invert: does not exist");return Ge(i,e)}function q1(n){const e=(n-Ke)/br;let t,r,i;for(t=n-Ke,r=0;t%br===Ct;t/=br,r++);for(i=br;i<n&&$1(i,e,n)!==n-Ke;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(n+Ke)/kc;return function(c,h){const g=c.pow(h,o);if(!c.eql(c.sqr(g),h))throw new Error("Cannot find square root");return g}}const s=(t+Ke)/br;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let h=r,g=a.pow(a.mul(a.ONE,i),t),y=a.pow(c,s),E=a.pow(c,t);for(;!a.eql(E,a.ONE);){if(a.eql(E,a.ZERO))return a.ZERO;let x=1;for(let R=a.sqr(E);x<h&&!a.eql(R,a.ONE);x++)R=a.sqr(R);const T=a.pow(g,Ke<<BigInt(h-x-1));g=a.sqr(T),y=a.mul(y,T),E=a.mul(E,g),h=x}return y}}function V1(n){if(n%kc===z1){const e=(n+Ke)/kc;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(n%kh===xh){const e=(n-xh)/kh;return function(r,i){const s=r.mul(i,br),o=r.pow(s,e),a=r.mul(i,o),c=r.mul(r.mul(a,br),o),h=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(h),i))throw new Error("Cannot find square root");return h}}return q1(n)}const G1=(n,e)=>(Ge(n,e)&Ke)===Ke,j1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function K1(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=j1.reduce((r,i)=>(r[i]="function",r),e);return xi(n,t)}function Y1(n,e,t){if(t<Ct)throw new Error("invalid exponent, negatives unsupported");if(t===Ct)return n.ONE;if(t===Ke)return e;let r=n.ONE,i=e;for(;t>Ct;)t&Ke&&(r=n.mul(r,i)),i=n.sqr(i),t>>=Ke;return r}function J1(n,e){const t=new Array(e.length),r=e.reduce((s,o,a)=>n.is0(o)?s:(t[a]=s,n.mul(s,o)),n.ONE),i=n.inv(r);return e.reduceRight((s,o,a)=>n.is0(o)?s:(t[a]=n.mul(s,t[a]),n.mul(s,o)),i),t}function yp(n,e){const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function $o(n,e,t=!1,r={}){if(n<=Ct)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:i,nByteLength:s}=yp(n,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:n,isLE:t,BITS:i,BYTES:s,MASK:Dl(i),ZERO:Ct,ONE:Ke,create:c=>Ge(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ct<=c&&c<n},is0:c=>c===Ct,isOdd:c=>(c&Ke)===Ke,neg:c=>Ge(-c,n),eql:(c,h)=>c===h,sqr:c=>Ge(c*c,n),add:(c,h)=>Ge(c+h,n),sub:(c,h)=>Ge(c-h,n),mul:(c,h)=>Ge(c*h,n),pow:(c,h)=>Y1(a,c,h),div:(c,h)=>Ge(c*Ac(h,n),n),sqrN:c=>c*c,addN:(c,h)=>c+h,subN:(c,h)=>c-h,mulN:(c,h)=>c*h,inv:c=>Ac(c,n),sqrt:r.sqrt||(c=>(o||(o=V1(n)),o(a,c))),invertBatch:c=>J1(a,c),cmov:(c,h,g)=>g?h:c,toBytes:c=>t?es(c,s):gi(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?si(c):xr(c)}});return Object.freeze(a)}function _p(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function wp(n){const e=_p(n);return e+Math.ceil(e/2)}function Z1(n,e,t=!1){const r=n.length,i=_p(e),s=wp(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=t?si(n):xr(n),a=Ge(o,e-Ke)+Ke;return t?es(a,i):gi(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ah=BigInt(0),Ts=BigInt(1);function Fa(n,e){const t=e.negate();return n?t:e}function bp(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function Ua(n,e){bp(n,e);const t=Math.ceil(e/n)+1,r=2**(n-1);return{windows:t,windowSize:r}}function X1(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function Q1(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const Wa=new WeakMap,vp=new WeakMap;function Ha(n){return vp.get(n)||1}function Ep(n,e){return{constTimeNegate:Fa,hasPrecomputes(t){return Ha(t)!==1},unsafeLadder(t,r,i=n.ZERO){let s=t;for(;r>Ah;)r&Ts&&(i=i.add(s)),s=s.double(),r>>=Ts;return i},precomputeWindow(t,r){const{windows:i,windowSize:s}=Ua(r,e),o=[];let a=t,c=a;for(let h=0;h<i;h++){c=a,o.push(c);for(let g=1;g<s;g++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,i){const{windows:s,windowSize:o}=Ua(t,e);let a=n.ZERO,c=n.BASE;const h=BigInt(2**t-1),g=2**t,y=BigInt(t);for(let E=0;E<s;E++){const x=E*o;let T=Number(i&h);i>>=y,T>o&&(T-=g,i+=Ts);const R=x,A=x+Math.abs(T)-1,D=E%2!==0,U=T<0;T===0?c=c.add(Fa(D,r[R])):a=a.add(Fa(U,r[A]))}return{p:a,f:c}},wNAFUnsafe(t,r,i,s=n.ZERO){const{windows:o,windowSize:a}=Ua(t,e),c=BigInt(2**t-1),h=2**t,g=BigInt(t);for(let y=0;y<o;y++){const E=y*a;if(i===Ah)break;let x=Number(i&c);if(i>>=g,x>a&&(x-=h,i+=Ts),x===0)continue;let T=r[E+Math.abs(x)-1];x<0&&(T=T.negate()),s=s.add(T)}return s},getPrecomputes(t,r,i){let s=Wa.get(r);return s||(s=this.precomputeWindow(r,t),t!==1&&Wa.set(r,i(s))),s},wNAFCached(t,r,i){const s=Ha(t);return this.wNAF(s,this.getPrecomputes(s,t,i),r)},wNAFCachedUnsafe(t,r,i,s){const o=Ha(t);return o===1?this.unsafeLadder(t,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),r,s)},setWindowSize(t,r){bp(r,e),vp.set(t,r),Wa.delete(t)}}}function Sp(n,e,t,r){if(X1(t,n),Q1(r,e),t.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=n.ZERO,s=gp(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),h=Math.floor((e.BITS-1)/o)*o;let g=i;for(let y=h;y>=0;y-=o){c.fill(i);for(let x=0;x<r.length;x++){const T=r[x],R=Number(T>>BigInt(y)&BigInt(a));c[R]=c[R].add(t[x])}let E=i;for(let x=c.length-1,T=i;x>0;x--)T=T.add(c[x]),E=E.add(T);if(g=g.add(E),y!==0)for(let x=0;x<o;x++)g=g.double()}return g}function Fl(n){return K1(n.Fp),xi(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...yp(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dn=BigInt(0),Yt=BigInt(1),Rs=BigInt(2),eE=BigInt(8),tE={zip215:!0};function nE(n){const e=Fl(n);return xi(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function rE(n){const e=nE(n),{Fp:t,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,h=Rs<<BigInt(a*8)-Yt,g=t.create,y=$o(e.n,e.nBitLength),E=e.uvRatio||((m,w)=>{try{return{isValid:!0,value:t.sqrt(m*t.inv(w))}}catch{return{isValid:!1,value:dn}}}),x=e.adjustScalarBytes||(m=>m),T=e.domain||((m,w,v)=>{if(Hn("phflag",v),w.length||v)throw new Error("Contexts/pre-hash are not supported");return m});function R(m,w){cn("coordinate "+m,w,dn,h)}function A(m){if(!(m instanceof L))throw new Error("ExtendedPoint expected")}const D=ts((m,w)=>{const{ex:v,ey:k,ez:M}=m,b=m.is0();w==null&&(w=b?eE:t.inv(M));const d=g(v*w),I=g(k*w),H=g(M*w);if(b)return{x:dn,y:Yt};if(H!==Yt)throw new Error("invZ was invalid");return{x:d,y:I}}),U=ts(m=>{const{a:w,d:v}=e;if(m.is0())throw new Error("bad point: ZERO");const{ex:k,ey:M,ez:b,et:d}=m,I=g(k*k),H=g(M*M),V=g(b*b),Y=g(V*V),be=g(I*w),oe=g(V*g(be+H)),de=g(Y+g(v*g(I*H)));if(oe!==de)throw new Error("bad point: equation left != right (1)");const Je=g(k*M),Se=g(b*d);if(Je!==Se)throw new Error("bad point: equation left != right (2)");return!0});class L{constructor(w,v,k,M){this.ex=w,this.ey=v,this.ez=k,this.et=M,R("x",w),R("y",v),R("z",k),R("t",M),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof L)throw new Error("extended point not allowed");const{x:v,y:k}=w||{};return R("x",v),R("y",k),new L(v,k,Yt,g(v*k))}static normalizeZ(w){const v=t.invertBatch(w.map(k=>k.ez));return w.map((k,M)=>k.toAffine(v[M])).map(L.fromAffine)}static msm(w,v){return Sp(L,y,w,v)}_setWindowSize(w){j.setWindowSize(this,w)}assertValidity(){U(this)}equals(w){A(w);const{ex:v,ey:k,ez:M}=this,{ex:b,ey:d,ez:I}=w,H=g(v*I),V=g(b*M),Y=g(k*I),be=g(d*M);return H===V&&Y===be}is0(){return this.equals(L.ZERO)}negate(){return new L(g(-this.ex),this.ey,this.ez,g(-this.et))}double(){const{a:w}=e,{ex:v,ey:k,ez:M}=this,b=g(v*v),d=g(k*k),I=g(Rs*g(M*M)),H=g(w*b),V=v+k,Y=g(g(V*V)-b-d),be=H+d,oe=be-I,de=H-d,Je=g(Y*oe),Se=g(be*de),we=g(Y*de),nt=g(oe*be);return new L(Je,Se,nt,we)}add(w){A(w);const{a:v,d:k}=e,{ex:M,ey:b,ez:d,et:I}=this,{ex:H,ey:V,ez:Y,et:be}=w;if(v===BigInt(-1)){const Fe=g((b-M)*(V+H)),Be=g((b+M)*(V-H)),Tt=g(Be-Fe);if(Tt===dn)return this.double();const Oe=g(d*Rs*be),ze=g(I*Rs*Y),Kt=ze+Oe,$e=Be+Fe,_=ze-Oe,u=g(Kt*Tt),f=g($e*_),S=g(Kt*_),N=g(Tt*$e);return new L(u,f,N,S)}const oe=g(M*H),de=g(b*V),Je=g(I*k*be),Se=g(d*Y),we=g((M+b)*(H+V)-oe-de),nt=Se-Je,ke=Se+Je,Ce=g(de-v*oe),Hr=g(we*nt),De=g(ke*Ce),Ve=g(we*Ce),zr=g(nt*ke);return new L(Hr,De,zr,Ve)}subtract(w){return this.add(w.negate())}wNAF(w){return j.wNAFCached(this,w,L.normalizeZ)}multiply(w){const v=w;cn("scalar",v,Yt,r);const{p:k,f:M}=this.wNAF(v);return L.normalizeZ([k,M])[0]}multiplyUnsafe(w,v=L.ZERO){const k=w;return cn("scalar",k,dn,r),k===dn?Z:this.is0()||k===Yt?this:j.wNAFCachedUnsafe(this,k,L.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return j.unsafeLadder(this,r).is0()}toAffine(w){return D(this,w)}clearCofactor(){const{h:w}=e;return w===Yt?this:this.multiplyUnsafe(w)}static fromHex(w,v=!1){const{d:k,a:M}=e,b=t.BYTES;w=bt("pointHex",w,b),Hn("zip215",v);const d=w.slice(),I=w[b-1];d[b-1]=I&-129;const H=si(d),V=v?h:t.ORDER;cn("pointHex.y",H,dn,V);const Y=g(H*H),be=g(Y-Yt),oe=g(k*Y-M);let{isValid:de,value:Je}=E(be,oe);if(!de)throw new Error("Point.fromHex: invalid y coordinate");const Se=(Je&Yt)===Yt,we=(I&128)!==0;if(!v&&Je===dn&&we)throw new Error("Point.fromHex: x=0 and x_0=1");return we!==Se&&(Je=g(-Je)),L.fromAffine({x:Je,y:H})}static fromPrivateKey(w){return Q(w).point}toRawBytes(){const{x:w,y:v}=this.toAffine(),k=es(v,t.BYTES);return k[k.length-1]|=w&Yt?128:0,k}toHex(){return Br(this.toRawBytes())}}L.BASE=new L(e.Gx,e.Gy,Yt,g(e.Gx*e.Gy)),L.ZERO=new L(dn,Yt,Yt,dn);const{BASE:q,ZERO:Z}=L,j=Ep(L,a*8);function X(m){return Ge(m,r)}function ee(m){return X(si(m))}function Q(m){const w=t.BYTES;m=bt("private key",m,w);const v=bt("hashed private key",s(m),2*w),k=x(v.slice(0,w)),M=v.slice(w,2*w),b=ee(k),d=q.multiply(b),I=d.toRawBytes();return{head:k,prefix:M,scalar:b,point:d,pointBytes:I}}function Ae(m){return Q(m).pointBytes}function re(m=new Uint8Array,...w){const v=Pr(...w);return ee(s(T(v,bt("context",m),!!i)))}function he(m,w,v={}){m=bt("message",m),i&&(m=i(m));const{prefix:k,scalar:M,pointBytes:b}=Q(w),d=re(v.context,k,m),I=q.multiply(d).toRawBytes(),H=re(v.context,I,b,m),V=X(d+H*M);cn("signature.s",V,dn,r);const Y=Pr(I,es(V,t.BYTES));return bt("result",Y,t.BYTES*2)}const C=tE;function l(m,w,v,k=C){const{context:M,zip215:b}=k,d=t.BYTES;m=bt("signature",m,2*d),w=bt("message",w),v=bt("publicKey",v,d),b!==void 0&&Hn("zip215",b),i&&(w=i(w));const I=si(m.slice(d,2*d));let H,V,Y;try{H=L.fromHex(v,b),V=L.fromHex(m.slice(0,d),b),Y=q.multiplyUnsafe(I)}catch{return!1}if(!b&&H.isSmallOrder())return!1;const be=re(M,V.toRawBytes(),H.toRawBytes(),w);return V.add(H.multiplyUnsafe(be)).subtract(Y).clearCofactor().equals(L.ZERO)}return q._setWindowSize(8),{CURVE:e,getPublicKey:Ae,sign:he,verify:l,ExtendedPoint:L,utils:{getExtendedPublicKey:Q,randomPrivateKey:()=>o(t.BYTES),precompute(m=8,w=L.BASE){return w._setWindowSize(m),w.multiply(BigInt(3)),w}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ul=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ch=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const iE=BigInt(1),Th=BigInt(2);BigInt(3);const sE=BigInt(5),oE=BigInt(8);function aE(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),i=BigInt(80),s=Ul,a=n*n%s*n%s,c=Ze(a,Th,s)*a%s,h=Ze(c,iE,s)*n%s,g=Ze(h,sE,s)*h%s,y=Ze(g,e,s)*g%s,E=Ze(y,t,s)*y%s,x=Ze(E,r,s)*E%s,T=Ze(x,i,s)*x%s,R=Ze(T,i,s)*x%s,A=Ze(R,e,s)*g%s;return{pow_p_5_8:Ze(A,Th,s)*n%s,b2:a}}function cE(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function lE(n,e){const t=Ul,r=Ge(e*e*e,t),i=Ge(r*r*e,t),s=aE(n*i).pow_p_5_8;let o=Ge(n*r*s,t);const a=Ge(e*o*o,t),c=o,h=Ge(o*Ch,t),g=a===n,y=a===Ge(-n,t),E=a===Ge(-n*Ch,t);return g&&(o=c),(y||E)&&(o=h),G1(o,t)&&(o=Ge(-o,t)),{isValid:g||y,value:o}}const uE=$o(Ul,void 0,!0),hE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:uE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:oE,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:M1,randomBytes:dp,adjustScalarBytes:cE,uvRatio:lE},Wl=rE(hE);var Hl={exports:{}};const dE={},fE=Object.freeze(Object.defineProperty({__proto__:null,default:dE},Symbol.toStringTag,{value:"Module"})),pE=Bl(fE);Hl.exports;(function(n){(function(e,t){function r(C,l){if(!C)throw new Error(l||"Assertion failed")}function i(C,l){C.super_=l;var p=function(){};p.prototype=l.prototype,C.prototype=new p,C.prototype.constructor=C}function s(C,l,p){if(s.isBN(C))return C;this.negative=0,this.words=null,this.length=0,this.red=null,C!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(C||0,l||10,p||"be"))}typeof e=="object"?e.exports=s:t.BN=s,s.BN=s,s.wordSize=26;var o;try{typeof window<"u"&&typeof window.Buffer<"u"?o=window.Buffer:o=pE.Buffer}catch{}s.isBN=function(l){return l instanceof s?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===s.wordSize&&Array.isArray(l.words)},s.max=function(l,p){return l.cmp(p)>0?l:p},s.min=function(l,p){return l.cmp(p)<0?l:p},s.prototype._init=function(l,p,m){if(typeof l=="number")return this._initNumber(l,p,m);if(typeof l=="object")return this._initArray(l,p,m);p==="hex"&&(p=16),r(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var w=0;l[0]==="-"&&(w++,this.negative=1),w<l.length&&(p===16?this._parseHex(l,w,m):(this._parseBase(l,p,w),m==="le"&&this._initArray(this.toArray(),p,m)))},s.prototype._initNumber=function(l,p,m){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(r(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),m==="le"&&this._initArray(this.toArray(),p,m)},s.prototype._initArray=function(l,p,m){if(r(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var w=0;w<this.length;w++)this.words[w]=0;var v,k,M=0;if(m==="be")for(w=l.length-1,v=0;w>=0;w-=3)k=l[w]|l[w-1]<<8|l[w-2]<<16,this.words[v]|=k<<M&67108863,this.words[v+1]=k>>>26-M&67108863,M+=24,M>=26&&(M-=26,v++);else if(m==="le")for(w=0,v=0;w<l.length;w+=3)k=l[w]|l[w+1]<<8|l[w+2]<<16,this.words[v]|=k<<M&67108863,this.words[v+1]=k>>>26-M&67108863,M+=24,M>=26&&(M-=26,v++);return this._strip()};function a(C,l){var p=C.charCodeAt(l);if(p>=48&&p<=57)return p-48;if(p>=65&&p<=70)return p-55;if(p>=97&&p<=102)return p-87;r(!1,"Invalid character in "+C)}function c(C,l,p){var m=a(C,p);return p-1>=l&&(m|=a(C,p-1)<<4),m}s.prototype._parseHex=function(l,p,m){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var w=0;w<this.length;w++)this.words[w]=0;var v=0,k=0,M;if(m==="be")for(w=l.length-1;w>=p;w-=2)M=c(l,p,w)<<v,this.words[k]|=M&67108863,v>=18?(v-=18,k+=1,this.words[k]|=M>>>26):v+=8;else{var b=l.length-p;for(w=b%2===0?p+1:p;w<l.length;w+=2)M=c(l,p,w)<<v,this.words[k]|=M&67108863,v>=18?(v-=18,k+=1,this.words[k]|=M>>>26):v+=8}this._strip()};function h(C,l,p,m){for(var w=0,v=0,k=Math.min(C.length,p),M=l;M<k;M++){var b=C.charCodeAt(M)-48;w*=m,b>=49?v=b-49+10:b>=17?v=b-17+10:v=b,r(b>=0&&v<m,"Invalid character"),w+=v}return w}s.prototype._parseBase=function(l,p,m){this.words=[0],this.length=1;for(var w=0,v=1;v<=67108863;v*=p)w++;w--,v=v/p|0;for(var k=l.length-m,M=k%w,b=Math.min(k,k-M)+m,d=0,I=m;I<b;I+=w)d=h(l,I,I+w,p),this.imuln(v),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(M!==0){var H=1;for(d=h(l,I,l.length,p),I=0;I<M;I++)H*=p;this.imuln(H),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}this._strip()},s.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red};function g(C,l){C.words=l.words,C.length=l.length,C.negative=l.negative,C.red=l.red}if(s.prototype._move=function(l){g(l,this)},s.prototype.clone=function(){var l=new s(null);return this.copy(l),l},s.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=y}catch{s.prototype.inspect=y}else s.prototype.inspect=y;function y(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var E=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],x=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],T=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(l,p){l=l||10,p=p|0||1;var m;if(l===16||l==="hex"){m="";for(var w=0,v=0,k=0;k<this.length;k++){var M=this.words[k],b=((M<<w|v)&16777215).toString(16);v=M>>>24-w&16777215,w+=2,w>=26&&(w-=26,k--),v!==0||k!==this.length-1?m=E[6-b.length]+b+m:m=b+m}for(v!==0&&(m=v.toString(16)+m);m.length%p!==0;)m="0"+m;return this.negative!==0&&(m="-"+m),m}if(l===(l|0)&&l>=2&&l<=36){var d=x[l],I=T[l];m="";var H=this.clone();for(H.negative=0;!H.isZero();){var V=H.modrn(I).toString(l);H=H.idivn(I),H.isZero()?m=V+m:m=E[d-V.length]+V+m}for(this.isZero()&&(m="0"+m);m.length%p!==0;)m="0"+m;return this.negative!==0&&(m="-"+m),m}r(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(l,p){return this.toArrayLike(o,l,p)}),s.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)};var R=function(l,p){return l.allocUnsafe?l.allocUnsafe(p):new l(p)};s.prototype.toArrayLike=function(l,p,m){this._strip();var w=this.byteLength(),v=m||Math.max(1,w);r(w<=v,"byte array longer than desired length"),r(v>0,"Requested array length <= 0");var k=R(l,v),M=p==="le"?"LE":"BE";return this["_toArrayLike"+M](k,w),k},s.prototype._toArrayLikeLE=function(l,p){for(var m=0,w=0,v=0,k=0;v<this.length;v++){var M=this.words[v]<<k|w;l[m++]=M&255,m<l.length&&(l[m++]=M>>8&255),m<l.length&&(l[m++]=M>>16&255),k===6?(m<l.length&&(l[m++]=M>>24&255),w=0,k=0):(w=M>>>24,k+=2)}if(m<l.length)for(l[m++]=w;m<l.length;)l[m++]=0},s.prototype._toArrayLikeBE=function(l,p){for(var m=l.length-1,w=0,v=0,k=0;v<this.length;v++){var M=this.words[v]<<k|w;l[m--]=M&255,m>=0&&(l[m--]=M>>8&255),m>=0&&(l[m--]=M>>16&255),k===6?(m>=0&&(l[m--]=M>>24&255),w=0,k=0):(w=M>>>24,k+=2)}if(m>=0)for(l[m--]=w;m>=0;)l[m--]=0},Math.clz32?s.prototype._countBits=function(l){return 32-Math.clz32(l)}:s.prototype._countBits=function(l){var p=l,m=0;return p>=4096&&(m+=13,p>>>=13),p>=64&&(m+=7,p>>>=7),p>=8&&(m+=4,p>>>=4),p>=2&&(m+=2,p>>>=2),m+p},s.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,m=0;return p&8191||(m+=13,p>>>=13),p&127||(m+=7,p>>>=7),p&15||(m+=4,p>>>=4),p&3||(m+=2,p>>>=2),p&1||m++,m},s.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function A(C){for(var l=new Array(C.bitLength()),p=0;p<l.length;p++){var m=p/26|0,w=p%26;l[p]=C.words[m]>>>w&1}return l}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var m=this._zeroBits(this.words[p]);if(l+=m,m!==26)break}return l},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},s.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this._strip()},s.prototype.ior=function(l){return r((this.negative|l.negative)===0),this.iuor(l)},s.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},s.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},s.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var m=0;m<p.length;m++)this.words[m]=this.words[m]&l.words[m];return this.length=p.length,this._strip()},s.prototype.iand=function(l){return r((this.negative|l.negative)===0),this.iuand(l)},s.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},s.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},s.prototype.iuxor=function(l){var p,m;this.length>l.length?(p=this,m=l):(p=l,m=this);for(var w=0;w<m.length;w++)this.words[w]=p.words[w]^m.words[w];if(this!==p)for(;w<p.length;w++)this.words[w]=p.words[w];return this.length=p.length,this._strip()},s.prototype.ixor=function(l){return r((this.negative|l.negative)===0),this.iuxor(l)},s.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},s.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},s.prototype.inotn=function(l){r(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,m=l%26;this._expand(p),m>0&&p--;for(var w=0;w<p;w++)this.words[w]=~this.words[w]&67108863;return m>0&&(this.words[w]=~this.words[w]&67108863>>26-m),this._strip()},s.prototype.notn=function(l){return this.clone().inotn(l)},s.prototype.setn=function(l,p){r(typeof l=="number"&&l>=0);var m=l/26|0,w=l%26;return this._expand(m+1),p?this.words[m]=this.words[m]|1<<w:this.words[m]=this.words[m]&~(1<<w),this._strip()},s.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var m,w;this.length>l.length?(m=this,w=l):(m=l,w=this);for(var v=0,k=0;k<w.length;k++)p=(m.words[k]|0)+(w.words[k]|0)+v,this.words[k]=p&67108863,v=p>>>26;for(;v!==0&&k<m.length;k++)p=(m.words[k]|0)+v,this.words[k]=p&67108863,v=p>>>26;if(this.length=m.length,v!==0)this.words[this.length]=v,this.length++;else if(m!==this)for(;k<m.length;k++)this.words[k]=m.words[k];return this},s.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},s.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var m=this.cmp(l);if(m===0)return this.negative=0,this.length=1,this.words[0]=0,this;var w,v;m>0?(w=this,v=l):(w=l,v=this);for(var k=0,M=0;M<v.length;M++)p=(w.words[M]|0)-(v.words[M]|0)+k,k=p>>26,this.words[M]=p&67108863;for(;k!==0&&M<w.length;M++)p=(w.words[M]|0)+k,k=p>>26,this.words[M]=p&67108863;if(k===0&&M<w.length&&w!==this)for(;M<w.length;M++)this.words[M]=w.words[M];return this.length=Math.max(this.length,M),w!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(l){return this.clone().isub(l)};function D(C,l,p){p.negative=l.negative^C.negative;var m=C.length+l.length|0;p.length=m,m=m-1|0;var w=C.words[0]|0,v=l.words[0]|0,k=w*v,M=k&67108863,b=k/67108864|0;p.words[0]=M;for(var d=1;d<m;d++){for(var I=b>>>26,H=b&67108863,V=Math.min(d,l.length-1),Y=Math.max(0,d-C.length+1);Y<=V;Y++){var be=d-Y|0;w=C.words[be]|0,v=l.words[Y]|0,k=w*v+H,I+=k/67108864|0,H=k&67108863}p.words[d]=H|0,b=I|0}return b!==0?p.words[d]=b|0:p.length--,p._strip()}var U=function(l,p,m){var w=l.words,v=p.words,k=m.words,M=0,b,d,I,H=w[0]|0,V=H&8191,Y=H>>>13,be=w[1]|0,oe=be&8191,de=be>>>13,Je=w[2]|0,Se=Je&8191,we=Je>>>13,nt=w[3]|0,ke=nt&8191,Ce=nt>>>13,Hr=w[4]|0,De=Hr&8191,Ve=Hr>>>13,zr=w[5]|0,Fe=zr&8191,Be=zr>>>13,Tt=w[6]|0,Oe=Tt&8191,ze=Tt>>>13,Kt=w[7]|0,$e=Kt&8191,_=Kt>>>13,u=w[8]|0,f=u&8191,S=u>>>13,N=w[9]|0,B=N&8191,F=N>>>13,me=v[0]|0,ge=me&8191,fe=me>>>13,qe=v[1]|0,le=qe&8191,rt=qe>>>13,iu=v[2]|0,it=iu&8191,st=iu>>>13,su=v[3]|0,ot=su&8191,at=su>>>13,ou=v[4]|0,ct=ou&8191,lt=ou>>>13,au=v[5]|0,ut=au&8191,ht=au>>>13,cu=v[6]|0,dt=cu&8191,ft=cu>>>13,lu=v[7]|0,pt=lu&8191,gt=lu>>>13,uu=v[8]|0,mt=uu&8191,yt=uu>>>13,hu=v[9]|0,_t=hu&8191,wt=hu>>>13;m.negative=l.negative^p.negative,m.length=19,b=Math.imul(V,ge),d=Math.imul(V,fe),d=d+Math.imul(Y,ge)|0,I=Math.imul(Y,fe);var Qo=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(Qo>>>26)|0,Qo&=67108863,b=Math.imul(oe,ge),d=Math.imul(oe,fe),d=d+Math.imul(de,ge)|0,I=Math.imul(de,fe),b=b+Math.imul(V,le)|0,d=d+Math.imul(V,rt)|0,d=d+Math.imul(Y,le)|0,I=I+Math.imul(Y,rt)|0;var ea=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ea>>>26)|0,ea&=67108863,b=Math.imul(Se,ge),d=Math.imul(Se,fe),d=d+Math.imul(we,ge)|0,I=Math.imul(we,fe),b=b+Math.imul(oe,le)|0,d=d+Math.imul(oe,rt)|0,d=d+Math.imul(de,le)|0,I=I+Math.imul(de,rt)|0,b=b+Math.imul(V,it)|0,d=d+Math.imul(V,st)|0,d=d+Math.imul(Y,it)|0,I=I+Math.imul(Y,st)|0;var ta=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ta>>>26)|0,ta&=67108863,b=Math.imul(ke,ge),d=Math.imul(ke,fe),d=d+Math.imul(Ce,ge)|0,I=Math.imul(Ce,fe),b=b+Math.imul(Se,le)|0,d=d+Math.imul(Se,rt)|0,d=d+Math.imul(we,le)|0,I=I+Math.imul(we,rt)|0,b=b+Math.imul(oe,it)|0,d=d+Math.imul(oe,st)|0,d=d+Math.imul(de,it)|0,I=I+Math.imul(de,st)|0,b=b+Math.imul(V,ot)|0,d=d+Math.imul(V,at)|0,d=d+Math.imul(Y,ot)|0,I=I+Math.imul(Y,at)|0;var na=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(na>>>26)|0,na&=67108863,b=Math.imul(De,ge),d=Math.imul(De,fe),d=d+Math.imul(Ve,ge)|0,I=Math.imul(Ve,fe),b=b+Math.imul(ke,le)|0,d=d+Math.imul(ke,rt)|0,d=d+Math.imul(Ce,le)|0,I=I+Math.imul(Ce,rt)|0,b=b+Math.imul(Se,it)|0,d=d+Math.imul(Se,st)|0,d=d+Math.imul(we,it)|0,I=I+Math.imul(we,st)|0,b=b+Math.imul(oe,ot)|0,d=d+Math.imul(oe,at)|0,d=d+Math.imul(de,ot)|0,I=I+Math.imul(de,at)|0,b=b+Math.imul(V,ct)|0,d=d+Math.imul(V,lt)|0,d=d+Math.imul(Y,ct)|0,I=I+Math.imul(Y,lt)|0;var ra=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ra>>>26)|0,ra&=67108863,b=Math.imul(Fe,ge),d=Math.imul(Fe,fe),d=d+Math.imul(Be,ge)|0,I=Math.imul(Be,fe),b=b+Math.imul(De,le)|0,d=d+Math.imul(De,rt)|0,d=d+Math.imul(Ve,le)|0,I=I+Math.imul(Ve,rt)|0,b=b+Math.imul(ke,it)|0,d=d+Math.imul(ke,st)|0,d=d+Math.imul(Ce,it)|0,I=I+Math.imul(Ce,st)|0,b=b+Math.imul(Se,ot)|0,d=d+Math.imul(Se,at)|0,d=d+Math.imul(we,ot)|0,I=I+Math.imul(we,at)|0,b=b+Math.imul(oe,ct)|0,d=d+Math.imul(oe,lt)|0,d=d+Math.imul(de,ct)|0,I=I+Math.imul(de,lt)|0,b=b+Math.imul(V,ut)|0,d=d+Math.imul(V,ht)|0,d=d+Math.imul(Y,ut)|0,I=I+Math.imul(Y,ht)|0;var ia=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ia>>>26)|0,ia&=67108863,b=Math.imul(Oe,ge),d=Math.imul(Oe,fe),d=d+Math.imul(ze,ge)|0,I=Math.imul(ze,fe),b=b+Math.imul(Fe,le)|0,d=d+Math.imul(Fe,rt)|0,d=d+Math.imul(Be,le)|0,I=I+Math.imul(Be,rt)|0,b=b+Math.imul(De,it)|0,d=d+Math.imul(De,st)|0,d=d+Math.imul(Ve,it)|0,I=I+Math.imul(Ve,st)|0,b=b+Math.imul(ke,ot)|0,d=d+Math.imul(ke,at)|0,d=d+Math.imul(Ce,ot)|0,I=I+Math.imul(Ce,at)|0,b=b+Math.imul(Se,ct)|0,d=d+Math.imul(Se,lt)|0,d=d+Math.imul(we,ct)|0,I=I+Math.imul(we,lt)|0,b=b+Math.imul(oe,ut)|0,d=d+Math.imul(oe,ht)|0,d=d+Math.imul(de,ut)|0,I=I+Math.imul(de,ht)|0,b=b+Math.imul(V,dt)|0,d=d+Math.imul(V,ft)|0,d=d+Math.imul(Y,dt)|0,I=I+Math.imul(Y,ft)|0;var sa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(sa>>>26)|0,sa&=67108863,b=Math.imul($e,ge),d=Math.imul($e,fe),d=d+Math.imul(_,ge)|0,I=Math.imul(_,fe),b=b+Math.imul(Oe,le)|0,d=d+Math.imul(Oe,rt)|0,d=d+Math.imul(ze,le)|0,I=I+Math.imul(ze,rt)|0,b=b+Math.imul(Fe,it)|0,d=d+Math.imul(Fe,st)|0,d=d+Math.imul(Be,it)|0,I=I+Math.imul(Be,st)|0,b=b+Math.imul(De,ot)|0,d=d+Math.imul(De,at)|0,d=d+Math.imul(Ve,ot)|0,I=I+Math.imul(Ve,at)|0,b=b+Math.imul(ke,ct)|0,d=d+Math.imul(ke,lt)|0,d=d+Math.imul(Ce,ct)|0,I=I+Math.imul(Ce,lt)|0,b=b+Math.imul(Se,ut)|0,d=d+Math.imul(Se,ht)|0,d=d+Math.imul(we,ut)|0,I=I+Math.imul(we,ht)|0,b=b+Math.imul(oe,dt)|0,d=d+Math.imul(oe,ft)|0,d=d+Math.imul(de,dt)|0,I=I+Math.imul(de,ft)|0,b=b+Math.imul(V,pt)|0,d=d+Math.imul(V,gt)|0,d=d+Math.imul(Y,pt)|0,I=I+Math.imul(Y,gt)|0;var oa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(oa>>>26)|0,oa&=67108863,b=Math.imul(f,ge),d=Math.imul(f,fe),d=d+Math.imul(S,ge)|0,I=Math.imul(S,fe),b=b+Math.imul($e,le)|0,d=d+Math.imul($e,rt)|0,d=d+Math.imul(_,le)|0,I=I+Math.imul(_,rt)|0,b=b+Math.imul(Oe,it)|0,d=d+Math.imul(Oe,st)|0,d=d+Math.imul(ze,it)|0,I=I+Math.imul(ze,st)|0,b=b+Math.imul(Fe,ot)|0,d=d+Math.imul(Fe,at)|0,d=d+Math.imul(Be,ot)|0,I=I+Math.imul(Be,at)|0,b=b+Math.imul(De,ct)|0,d=d+Math.imul(De,lt)|0,d=d+Math.imul(Ve,ct)|0,I=I+Math.imul(Ve,lt)|0,b=b+Math.imul(ke,ut)|0,d=d+Math.imul(ke,ht)|0,d=d+Math.imul(Ce,ut)|0,I=I+Math.imul(Ce,ht)|0,b=b+Math.imul(Se,dt)|0,d=d+Math.imul(Se,ft)|0,d=d+Math.imul(we,dt)|0,I=I+Math.imul(we,ft)|0,b=b+Math.imul(oe,pt)|0,d=d+Math.imul(oe,gt)|0,d=d+Math.imul(de,pt)|0,I=I+Math.imul(de,gt)|0,b=b+Math.imul(V,mt)|0,d=d+Math.imul(V,yt)|0,d=d+Math.imul(Y,mt)|0,I=I+Math.imul(Y,yt)|0;var aa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(aa>>>26)|0,aa&=67108863,b=Math.imul(B,ge),d=Math.imul(B,fe),d=d+Math.imul(F,ge)|0,I=Math.imul(F,fe),b=b+Math.imul(f,le)|0,d=d+Math.imul(f,rt)|0,d=d+Math.imul(S,le)|0,I=I+Math.imul(S,rt)|0,b=b+Math.imul($e,it)|0,d=d+Math.imul($e,st)|0,d=d+Math.imul(_,it)|0,I=I+Math.imul(_,st)|0,b=b+Math.imul(Oe,ot)|0,d=d+Math.imul(Oe,at)|0,d=d+Math.imul(ze,ot)|0,I=I+Math.imul(ze,at)|0,b=b+Math.imul(Fe,ct)|0,d=d+Math.imul(Fe,lt)|0,d=d+Math.imul(Be,ct)|0,I=I+Math.imul(Be,lt)|0,b=b+Math.imul(De,ut)|0,d=d+Math.imul(De,ht)|0,d=d+Math.imul(Ve,ut)|0,I=I+Math.imul(Ve,ht)|0,b=b+Math.imul(ke,dt)|0,d=d+Math.imul(ke,ft)|0,d=d+Math.imul(Ce,dt)|0,I=I+Math.imul(Ce,ft)|0,b=b+Math.imul(Se,pt)|0,d=d+Math.imul(Se,gt)|0,d=d+Math.imul(we,pt)|0,I=I+Math.imul(we,gt)|0,b=b+Math.imul(oe,mt)|0,d=d+Math.imul(oe,yt)|0,d=d+Math.imul(de,mt)|0,I=I+Math.imul(de,yt)|0,b=b+Math.imul(V,_t)|0,d=d+Math.imul(V,wt)|0,d=d+Math.imul(Y,_t)|0,I=I+Math.imul(Y,wt)|0;var ca=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ca>>>26)|0,ca&=67108863,b=Math.imul(B,le),d=Math.imul(B,rt),d=d+Math.imul(F,le)|0,I=Math.imul(F,rt),b=b+Math.imul(f,it)|0,d=d+Math.imul(f,st)|0,d=d+Math.imul(S,it)|0,I=I+Math.imul(S,st)|0,b=b+Math.imul($e,ot)|0,d=d+Math.imul($e,at)|0,d=d+Math.imul(_,ot)|0,I=I+Math.imul(_,at)|0,b=b+Math.imul(Oe,ct)|0,d=d+Math.imul(Oe,lt)|0,d=d+Math.imul(ze,ct)|0,I=I+Math.imul(ze,lt)|0,b=b+Math.imul(Fe,ut)|0,d=d+Math.imul(Fe,ht)|0,d=d+Math.imul(Be,ut)|0,I=I+Math.imul(Be,ht)|0,b=b+Math.imul(De,dt)|0,d=d+Math.imul(De,ft)|0,d=d+Math.imul(Ve,dt)|0,I=I+Math.imul(Ve,ft)|0,b=b+Math.imul(ke,pt)|0,d=d+Math.imul(ke,gt)|0,d=d+Math.imul(Ce,pt)|0,I=I+Math.imul(Ce,gt)|0,b=b+Math.imul(Se,mt)|0,d=d+Math.imul(Se,yt)|0,d=d+Math.imul(we,mt)|0,I=I+Math.imul(we,yt)|0,b=b+Math.imul(oe,_t)|0,d=d+Math.imul(oe,wt)|0,d=d+Math.imul(de,_t)|0,I=I+Math.imul(de,wt)|0;var la=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(la>>>26)|0,la&=67108863,b=Math.imul(B,it),d=Math.imul(B,st),d=d+Math.imul(F,it)|0,I=Math.imul(F,st),b=b+Math.imul(f,ot)|0,d=d+Math.imul(f,at)|0,d=d+Math.imul(S,ot)|0,I=I+Math.imul(S,at)|0,b=b+Math.imul($e,ct)|0,d=d+Math.imul($e,lt)|0,d=d+Math.imul(_,ct)|0,I=I+Math.imul(_,lt)|0,b=b+Math.imul(Oe,ut)|0,d=d+Math.imul(Oe,ht)|0,d=d+Math.imul(ze,ut)|0,I=I+Math.imul(ze,ht)|0,b=b+Math.imul(Fe,dt)|0,d=d+Math.imul(Fe,ft)|0,d=d+Math.imul(Be,dt)|0,I=I+Math.imul(Be,ft)|0,b=b+Math.imul(De,pt)|0,d=d+Math.imul(De,gt)|0,d=d+Math.imul(Ve,pt)|0,I=I+Math.imul(Ve,gt)|0,b=b+Math.imul(ke,mt)|0,d=d+Math.imul(ke,yt)|0,d=d+Math.imul(Ce,mt)|0,I=I+Math.imul(Ce,yt)|0,b=b+Math.imul(Se,_t)|0,d=d+Math.imul(Se,wt)|0,d=d+Math.imul(we,_t)|0,I=I+Math.imul(we,wt)|0;var ua=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ua>>>26)|0,ua&=67108863,b=Math.imul(B,ot),d=Math.imul(B,at),d=d+Math.imul(F,ot)|0,I=Math.imul(F,at),b=b+Math.imul(f,ct)|0,d=d+Math.imul(f,lt)|0,d=d+Math.imul(S,ct)|0,I=I+Math.imul(S,lt)|0,b=b+Math.imul($e,ut)|0,d=d+Math.imul($e,ht)|0,d=d+Math.imul(_,ut)|0,I=I+Math.imul(_,ht)|0,b=b+Math.imul(Oe,dt)|0,d=d+Math.imul(Oe,ft)|0,d=d+Math.imul(ze,dt)|0,I=I+Math.imul(ze,ft)|0,b=b+Math.imul(Fe,pt)|0,d=d+Math.imul(Fe,gt)|0,d=d+Math.imul(Be,pt)|0,I=I+Math.imul(Be,gt)|0,b=b+Math.imul(De,mt)|0,d=d+Math.imul(De,yt)|0,d=d+Math.imul(Ve,mt)|0,I=I+Math.imul(Ve,yt)|0,b=b+Math.imul(ke,_t)|0,d=d+Math.imul(ke,wt)|0,d=d+Math.imul(Ce,_t)|0,I=I+Math.imul(Ce,wt)|0;var ha=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ha>>>26)|0,ha&=67108863,b=Math.imul(B,ct),d=Math.imul(B,lt),d=d+Math.imul(F,ct)|0,I=Math.imul(F,lt),b=b+Math.imul(f,ut)|0,d=d+Math.imul(f,ht)|0,d=d+Math.imul(S,ut)|0,I=I+Math.imul(S,ht)|0,b=b+Math.imul($e,dt)|0,d=d+Math.imul($e,ft)|0,d=d+Math.imul(_,dt)|0,I=I+Math.imul(_,ft)|0,b=b+Math.imul(Oe,pt)|0,d=d+Math.imul(Oe,gt)|0,d=d+Math.imul(ze,pt)|0,I=I+Math.imul(ze,gt)|0,b=b+Math.imul(Fe,mt)|0,d=d+Math.imul(Fe,yt)|0,d=d+Math.imul(Be,mt)|0,I=I+Math.imul(Be,yt)|0,b=b+Math.imul(De,_t)|0,d=d+Math.imul(De,wt)|0,d=d+Math.imul(Ve,_t)|0,I=I+Math.imul(Ve,wt)|0;var da=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(da>>>26)|0,da&=67108863,b=Math.imul(B,ut),d=Math.imul(B,ht),d=d+Math.imul(F,ut)|0,I=Math.imul(F,ht),b=b+Math.imul(f,dt)|0,d=d+Math.imul(f,ft)|0,d=d+Math.imul(S,dt)|0,I=I+Math.imul(S,ft)|0,b=b+Math.imul($e,pt)|0,d=d+Math.imul($e,gt)|0,d=d+Math.imul(_,pt)|0,I=I+Math.imul(_,gt)|0,b=b+Math.imul(Oe,mt)|0,d=d+Math.imul(Oe,yt)|0,d=d+Math.imul(ze,mt)|0,I=I+Math.imul(ze,yt)|0,b=b+Math.imul(Fe,_t)|0,d=d+Math.imul(Fe,wt)|0,d=d+Math.imul(Be,_t)|0,I=I+Math.imul(Be,wt)|0;var fa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(fa>>>26)|0,fa&=67108863,b=Math.imul(B,dt),d=Math.imul(B,ft),d=d+Math.imul(F,dt)|0,I=Math.imul(F,ft),b=b+Math.imul(f,pt)|0,d=d+Math.imul(f,gt)|0,d=d+Math.imul(S,pt)|0,I=I+Math.imul(S,gt)|0,b=b+Math.imul($e,mt)|0,d=d+Math.imul($e,yt)|0,d=d+Math.imul(_,mt)|0,I=I+Math.imul(_,yt)|0,b=b+Math.imul(Oe,_t)|0,d=d+Math.imul(Oe,wt)|0,d=d+Math.imul(ze,_t)|0,I=I+Math.imul(ze,wt)|0;var pa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(pa>>>26)|0,pa&=67108863,b=Math.imul(B,pt),d=Math.imul(B,gt),d=d+Math.imul(F,pt)|0,I=Math.imul(F,gt),b=b+Math.imul(f,mt)|0,d=d+Math.imul(f,yt)|0,d=d+Math.imul(S,mt)|0,I=I+Math.imul(S,yt)|0,b=b+Math.imul($e,_t)|0,d=d+Math.imul($e,wt)|0,d=d+Math.imul(_,_t)|0,I=I+Math.imul(_,wt)|0;var ga=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ga>>>26)|0,ga&=67108863,b=Math.imul(B,mt),d=Math.imul(B,yt),d=d+Math.imul(F,mt)|0,I=Math.imul(F,yt),b=b+Math.imul(f,_t)|0,d=d+Math.imul(f,wt)|0,d=d+Math.imul(S,_t)|0,I=I+Math.imul(S,wt)|0;var ma=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ma>>>26)|0,ma&=67108863,b=Math.imul(B,_t),d=Math.imul(B,wt),d=d+Math.imul(F,_t)|0,I=Math.imul(F,wt);var ya=(M+b|0)+((d&8191)<<13)|0;return M=(I+(d>>>13)|0)+(ya>>>26)|0,ya&=67108863,k[0]=Qo,k[1]=ea,k[2]=ta,k[3]=na,k[4]=ra,k[5]=ia,k[6]=sa,k[7]=oa,k[8]=aa,k[9]=ca,k[10]=la,k[11]=ua,k[12]=ha,k[13]=da,k[14]=fa,k[15]=pa,k[16]=ga,k[17]=ma,k[18]=ya,M!==0&&(k[19]=M,m.length++),m};Math.imul||(U=D);function L(C,l,p){p.negative=l.negative^C.negative,p.length=C.length+l.length;for(var m=0,w=0,v=0;v<p.length-1;v++){var k=w;w=0;for(var M=m&67108863,b=Math.min(v,l.length-1),d=Math.max(0,v-C.length+1);d<=b;d++){var I=v-d,H=C.words[I]|0,V=l.words[d]|0,Y=H*V,be=Y&67108863;k=k+(Y/67108864|0)|0,be=be+M|0,M=be&67108863,k=k+(be>>>26)|0,w+=k>>>26,k&=67108863}p.words[v]=M,m=k,k=w}return m!==0?p.words[v]=m:p.length--,p._strip()}function q(C,l,p){return L(C,l,p)}s.prototype.mulTo=function(l,p){var m,w=this.length+l.length;return this.length===10&&l.length===10?m=U(this,l,p):w<63?m=D(this,l,p):w<1024?m=L(this,l,p):m=q(this,l,p),m},s.prototype.mul=function(l){var p=new s(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},s.prototype.mulf=function(l){var p=new s(null);return p.words=new Array(this.length+l.length),q(this,l,p)},s.prototype.imul=function(l){return this.clone().mulTo(l,this)},s.prototype.imuln=function(l){var p=l<0;p&&(l=-l),r(typeof l=="number"),r(l<67108864);for(var m=0,w=0;w<this.length;w++){var v=(this.words[w]|0)*l,k=(v&67108863)+(m&67108863);m>>=26,m+=v/67108864|0,m+=k>>>26,this.words[w]=k&67108863}return m!==0&&(this.words[w]=m,this.length++),p?this.ineg():this},s.prototype.muln=function(l){return this.clone().imuln(l)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(l){var p=A(l);if(p.length===0)return new s(1);for(var m=this,w=0;w<p.length&&p[w]===0;w++,m=m.sqr());if(++w<p.length)for(var v=m.sqr();w<p.length;w++,v=v.sqr())p[w]!==0&&(m=m.mul(v));return m},s.prototype.iushln=function(l){r(typeof l=="number"&&l>=0);var p=l%26,m=(l-p)/26,w=67108863>>>26-p<<26-p,v;if(p!==0){var k=0;for(v=0;v<this.length;v++){var M=this.words[v]&w,b=(this.words[v]|0)-M<<p;this.words[v]=b|k,k=M>>>26-p}k&&(this.words[v]=k,this.length++)}if(m!==0){for(v=this.length-1;v>=0;v--)this.words[v+m]=this.words[v];for(v=0;v<m;v++)this.words[v]=0;this.length+=m}return this._strip()},s.prototype.ishln=function(l){return r(this.negative===0),this.iushln(l)},s.prototype.iushrn=function(l,p,m){r(typeof l=="number"&&l>=0);var w;p?w=(p-p%26)/26:w=0;var v=l%26,k=Math.min((l-v)/26,this.length),M=67108863^67108863>>>v<<v,b=m;if(w-=k,w=Math.max(0,w),b){for(var d=0;d<k;d++)b.words[d]=this.words[d];b.length=k}if(k!==0)if(this.length>k)for(this.length-=k,d=0;d<this.length;d++)this.words[d]=this.words[d+k];else this.words[0]=0,this.length=1;var I=0;for(d=this.length-1;d>=0&&(I!==0||d>=w);d--){var H=this.words[d]|0;this.words[d]=I<<26-v|H>>>v,I=H&M}return b&&I!==0&&(b.words[b.length++]=I),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(l,p,m){return r(this.negative===0),this.iushrn(l,p,m)},s.prototype.shln=function(l){return this.clone().ishln(l)},s.prototype.ushln=function(l){return this.clone().iushln(l)},s.prototype.shrn=function(l){return this.clone().ishrn(l)},s.prototype.ushrn=function(l){return this.clone().iushrn(l)},s.prototype.testn=function(l){r(typeof l=="number"&&l>=0);var p=l%26,m=(l-p)/26,w=1<<p;if(this.length<=m)return!1;var v=this.words[m];return!!(v&w)},s.prototype.imaskn=function(l){r(typeof l=="number"&&l>=0);var p=l%26,m=(l-p)/26;if(r(this.negative===0,"imaskn works only with positive numbers"),this.length<=m)return this;if(p!==0&&m++,this.length=Math.min(m,this.length),p!==0){var w=67108863^67108863>>>p<<p;this.words[this.length-1]&=w}return this._strip()},s.prototype.maskn=function(l){return this.clone().imaskn(l)},s.prototype.iaddn=function(l){return r(typeof l=="number"),r(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<=l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},s.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},s.prototype.isubn=function(l){if(r(typeof l=="number"),r(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this._strip()},s.prototype.addn=function(l){return this.clone().iaddn(l)},s.prototype.subn=function(l){return this.clone().isubn(l)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(l,p,m){var w=l.length+m,v;this._expand(w);var k,M=0;for(v=0;v<l.length;v++){k=(this.words[v+m]|0)+M;var b=(l.words[v]|0)*p;k-=b&67108863,M=(k>>26)-(b/67108864|0),this.words[v+m]=k&67108863}for(;v<this.length-m;v++)k=(this.words[v+m]|0)+M,M=k>>26,this.words[v+m]=k&67108863;if(M===0)return this._strip();for(r(M===-1),M=0,v=0;v<this.length;v++)k=-(this.words[v]|0)+M,M=k>>26,this.words[v]=k&67108863;return this.negative=1,this._strip()},s.prototype._wordDiv=function(l,p){var m=this.length-l.length,w=this.clone(),v=l,k=v.words[v.length-1]|0,M=this._countBits(k);m=26-M,m!==0&&(v=v.ushln(m),w.iushln(m),k=v.words[v.length-1]|0);var b=w.length-v.length,d;if(p!=="mod"){d=new s(null),d.length=b+1,d.words=new Array(d.length);for(var I=0;I<d.length;I++)d.words[I]=0}var H=w.clone()._ishlnsubmul(v,1,b);H.negative===0&&(w=H,d&&(d.words[b]=1));for(var V=b-1;V>=0;V--){var Y=(w.words[v.length+V]|0)*67108864+(w.words[v.length+V-1]|0);for(Y=Math.min(Y/k|0,67108863),w._ishlnsubmul(v,Y,V);w.negative!==0;)Y--,w.negative=0,w._ishlnsubmul(v,1,V),w.isZero()||(w.negative^=1);d&&(d.words[V]=Y)}return d&&d._strip(),w._strip(),p!=="div"&&m!==0&&w.iushrn(m),{div:d||null,mod:w}},s.prototype.divmod=function(l,p,m){if(r(!l.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var w,v,k;return this.negative!==0&&l.negative===0?(k=this.neg().divmod(l,p),p!=="mod"&&(w=k.div.neg()),p!=="div"&&(v=k.mod.neg(),m&&v.negative!==0&&v.iadd(l)),{div:w,mod:v}):this.negative===0&&l.negative!==0?(k=this.divmod(l.neg(),p),p!=="mod"&&(w=k.div.neg()),{div:w,mod:k.mod}):this.negative&l.negative?(k=this.neg().divmod(l.neg(),p),p!=="div"&&(v=k.mod.neg(),m&&v.negative!==0&&v.isub(l)),{div:k.div,mod:v}):l.length>this.length||this.cmp(l)<0?{div:new s(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new s(this.modrn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new s(this.modrn(l.words[0]))}:this._wordDiv(l,p)},s.prototype.div=function(l){return this.divmod(l,"div",!1).div},s.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},s.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},s.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var m=p.div.negative!==0?p.mod.isub(l):p.mod,w=l.ushrn(1),v=l.andln(1),k=m.cmp(w);return k<0||v===1&&k===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},s.prototype.modrn=function(l){var p=l<0;p&&(l=-l),r(l<=67108863);for(var m=(1<<26)%l,w=0,v=this.length-1;v>=0;v--)w=(m*w+(this.words[v]|0))%l;return p?-w:w},s.prototype.modn=function(l){return this.modrn(l)},s.prototype.idivn=function(l){var p=l<0;p&&(l=-l),r(l<=67108863);for(var m=0,w=this.length-1;w>=0;w--){var v=(this.words[w]|0)+m*67108864;this.words[w]=v/l|0,m=v%l}return this._strip(),p?this.ineg():this},s.prototype.divn=function(l){return this.clone().idivn(l)},s.prototype.egcd=function(l){r(l.negative===0),r(!l.isZero());var p=this,m=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var w=new s(1),v=new s(0),k=new s(0),M=new s(1),b=0;p.isEven()&&m.isEven();)p.iushrn(1),m.iushrn(1),++b;for(var d=m.clone(),I=p.clone();!p.isZero();){for(var H=0,V=1;!(p.words[0]&V)&&H<26;++H,V<<=1);if(H>0)for(p.iushrn(H);H-- >0;)(w.isOdd()||v.isOdd())&&(w.iadd(d),v.isub(I)),w.iushrn(1),v.iushrn(1);for(var Y=0,be=1;!(m.words[0]&be)&&Y<26;++Y,be<<=1);if(Y>0)for(m.iushrn(Y);Y-- >0;)(k.isOdd()||M.isOdd())&&(k.iadd(d),M.isub(I)),k.iushrn(1),M.iushrn(1);p.cmp(m)>=0?(p.isub(m),w.isub(k),v.isub(M)):(m.isub(p),k.isub(w),M.isub(v))}return{a:k,b:M,gcd:m.iushln(b)}},s.prototype._invmp=function(l){r(l.negative===0),r(!l.isZero());var p=this,m=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var w=new s(1),v=new s(0),k=m.clone();p.cmpn(1)>0&&m.cmpn(1)>0;){for(var M=0,b=1;!(p.words[0]&b)&&M<26;++M,b<<=1);if(M>0)for(p.iushrn(M);M-- >0;)w.isOdd()&&w.iadd(k),w.iushrn(1);for(var d=0,I=1;!(m.words[0]&I)&&d<26;++d,I<<=1);if(d>0)for(m.iushrn(d);d-- >0;)v.isOdd()&&v.iadd(k),v.iushrn(1);p.cmp(m)>=0?(p.isub(m),w.isub(v)):(m.isub(p),v.isub(w))}var H;return p.cmpn(1)===0?H=w:H=v,H.cmpn(0)<0&&H.iadd(l),H},s.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),m=l.clone();p.negative=0,m.negative=0;for(var w=0;p.isEven()&&m.isEven();w++)p.iushrn(1),m.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;m.isEven();)m.iushrn(1);var v=p.cmp(m);if(v<0){var k=p;p=m,m=k}else if(v===0||m.cmpn(1)===0)break;p.isub(m)}while(!0);return m.iushln(w)},s.prototype.invm=function(l){return this.egcd(l).a.umod(l)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(l){return this.words[0]&l},s.prototype.bincn=function(l){r(typeof l=="number");var p=l%26,m=(l-p)/26,w=1<<p;if(this.length<=m)return this._expand(m+1),this.words[m]|=w,this;for(var v=w,k=m;v!==0&&k<this.length;k++){var M=this.words[k]|0;M+=v,v=M>>>26,M&=67108863,this.words[k]=M}return v!==0&&(this.words[k]=v,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this._strip();var m;if(this.length>1)m=1;else{p&&(l=-l),r(l<=67108863,"Number is too big");var w=this.words[0]|0;m=w===l?0:w<l?-1:1}return this.negative!==0?-m|0:m},s.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},s.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,m=this.length-1;m>=0;m--){var w=this.words[m]|0,v=l.words[m]|0;if(w!==v){w<v?p=-1:w>v&&(p=1);break}}return p},s.prototype.gtn=function(l){return this.cmpn(l)===1},s.prototype.gt=function(l){return this.cmp(l)===1},s.prototype.gten=function(l){return this.cmpn(l)>=0},s.prototype.gte=function(l){return this.cmp(l)>=0},s.prototype.ltn=function(l){return this.cmpn(l)===-1},s.prototype.lt=function(l){return this.cmp(l)===-1},s.prototype.lten=function(l){return this.cmpn(l)<=0},s.prototype.lte=function(l){return this.cmp(l)<=0},s.prototype.eqn=function(l){return this.cmpn(l)===0},s.prototype.eq=function(l){return this.cmp(l)===0},s.red=function(l){return new re(l)},s.prototype.toRed=function(l){return r(!this.red,"Already a number in reduction context"),r(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},s.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(l){return this.red=l,this},s.prototype.forceRed=function(l){return r(!this.red,"Already a number in reduction context"),this._forceRed(l)},s.prototype.redAdd=function(l){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},s.prototype.redIAdd=function(l){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},s.prototype.redSub=function(l){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},s.prototype.redISub=function(l){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},s.prototype.redShl=function(l){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},s.prototype.redMul=function(l){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},s.prototype.redIMul=function(l){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},s.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(l){return r(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var Z={k256:null,p224:null,p192:null,p25519:null};function j(C,l){this.name=C,this.p=new s(l,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}j.prototype._tmp=function(){var l=new s(null);return l.words=new Array(Math.ceil(this.n/13)),l},j.prototype.ireduce=function(l){var p=l,m;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),m=p.bitLength();while(m>this.n);var w=m<this.n?-1:p.ucmp(this.p);return w===0?(p.words[0]=0,p.length=1):w>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},j.prototype.split=function(l,p){l.iushrn(this.n,0,p)},j.prototype.imulK=function(l){return l.imul(this.k)};function X(){j.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}i(X,j),X.prototype.split=function(l,p){for(var m=4194303,w=Math.min(l.length,9),v=0;v<w;v++)p.words[v]=l.words[v];if(p.length=w,l.length<=9){l.words[0]=0,l.length=1;return}var k=l.words[9];for(p.words[p.length++]=k&m,v=10;v<l.length;v++){var M=l.words[v]|0;l.words[v-10]=(M&m)<<4|k>>>22,k=M}k>>>=22,l.words[v-10]=k,k===0&&l.length>10?l.length-=10:l.length-=9},X.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,m=0;m<l.length;m++){var w=l.words[m]|0;p+=w*977,l.words[m]=p&67108863,p=w*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function ee(){j.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}i(ee,j);function Q(){j.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}i(Q,j);function Ae(){j.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}i(Ae,j),Ae.prototype.imulK=function(l){for(var p=0,m=0;m<l.length;m++){var w=(l.words[m]|0)*19+p,v=w&67108863;w>>>=26,l.words[m]=v,p=w}return p!==0&&(l.words[l.length++]=p),l},s._prime=function(l){if(Z[l])return Z[l];var p;if(l==="k256")p=new X;else if(l==="p224")p=new ee;else if(l==="p192")p=new Q;else if(l==="p25519")p=new Ae;else throw new Error("Unknown prime "+l);return Z[l]=p,p};function re(C){if(typeof C=="string"){var l=s._prime(C);this.m=l.p,this.prime=l}else r(C.gtn(1),"modulus must be greater than 1"),this.m=C,this.prime=null}re.prototype._verify1=function(l){r(l.negative===0,"red works only with positives"),r(l.red,"red works only with red numbers")},re.prototype._verify2=function(l,p){r((l.negative|p.negative)===0,"red works only with positives"),r(l.red&&l.red===p.red,"red works only with red numbers")},re.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):(g(l,l.umod(this.m)._forceRed(this)),l)},re.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},re.prototype.add=function(l,p){this._verify2(l,p);var m=l.add(p);return m.cmp(this.m)>=0&&m.isub(this.m),m._forceRed(this)},re.prototype.iadd=function(l,p){this._verify2(l,p);var m=l.iadd(p);return m.cmp(this.m)>=0&&m.isub(this.m),m},re.prototype.sub=function(l,p){this._verify2(l,p);var m=l.sub(p);return m.cmpn(0)<0&&m.iadd(this.m),m._forceRed(this)},re.prototype.isub=function(l,p){this._verify2(l,p);var m=l.isub(p);return m.cmpn(0)<0&&m.iadd(this.m),m},re.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},re.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},re.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},re.prototype.isqr=function(l){return this.imul(l,l.clone())},re.prototype.sqr=function(l){return this.mul(l,l)},re.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(r(p%2===1),p===3){var m=this.m.add(new s(1)).iushrn(2);return this.pow(l,m)}for(var w=this.m.subn(1),v=0;!w.isZero()&&w.andln(1)===0;)v++,w.iushrn(1);r(!w.isZero());var k=new s(1).toRed(this),M=k.redNeg(),b=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new s(2*d*d).toRed(this);this.pow(d,b).cmp(M)!==0;)d.redIAdd(M);for(var I=this.pow(d,w),H=this.pow(l,w.addn(1).iushrn(1)),V=this.pow(l,w),Y=v;V.cmp(k)!==0;){for(var be=V,oe=0;be.cmp(k)!==0;oe++)be=be.redSqr();r(oe<Y);var de=this.pow(I,new s(1).iushln(Y-oe-1));H=H.redMul(de),I=de.redSqr(),V=V.redMul(I),Y=oe}return H},re.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},re.prototype.pow=function(l,p){if(p.isZero())return new s(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var m=4,w=new Array(1<<m);w[0]=new s(1).toRed(this),w[1]=l;for(var v=2;v<w.length;v++)w[v]=this.mul(w[v-1],l);var k=w[0],M=0,b=0,d=p.bitLength()%26;for(d===0&&(d=26),v=p.length-1;v>=0;v--){for(var I=p.words[v],H=d-1;H>=0;H--){var V=I>>H&1;if(k!==w[0]&&(k=this.sqr(k)),V===0&&M===0){b=0;continue}M<<=1,M|=V,b++,!(b!==m&&(v!==0||H!==0))&&(k=this.mul(k,w[M]),b=0,M=0)}d=26}return k},re.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},re.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},s.mont=function(l){return new he(l)};function he(C){re.call(this,C),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}i(he,re),he.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},he.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},he.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var m=l.imul(p),w=m.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=m.isub(w).iushrn(this.shift),k=v;return v.cmp(this.m)>=0?k=v.isub(this.m):v.cmpn(0)<0&&(k=v.iadd(this.m)),k._forceRed(this)},he.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new s(0)._forceRed(this);var m=l.mul(p),w=m.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=m.isub(w).iushrn(this.shift),k=v;return v.cmp(this.m)>=0?k=v.isub(this.m):v.cmpn(0)<0&&(k=v.iadd(this.m)),k._forceRed(this)},he.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(n,_n)})(Hl);var Ip=Hl.exports;const Rh=Do(Ip);var Cc={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(n,e){var t=pe,r=t.Buffer;function i(o,a){for(var c in o)a[c]=o[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?n.exports=t:(i(t,e),e.Buffer=s);function s(o,a,c){return r(o,a,c)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(o,a,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,c)},s.alloc=function(o,a,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var h=r(o);return a!==void 0?typeof c=="string"?h.fill(a,c):h.fill(a):h.fill(0),h},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}})(Cc,Cc.exports);var gE=Cc.exports,Ms=gE.Buffer;function mE(n){if(n.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var r=0;r<n.length;r++){var i=n.charAt(r),s=i.charCodeAt(0);if(e[s]!==255)throw new TypeError(i+" is ambiguous");e[s]=r}var o=n.length,a=n.charAt(0),c=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function g(x){if((Array.isArray(x)||x instanceof Uint8Array)&&(x=Ms.from(x)),!Ms.isBuffer(x))throw new TypeError("Expected Buffer");if(x.length===0)return"";for(var T=0,R=0,A=0,D=x.length;A!==D&&x[A]===0;)A++,T++;for(var U=(D-A)*h+1>>>0,L=new Uint8Array(U);A!==D;){for(var q=x[A],Z=0,j=U-1;(q!==0||Z<R)&&j!==-1;j--,Z++)q+=256*L[j]>>>0,L[j]=q%o>>>0,q=q/o>>>0;if(q!==0)throw new Error("Non-zero carry");R=Z,A++}for(var X=U-R;X!==U&&L[X]===0;)X++;for(var ee=a.repeat(T);X<U;++X)ee+=n.charAt(L[X]);return ee}function y(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return Ms.alloc(0);for(var T=0,R=0,A=0;x[T]===a;)R++,T++;for(var D=(x.length-T)*c+1>>>0,U=new Uint8Array(D);T<x.length;){var L=e[x.charCodeAt(T)];if(L===255)return;for(var q=0,Z=D-1;(L!==0||q<A)&&Z!==-1;Z--,q++)L+=o*U[Z]>>>0,U[Z]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");A=q,T++}for(var j=D-A;j!==D&&U[j]===0;)j++;var X=Ms.allocUnsafe(R+(D-j));X.fill(0,0,R);for(var ee=R;j!==D;)X[ee++]=U[j++];return X}function E(x){var T=y(x);if(T)return T;throw new Error("Non-base"+o+" character")}return{encode:g,decodeUnsafe:y,decode:E}}var yE=mE,_E=yE,wE="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",xp=_E(wE);const Lt=Do(xp),bE=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Zn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xn=new Uint32Array(64);class vE extends fp{constructor(){super(64,32,8,!1),this.A=Zn[0]|0,this.B=Zn[1]|0,this.C=Zn[2]|0,this.D=Zn[3]|0,this.E=Zn[4]|0,this.F=Zn[5]|0,this.G=Zn[6]|0,this.H=Zn[7]|0}get(){const{A:e,B:t,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,r,i,s,o,a,c]}set(e,t,r,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let y=0;y<16;y++,t+=4)Xn[y]=e.getUint32(t,!1);for(let y=16;y<64;y++){const E=Xn[y-15],x=Xn[y-2],T=bn(E,7)^bn(E,18)^E>>>3,R=bn(x,17)^bn(x,19)^x>>>10;Xn[y]=R+Xn[y-7]+T+Xn[y-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:h,H:g}=this;for(let y=0;y<64;y++){const E=bn(a,6)^bn(a,11)^bn(a,25),x=g+E+s1(a,c,h)+bE[y]+Xn[y]|0,R=(bn(r,2)^bn(r,13)^bn(r,22))+o1(r,i,s)|0;g=h,h=c,c=a,a=o+x|0,o=s,s=i,i=r,r=x+R|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,h=h+this.G|0,g=g+this.H|0,this.set(r,i,s,o,a,c,h,g)}roundClean(){Xn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Tc=hp(()=>new vE);var Bt={};function Bn(n,e,t){return e<=n&&n<=t}function qo(n){if(n===void 0)return{};if(n===Object(n))return n;throw TypeError("Could not convert argument to dictionary")}function EE(n){for(var e=String(n),t=e.length,r=0,i=[];r<t;){var s=e.charCodeAt(r);if(s<55296||s>57343)i.push(s);else if(56320<=s&&s<=57343)i.push(65533);else if(55296<=s&&s<=56319)if(r===t-1)i.push(65533);else{var o=n.charCodeAt(r+1);if(56320<=o&&o<=57343){var a=s&1023,c=o&1023;i.push(65536+(a<<10)+c),r+=1}else i.push(65533)}r+=1}return i}function SE(n){for(var e="",t=0;t<n.length;++t){var r=n[t];r<=65535?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return e}var ho=-1;function zl(n){this.tokens=[].slice.call(n)}zl.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():ho},prepend:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.unshift(e.pop());else this.tokens.unshift(n)},push:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.push(e.shift());else this.tokens.push(n)}};var mi=-1;function za(n,e){if(n)throw TypeError("Decoder error");return e||65533}var fo="utf-8";function po(n,e){if(!(this instanceof po))return new po(n,e);if(n=n!==void 0?String(n).toLowerCase():fo,n!==fo)throw new Error("Encoding not supported. Only utf-8 is supported");e=qo(e),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=!!e.fatal,this._ignoreBOM=!!e.ignoreBOM,Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}po.prototype={decode:function(e,t){var r;typeof e=="object"&&e instanceof ArrayBuffer?r=new Uint8Array(e):typeof e=="object"&&"buffer"in e&&e.buffer instanceof ArrayBuffer?r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):r=new Uint8Array(0),t=qo(t),this._streaming||(this._decoder=new IE({fatal:this._fatal}),this._BOMseen=!1),this._streaming=!!t.stream;for(var i=new zl(r),s=[],o;!i.endOfStream()&&(o=this._decoder.handler(i,i.read()),o!==mi);)o!==null&&(Array.isArray(o)?s.push.apply(s,o):s.push(o));if(!this._streaming){do{if(o=this._decoder.handler(i,i.read()),o===mi)break;o!==null&&(Array.isArray(o)?s.push.apply(s,o):s.push(o))}while(!i.endOfStream());this._decoder=null}return s.length&&["utf-8"].indexOf(this.encoding)!==-1&&!this._ignoreBOM&&!this._BOMseen&&(s[0]===65279?(this._BOMseen=!0,s.shift()):this._BOMseen=!0),SE(s)}};function go(n,e){if(!(this instanceof go))return new go(n,e);if(n=n!==void 0?String(n).toLowerCase():fo,n!==fo)throw new Error("Encoding not supported. Only utf-8 is supported");e=qo(e),this._streaming=!1,this._encoder=null,this._options={fatal:!!e.fatal},Object.defineProperty(this,"encoding",{value:"utf-8"})}go.prototype={encode:function(e,t){e=e?String(e):"",t=qo(t),this._streaming||(this._encoder=new xE(this._options)),this._streaming=!!t.stream;for(var r=[],i=new zl(EE(e)),s;!i.endOfStream()&&(s=this._encoder.handler(i,i.read()),s!==mi);)Array.isArray(s)?r.push.apply(r,s):r.push(s);if(!this._streaming){for(;s=this._encoder.handler(i,i.read()),s!==mi;)Array.isArray(s)?r.push.apply(r,s):r.push(s);this._encoder=null}return new Uint8Array(r)}};function IE(n){var e=n.fatal,t=0,r=0,i=0,s=128,o=191;this.handler=function(a,c){if(c===ho&&i!==0)return i=0,za(e);if(c===ho)return mi;if(i===0){if(Bn(c,0,127))return c;if(Bn(c,194,223))i=1,t=c-192;else if(Bn(c,224,239))c===224&&(s=160),c===237&&(o=159),i=2,t=c-224;else if(Bn(c,240,244))c===240&&(s=144),c===244&&(o=143),i=3,t=c-240;else return za(e);return t=t<<6*i,null}if(!Bn(c,s,o))return t=i=r=0,s=128,o=191,a.prepend(c),za(e);if(s=128,o=191,r+=1,t+=c-128<<6*(i-r),r!==i)return null;var h=t;return t=i=r=0,h}}function xE(n){n.fatal,this.handler=function(e,t){if(t===ho)return mi;if(Bn(t,0,127))return t;var r,i;Bn(t,128,2047)?(r=1,i=192):Bn(t,2048,65535)?(r=2,i=224):Bn(t,65536,1114111)&&(r=3,i=240);for(var s=[(t>>6*r)+i];r>0;){var o=t>>6*(r-1);s.push(128|o&63),r-=1}return s}}const kE=Object.freeze(Object.defineProperty({__proto__:null,TextDecoder:po,TextEncoder:go},Symbol.toStringTag,{value:"Module"})),AE=Bl(kE);var CE=_n&&_n.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),TE=_n&&_n.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Cn=_n&&_n.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},RE=_n&&_n.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.hasOwnProperty.call(n,t)&&CE(e,n,t);return TE(e,n),e},kp=_n&&_n.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Bt,"__esModule",{value:!0});var Ap=Bt.deserializeUnchecked=Bp=Bt.deserialize=Np=Bt.serialize=Bt.BinaryReader=Bt.BinaryWriter=Bt.BorshError=Bt.baseDecode=Bt.baseEncode=void 0;const or=kp(Ip),Cp=kp(xp),ME=RE(AE),NE=typeof TextDecoder!="function"?ME.TextDecoder:TextDecoder,BE=new NE("utf-8",{fatal:!0});function PE(n){return typeof n=="string"&&(n=Buffer.from(n,"utf8")),Cp.default.encode(Buffer.from(n))}Bt.baseEncode=PE;function LE(n){return Buffer.from(Cp.default.decode(n))}Bt.baseDecode=LE;const $a=1024;class zt extends Error{constructor(e){super(e),this.fieldPath=[],this.originalMessage=e}addToFieldPath(e){this.fieldPath.splice(0,0,e),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}Bt.BorshError=zt;class Tp{constructor(){this.buf=Buffer.alloc($a),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=Buffer.concat([this.buf,Buffer.alloc($a)]))}writeU8(e){this.maybeResize(),this.buf.writeUInt8(e,this.length),this.length+=1}writeU16(e){this.maybeResize(),this.buf.writeUInt16LE(e,this.length),this.length+=2}writeU32(e){this.maybeResize(),this.buf.writeUInt32LE(e,this.length),this.length+=4}writeU64(e){this.maybeResize(),this.writeBuffer(Buffer.from(new or.default(e).toArray("le",8)))}writeU128(e){this.maybeResize(),this.writeBuffer(Buffer.from(new or.default(e).toArray("le",16)))}writeU256(e){this.maybeResize(),this.writeBuffer(Buffer.from(new or.default(e).toArray("le",32)))}writeU512(e){this.maybeResize(),this.writeBuffer(Buffer.from(new or.default(e).toArray("le",64)))}writeBuffer(e){this.buf=Buffer.concat([Buffer.from(this.buf.subarray(0,this.length)),e,Buffer.alloc($a)]),this.length+=e.length}writeString(e){this.maybeResize();const t=Buffer.from(e,"utf8");this.writeU32(t.length),this.writeBuffer(t)}writeFixedArray(e){this.writeBuffer(Buffer.from(e))}writeArray(e,t){this.maybeResize(),this.writeU32(e.length);for(const r of e)this.maybeResize(),t(r)}toArray(){return this.buf.subarray(0,this.length)}}Bt.BinaryWriter=Tp;function Tn(n,e,t){const r=t.value;t.value=function(...i){try{return r.apply(this,i)}catch(s){if(s instanceof RangeError){const o=s.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(o)>=0)throw new zt("Reached the end of buffer when deserializing")}throw s}}}class Qt{constructor(e){this.buf=e,this.offset=0}readU8(){const e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readU16(){const e=this.buf.readUInt16LE(this.offset);return this.offset+=2,e}readU32(){const e=this.buf.readUInt32LE(this.offset);return this.offset+=4,e}readU64(){const e=this.readBuffer(8);return new or.default(e,"le")}readU128(){const e=this.readBuffer(16);return new or.default(e,"le")}readU256(){const e=this.readBuffer(32);return new or.default(e,"le")}readU512(){const e=this.readBuffer(64);return new or.default(e,"le")}readBuffer(e){if(this.offset+e>this.buf.length)throw new zt(`Expected buffer length ${e} isn't within bounds`);const t=this.buf.slice(this.offset,this.offset+e);return this.offset+=e,t}readString(){const e=this.readU32(),t=this.readBuffer(e);try{return BE.decode(t)}catch(r){throw new zt(`Error decoding UTF-8 string: ${r}`)}}readFixedArray(e){return new Uint8Array(this.readBuffer(e))}readArray(e){const t=this.readU32(),r=Array();for(let i=0;i<t;++i)r.push(e());return r}}Cn([Tn],Qt.prototype,"readU8",null);Cn([Tn],Qt.prototype,"readU16",null);Cn([Tn],Qt.prototype,"readU32",null);Cn([Tn],Qt.prototype,"readU64",null);Cn([Tn],Qt.prototype,"readU128",null);Cn([Tn],Qt.prototype,"readU256",null);Cn([Tn],Qt.prototype,"readU512",null);Cn([Tn],Qt.prototype,"readString",null);Cn([Tn],Qt.prototype,"readFixedArray",null);Cn([Tn],Qt.prototype,"readArray",null);Bt.BinaryReader=Qt;function Rp(n){return n.charAt(0).toUpperCase()+n.slice(1)}function vr(n,e,t,r,i){try{if(typeof r=="string")i[`write${Rp(r)}`](t);else if(r instanceof Array)if(typeof r[0]=="number"){if(t.length!==r[0])throw new zt(`Expecting byte array of length ${r[0]}, but got ${t.length} bytes`);i.writeFixedArray(t)}else if(r.length===2&&typeof r[1]=="number"){if(t.length!==r[1])throw new zt(`Expecting byte array of length ${r[1]}, but got ${t.length} bytes`);for(let s=0;s<r[1];s++)vr(n,null,t[s],r[0],i)}else i.writeArray(t,s=>{vr(n,e,s,r[0],i)});else if(r.kind!==void 0)switch(r.kind){case"option":{t==null?i.writeU8(0):(i.writeU8(1),vr(n,e,t,r.type,i));break}case"map":{i.writeU32(t.size),t.forEach((s,o)=>{vr(n,e,o,r.key,i),vr(n,e,s,r.value,i)});break}default:throw new zt(`FieldType ${r} unrecognized`)}else Mp(n,t,i)}catch(s){throw s instanceof zt&&s.addToFieldPath(e),s}}function Mp(n,e,t){if(typeof e.borshSerialize=="function"){e.borshSerialize(t);return}const r=n.get(e.constructor);if(!r)throw new zt(`Class ${e.constructor.name} is missing in schema`);if(r.kind==="struct")r.fields.map(([i,s])=>{vr(n,i,e[i],s,t)});else if(r.kind==="enum"){const i=e[r.field];for(let s=0;s<r.values.length;++s){const[o,a]=r.values[s];if(o===i){t.writeU8(s),vr(n,o,e[o],a,t);break}}}else throw new zt(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function OE(n,e,t=Tp){const r=new t;return Mp(n,e,r),r.toArray()}var Np=Bt.serialize=OE;function Er(n,e,t,r){try{if(typeof t=="string")return r[`read${Rp(t)}`]();if(t instanceof Array){if(typeof t[0]=="number")return r.readFixedArray(t[0]);if(typeof t[1]=="number"){const i=[];for(let s=0;s<t[1];s++)i.push(Er(n,null,t[0],r));return i}else return r.readArray(()=>Er(n,e,t[0],r))}if(t.kind==="option")return r.readU8()?Er(n,e,t.type,r):void 0;if(t.kind==="map"){let i=new Map;const s=r.readU32();for(let o=0;o<s;o++){const a=Er(n,e,t.key,r),c=Er(n,e,t.value,r);i.set(a,c)}return i}return $l(n,t,r)}catch(i){throw i instanceof zt&&i.addToFieldPath(e),i}}function $l(n,e,t){if(typeof e.borshDeserialize=="function")return e.borshDeserialize(t);const r=n.get(e);if(!r)throw new zt(`Class ${e.name} is missing in schema`);if(r.kind==="struct"){const i={};for(const[s,o]of n.get(e).fields)i[s]=Er(n,s,o,t);return new e(i)}if(r.kind==="enum"){const i=t.readU8();if(i>=r.values.length)throw new zt(`Enum index: ${i} is out of range`);const[s,o]=r.values[i],a=Er(n,s,o,t);return new e({[s]:a})}throw new zt(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function DE(n,e,t,r=Qt){const i=new r(t),s=$l(n,e,i);if(i.offset<t.length)throw new zt(`Unexpected ${t.length-i.offset} bytes after deserialized data`);return s}var Bp=Bt.deserialize=DE;function FE(n,e,t,r=Qt){const i=new r(t);return $l(n,e,i)}Ap=Bt.deserializeUnchecked=FE;var O={};Object.defineProperty(O,"__esModule",{value:!0});O.s16=O.s8=O.nu64be=O.u48be=O.u40be=O.u32be=O.u24be=O.u16be=Mt=O.nu64=O.u48=O.u40=ie=O.u32=O.u24=rn=O.u16=Me=O.u8=kr=O.offset=O.greedy=O.Constant=O.UTF8=O.CString=O.Blob=O.Boolean=O.BitField=O.BitStructure=O.VariantLayout=O.Union=O.UnionLayoutDiscriminator=O.UnionDiscriminator=O.Structure=O.Sequence=O.DoubleBE=O.Double=O.FloatBE=O.Float=O.NearInt64BE=O.NearInt64=O.NearUInt64BE=O.NearUInt64=O.IntBE=O.Int=O.UIntBE=O.UInt=O.OffsetLayout=O.GreedyCount=O.ExternalLayout=O.bindConstructorLayout=O.nameWithProperty=O.Layout=O.uint8ArrayToBuffer=O.checkUint8Array=void 0;O.constant=O.utf8=O.cstr=Xe=O.blob=O.unionLayoutDiscriminator=O.union=$t=O.seq=O.bits=te=O.struct=O.f64be=O.f64=O.f32be=O.f32=O.ns64be=O.s48be=O.s40be=O.s32be=O.s24be=O.s16be=Xt=O.ns64=O.s48=O.s40=O.s32=O.s24=void 0;const ql=pe;function ki(n){if(!(n instanceof Uint8Array))throw new TypeError("b must be a Uint8Array")}O.checkUint8Array=ki;function Re(n){return ki(n),ql.Buffer.from(n.buffer,n.byteOffset,n.length)}O.uint8ArrayToBuffer=Re;class Ne{constructor(e,t){if(!Number.isInteger(e))throw new TypeError("span must be an integer");this.span=e,this.property=t}makeDestinationObject(){return{}}getSpan(e,t){if(0>this.span)throw new RangeError("indeterminate span");return this.span}replicate(e){const t=Object.create(this.constructor.prototype);return Object.assign(t,this),t.property=e,t}fromArray(e){}}O.Layout=Ne;function Vl(n,e){return e.property?n+"["+e.property+"]":n}O.nameWithProperty=Vl;function UE(n,e){if(typeof n!="function")throw new TypeError("Class must be constructor");if(Object.prototype.hasOwnProperty.call(n,"layout_"))throw new Error("Class is already bound to a layout");if(!(e&&e instanceof Ne))throw new TypeError("layout must be a Layout");if(Object.prototype.hasOwnProperty.call(e,"boundConstructor_"))throw new Error("layout is already bound to a constructor");n.layout_=e,e.boundConstructor_=n,e.makeDestinationObject=()=>new n,Object.defineProperty(n.prototype,"encode",{value(t,r){return e.encode(this,t,r)},writable:!0}),Object.defineProperty(n,"decode",{value(t,r){return e.decode(t,r)},writable:!0})}O.bindConstructorLayout=UE;class Jt extends Ne{isCount(){throw new Error("ExternalLayout is abstract")}}O.ExternalLayout=Jt;class Pp extends Jt{constructor(e=1,t){if(!Number.isInteger(e)||0>=e)throw new TypeError("elementSpan must be a (positive) integer");super(-1,t),this.elementSpan=e}isCount(){return!0}decode(e,t=0){ki(e);const r=e.length-t;return Math.floor(r/this.elementSpan)}encode(e,t,r){return 0}}O.GreedyCount=Pp;class Gl extends Jt{constructor(e,t=0,r){if(!(e instanceof Ne))throw new TypeError("layout must be a Layout");if(!Number.isInteger(t))throw new TypeError("offset must be integer or undefined");super(e.span,r||e.property),this.layout=e,this.offset=t}isCount(){return this.layout instanceof un||this.layout instanceof yn}decode(e,t=0){return this.layout.decode(e,t+this.offset)}encode(e,t,r=0){return this.layout.encode(e,t,r+this.offset)}}O.OffsetLayout=Gl;class un extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readUIntLE(t,this.span)}encode(e,t,r=0){return Re(t).writeUIntLE(e,r,this.span),this.span}}O.UInt=un;class yn extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readUIntBE(t,this.span)}encode(e,t,r=0){return Re(t).writeUIntBE(e,r,this.span),this.span}}O.UIntBE=yn;class Dr extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readIntLE(t,this.span)}encode(e,t,r=0){return Re(t).writeIntLE(e,r,this.span),this.span}}O.Int=Dr;class Ai extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readIntBE(t,this.span)}encode(e,t,r=0){return Re(t).writeIntBE(e,r,this.span),this.span}}O.IntBE=Ai;const Rc=Math.pow(2,32);function Vo(n){const e=Math.floor(n/Rc),t=n-e*Rc;return{hi32:e,lo32:t}}function Go(n,e){return n*Rc+e}class Lp extends Ne{constructor(e){super(8,e)}decode(e,t=0){const r=Re(e),i=r.readUInt32LE(t),s=r.readUInt32LE(t+4);return Go(s,i)}encode(e,t,r=0){const i=Vo(e),s=Re(t);return s.writeUInt32LE(i.lo32,r),s.writeUInt32LE(i.hi32,r+4),8}}O.NearUInt64=Lp;class Op extends Ne{constructor(e){super(8,e)}decode(e,t=0){const r=Re(e),i=r.readUInt32BE(t),s=r.readUInt32BE(t+4);return Go(i,s)}encode(e,t,r=0){const i=Vo(e),s=Re(t);return s.writeUInt32BE(i.hi32,r),s.writeUInt32BE(i.lo32,r+4),8}}O.NearUInt64BE=Op;class Dp extends Ne{constructor(e){super(8,e)}decode(e,t=0){const r=Re(e),i=r.readUInt32LE(t),s=r.readInt32LE(t+4);return Go(s,i)}encode(e,t,r=0){const i=Vo(e),s=Re(t);return s.writeUInt32LE(i.lo32,r),s.writeInt32LE(i.hi32,r+4),8}}O.NearInt64=Dp;class Fp extends Ne{constructor(e){super(8,e)}decode(e,t=0){const r=Re(e),i=r.readInt32BE(t),s=r.readUInt32BE(t+4);return Go(i,s)}encode(e,t,r=0){const i=Vo(e),s=Re(t);return s.writeInt32BE(i.hi32,r),s.writeUInt32BE(i.lo32,r+4),8}}O.NearInt64BE=Fp;class Up extends Ne{constructor(e){super(4,e)}decode(e,t=0){return Re(e).readFloatLE(t)}encode(e,t,r=0){return Re(t).writeFloatLE(e,r),4}}O.Float=Up;class Wp extends Ne{constructor(e){super(4,e)}decode(e,t=0){return Re(e).readFloatBE(t)}encode(e,t,r=0){return Re(t).writeFloatBE(e,r),4}}O.FloatBE=Wp;class Hp extends Ne{constructor(e){super(8,e)}decode(e,t=0){return Re(e).readDoubleLE(t)}encode(e,t,r=0){return Re(t).writeDoubleLE(e,r),8}}O.Double=Hp;class zp extends Ne{constructor(e){super(8,e)}decode(e,t=0){return Re(e).readDoubleBE(t)}encode(e,t,r=0){return Re(t).writeDoubleBE(e,r),8}}O.DoubleBE=zp;class $p extends Ne{constructor(e,t,r){if(!(e instanceof Ne))throw new TypeError("elementLayout must be a Layout");if(!(t instanceof Jt&&t.isCount()||Number.isInteger(t)&&0<=t))throw new TypeError("count must be non-negative integer or an unsigned integer ExternalLayout");let i=-1;!(t instanceof Jt)&&0<e.span&&(i=t*e.span),super(i,r),this.elementLayout=e,this.count=t}getSpan(e,t=0){if(0<=this.span)return this.span;let r=0,i=this.count;if(i instanceof Jt&&(i=i.decode(e,t)),0<this.elementLayout.span)r=i*this.elementLayout.span;else{let s=0;for(;s<i;)r+=this.elementLayout.getSpan(e,t+r),++s}return r}decode(e,t=0){const r=[];let i=0,s=this.count;for(s instanceof Jt&&(s=s.decode(e,t));i<s;)r.push(this.elementLayout.decode(e,t)),t+=this.elementLayout.getSpan(e,t),i+=1;return r}encode(e,t,r=0){const i=this.elementLayout,s=e.reduce((o,a)=>o+i.encode(a,t,r+o),0);return this.count instanceof Jt&&this.count.encode(e.length,t,r),s}}O.Sequence=$p;class qp extends Ne{constructor(e,t,r){if(!(Array.isArray(e)&&e.reduce((s,o)=>s&&o instanceof Ne,!0)))throw new TypeError("fields must be array of Layout instances");typeof t=="boolean"&&r===void 0&&(r=t,t=void 0);for(const s of e)if(0>s.span&&s.property===void 0)throw new Error("fields cannot contain unnamed variable-length layout");let i=-1;try{i=e.reduce((s,o)=>s+o.getSpan(),0)}catch{}super(i,t),this.fields=e,this.decodePrefixes=!!r}getSpan(e,t=0){if(0<=this.span)return this.span;let r=0;try{r=this.fields.reduce((i,s)=>{const o=s.getSpan(e,t);return t+=o,i+o},0)}catch{throw new RangeError("indeterminate span")}return r}decode(e,t=0){ki(e);const r=this.makeDestinationObject();for(const i of this.fields)if(i.property!==void 0&&(r[i.property]=i.decode(e,t)),t+=i.getSpan(e,t),this.decodePrefixes&&e.length===t)break;return r}encode(e,t,r=0){const i=r;let s=0,o=0;for(const a of this.fields){let c=a.span;if(o=0<c?c:0,a.property!==void 0){const h=e[a.property];h!==void 0&&(o=a.encode(h,t,r),0>c&&(c=a.getSpan(t,r)))}s=r,r+=c}return s+o-i}fromArray(e){const t=this.makeDestinationObject();for(const r of this.fields)r.property!==void 0&&0<e.length&&(t[r.property]=e.shift());return t}layoutFor(e){if(typeof e!="string")throw new TypeError("property must be string");for(const t of this.fields)if(t.property===e)return t}offsetOf(e){if(typeof e!="string")throw new TypeError("property must be string");let t=0;for(const r of this.fields){if(r.property===e)return t;0>r.span?t=-1:0<=t&&(t+=r.span)}}}O.Structure=qp;class jl{constructor(e){this.property=e}decode(e,t){throw new Error("UnionDiscriminator is abstract")}encode(e,t,r){throw new Error("UnionDiscriminator is abstract")}}O.UnionDiscriminator=jl;class mo extends jl{constructor(e,t){if(!(e instanceof Jt&&e.isCount()))throw new TypeError("layout must be an unsigned integer ExternalLayout");super(t||e.property||"variant"),this.layout=e}decode(e,t){return this.layout.decode(e,t)}encode(e,t,r){return this.layout.encode(e,t,r)}}O.UnionLayoutDiscriminator=mo;class Kl extends Ne{constructor(e,t,r){let i;if(e instanceof un||e instanceof yn)i=new mo(new Gl(e));else if(e instanceof Jt&&e.isCount())i=new mo(e);else if(e instanceof jl)i=e;else throw new TypeError("discr must be a UnionDiscriminator or an unsigned integer layout");if(t===void 0&&(t=null),!(t===null||t instanceof Ne))throw new TypeError("defaultLayout must be null or a Layout");if(t!==null){if(0>t.span)throw new Error("defaultLayout must have constant span");t.property===void 0&&(t=t.replicate("content"))}let s=-1;t&&(s=t.span,0<=s&&(e instanceof un||e instanceof yn)&&(s+=i.layout.span)),super(s,r),this.discriminator=i,this.usesPrefixDiscriminator=e instanceof un||e instanceof yn,this.defaultLayout=t,this.registry={};let o=this.defaultGetSourceVariant.bind(this);this.getSourceVariant=function(a){return o(a)},this.configGetSourceVariant=function(a){o=a.bind(this)}}getSpan(e,t=0){if(0<=this.span)return this.span;const r=this.getVariant(e,t);if(!r)throw new Error("unable to determine span for unrecognized variant");return r.getSpan(e,t)}defaultGetSourceVariant(e){if(Object.prototype.hasOwnProperty.call(e,this.discriminator.property)){if(this.defaultLayout&&this.defaultLayout.property&&Object.prototype.hasOwnProperty.call(e,this.defaultLayout.property))return;const t=this.registry[e[this.discriminator.property]];if(t&&(!t.layout||t.property&&Object.prototype.hasOwnProperty.call(e,t.property)))return t}else for(const t in this.registry){const r=this.registry[t];if(r.property&&Object.prototype.hasOwnProperty.call(e,r.property))return r}throw new Error("unable to infer src variant")}decode(e,t=0){let r;const i=this.discriminator,s=i.decode(e,t),o=this.registry[s];if(o===void 0){const a=this.defaultLayout;let c=0;this.usesPrefixDiscriminator&&(c=i.layout.span),r=this.makeDestinationObject(),r[i.property]=s,r[a.property]=a.decode(e,t+c)}else r=o.decode(e,t);return r}encode(e,t,r=0){const i=this.getSourceVariant(e);if(i===void 0){const s=this.discriminator,o=this.defaultLayout;let a=0;return this.usesPrefixDiscriminator&&(a=s.layout.span),s.encode(e[s.property],t,r),a+o.encode(e[o.property],t,r+a)}return i.encode(e,t,r)}addVariant(e,t,r){const i=new Vp(this,e,t,r);return this.registry[e]=i,i}getVariant(e,t=0){let r;return e instanceof Uint8Array?r=this.discriminator.decode(e,t):r=e,this.registry[r]}}O.Union=Kl;class Vp extends Ne{constructor(e,t,r,i){if(!(e instanceof Kl))throw new TypeError("union must be a Union");if(!Number.isInteger(t)||0>t)throw new TypeError("variant must be a (non-negative) integer");if(typeof r=="string"&&i===void 0&&(i=r,r=null),r){if(!(r instanceof Ne))throw new TypeError("layout must be a Layout");if(e.defaultLayout!==null&&0<=r.span&&r.span>e.defaultLayout.span)throw new Error("variant span exceeds span of containing union");if(typeof i!="string")throw new TypeError("variant must have a String property")}let s=e.span;0>e.span&&(s=r?r.span:0,0<=s&&e.usesPrefixDiscriminator&&(s+=e.discriminator.layout.span)),super(s,i),this.union=e,this.variant=t,this.layout=r||null}getSpan(e,t=0){if(0<=this.span)return this.span;let r=0;this.union.usesPrefixDiscriminator&&(r=this.union.discriminator.layout.span);let i=0;return this.layout&&(i=this.layout.getSpan(e,t+r)),r+i}decode(e,t=0){const r=this.makeDestinationObject();if(this!==this.union.getVariant(e,t))throw new Error("variant mismatch");let i=0;return this.union.usesPrefixDiscriminator&&(i=this.union.discriminator.layout.span),this.layout?r[this.property]=this.layout.decode(e,t+i):this.property?r[this.property]=!0:this.union.usesPrefixDiscriminator&&(r[this.union.discriminator.property]=this.variant),r}encode(e,t,r=0){let i=0;if(this.union.usesPrefixDiscriminator&&(i=this.union.discriminator.layout.span),this.layout&&!Object.prototype.hasOwnProperty.call(e,this.property))throw new TypeError("variant lacks property "+this.property);this.union.discriminator.encode(this.variant,t,r);let s=i;if(this.layout&&(this.layout.encode(e[this.property],t,r+i),s+=this.layout.getSpan(t,r+i),0<=this.union.span&&s>this.union.span))throw new Error("encoded variant overruns containing union");return s}fromArray(e){if(this.layout)return this.layout.fromArray(e)}}O.VariantLayout=Vp;function Gr(n){return 0>n&&(n+=4294967296),n}class Yl extends Ne{constructor(e,t,r){if(!(e instanceof un||e instanceof yn))throw new TypeError("word must be a UInt or UIntBE layout");if(typeof t=="string"&&r===void 0&&(r=t,t=!1),4<e.span)throw new RangeError("word cannot exceed 32 bits");super(e.span,r),this.word=e,this.msb=!!t,this.fields=[];let i=0;this._packedSetValue=function(s){return i=Gr(s),this},this._packedGetValue=function(){return i}}decode(e,t=0){const r=this.makeDestinationObject(),i=this.word.decode(e,t);this._packedSetValue(i);for(const s of this.fields)s.property!==void 0&&(r[s.property]=s.decode(e));return r}encode(e,t,r=0){const i=this.word.decode(t,r);this._packedSetValue(i);for(const s of this.fields)if(s.property!==void 0){const o=e[s.property];o!==void 0&&s.encode(o)}return this.word.encode(this._packedGetValue(),t,r)}addField(e,t){const r=new Jl(this,e,t);return this.fields.push(r),r}addBoolean(e){const t=new Gp(this,e);return this.fields.push(t),t}fieldFor(e){if(typeof e!="string")throw new TypeError("property must be string");for(const t of this.fields)if(t.property===e)return t}}O.BitStructure=Yl;class Jl{constructor(e,t,r){if(!(e instanceof Yl))throw new TypeError("container must be a BitStructure");if(!Number.isInteger(t)||0>=t)throw new TypeError("bits must be positive integer");const i=8*e.span,s=e.fields.reduce((o,a)=>o+a.bits,0);if(t+s>i)throw new Error("bits too long for span remainder ("+(i-s)+" of "+i+" remain)");this.container=e,this.bits=t,this.valueMask=(1<<t)-1,t===32&&(this.valueMask=4294967295),this.start=s,this.container.msb&&(this.start=i-s-t),this.wordMask=Gr(this.valueMask<<this.start),this.property=r}decode(e,t){const r=this.container._packedGetValue();return Gr(r&this.wordMask)>>>this.start}encode(e){if(typeof e!="number"||!Number.isInteger(e)||e!==Gr(e&this.valueMask))throw new TypeError(Vl("BitField.encode",this)+" value must be integer not exceeding "+this.valueMask);const t=this.container._packedGetValue(),r=Gr(e<<this.start);this.container._packedSetValue(Gr(t&~this.wordMask)|r)}}O.BitField=Jl;let Gp=class extends Jl{constructor(e,t){super(e,1,t)}decode(e,t){return!!super.decode(e,t)}encode(e){typeof e=="boolean"&&(e=+e),super.encode(e)}};O.Boolean=Gp;class jp extends Ne{constructor(e,t){if(!(e instanceof Jt&&e.isCount()||Number.isInteger(e)&&0<=e))throw new TypeError("length must be positive integer or an unsigned integer ExternalLayout");let r=-1;e instanceof Jt||(r=e),super(r,t),this.length=e}getSpan(e,t){let r=this.span;return 0>r&&(r=this.length.decode(e,t)),r}decode(e,t=0){let r=this.span;return 0>r&&(r=this.length.decode(e,t)),Re(e).slice(t,t+r)}encode(e,t,r){let i=this.length;if(this.length instanceof Jt&&(i=e.length),!(e instanceof Uint8Array&&i===e.length))throw new TypeError(Vl("Blob.encode",this)+" requires (length "+i+") Uint8Array as src");if(r+i>t.length)throw new RangeError("encoding overruns Uint8Array");const s=Re(e);return Re(t).write(s.toString("hex"),r,i,"hex"),this.length instanceof Jt&&this.length.encode(i,t,r),i}}O.Blob=jp;class Kp extends Ne{constructor(e){super(-1,e)}getSpan(e,t=0){ki(e);let r=t;for(;r<e.length&&e[r]!==0;)r+=1;return 1+r-t}decode(e,t=0){const r=this.getSpan(e,t);return Re(e).slice(t,t+r-1).toString("utf-8")}encode(e,t,r=0){typeof e!="string"&&(e=String(e));const i=ql.Buffer.from(e,"utf8"),s=i.length;if(r+s>t.length)throw new RangeError("encoding overruns Buffer");const o=Re(t);return i.copy(o,r),o[r+s]=0,s+1}}O.CString=Kp;class Yp extends Ne{constructor(e,t){if(typeof e=="string"&&t===void 0&&(t=e,e=void 0),e===void 0)e=-1;else if(!Number.isInteger(e))throw new TypeError("maxSpan must be an integer");super(-1,t),this.maxSpan=e}getSpan(e,t=0){return ki(e),e.length-t}decode(e,t=0){const r=this.getSpan(e,t);if(0<=this.maxSpan&&this.maxSpan<r)throw new RangeError("text length exceeds maxSpan");return Re(e).slice(t,t+r).toString("utf-8")}encode(e,t,r=0){typeof e!="string"&&(e=String(e));const i=ql.Buffer.from(e,"utf8"),s=i.length;if(0<=this.maxSpan&&this.maxSpan<s)throw new RangeError("text length exceeds maxSpan");if(r+s>t.length)throw new RangeError("encoding overruns Buffer");return i.copy(Re(t),r),s}}O.UTF8=Yp;class Jp extends Ne{constructor(e,t){super(0,t),this.value=e}decode(e,t){return this.value}encode(e,t,r){return 0}}O.Constant=Jp;O.greedy=(n,e)=>new Pp(n,e);var kr=O.offset=(n,e,t)=>new Gl(n,e,t),Me=O.u8=n=>new un(1,n),rn=O.u16=n=>new un(2,n);O.u24=n=>new un(3,n);var ie=O.u32=n=>new un(4,n);O.u40=n=>new un(5,n);O.u48=n=>new un(6,n);var Mt=O.nu64=n=>new Lp(n);O.u16be=n=>new yn(2,n);O.u24be=n=>new yn(3,n);O.u32be=n=>new yn(4,n);O.u40be=n=>new yn(5,n);O.u48be=n=>new yn(6,n);O.nu64be=n=>new Op(n);O.s8=n=>new Dr(1,n);O.s16=n=>new Dr(2,n);O.s24=n=>new Dr(3,n);O.s32=n=>new Dr(4,n);O.s40=n=>new Dr(5,n);O.s48=n=>new Dr(6,n);var Xt=O.ns64=n=>new Dp(n);O.s16be=n=>new Ai(2,n);O.s24be=n=>new Ai(3,n);O.s32be=n=>new Ai(4,n);O.s40be=n=>new Ai(5,n);O.s48be=n=>new Ai(6,n);O.ns64be=n=>new Fp(n);O.f32=n=>new Up(n);O.f32be=n=>new Wp(n);O.f64=n=>new Hp(n);O.f64be=n=>new zp(n);var te=O.struct=(n,e,t)=>new qp(n,e,t);O.bits=(n,e,t)=>new Yl(n,e,t);var $t=O.seq=(n,e,t)=>new $p(n,e,t);O.union=(n,e,t)=>new Kl(n,e,t);O.unionLayoutDiscriminator=(n,e)=>new mo(n,e);var Xe=O.blob=(n,e)=>new jp(n,e);O.cstr=n=>new Kp(n);O.utf8=(n,e)=>new Yp(n,e);O.constant=(n,e)=>new Jp(n,e);var ys={};Object.defineProperty(ys,"__esModule",{value:!0});function WE(n){{const e=Buffer.from(n);e.reverse();const t=e.toString("hex");return t.length===0?BigInt(0):BigInt(`0x${t}`)}}var HE=ys.toBigIntLE=WE;function zE(n){{const e=n.toString("hex");return e.length===0?BigInt(0):BigInt(`0x${e}`)}}ys.toBigIntBE=zE;function $E(n,e){{const t=n.toString(16),r=Buffer.from(t.padStart(e*2,"0").slice(0,e*2),"hex");return r.reverse(),r}}var qE=ys.toBufferLE=$E;function VE(n,e){{const t=n.toString(16);return Buffer.from(t.padStart(e*2,"0").slice(0,e*2),"hex")}}ys.toBufferBE=VE;class GE extends TypeError{constructor(e,t){let r;const{message:i,explanation:s,...o}=e,{path:a}=e,c=a.length===0?i:`At path: ${a.join(".")} -- ${i}`;super(s??c),s!=null&&(this.cause=c),Object.assign(this,o),this.name=this.constructor.name,this.failures=()=>r??(r=[e,...t()])}}function jE(n){return _s(n)&&typeof n[Symbol.iterator]=="function"}function _s(n){return typeof n=="object"&&n!=null}function yo(n){return _s(n)&&!Array.isArray(n)}function wn(n){return typeof n=="symbol"?n.toString():typeof n=="string"?JSON.stringify(n):`${n}`}function KE(n){const{done:e,value:t}=n.next();return e?void 0:t}function YE(n,e,t,r){if(n===!0)return;n===!1?n={}:typeof n=="string"&&(n={message:n});const{path:i,branch:s}=e,{type:o}=t,{refinement:a,message:c=`Expected a value of type \`${o}\`${a?` with refinement \`${a}\``:""}, but received: \`${wn(r)}\``}=n;return{value:r,type:o,refinement:a,key:i[i.length-1],path:i,branch:s,...n,message:c}}function*Mh(n,e,t,r){jE(n)||(n=[n]);for(const i of n){const s=YE(i,e,t,r);s&&(yield s)}}function*Zl(n,e,t={}){const{path:r=[],branch:i=[n],coerce:s=!1,mask:o=!1}=t,a={path:r,branch:i,mask:o};s&&(n=e.coercer(n,a));let c="valid";for(const h of e.validator(n,a))h.explanation=t.message,c="not_valid",yield[h,void 0];for(let[h,g,y]of e.entries(n,a)){const E=Zl(g,y,{path:h===void 0?r:[...r,h],branch:h===void 0?i:[...i,g],coerce:s,mask:o,message:t.message});for(const x of E)x[0]?(c=x[0].refinement!=null?"not_refined":"not_valid",yield[x[0],void 0]):s&&(g=x[1],h===void 0?n=g:n instanceof Map?n.set(h,g):n instanceof Set?n.add(g):_s(n)&&(g!==void 0||h in n)&&(n[h]=g))}if(c!=="not_valid")for(const h of e.refiner(n,a))h.explanation=t.message,c="not_refined",yield[h,void 0];c==="valid"&&(yield[void 0,n])}let Rn=class{constructor(e){const{type:t,schema:r,validator:i,refiner:s,coercer:o=c=>c,entries:a=function*(){}}=e;this.type=t,this.schema=r,this.entries=a,this.coercer=o,i?this.validator=(c,h)=>{const g=i(c,h);return Mh(g,h,this,c)}:this.validator=()=>[],s?this.refiner=(c,h)=>{const g=s(c,h);return Mh(g,h,this,c)}:this.refiner=()=>[]}assert(e,t){return JE(e,this,t)}create(e,t){return G(e,this,t)}is(e){return Zp(e,this)}mask(e,t){return ZE(e,this,t)}validate(e,t={}){return ws(e,this,t)}};function JE(n,e,t){const r=ws(n,e,{message:t});if(r[0])throw r[0]}function G(n,e,t){const r=ws(n,e,{coerce:!0,message:t});if(r[0])throw r[0];return r[1]}function ZE(n,e,t){const r=ws(n,e,{coerce:!0,mask:!0,message:t});if(r[0])throw r[0];return r[1]}function Zp(n,e){return!ws(n,e)[0]}function ws(n,e,t={}){const r=Zl(n,e,t),i=KE(r);return i[0]?[new GE(i[0],function*(){for(const o of r)o[0]&&(yield o[0])}),void 0]:[void 0,i[1]]}function Fr(n,e){return new Rn({type:n,schema:null,validator:e})}function XE(){return Fr("any",()=>!0)}function K(n){return new Rn({type:"array",schema:n,*entries(e){if(n&&Array.isArray(e))for(const[t,r]of e.entries())yield[t,r,n]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||`Expected an array value, but received: ${wn(e)}`}})}function kn(){return Fr("boolean",n=>typeof n=="boolean")}function Xl(n){return Fr("instance",e=>e instanceof n||`Expected a \`${n.name}\` instance, but received: ${wn(e)}`)}function je(n){const e=wn(n),t=typeof n;return new Rn({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?n:null,validator(r){return r===n||`Expected the literal \`${e}\`, but received: ${wn(r)}`}})}function QE(){return Fr("never",()=>!1)}function J(n){return new Rn({...n,validator:(e,t)=>e===null||n.validator(e,t),refiner:(e,t)=>e===null||n.refiner(e,t)})}function P(){return Fr("number",n=>typeof n=="number"&&!isNaN(n)||`Expected a number, but received: ${wn(n)}`)}function se(n){return new Rn({...n,validator:(e,t)=>e===void 0||n.validator(e,t),refiner:(e,t)=>e===void 0||n.refiner(e,t)})}function Xp(n,e){return new Rn({type:"record",schema:null,*entries(t){if(_s(t))for(const r in t){const i=t[r];yield[r,r,n],yield[r,i,e]}},validator(t){return yo(t)||`Expected an object, but received: ${wn(t)}`},coercer(t){return yo(t)?{...t}:t}})}function $(){return Fr("string",n=>typeof n=="string"||`Expected a string, but received: ${wn(n)}`)}function Ql(n){const e=QE();return new Rn({type:"tuple",schema:null,*entries(t){if(Array.isArray(t)){const r=Math.max(n.length,t.length);for(let i=0;i<r;i++)yield[i,t[i],n[i]||e]}},validator(t){return Array.isArray(t)||`Expected an array, but received: ${wn(t)}`},coercer(t){return Array.isArray(t)?t.slice():t}})}function W(n){const e=Object.keys(n);return new Rn({type:"type",schema:n,*entries(t){if(_s(t))for(const r of e)yield[r,t[r],n[r]]},validator(t){return yo(t)||`Expected an object, but received: ${wn(t)}`},coercer(t){return yo(t)?{...t}:t}})}function Gt(n){const e=n.map(t=>t.type).join(" | ");return new Rn({type:"union",schema:null,coercer(t,r){for(const i of n){const[s,o]=i.validate(t,{coerce:!0,mask:r.mask});if(!s)return o}return t},validator(t,r){const i=[];for(const s of n){const[...o]=Zl(t,s,r),[a]=o;if(a[0])for(const[c]of o)c&&i.push(c);else return[]}return[`Expected the value to satisfy a union of \`${e}\`, but received: ${wn(t)}`,...i]}})}function Ci(){return Fr("unknown",()=>!0)}function bs(n,e,t){return new Rn({...n,coercer:(r,i)=>Zp(r,e)?n.coercer(t(r,i),i):n.coercer(r,i)})}var Ns,eS=new Uint8Array(16);function Qp(){if(!Ns&&(Ns=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ns))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ns(eS)}const tS=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function jo(n){return typeof n=="string"&&tS.test(n)}var Rt=[];for(var qa=0;qa<256;++qa)Rt.push((qa+256).toString(16).substr(1));function Ko(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Rt[n[e+0]]+Rt[n[e+1]]+Rt[n[e+2]]+Rt[n[e+3]]+"-"+Rt[n[e+4]]+Rt[n[e+5]]+"-"+Rt[n[e+6]]+Rt[n[e+7]]+"-"+Rt[n[e+8]]+Rt[n[e+9]]+"-"+Rt[n[e+10]]+Rt[n[e+11]]+Rt[n[e+12]]+Rt[n[e+13]]+Rt[n[e+14]]+Rt[n[e+15]]).toLowerCase();if(!jo(t))throw TypeError("Stringified UUID is invalid");return t}var Nh,Va,Ga=0,ja=0;function nS(n,e,t){var r=e&&t||0,i=e||new Array(16);n=n||{};var s=n.node||Nh,o=n.clockseq!==void 0?n.clockseq:Va;if(s==null||o==null){var a=n.random||(n.rng||Qp)();s==null&&(s=Nh=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=Va=(a[6]<<8|a[7])&16383)}var c=n.msecs!==void 0?n.msecs:Date.now(),h=n.nsecs!==void 0?n.nsecs:ja+1,g=c-Ga+(h-ja)/1e4;if(g<0&&n.clockseq===void 0&&(o=o+1&16383),(g<0||c>Ga)&&n.nsecs===void 0&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ga=c,ja=h,Va=o,c+=122192928e5;var y=((c&268435455)*1e4+h)%4294967296;i[r++]=y>>>24&255,i[r++]=y>>>16&255,i[r++]=y>>>8&255,i[r++]=y&255;var E=c/4294967296*1e4&268435455;i[r++]=E>>>8&255,i[r++]=E&255,i[r++]=E>>>24&15|16,i[r++]=E>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(var x=0;x<6;++x)i[r+x]=s[x];return e||Ko(i)}function eg(n){if(!jo(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function rS(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var iS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",sS="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function tg(n,e,t){function r(i,s,o,a){if(typeof i=="string"&&(i=rS(i)),typeof s=="string"&&(s=eg(s)),s.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(var h=0;h<16;++h)o[a+h]=c[h];return o}return Ko(c)}try{r.name=n}catch{}return r.DNS=iS,r.URL=sS,r}function oS(n){if(typeof n=="string"){var e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(var t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return aS(cS(lS(n),n.length*8))}function aS(n){for(var e=[],t=n.length*32,r="0123456789abcdef",i=0;i<t;i+=8){var s=n[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);e.push(o)}return e}function ng(n){return(n+64>>>9<<4)+14+1}function cS(n,e){n[e>>5]|=128<<e%32,n[ng(e)-1]=e;for(var t=1732584193,r=-271733879,i=-1732584194,s=271733878,o=0;o<n.length;o+=16){var a=t,c=r,h=i,g=s;t=Dt(t,r,i,s,n[o],7,-680876936),s=Dt(s,t,r,i,n[o+1],12,-389564586),i=Dt(i,s,t,r,n[o+2],17,606105819),r=Dt(r,i,s,t,n[o+3],22,-1044525330),t=Dt(t,r,i,s,n[o+4],7,-176418897),s=Dt(s,t,r,i,n[o+5],12,1200080426),i=Dt(i,s,t,r,n[o+6],17,-1473231341),r=Dt(r,i,s,t,n[o+7],22,-45705983),t=Dt(t,r,i,s,n[o+8],7,1770035416),s=Dt(s,t,r,i,n[o+9],12,-1958414417),i=Dt(i,s,t,r,n[o+10],17,-42063),r=Dt(r,i,s,t,n[o+11],22,-1990404162),t=Dt(t,r,i,s,n[o+12],7,1804603682),s=Dt(s,t,r,i,n[o+13],12,-40341101),i=Dt(i,s,t,r,n[o+14],17,-1502002290),r=Dt(r,i,s,t,n[o+15],22,1236535329),t=Ft(t,r,i,s,n[o+1],5,-165796510),s=Ft(s,t,r,i,n[o+6],9,-1069501632),i=Ft(i,s,t,r,n[o+11],14,643717713),r=Ft(r,i,s,t,n[o],20,-373897302),t=Ft(t,r,i,s,n[o+5],5,-701558691),s=Ft(s,t,r,i,n[o+10],9,38016083),i=Ft(i,s,t,r,n[o+15],14,-660478335),r=Ft(r,i,s,t,n[o+4],20,-405537848),t=Ft(t,r,i,s,n[o+9],5,568446438),s=Ft(s,t,r,i,n[o+14],9,-1019803690),i=Ft(i,s,t,r,n[o+3],14,-187363961),r=Ft(r,i,s,t,n[o+8],20,1163531501),t=Ft(t,r,i,s,n[o+13],5,-1444681467),s=Ft(s,t,r,i,n[o+2],9,-51403784),i=Ft(i,s,t,r,n[o+7],14,1735328473),r=Ft(r,i,s,t,n[o+12],20,-1926607734),t=Ut(t,r,i,s,n[o+5],4,-378558),s=Ut(s,t,r,i,n[o+8],11,-2022574463),i=Ut(i,s,t,r,n[o+11],16,1839030562),r=Ut(r,i,s,t,n[o+14],23,-35309556),t=Ut(t,r,i,s,n[o+1],4,-1530992060),s=Ut(s,t,r,i,n[o+4],11,1272893353),i=Ut(i,s,t,r,n[o+7],16,-155497632),r=Ut(r,i,s,t,n[o+10],23,-1094730640),t=Ut(t,r,i,s,n[o+13],4,681279174),s=Ut(s,t,r,i,n[o],11,-358537222),i=Ut(i,s,t,r,n[o+3],16,-722521979),r=Ut(r,i,s,t,n[o+6],23,76029189),t=Ut(t,r,i,s,n[o+9],4,-640364487),s=Ut(s,t,r,i,n[o+12],11,-421815835),i=Ut(i,s,t,r,n[o+15],16,530742520),r=Ut(r,i,s,t,n[o+2],23,-995338651),t=Wt(t,r,i,s,n[o],6,-198630844),s=Wt(s,t,r,i,n[o+7],10,1126891415),i=Wt(i,s,t,r,n[o+14],15,-1416354905),r=Wt(r,i,s,t,n[o+5],21,-57434055),t=Wt(t,r,i,s,n[o+12],6,1700485571),s=Wt(s,t,r,i,n[o+3],10,-1894986606),i=Wt(i,s,t,r,n[o+10],15,-1051523),r=Wt(r,i,s,t,n[o+1],21,-2054922799),t=Wt(t,r,i,s,n[o+8],6,1873313359),s=Wt(s,t,r,i,n[o+15],10,-30611744),i=Wt(i,s,t,r,n[o+6],15,-1560198380),r=Wt(r,i,s,t,n[o+13],21,1309151649),t=Wt(t,r,i,s,n[o+4],6,-145523070),s=Wt(s,t,r,i,n[o+11],10,-1120210379),i=Wt(i,s,t,r,n[o+2],15,718787259),r=Wt(r,i,s,t,n[o+9],21,-343485551),t=ar(t,a),r=ar(r,c),i=ar(i,h),s=ar(s,g)}return[t,r,i,s]}function lS(n){if(n.length===0)return[];for(var e=n.length*8,t=new Uint32Array(ng(e)),r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function ar(n,e){var t=(n&65535)+(e&65535),r=(n>>16)+(e>>16)+(t>>16);return r<<16|t&65535}function uS(n,e){return n<<e|n>>>32-e}function Yo(n,e,t,r,i,s){return ar(uS(ar(ar(e,n),ar(r,s)),i),t)}function Dt(n,e,t,r,i,s,o){return Yo(e&t|~e&r,n,e,i,s,o)}function Ft(n,e,t,r,i,s,o){return Yo(e&r|t&~r,n,e,i,s,o)}function Ut(n,e,t,r,i,s,o){return Yo(e^t^r,n,e,i,s,o)}function Wt(n,e,t,r,i,s,o){return Yo(t^(e|~r),n,e,i,s,o)}var hS=tg("v3",48,oS);function dS(n,e,t){n=n||{};var r=n.random||(n.rng||Qp)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return Ko(r)}function fS(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function Ka(n,e){return n<<e|n>>>32-e}function pS(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var i=0;i<r.length;++i)n.push(r.charCodeAt(i))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var s=n.length/4+2,o=Math.ceil(s/16),a=new Array(o),c=0;c<o;++c){for(var h=new Uint32Array(16),g=0;g<16;++g)h[g]=n[c*64+g*4]<<24|n[c*64+g*4+1]<<16|n[c*64+g*4+2]<<8|n[c*64+g*4+3];a[c]=h}a[o-1][14]=(n.length-1)*8/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=(n.length-1)*8&4294967295;for(var y=0;y<o;++y){for(var E=new Uint32Array(80),x=0;x<16;++x)E[x]=a[y][x];for(var T=16;T<80;++T)E[T]=Ka(E[T-3]^E[T-8]^E[T-14]^E[T-16],1);for(var R=t[0],A=t[1],D=t[2],U=t[3],L=t[4],q=0;q<80;++q){var Z=Math.floor(q/20),j=Ka(R,5)+fS(Z,A,D,U)+L+e[Z]+E[q]>>>0;L=U,U=D,D=Ka(A,30)>>>0,A=R,R=j}t[0]=t[0]+R>>>0,t[1]=t[1]+A>>>0,t[2]=t[2]+D>>>0,t[3]=t[3]+U>>>0,t[4]=t[4]+L>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var gS=tg("v5",80,pS);const mS="00000000-0000-0000-0000-000000000000";function yS(n){if(!jo(n))throw TypeError("Invalid UUID");return parseInt(n.substr(14,1),16)}const _S=Object.freeze(Object.defineProperty({__proto__:null,NIL:mS,parse:eg,stringify:Ko,v1:nS,v3:hS,v4:dS,v5:gS,validate:jo,version:yS},Symbol.toStringTag,{value:"Module"})),rg=Bl(_S),wS=rg.v4,bS=function(n,e,t,r){if(typeof n!="string")throw new TypeError(n+" must be a string");r=r||{};const i=typeof r.version=="number"?r.version:2;if(i!==1&&i!==2)throw new TypeError(i+" must be 1 or 2");const s={method:n};if(i===2&&(s.jsonrpc="2.0"),e){if(typeof e!="object"&&!Array.isArray(e))throw new TypeError(e+" must be an object, array or omitted");s.params=e}if(typeof t>"u"){const o=typeof r.generator=="function"?r.generator:function(){return wS()};s.id=o(s,r)}else i===2&&t===null?r.notificationIdNull&&(s.id=null):s.id=t;return s};var vS=bS;const ES=rg.v4,SS=vS,ns=function(n,e){if(!(this instanceof ns))return new ns(n,e);e||(e={}),this.options={reviver:typeof e.reviver<"u"?e.reviver:null,replacer:typeof e.replacer<"u"?e.replacer:null,generator:typeof e.generator<"u"?e.generator:function(){return ES()},version:typeof e.version<"u"?e.version:2,notificationIdNull:typeof e.notificationIdNull=="boolean"?e.notificationIdNull:!1},this.callServer=n};var IS=ns;ns.prototype.request=function(n,e,t,r){const i=this;let s=null;const o=Array.isArray(n)&&typeof e=="function";if(this.options.version===1&&o)throw new TypeError("JSON-RPC 1.0 does not support batching");if(o||!o&&n&&typeof n=="object"&&typeof e=="function")r=e,s=n;else{typeof t=="function"&&(r=t,t=void 0);const h=typeof r=="function";try{s=SS(n,e,t,{generator:this.options.generator,version:this.options.version,notificationIdNull:this.options.notificationIdNull})}catch(g){if(h)return r(g);throw g}if(!h)return s}let c;try{c=JSON.stringify(s,this.options.replacer)}catch(h){return r(h)}return this.callServer(c,function(h,g){i._parseResponse(h,g,r)}),s};ns.prototype._parseResponse=function(n,e,t){if(n){t(n);return}if(!e)return t();let r;try{r=JSON.parse(e,this.options.reviver)}catch(i){return t(i)}if(t.length===3)if(Array.isArray(r)){const i=function(o){return typeof o.error<"u"},s=function(o){return!i(o)};return t(null,r.filter(i),r.filter(s))}else return t(null,r.error,r.result);t(null,r)};const xS=Do(IS);var ig={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,h,g){this.fn=c,this.context=h,this.once=g||!1}function s(c,h,g,y,E){if(typeof g!="function")throw new TypeError("The listener must be a function");var x=new i(g,y||c,E),T=t?t+h:h;return c._events[T]?c._events[T].fn?c._events[T]=[c._events[T],x]:c._events[T].push(x):(c._events[T]=x,c._eventsCount++),c}function o(c,h){--c._eventsCount===0?c._events=new r:delete c._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],g,y;if(this._eventsCount===0)return h;for(y in g=this._events)e.call(g,y)&&h.push(t?y.slice(1):y);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(g)):h},a.prototype.listeners=function(h){var g=t?t+h:h,y=this._events[g];if(!y)return[];if(y.fn)return[y.fn];for(var E=0,x=y.length,T=new Array(x);E<x;E++)T[E]=y[E].fn;return T},a.prototype.listenerCount=function(h){var g=t?t+h:h,y=this._events[g];return y?y.fn?1:y.length:0},a.prototype.emit=function(h,g,y,E,x,T){var R=t?t+h:h;if(!this._events[R])return!1;var A=this._events[R],D=arguments.length,U,L;if(A.fn){switch(A.once&&this.removeListener(h,A.fn,void 0,!0),D){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,g),!0;case 3:return A.fn.call(A.context,g,y),!0;case 4:return A.fn.call(A.context,g,y,E),!0;case 5:return A.fn.call(A.context,g,y,E,x),!0;case 6:return A.fn.call(A.context,g,y,E,x,T),!0}for(L=1,U=new Array(D-1);L<D;L++)U[L-1]=arguments[L];A.fn.apply(A.context,U)}else{var q=A.length,Z;for(L=0;L<q;L++)switch(A[L].once&&this.removeListener(h,A[L].fn,void 0,!0),D){case 1:A[L].fn.call(A[L].context);break;case 2:A[L].fn.call(A[L].context,g);break;case 3:A[L].fn.call(A[L].context,g,y);break;case 4:A[L].fn.call(A[L].context,g,y,E);break;default:if(!U)for(Z=1,U=new Array(D-1);Z<D;Z++)U[Z-1]=arguments[Z];A[L].fn.apply(A[L].context,U)}}return!0},a.prototype.on=function(h,g,y){return s(this,h,g,y,!1)},a.prototype.once=function(h,g,y){return s(this,h,g,y,!0)},a.prototype.removeListener=function(h,g,y,E){var x=t?t+h:h;if(!this._events[x])return this;if(!g)return o(this,x),this;var T=this._events[x];if(T.fn)T.fn===g&&(!E||T.once)&&(!y||T.context===y)&&o(this,x);else{for(var R=0,A=[],D=T.length;R<D;R++)(T[R].fn!==g||E&&!T[R].once||y&&T[R].context!==y)&&A.push(T[R]);A.length?this._events[x]=A.length===1?A[0]:A:o(this,x)}return this},a.prototype.removeAllListeners=function(h){var g;return h?(g=t?t+h:h,this._events[g]&&o(this,g)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(ig);var kS=ig.exports;const sg=Do(kS);var AS=class extends sg{constructor(e,t,r){super();Et(this,"socket");this.socket=new window.WebSocket(e,r),this.socket.onopen=()=>this.emit("open"),this.socket.onmessage=i=>this.emit("message",i.data),this.socket.onerror=i=>this.emit("error",i),this.socket.onclose=i=>{this.emit("close",i.code,i.reason)}}send(e,t,r){const i=r||t;try{this.socket.send(e),i()}catch(s){i(s)}}close(e,t){this.socket.close(e,t)}addEventListener(e,t,r){this.socket.addEventListener(e,t,r)}};function CS(n,e){return new AS(n,e)}var TS=class{encode(n){return JSON.stringify(n)}decode(n){return JSON.parse(n)}},RS=class extends sg{constructor(e,t="ws://localhost:8080",{autoconnect:r=!0,reconnect:i=!0,reconnect_interval:s=1e3,max_reconnects:o=5,...a}={},c,h){super();Et(this,"address");Et(this,"rpc_id");Et(this,"queue");Et(this,"options");Et(this,"autoconnect");Et(this,"ready");Et(this,"reconnect");Et(this,"reconnect_timer_id");Et(this,"reconnect_interval");Et(this,"max_reconnects");Et(this,"rest_options");Et(this,"current_reconnects");Et(this,"generate_request_id");Et(this,"socket");Et(this,"webSocketFactory");Et(this,"dataPack");this.webSocketFactory=e,this.queue={},this.rpc_id=0,this.address=t,this.autoconnect=r,this.ready=!1,this.reconnect=i,this.reconnect_timer_id=void 0,this.reconnect_interval=s,this.max_reconnects=o,this.rest_options=a,this.current_reconnects=0,this.generate_request_id=c||(()=>++this.rpc_id),h?this.dataPack=h:this.dataPack=new TS,this.autoconnect&&this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects,...this.rest_options})}connect(){this.socket||this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects,...this.rest_options})}call(e,t,r,i){return!i&&typeof r=="object"&&(i=r,r=null),new Promise((s,o)=>{if(!this.ready)return o(new Error("socket not ready"));const a=this.generate_request_id(e,t),c={jsonrpc:"2.0",method:e,params:t||void 0,id:a};this.socket.send(this.dataPack.encode(c),i,h=>{if(h)return o(h);this.queue[a]={promise:[s,o]},r&&(this.queue[a].timeout=setTimeout(()=>{delete this.queue[a],o(new Error("reply timeout"))},r))})})}async login(e){const t=await this.call("rpc.login",e);if(!t)throw new Error("authentication failed");return t}async listMethods(){return await this.call("__listMethods")}notify(e,t){return new Promise((r,i)=>{if(!this.ready)return i(new Error("socket not ready"));const s={jsonrpc:"2.0",method:e,params:t};this.socket.send(this.dataPack.encode(s),o=>{if(o)return i(o);r()})})}async subscribe(e){typeof e=="string"&&(e=[e]);const t=await this.call("rpc.on",e);if(typeof e=="string"&&t[e]!=="ok")throw new Error("Failed subscribing to an event '"+e+"' with: "+t[e]);return t}async unsubscribe(e){typeof e=="string"&&(e=[e]);const t=await this.call("rpc.off",e);if(typeof e=="string"&&t[e]!=="ok")throw new Error("Failed unsubscribing from an event with: "+t);return t}close(e,t){this.socket.close(e||1e3,t)}setAutoReconnect(e){this.reconnect=e}setReconnectInterval(e){this.reconnect_interval=e}setMaxReconnects(e){this.max_reconnects=e}_connect(e,t){clearTimeout(this.reconnect_timer_id),this.socket=this.webSocketFactory(e,t),this.socket.addEventListener("open",()=>{this.ready=!0,this.emit("open"),this.current_reconnects=0}),this.socket.addEventListener("message",({data:r})=>{r instanceof ArrayBuffer&&(r=pe.Buffer.from(r).toString());try{r=this.dataPack.decode(r)}catch{return}if(r.notification&&this.listeners(r.notification).length){if(!Object.keys(r.params).length)return this.emit(r.notification);const i=[r.notification];if(r.params.constructor===Object)i.push(r.params);else for(let s=0;s<r.params.length;s++)i.push(r.params[s]);return Promise.resolve().then(()=>{this.emit.apply(this,i)})}if(!this.queue[r.id])return r.method?Promise.resolve().then(()=>{this.emit(r.method,r==null?void 0:r.params)}):void 0;"error"in r=="result"in r&&this.queue[r.id].promise[1](new Error('Server response malformed. Response must include either "result" or "error", but not both.')),this.queue[r.id].timeout&&clearTimeout(this.queue[r.id].timeout),r.error?this.queue[r.id].promise[1](r.error):this.queue[r.id].promise[0](r.result),delete this.queue[r.id]}),this.socket.addEventListener("error",r=>this.emit("error",r)),this.socket.addEventListener("close",({code:r,reason:i})=>{this.ready&&setTimeout(()=>this.emit("close",r,i),0),this.ready=!1,this.socket=void 0,r!==1e3&&(this.current_reconnects++,this.reconnect&&(this.max_reconnects>this.current_reconnects||this.max_reconnects===0)&&(this.reconnect_timer_id=setTimeout(()=>this._connect(e,t),this.reconnect_interval)))})}};class og extends up{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,e1(e);const r=Ll(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return uo(this),this.iHash.update(e),this}digestInto(e){uo(this),Uo(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ag=(n,e,t)=>new og(n,e).update(t).digest();ag.create=(n,e)=>new og(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Bh(n){n.lowS!==void 0&&Hn("lowS",n.lowS),n.prehash!==void 0&&Hn("prehash",n.prehash)}function MS(n){const e=Fl(n);xi(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:i}=e;if(t){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:NS,hexToBytes:BS}=H1;class PS extends Error{constructor(e=""){super(e)}}const Nn={Err:PS,_tlv:{encode:(n,e)=>{const{Err:t}=Nn;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,i=Jr(r);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=r>127?Jr(i.length/2|128):"";return Jr(n)+s+i+e},decode(n,e){const{Err:t}=Nn;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const h=e.subarray(r,r+c);if(h.length!==c)throw new t("tlv.decode: length bytes not complete");if(h[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const g of h)o=o<<8|g;if(r+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(n){const{Err:e}=Nn;if(n<Pn)throw new e("integer: negative integers are not allowed");let t=Jr(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=Nn;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return NS(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=Nn,i=typeof n=="string"?BS(n):n;ms(i);const{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:h,l:g}=r.decode(2,c);if(g.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(h)}},hexFromSig(n){const{_tlv:e,_int:t}=Nn,r=e.encode(2,t.encode(n.r)),i=e.encode(2,t.encode(n.s)),s=r+i;return e.encode(48,s)}},Pn=BigInt(0),xt=BigInt(1);BigInt(2);const Ph=BigInt(3);BigInt(4);function LS(n){const e=MS(n),{Fp:t}=e,r=$o(e.n,e.nBitLength),i=e.toBytes||((R,A,D)=>{const U=A.toAffine();return Pr(Uint8Array.from([4]),t.toBytes(U.x),t.toBytes(U.y))}),s=e.fromBytes||(R=>{const A=R.subarray(1),D=t.fromBytes(A.subarray(0,t.BYTES)),U=t.fromBytes(A.subarray(t.BYTES,2*t.BYTES));return{x:D,y:U}});function o(R){const{a:A,b:D}=e,U=t.sqr(R),L=t.mul(U,R);return t.add(t.add(L,t.mul(R,A)),D)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(R){return zo(R,xt,e.n)}function c(R){const{allowedPrivateKeyLengths:A,nByteLength:D,wrapPrivateKey:U,n:L}=e;if(A&&typeof R!="bigint"){if(Nr(R)&&(R=Br(R)),typeof R!="string"||!A.includes(R.length))throw new Error("invalid private key");R=R.padStart(D*2,"0")}let q;try{q=typeof R=="bigint"?R:xr(bt("private key",R,D))}catch{throw new Error("invalid private key, expected hex or "+D+" bytes, got "+typeof R)}return U&&(q=Ge(q,L)),cn("private key",q,xt,L),q}function h(R){if(!(R instanceof E))throw new Error("ProjectivePoint expected")}const g=ts((R,A)=>{const{px:D,py:U,pz:L}=R;if(t.eql(L,t.ONE))return{x:D,y:U};const q=R.is0();A==null&&(A=q?t.ONE:t.inv(L));const Z=t.mul(D,A),j=t.mul(U,A),X=t.mul(L,A);if(q)return{x:t.ZERO,y:t.ZERO};if(!t.eql(X,t.ONE))throw new Error("invZ was invalid");return{x:Z,y:j}}),y=ts(R=>{if(R.is0()){if(e.allowInfinityPoint&&!t.is0(R.py))return;throw new Error("bad point: ZERO")}const{x:A,y:D}=R.toAffine();if(!t.isValid(A)||!t.isValid(D))throw new Error("bad point: x or y not FE");const U=t.sqr(D),L=o(A);if(!t.eql(U,L))throw new Error("bad point: equation left != right");if(!R.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class E{constructor(A,D,U){if(this.px=A,this.py=D,this.pz=U,A==null||!t.isValid(A))throw new Error("x required");if(D==null||!t.isValid(D))throw new Error("y required");if(U==null||!t.isValid(U))throw new Error("z required");Object.freeze(this)}static fromAffine(A){const{x:D,y:U}=A||{};if(!A||!t.isValid(D)||!t.isValid(U))throw new Error("invalid affine point");if(A instanceof E)throw new Error("projective point not allowed");const L=q=>t.eql(q,t.ZERO);return L(D)&&L(U)?E.ZERO:new E(D,U,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(A){const D=t.invertBatch(A.map(U=>U.pz));return A.map((U,L)=>U.toAffine(D[L])).map(E.fromAffine)}static fromHex(A){const D=E.fromAffine(s(bt("pointHex",A)));return D.assertValidity(),D}static fromPrivateKey(A){return E.BASE.multiply(c(A))}static msm(A,D){return Sp(E,r,A,D)}_setWindowSize(A){T.setWindowSize(this,A)}assertValidity(){y(this)}hasEvenY(){const{y:A}=this.toAffine();if(t.isOdd)return!t.isOdd(A);throw new Error("Field doesn't support isOdd")}equals(A){h(A);const{px:D,py:U,pz:L}=this,{px:q,py:Z,pz:j}=A,X=t.eql(t.mul(D,j),t.mul(q,L)),ee=t.eql(t.mul(U,j),t.mul(Z,L));return X&&ee}negate(){return new E(this.px,t.neg(this.py),this.pz)}double(){const{a:A,b:D}=e,U=t.mul(D,Ph),{px:L,py:q,pz:Z}=this;let j=t.ZERO,X=t.ZERO,ee=t.ZERO,Q=t.mul(L,L),Ae=t.mul(q,q),re=t.mul(Z,Z),he=t.mul(L,q);return he=t.add(he,he),ee=t.mul(L,Z),ee=t.add(ee,ee),j=t.mul(A,ee),X=t.mul(U,re),X=t.add(j,X),j=t.sub(Ae,X),X=t.add(Ae,X),X=t.mul(j,X),j=t.mul(he,j),ee=t.mul(U,ee),re=t.mul(A,re),he=t.sub(Q,re),he=t.mul(A,he),he=t.add(he,ee),ee=t.add(Q,Q),Q=t.add(ee,Q),Q=t.add(Q,re),Q=t.mul(Q,he),X=t.add(X,Q),re=t.mul(q,Z),re=t.add(re,re),Q=t.mul(re,he),j=t.sub(j,Q),ee=t.mul(re,Ae),ee=t.add(ee,ee),ee=t.add(ee,ee),new E(j,X,ee)}add(A){h(A);const{px:D,py:U,pz:L}=this,{px:q,py:Z,pz:j}=A;let X=t.ZERO,ee=t.ZERO,Q=t.ZERO;const Ae=e.a,re=t.mul(e.b,Ph);let he=t.mul(D,q),C=t.mul(U,Z),l=t.mul(L,j),p=t.add(D,U),m=t.add(q,Z);p=t.mul(p,m),m=t.add(he,C),p=t.sub(p,m),m=t.add(D,L);let w=t.add(q,j);return m=t.mul(m,w),w=t.add(he,l),m=t.sub(m,w),w=t.add(U,L),X=t.add(Z,j),w=t.mul(w,X),X=t.add(C,l),w=t.sub(w,X),Q=t.mul(Ae,m),X=t.mul(re,l),Q=t.add(X,Q),X=t.sub(C,Q),Q=t.add(C,Q),ee=t.mul(X,Q),C=t.add(he,he),C=t.add(C,he),l=t.mul(Ae,l),m=t.mul(re,m),C=t.add(C,l),l=t.sub(he,l),l=t.mul(Ae,l),m=t.add(m,l),he=t.mul(C,m),ee=t.add(ee,he),he=t.mul(w,m),X=t.mul(p,X),X=t.sub(X,he),he=t.mul(p,C),Q=t.mul(w,Q),Q=t.add(Q,he),new E(X,ee,Q)}subtract(A){return this.add(A.negate())}is0(){return this.equals(E.ZERO)}wNAF(A){return T.wNAFCached(this,A,E.normalizeZ)}multiplyUnsafe(A){const{endo:D,n:U}=e;cn("scalar",A,Pn,U);const L=E.ZERO;if(A===Pn)return L;if(this.is0()||A===xt)return this;if(!D||T.hasPrecomputes(this))return T.wNAFCachedUnsafe(this,A,E.normalizeZ);let{k1neg:q,k1:Z,k2neg:j,k2:X}=D.splitScalar(A),ee=L,Q=L,Ae=this;for(;Z>Pn||X>Pn;)Z&xt&&(ee=ee.add(Ae)),X&xt&&(Q=Q.add(Ae)),Ae=Ae.double(),Z>>=xt,X>>=xt;return q&&(ee=ee.negate()),j&&(Q=Q.negate()),Q=new E(t.mul(Q.px,D.beta),Q.py,Q.pz),ee.add(Q)}multiply(A){const{endo:D,n:U}=e;cn("scalar",A,xt,U);let L,q;if(D){const{k1neg:Z,k1:j,k2neg:X,k2:ee}=D.splitScalar(A);let{p:Q,f:Ae}=this.wNAF(j),{p:re,f:he}=this.wNAF(ee);Q=T.constTimeNegate(Z,Q),re=T.constTimeNegate(X,re),re=new E(t.mul(re.px,D.beta),re.py,re.pz),L=Q.add(re),q=Ae.add(he)}else{const{p:Z,f:j}=this.wNAF(A);L=Z,q=j}return E.normalizeZ([L,q])[0]}multiplyAndAddUnsafe(A,D,U){const L=E.BASE,q=(j,X)=>X===Pn||X===xt||!j.equals(L)?j.multiplyUnsafe(X):j.multiply(X),Z=q(this,D).add(q(A,U));return Z.is0()?void 0:Z}toAffine(A){return g(this,A)}isTorsionFree(){const{h:A,isTorsionFree:D}=e;if(A===xt)return!0;if(D)return D(E,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:A,clearCofactor:D}=e;return A===xt?this:D?D(E,this):this.multiplyUnsafe(e.h)}toRawBytes(A=!0){return Hn("isCompressed",A),this.assertValidity(),i(E,this,A)}toHex(A=!0){return Hn("isCompressed",A),Br(this.toRawBytes(A))}}E.BASE=new E(e.Gx,e.Gy,t.ONE),E.ZERO=new E(t.ZERO,t.ONE,t.ZERO);const x=e.nBitLength,T=Ep(E,e.endo?Math.ceil(x/2):x);return{CURVE:e,ProjectivePoint:E,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function OS(n){const e=Fl(n);return xi(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function DS(n){const e=OS(n),{Fp:t,n:r}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(l){return Ge(l,r)}function a(l){return Ac(l,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:g,isWithinCurveOrder:y}=LS({...e,toBytes(l,p,m){const w=p.toAffine(),v=t.toBytes(w.x),k=Pr;return Hn("isCompressed",m),m?k(Uint8Array.from([p.hasEvenY()?2:3]),v):k(Uint8Array.from([4]),v,t.toBytes(w.y))},fromBytes(l){const p=l.length,m=l[0],w=l.subarray(1);if(p===i&&(m===2||m===3)){const v=xr(w);if(!zo(v,xt,t.ORDER))throw new Error("Point is not on curve");const k=g(v);let M;try{M=t.sqrt(k)}catch(I){const H=I instanceof Error?": "+I.message:"";throw new Error("Point is not on curve"+H)}const b=(M&xt)===xt;return(m&1)===1!==b&&(M=t.neg(M)),{x:v,y:M}}else if(p===s&&m===4){const v=t.fromBytes(w.subarray(0,t.BYTES)),k=t.fromBytes(w.subarray(t.BYTES,2*t.BYTES));return{x:v,y:k}}else{const v=i,k=s;throw new Error("invalid Point, expected length of "+v+", or uncompressed "+k+", got "+p)}}}),E=l=>Br(gi(l,e.nByteLength));function x(l){const p=r>>xt;return l>p}function T(l){return x(l)?o(-l):l}const R=(l,p,m)=>xr(l.slice(p,m));class A{constructor(p,m,w){this.r=p,this.s=m,this.recovery=w,this.assertValidity()}static fromCompact(p){const m=e.nByteLength;return p=bt("compactSignature",p,m*2),new A(R(p,0,m),R(p,m,2*m))}static fromDER(p){const{r:m,s:w}=Nn.toSig(bt("DER",p));return new A(m,w)}assertValidity(){cn("r",this.r,xt,r),cn("s",this.s,xt,r)}addRecoveryBit(p){return new A(this.r,this.s,p)}recoverPublicKey(p){const{r:m,s:w,recovery:v}=this,k=j(bt("msgHash",p));if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");const M=v===2||v===3?m+e.n:m;if(M>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const b=v&1?"03":"02",d=c.fromHex(b+E(M)),I=a(M),H=o(-k*I),V=o(w*I),Y=c.BASE.multiplyAndAddUnsafe(d,H,V);if(!Y)throw new Error("point at infinify");return Y.assertValidity(),Y}hasHighS(){return x(this.s)}normalizeS(){return this.hasHighS()?new A(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return pi(this.toDERHex())}toDERHex(){return Nn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return pi(this.toCompactHex())}toCompactHex(){return E(this.r)+E(this.s)}}const D={isValidPrivateKey(l){try{return h(l),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const l=wp(e.n);return Z1(e.randomBytes(l),e.n)},precompute(l=8,p=c.BASE){return p._setWindowSize(l),p.multiply(BigInt(3)),p}};function U(l,p=!0){return c.fromPrivateKey(l).toRawBytes(p)}function L(l){const p=Nr(l),m=typeof l=="string",w=(p||m)&&l.length;return p?w===i||w===s:m?w===2*i||w===2*s:l instanceof c}function q(l,p,m=!0){if(L(l))throw new Error("first arg must be private key");if(!L(p))throw new Error("second arg must be public key");return c.fromHex(p).multiply(h(l)).toRawBytes(m)}const Z=e.bits2int||function(l){if(l.length>8192)throw new Error("input is too large");const p=xr(l),m=l.length*8-e.nBitLength;return m>0?p>>BigInt(m):p},j=e.bits2int_modN||function(l){return o(Z(l))},X=Dl(e.nBitLength);function ee(l){return cn("num < 2^"+e.nBitLength,l,Pn,X),gi(l,e.nByteLength)}function Q(l,p,m=Ae){if(["recovered","canonical"].some(oe=>oe in m))throw new Error("sign() legacy options not supported");const{hash:w,randomBytes:v}=e;let{lowS:k,prehash:M,extraEntropy:b}=m;k==null&&(k=!0),l=bt("msgHash",l),Bh(m),M&&(l=bt("prehashed msgHash",w(l)));const d=j(l),I=h(p),H=[ee(I),ee(d)];if(b!=null&&b!==!1){const oe=b===!0?v(t.BYTES):b;H.push(bt("extraEntropy",oe))}const V=Pr(...H),Y=d;function be(oe){const de=Z(oe);if(!y(de))return;const Je=a(de),Se=c.BASE.multiply(de).toAffine(),we=o(Se.x);if(we===Pn)return;const nt=o(Je*o(Y+we*I));if(nt===Pn)return;let ke=(Se.x===we?0:2)|Number(Se.y&xt),Ce=nt;return k&&x(nt)&&(Ce=T(nt),ke^=1),new A(we,Ce,ke)}return{seed:V,k2sig:be}}const Ae={lowS:e.lowS,prehash:!1},re={lowS:e.lowS,prehash:!1};function he(l,p,m=Ae){const{seed:w,k2sig:v}=Q(l,p,m),k=e;return mp(k.hash.outputLen,k.nByteLength,k.hmac)(w,v)}c.BASE._setWindowSize(8);function C(l,p,m,w=re){var ke;const v=l;p=bt("msgHash",p),m=bt("publicKey",m);const{lowS:k,prehash:M,format:b}=w;if(Bh(w),"strict"in w)throw new Error("options.strict was renamed to lowS");if(b!==void 0&&b!=="compact"&&b!=="der")throw new Error("format must be compact or der");const d=typeof v=="string"||Nr(v),I=!d&&!b&&typeof v=="object"&&v!==null&&typeof v.r=="bigint"&&typeof v.s=="bigint";if(!d&&!I)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let H,V;try{if(I&&(H=new A(v.r,v.s)),d){try{b!=="compact"&&(H=A.fromDER(v))}catch(Ce){if(!(Ce instanceof Nn.Err))throw Ce}!H&&b!=="der"&&(H=A.fromCompact(v))}V=c.fromHex(m)}catch{return!1}if(!H||k&&H.hasHighS())return!1;M&&(p=e.hash(p));const{r:Y,s:be}=H,oe=j(p),de=a(be),Je=o(oe*de),Se=o(Y*de),we=(ke=c.BASE.multiplyAndAddUnsafe(V,Je,Se))==null?void 0:ke.toAffine();return we?o(we.x)===Y:!1}return{CURVE:e,getPublicKey:U,getSharedSecret:q,sign:he,verify:C,ProjectivePoint:c,Signature:A,utils:D}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function FS(n){return{hash:n,hmac:(e,...t)=>ag(n,e,r1(...t)),randomBytes:dp}}function US(n,e){const t=r=>DS({...n,...FS(r)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const cg=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Lh=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),WS=BigInt(1),Mc=BigInt(2),Oh=(n,e)=>(n+e/Mc)/e;function HS(n){const e=cg,t=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),h=n*n*n%e,g=h*h*n%e,y=Ze(g,t,e)*g%e,E=Ze(y,t,e)*g%e,x=Ze(E,Mc,e)*h%e,T=Ze(x,i,e)*x%e,R=Ze(T,s,e)*T%e,A=Ze(R,a,e)*R%e,D=Ze(A,c,e)*A%e,U=Ze(D,a,e)*R%e,L=Ze(U,t,e)*g%e,q=Ze(L,o,e)*T%e,Z=Ze(q,r,e)*h%e,j=Ze(Z,Mc,e);if(!Nc.eql(Nc.sqr(j),n))throw new Error("Cannot find square root");return j}const Nc=$o(cg,void 0,void 0,{sqrt:HS}),zS=US({a:BigInt(0),b:BigInt(7),Fp:Nc,n:Lh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=Lh,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-WS*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=Oh(s*n,e),c=Oh(-r*n,e);let h=Ge(n-a*t-c*i,e),g=Ge(-a*r-c*s,e);const y=h>o,E=g>o;if(y&&(h=e-h),E&&(g=e-g),h>o||g>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:y,k1:h,k2neg:E,k2:g}}}},Tc);BigInt(0);function Dh(n){try{return Wl.ExtendedPoint.fromHex(n),!0}catch{return!1}}const $S=(n,e)=>Wl.sign(n,e.slice(0,32)),qS=Wl.verify,Nt=n=>pe.Buffer.isBuffer(n)?n:n instanceof Uint8Array?pe.Buffer.from(n.buffer,n.byteOffset,n.byteLength):pe.Buffer.from(n);class VS{constructor(e){Object.assign(this,e)}encode(){return pe.Buffer.from(Np(Us,this))}static decode(e){return Bp(Us,this,e)}static decodeUnchecked(e){return Ap(Us,this,e)}}const Us=new Map;var lg;const GS=32,dr=32;function jS(n){return n._bn!==void 0}let Fh=1;class ce extends VS{constructor(e){if(super({}),this._bn=void 0,jS(e))this._bn=e._bn;else{if(typeof e=="string"){const t=Lt.decode(e);if(t.length!=dr)throw new Error("Invalid public key input");this._bn=new Rh(t)}else this._bn=new Rh(e);if(this._bn.byteLength()>dr)throw new Error("Invalid public key input")}}static unique(){const e=new ce(Fh);return Fh+=1,new ce(e.toBuffer())}equals(e){return this._bn.eq(e._bn)}toBase58(){return Lt.encode(this.toBytes())}toJSON(){return this.toBase58()}toBytes(){const e=this.toBuffer();return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}toBuffer(){const e=this._bn.toArrayLike(pe.Buffer);if(e.length===dr)return e;const t=pe.Buffer.alloc(32);return e.copy(t,32-e.length),t}get[Symbol.toStringTag](){return`PublicKey(${this.toString()})`}toString(){return this.toBase58()}static async createWithSeed(e,t,r){const i=pe.Buffer.concat([e.toBuffer(),pe.Buffer.from(t),r.toBuffer()]),s=Tc(i);return new ce(s)}static createProgramAddressSync(e,t){let r=pe.Buffer.alloc(0);e.forEach(function(s){if(s.length>GS)throw new TypeError("Max seed length exceeded");r=pe.Buffer.concat([r,Nt(s)])}),r=pe.Buffer.concat([r,t.toBuffer(),pe.Buffer.from("ProgramDerivedAddress")]);const i=Tc(r);if(Dh(i))throw new Error("Invalid seeds, address must fall off the curve");return new ce(i)}static async createProgramAddress(e,t){return this.createProgramAddressSync(e,t)}static findProgramAddressSync(e,t){let r=255,i;for(;r!=0;){try{const s=e.concat(pe.Buffer.from([r]));i=this.createProgramAddressSync(s,t)}catch(s){if(s instanceof TypeError)throw s;r--;continue}return[i,r]}throw new Error("Unable to find a viable program address nonce")}static async findProgramAddress(e,t){return this.findProgramAddressSync(e,t)}static isOnCurve(e){const t=new ce(e);return Dh(t.toBytes())}}lg=ce;ce.default=new lg("11111111111111111111111111111111");Us.set(ce,{kind:"struct",fields:[["_bn","u256"]]});new ce("BPFLoader1111111111111111111111111111111111");const oi=1232,ug=127,hg=64;class dg extends Error{constructor(e){super(`Signature ${e} has expired: block height exceeded.`),this.signature=void 0,this.signature=e}}Object.defineProperty(dg.prototype,"name",{value:"TransactionExpiredBlockheightExceededError"});class fg extends Error{constructor(e,t){super(`Transaction was not confirmed in ${t.toFixed(2)} seconds. It is unknown if it succeeded or failed. Check signature ${e} using the Solana Explorer or CLI tools.`),this.signature=void 0,this.signature=e}}Object.defineProperty(fg.prototype,"name",{value:"TransactionExpiredTimeoutError"});class Oi extends Error{constructor(e){super(`Signature ${e} has expired: the nonce is no longer valid.`),this.signature=void 0,this.signature=e}}Object.defineProperty(Oi.prototype,"name",{value:"TransactionExpiredNonceInvalidError"});class _o{constructor(e,t){this.staticAccountKeys=void 0,this.accountKeysFromLookups=void 0,this.staticAccountKeys=e,this.accountKeysFromLookups=t}keySegments(){const e=[this.staticAccountKeys];return this.accountKeysFromLookups&&(e.push(this.accountKeysFromLookups.writable),e.push(this.accountKeysFromLookups.readonly)),e}get(e){for(const t of this.keySegments()){if(e<t.length)return t[e];e-=t.length}}get length(){return this.keySegments().flat().length}compileInstructions(e){if(this.length>256)throw new Error("Account index overflow encountered during compilation");const r=new Map;this.keySegments().flat().forEach((s,o)=>{r.set(s.toBase58(),o)});const i=s=>{const o=r.get(s.toBase58());if(o===void 0)throw new Error("Encountered an unknown instruction account key during compilation");return o};return e.map(s=>({programIdIndex:i(s.programId),accountKeyIndexes:s.keys.map(o=>i(o.pubkey)),data:s.data}))}}const Ie=(n="publicKey")=>Xe(32,n),Zr=(n="string")=>{const e=te([ie("length"),ie("lengthPadding"),Xe(kr(ie(),-8),"chars")],n),t=e.decode.bind(e),r=e.encode.bind(e),i=e;return i.decode=(s,o)=>t(s,o).chars.toString(),i.encode=(s,o,a)=>{const c={chars:pe.Buffer.from(s,"utf8")};return r(c,o,a)},i.alloc=s=>ie().span+ie().span+pe.Buffer.from(s,"utf8").length,i},KS=(n="authorized")=>te([Ie("staker"),Ie("withdrawer")],n),YS=(n="lockup")=>te([Xt("unixTimestamp"),Xt("epoch"),Ie("custodian")],n),JS=(n="voteInit")=>te([Ie("nodePubkey"),Ie("authorizedVoter"),Ie("authorizedWithdrawer"),Me("commission")],n),ZS=(n="voteAuthorizeWithSeedArgs")=>te([ie("voteAuthorizationType"),Ie("currentAuthorityDerivedKeyOwnerPubkey"),Zr("currentAuthorityDerivedKeySeed"),Ie("newAuthorized")],n);function pg(n,e){const t=i=>{if(i.span>=0)return i.span;if(typeof i.alloc=="function")return i.alloc(e[i.property]);if("count"in i&&"elementLayout"in i){const s=e[i.property];if(Array.isArray(s))return s.length*t(i.elementLayout)}else if("fields"in i)return pg({layout:i},e[i.property]);return 0};let r=0;return n.layout.fields.forEach(i=>{r+=t(i)}),r}function sn(n){let e=0,t=0;for(;;){let r=n.shift();if(e|=(r&127)<<t*7,t+=1,!(r&128))break}return e}function on(n,e){let t=e;for(;;){let r=t&127;if(t>>=7,t==0){n.push(r);break}else r|=128,n.push(r)}}function vt(n,e){if(!n)throw new Error(e||"Assertion failed")}class Jo{constructor(e,t){this.payer=void 0,this.keyMetaMap=void 0,this.payer=e,this.keyMetaMap=t}static compile(e,t){const r=new Map,i=o=>{const a=o.toBase58();let c=r.get(a);return c===void 0&&(c={isSigner:!1,isWritable:!1,isInvoked:!1},r.set(a,c)),c},s=i(t);s.isSigner=!0,s.isWritable=!0;for(const o of e){i(o.programId).isInvoked=!0;for(const a of o.keys){const c=i(a.pubkey);c.isSigner||(c.isSigner=a.isSigner),c.isWritable||(c.isWritable=a.isWritable)}}return new Jo(t,r)}getMessageComponents(){const e=[...this.keyMetaMap.entries()];vt(e.length<=256,"Max static account keys length exceeded");const t=e.filter(([,c])=>c.isSigner&&c.isWritable),r=e.filter(([,c])=>c.isSigner&&!c.isWritable),i=e.filter(([,c])=>!c.isSigner&&c.isWritable),s=e.filter(([,c])=>!c.isSigner&&!c.isWritable),o={numRequiredSignatures:t.length+r.length,numReadonlySignedAccounts:r.length,numReadonlyUnsignedAccounts:s.length};{vt(t.length>0,"Expected at least one writable signer key");const[c]=t[0];vt(c===this.payer.toBase58(),"Expected first writable signer key to be the fee payer")}const a=[...t.map(([c])=>new ce(c)),...r.map(([c])=>new ce(c)),...i.map(([c])=>new ce(c)),...s.map(([c])=>new ce(c))];return[o,a]}extractTableLookup(e){const[t,r]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&o.isWritable),[i,s]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&!o.isWritable);if(!(t.length===0&&i.length===0))return[{accountKey:e.key,writableIndexes:t,readonlyIndexes:i},{writable:r,readonly:s}]}drainKeysFoundInLookupTable(e,t){const r=new Array,i=new Array;for(const[s,o]of this.keyMetaMap.entries())if(t(o)){const a=new ce(s),c=e.findIndex(h=>h.equals(a));c>=0&&(vt(c<256,"Max lookup table index exceeded"),r.push(c),i.push(a),this.keyMetaMap.delete(s))}return[r,i]}}const gg="Reached end of buffer unexpectedly";function Ln(n){if(n.length===0)throw new Error(gg);return n.shift()}function an(n,...e){const[t]=e;if(e.length===2?t+(e[1]??0)>n.length:t>=n.length)throw new Error(gg);return n.splice(...e)}class yr{constructor(e){this.header=void 0,this.accountKeys=void 0,this.recentBlockhash=void 0,this.instructions=void 0,this.indexToProgramIds=new Map,this.header=e.header,this.accountKeys=e.accountKeys.map(t=>new ce(t)),this.recentBlockhash=e.recentBlockhash,this.instructions=e.instructions,this.instructions.forEach(t=>this.indexToProgramIds.set(t.programIdIndex,this.accountKeys[t.programIdIndex]))}get version(){return"legacy"}get staticAccountKeys(){return this.accountKeys}get compiledInstructions(){return this.instructions.map(e=>({programIdIndex:e.programIdIndex,accountKeyIndexes:e.accounts,data:Lt.decode(e.data)}))}get addressTableLookups(){return[]}getAccountKeys(){return new _o(this.staticAccountKeys)}static compile(e){const t=Jo.compile(e.instructions,e.payerKey),[r,i]=t.getMessageComponents(),o=new _o(i).compileInstructions(e.instructions).map(a=>({programIdIndex:a.programIdIndex,accounts:a.accountKeyIndexes,data:Lt.encode(a.data)}));return new yr({header:r,accountKeys:i,recentBlockhash:e.recentBlockhash,instructions:o})}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures;if(e>=this.header.numRequiredSignatures){const r=e-t,s=this.accountKeys.length-t-this.header.numReadonlyUnsignedAccounts;return r<s}else{const r=t-this.header.numReadonlySignedAccounts;return e<r}}isProgramId(e){return this.indexToProgramIds.has(e)}programIds(){return[...this.indexToProgramIds.values()]}nonProgramIds(){return this.accountKeys.filter((e,t)=>!this.isProgramId(t))}serialize(){const e=this.accountKeys.length;let t=[];on(t,e);const r=this.instructions.map(y=>{const{accounts:E,programIdIndex:x}=y,T=Array.from(Lt.decode(y.data));let R=[];on(R,E.length);let A=[];return on(A,T.length),{programIdIndex:x,keyIndicesCount:pe.Buffer.from(R),keyIndices:E,dataLength:pe.Buffer.from(A),data:T}});let i=[];on(i,r.length);let s=pe.Buffer.alloc(oi);pe.Buffer.from(i).copy(s);let o=i.length;r.forEach(y=>{const x=te([Me("programIdIndex"),Xe(y.keyIndicesCount.length,"keyIndicesCount"),$t(Me("keyIndex"),y.keyIndices.length,"keyIndices"),Xe(y.dataLength.length,"dataLength"),$t(Me("userdatum"),y.data.length,"data")]).encode(y,s,o);o+=x}),s=s.slice(0,o);const a=te([Xe(1,"numRequiredSignatures"),Xe(1,"numReadonlySignedAccounts"),Xe(1,"numReadonlyUnsignedAccounts"),Xe(t.length,"keyCount"),$t(Ie("key"),e,"keys"),Ie("recentBlockhash")]),c={numRequiredSignatures:pe.Buffer.from([this.header.numRequiredSignatures]),numReadonlySignedAccounts:pe.Buffer.from([this.header.numReadonlySignedAccounts]),numReadonlyUnsignedAccounts:pe.Buffer.from([this.header.numReadonlyUnsignedAccounts]),keyCount:pe.Buffer.from(t),keys:this.accountKeys.map(y=>Nt(y.toBytes())),recentBlockhash:Lt.decode(this.recentBlockhash)};let h=pe.Buffer.alloc(2048);const g=a.encode(c,h);return s.copy(h,g),h.slice(0,g+s.length)}static from(e){let t=[...e];const r=Ln(t);if(r!==(r&ug))throw new Error("Versioned messages must be deserialized with VersionedMessage.deserialize()");const i=Ln(t),s=Ln(t),o=sn(t);let a=[];for(let E=0;E<o;E++){const x=an(t,0,dr);a.push(new ce(pe.Buffer.from(x)))}const c=an(t,0,dr),h=sn(t);let g=[];for(let E=0;E<h;E++){const x=Ln(t),T=sn(t),R=an(t,0,T),A=sn(t),D=an(t,0,A),U=Lt.encode(pe.Buffer.from(D));g.push({programIdIndex:x,accounts:R,data:U})}const y={header:{numRequiredSignatures:r,numReadonlySignedAccounts:i,numReadonlyUnsignedAccounts:s},recentBlockhash:Lt.encode(pe.Buffer.from(c)),accountKeys:a,instructions:g};return new yr(y)}}class wo{constructor(e){this.header=void 0,this.staticAccountKeys=void 0,this.recentBlockhash=void 0,this.compiledInstructions=void 0,this.addressTableLookups=void 0,this.header=e.header,this.staticAccountKeys=e.staticAccountKeys,this.recentBlockhash=e.recentBlockhash,this.compiledInstructions=e.compiledInstructions,this.addressTableLookups=e.addressTableLookups}get version(){return 0}get numAccountKeysFromLookups(){let e=0;for(const t of this.addressTableLookups)e+=t.readonlyIndexes.length+t.writableIndexes.length;return e}getAccountKeys(e){let t;if(e&&"accountKeysFromLookups"in e&&e.accountKeysFromLookups){if(this.numAccountKeysFromLookups!=e.accountKeysFromLookups.writable.length+e.accountKeysFromLookups.readonly.length)throw new Error("Failed to get account keys because of a mismatch in the number of account keys from lookups");t=e.accountKeysFromLookups}else if(e&&"addressLookupTableAccounts"in e&&e.addressLookupTableAccounts)t=this.resolveAddressTableLookups(e.addressLookupTableAccounts);else if(this.addressTableLookups.length>0)throw new Error("Failed to get account keys because address table lookups were not resolved");return new _o(this.staticAccountKeys,t)}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures,r=this.staticAccountKeys.length;if(e>=r){const i=e-r,s=this.addressTableLookups.reduce((o,a)=>o+a.writableIndexes.length,0);return i<s}else if(e>=this.header.numRequiredSignatures){const i=e-t,o=r-t-this.header.numReadonlyUnsignedAccounts;return i<o}else{const i=t-this.header.numReadonlySignedAccounts;return e<i}}resolveAddressTableLookups(e){const t={writable:[],readonly:[]};for(const r of this.addressTableLookups){const i=e.find(s=>s.key.equals(r.accountKey));if(!i)throw new Error(`Failed to find address lookup table account for table key ${r.accountKey.toBase58()}`);for(const s of r.writableIndexes)if(s<i.state.addresses.length)t.writable.push(i.state.addresses[s]);else throw new Error(`Failed to find address for index ${s} in address lookup table ${r.accountKey.toBase58()}`);for(const s of r.readonlyIndexes)if(s<i.state.addresses.length)t.readonly.push(i.state.addresses[s]);else throw new Error(`Failed to find address for index ${s} in address lookup table ${r.accountKey.toBase58()}`)}return t}static compile(e){const t=Jo.compile(e.instructions,e.payerKey),r=new Array,i={writable:new Array,readonly:new Array},s=e.addressLookupTableAccounts||[];for(const g of s){const y=t.extractTableLookup(g);if(y!==void 0){const[E,{writable:x,readonly:T}]=y;r.push(E),i.writable.push(...x),i.readonly.push(...T)}}const[o,a]=t.getMessageComponents(),h=new _o(a,i).compileInstructions(e.instructions);return new wo({header:o,staticAccountKeys:a,recentBlockhash:e.recentBlockhash,compiledInstructions:h,addressTableLookups:r})}serialize(){const e=Array();on(e,this.staticAccountKeys.length);const t=this.serializeInstructions(),r=Array();on(r,this.compiledInstructions.length);const i=this.serializeAddressTableLookups(),s=Array();on(s,this.addressTableLookups.length);const o=te([Me("prefix"),te([Me("numRequiredSignatures"),Me("numReadonlySignedAccounts"),Me("numReadonlyUnsignedAccounts")],"header"),Xe(e.length,"staticAccountKeysLength"),$t(Ie(),this.staticAccountKeys.length,"staticAccountKeys"),Ie("recentBlockhash"),Xe(r.length,"instructionsLength"),Xe(t.length,"serializedInstructions"),Xe(s.length,"addressTableLookupsLength"),Xe(i.length,"serializedAddressTableLookups")]),a=new Uint8Array(oi),h=o.encode({prefix:128,header:this.header,staticAccountKeysLength:new Uint8Array(e),staticAccountKeys:this.staticAccountKeys.map(g=>g.toBytes()),recentBlockhash:Lt.decode(this.recentBlockhash),instructionsLength:new Uint8Array(r),serializedInstructions:t,addressTableLookupsLength:new Uint8Array(s),serializedAddressTableLookups:i},a);return a.slice(0,h)}serializeInstructions(){let e=0;const t=new Uint8Array(oi);for(const r of this.compiledInstructions){const i=Array();on(i,r.accountKeyIndexes.length);const s=Array();on(s,r.data.length);const o=te([Me("programIdIndex"),Xe(i.length,"encodedAccountKeyIndexesLength"),$t(Me(),r.accountKeyIndexes.length,"accountKeyIndexes"),Xe(s.length,"encodedDataLength"),Xe(r.data.length,"data")]);e+=o.encode({programIdIndex:r.programIdIndex,encodedAccountKeyIndexesLength:new Uint8Array(i),accountKeyIndexes:r.accountKeyIndexes,encodedDataLength:new Uint8Array(s),data:r.data},t,e)}return t.slice(0,e)}serializeAddressTableLookups(){let e=0;const t=new Uint8Array(oi);for(const r of this.addressTableLookups){const i=Array();on(i,r.writableIndexes.length);const s=Array();on(s,r.readonlyIndexes.length);const o=te([Ie("accountKey"),Xe(i.length,"encodedWritableIndexesLength"),$t(Me(),r.writableIndexes.length,"writableIndexes"),Xe(s.length,"encodedReadonlyIndexesLength"),$t(Me(),r.readonlyIndexes.length,"readonlyIndexes")]);e+=o.encode({accountKey:r.accountKey.toBytes(),encodedWritableIndexesLength:new Uint8Array(i),writableIndexes:r.writableIndexes,encodedReadonlyIndexesLength:new Uint8Array(s),readonlyIndexes:r.readonlyIndexes},t,e)}return t.slice(0,e)}static deserialize(e){let t=[...e];const r=Ln(t),i=r&ug;vt(r!==i,"Expected versioned message but received legacy message");const s=i;vt(s===0,`Expected versioned message with version 0 but found version ${s}`);const o={numRequiredSignatures:Ln(t),numReadonlySignedAccounts:Ln(t),numReadonlyUnsignedAccounts:Ln(t)},a=[],c=sn(t);for(let T=0;T<c;T++)a.push(new ce(an(t,0,dr)));const h=Lt.encode(an(t,0,dr)),g=sn(t),y=[];for(let T=0;T<g;T++){const R=Ln(t),A=sn(t),D=an(t,0,A),U=sn(t),L=new Uint8Array(an(t,0,U));y.push({programIdIndex:R,accountKeyIndexes:D,data:L})}const E=sn(t),x=[];for(let T=0;T<E;T++){const R=new ce(an(t,0,dr)),A=sn(t),D=an(t,0,A),U=sn(t),L=an(t,0,U);x.push({accountKey:R,writableIndexes:D,readonlyIndexes:L})}return new wo({header:o,staticAccountKeys:a,recentBlockhash:h,compiledInstructions:y,addressTableLookups:x})}}let Qn=function(n){return n[n.BLOCKHEIGHT_EXCEEDED=0]="BLOCKHEIGHT_EXCEEDED",n[n.PROCESSED=1]="PROCESSED",n[n.TIMED_OUT=2]="TIMED_OUT",n[n.NONCE_INVALID=3]="NONCE_INVALID",n}({});const XS=pe.Buffer.alloc(hg).fill(0);class fn{constructor(e){this.keys=void 0,this.programId=void 0,this.data=pe.Buffer.alloc(0),this.programId=e.programId,this.keys=e.keys,e.data&&(this.data=e.data)}toJSON(){return{keys:this.keys.map(({pubkey:e,isSigner:t,isWritable:r})=>({pubkey:e.toJSON(),isSigner:t,isWritable:r})),programId:this.programId.toJSON(),data:[...this.data]}}}class En{get signature(){return this.signatures.length>0?this.signatures[0].signature:null}constructor(e){if(this.signatures=[],this.feePayer=void 0,this.instructions=[],this.recentBlockhash=void 0,this.lastValidBlockHeight=void 0,this.nonceInfo=void 0,this.minNonceContextSlot=void 0,this._message=void 0,this._json=void 0,!!e)if(e.feePayer&&(this.feePayer=e.feePayer),e.signatures&&(this.signatures=e.signatures),Object.prototype.hasOwnProperty.call(e,"nonceInfo")){const{minContextSlot:t,nonceInfo:r}=e;this.minNonceContextSlot=t,this.nonceInfo=r}else if(Object.prototype.hasOwnProperty.call(e,"lastValidBlockHeight")){const{blockhash:t,lastValidBlockHeight:r}=e;this.recentBlockhash=t,this.lastValidBlockHeight=r}else{const{recentBlockhash:t,nonceInfo:r}=e;r&&(this.nonceInfo=r),this.recentBlockhash=t}}toJSON(){return{recentBlockhash:this.recentBlockhash||null,feePayer:this.feePayer?this.feePayer.toJSON():null,nonceInfo:this.nonceInfo?{nonce:this.nonceInfo.nonce,nonceInstruction:this.nonceInfo.nonceInstruction.toJSON()}:null,instructions:this.instructions.map(e=>e.toJSON()),signers:this.signatures.map(({publicKey:e})=>e.toJSON())}}add(...e){if(e.length===0)throw new Error("No instructions");return e.forEach(t=>{"instructions"in t?this.instructions=this.instructions.concat(t.instructions):"data"in t&&"programId"in t&&"keys"in t?this.instructions.push(t):this.instructions.push(new fn(t))}),this}compileMessage(){if(this._message&&JSON.stringify(this.toJSON())===JSON.stringify(this._json))return this._message;let e,t;if(this.nonceInfo?(e=this.nonceInfo.nonce,this.instructions[0]!=this.nonceInfo.nonceInstruction?t=[this.nonceInfo.nonceInstruction,...this.instructions]:t=this.instructions):(e=this.recentBlockhash,t=this.instructions),!e)throw new Error("Transaction recentBlockhash required");t.length<1&&console.warn("No instructions provided");let r;if(this.feePayer)r=this.feePayer;else if(this.signatures.length>0&&this.signatures[0].publicKey)r=this.signatures[0].publicKey;else throw new Error("Transaction fee payer required");for(let R=0;R<t.length;R++)if(t[R].programId===void 0)throw new Error(`Transaction instruction index ${R} has undefined program id`);const i=[],s=[];t.forEach(R=>{R.keys.forEach(D=>{s.push({...D})});const A=R.programId.toString();i.includes(A)||i.push(A)}),i.forEach(R=>{s.push({pubkey:new ce(R),isSigner:!1,isWritable:!1})});const o=[];s.forEach(R=>{const A=R.pubkey.toString(),D=o.findIndex(U=>U.pubkey.toString()===A);D>-1?(o[D].isWritable=o[D].isWritable||R.isWritable,o[D].isSigner=o[D].isSigner||R.isSigner):o.push(R)}),o.sort(function(R,A){if(R.isSigner!==A.isSigner)return R.isSigner?-1:1;if(R.isWritable!==A.isWritable)return R.isWritable?-1:1;const D={localeMatcher:"best fit",usage:"sort",sensitivity:"variant",ignorePunctuation:!1,numeric:!1,caseFirst:"lower"};return R.pubkey.toBase58().localeCompare(A.pubkey.toBase58(),"en",D)});const a=o.findIndex(R=>R.pubkey.equals(r));if(a>-1){const[R]=o.splice(a,1);R.isSigner=!0,R.isWritable=!0,o.unshift(R)}else o.unshift({pubkey:r,isSigner:!0,isWritable:!0});for(const R of this.signatures){const A=o.findIndex(D=>D.pubkey.equals(R.publicKey));if(A>-1)o[A].isSigner||(o[A].isSigner=!0,console.warn("Transaction references a signature that is unnecessary, only the fee payer and instruction signer accounts should sign a transaction. This behavior is deprecated and will throw an error in the next major version release."));else throw new Error(`unknown signer: ${R.publicKey.toString()}`)}let c=0,h=0,g=0;const y=[],E=[];o.forEach(({pubkey:R,isSigner:A,isWritable:D})=>{A?(y.push(R.toString()),c+=1,D||(h+=1)):(E.push(R.toString()),D||(g+=1))});const x=y.concat(E),T=t.map(R=>{const{data:A,programId:D}=R;return{programIdIndex:x.indexOf(D.toString()),accounts:R.keys.map(U=>x.indexOf(U.pubkey.toString())),data:Lt.encode(A)}});return T.forEach(R=>{vt(R.programIdIndex>=0),R.accounts.forEach(A=>vt(A>=0))}),new yr({header:{numRequiredSignatures:c,numReadonlySignedAccounts:h,numReadonlyUnsignedAccounts:g},accountKeys:x,recentBlockhash:e,instructions:T})}_compile(){const e=this.compileMessage(),t=e.accountKeys.slice(0,e.header.numRequiredSignatures);return this.signatures.length===t.length&&this.signatures.every((i,s)=>t[s].equals(i.publicKey))||(this.signatures=t.map(r=>({signature:null,publicKey:r}))),e}serializeMessage(){return this._compile().serialize()}async getEstimatedFee(e){return(await e.getFeeForMessage(this.compileMessage())).value}setSigners(...e){if(e.length===0)throw new Error("No signers");const t=new Set;this.signatures=e.filter(r=>{const i=r.toString();return t.has(i)?!1:(t.add(i),!0)}).map(r=>({signature:null,publicKey:r}))}sign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,r=[];for(const s of e){const o=s.publicKey.toString();t.has(o)||(t.add(o),r.push(s))}this.signatures=r.map(s=>({signature:null,publicKey:s.publicKey}));const i=this._compile();this._partialSign(i,...r)}partialSign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,r=[];for(const s of e){const o=s.publicKey.toString();t.has(o)||(t.add(o),r.push(s))}const i=this._compile();this._partialSign(i,...r)}_partialSign(e,...t){const r=e.serialize();t.forEach(i=>{const s=$S(r,i.secretKey);this._addSignature(i.publicKey,Nt(s))})}addSignature(e,t){this._compile(),this._addSignature(e,t)}_addSignature(e,t){vt(t.length===64);const r=this.signatures.findIndex(i=>e.equals(i.publicKey));if(r<0)throw new Error(`unknown signer: ${e.toString()}`);this.signatures[r].signature=pe.Buffer.from(t)}verifySignatures(e=!0){return!this._getMessageSignednessErrors(this.serializeMessage(),e)}_getMessageSignednessErrors(e,t){const r={};for(const{signature:i,publicKey:s}of this.signatures)i===null?t&&(r.missing||(r.missing=[])).push(s):qS(i,e,s.toBytes())||(r.invalid||(r.invalid=[])).push(s);return r.invalid||r.missing?r:void 0}serialize(e){const{requireAllSignatures:t,verifySignatures:r}=Object.assign({requireAllSignatures:!0,verifySignatures:!0},e),i=this.serializeMessage();if(r){const s=this._getMessageSignednessErrors(i,t);if(s){let o="Signature verification failed.";throw s.invalid&&(o+=`
Invalid signature for public key${s.invalid.length===1?"":"(s)"} [\`${s.invalid.map(a=>a.toBase58()).join("`, `")}\`].`),s.missing&&(o+=`
Missing signature for public key${s.missing.length===1?"":"(s)"} [\`${s.missing.map(a=>a.toBase58()).join("`, `")}\`].`),new Error(o)}}return this._serialize(i)}_serialize(e){const{signatures:t}=this,r=[];on(r,t.length);const i=r.length+t.length*64+e.length,s=pe.Buffer.alloc(i);return vt(t.length<256),pe.Buffer.from(r).copy(s,0),t.forEach(({signature:o},a)=>{o!==null&&(vt(o.length===64,"signature has invalid length"),pe.Buffer.from(o).copy(s,r.length+a*64))}),e.copy(s,r.length+t.length*64),vt(s.length<=oi,`Transaction too large: ${s.length} > ${oi}`),s}get keys(){return vt(this.instructions.length===1),this.instructions[0].keys.map(e=>e.pubkey)}get programId(){return vt(this.instructions.length===1),this.instructions[0].programId}get data(){return vt(this.instructions.length===1),this.instructions[0].data}static from(e){let t=[...e];const r=sn(t);let i=[];for(let s=0;s<r;s++){const o=an(t,0,hg);i.push(Lt.encode(pe.Buffer.from(o)))}return En.populate(yr.from(t),i)}static populate(e,t=[]){const r=new En;return r.recentBlockhash=e.recentBlockhash,e.header.numRequiredSignatures>0&&(r.feePayer=e.accountKeys[0]),t.forEach((i,s)=>{const o={signature:i==Lt.encode(XS)?null:Lt.decode(i),publicKey:e.accountKeys[s]};r.signatures.push(o)}),e.instructions.forEach(i=>{const s=i.accounts.map(o=>{const a=e.accountKeys[o];return{pubkey:a,isSigner:r.signatures.some(c=>c.publicKey.toString()===a.toString())||e.isAccountSigner(o),isWritable:e.isAccountWritable(o)}});r.instructions.push(new fn({keys:s,programId:e.accountKeys[i.programIdIndex],data:Lt.decode(i.data)}))}),r._message=e,r._json=r.toJSON(),r}}const QS=160,eI=64,tI=QS/eI,nI=1e3/tI;new ce("SysvarC1ock11111111111111111111111111111111");new ce("SysvarEpochSchedu1e111111111111111111111111");new ce("Sysvar1nstructions1111111111111111111111111");const Ya=new ce("SysvarRecentB1ockHashes11111111111111111111"),Uh=new ce("SysvarRent111111111111111111111111111111111");new ce("SysvarRewards111111111111111111111111111111");new ce("SysvarS1otHashes111111111111111111111111111");new ce("SysvarS1otHistory11111111111111111111111111");new ce("SysvarStakeHistory1111111111111111111111111");class Wh extends Error{constructor({action:e,signature:t,transactionMessage:r,logs:i}){const s=i?`Logs: 
${JSON.stringify(i.slice(-10),null,2)}. `:"",o="\nCatch the `SendTransactionError` and call `getLogs()` on it for full details.";let a;switch(e){case"send":a=`Transaction ${t} resulted in an error. 
${r}. `+s+o;break;case"simulate":a=`Simulation failed. 
Message: ${r}. 
`+s+o;break;default:a=`Unknown action '${(c=>c)(e)}'`}super(a),this.signature=void 0,this.transactionMessage=void 0,this.transactionLogs=void 0,this.signature=t,this.transactionMessage=r,this.transactionLogs=i||void 0}get transactionError(){return{message:this.transactionMessage,logs:Array.isArray(this.transactionLogs)?this.transactionLogs:void 0}}get logs(){const e=this.transactionLogs;if(!(e!=null&&typeof e=="object"&&"then"in e))return e}async getLogs(e){return Array.isArray(this.transactionLogs)||(this.transactionLogs=new Promise((t,r)=>{e.getTransaction(this.signature).then(i=>{if(i&&i.meta&&i.meta.logMessages){const s=i.meta.logMessages;this.transactionLogs=s,t(s)}else r(new Error("Log messages not found"))}).catch(r)})),await this.transactionLogs}}class ne extends Error{constructor({code:e,message:t,data:r},i){super(i!=null?`${i}: ${t}`:t),this.code=void 0,this.data=void 0,this.code=e,this.data=r,this.name="SolanaJSONRPCError"}}function jr(n){return new Promise(e=>setTimeout(e,n))}function en(n,e){const t=n.layout.span>=0?n.layout.span:pg(n,e),r=pe.Buffer.alloc(t),i=Object.assign({instruction:n.index},e);return n.layout.encode(i,r),r}const rI=Mt("lamportsPerSignature"),mg=te([ie("version"),ie("state"),Ie("authorizedPubkey"),Ie("nonce"),te([rI],"feeCalculator")]),Hh=mg.span;class eu{constructor(e){this.authorizedPubkey=void 0,this.nonce=void 0,this.feeCalculator=void 0,this.authorizedPubkey=e.authorizedPubkey,this.nonce=e.nonce,this.feeCalculator=e.feeCalculator}static fromAccountData(e){const t=mg.decode(Nt(e),0);return new eu({authorizedPubkey:new ce(t.authorizedPubkey),nonce:new ce(t.nonce).toString(),feeCalculator:t.feeCalculator})}}const iI=n=>{const e=n.decode.bind(n),t=n.encode.bind(n);return{decode:e,encode:t}},sI=n=>e=>{const t=Xe(n,e),{encode:r,decode:i}=iI(t),s=t;return s.decode=(o,a)=>{const c=i(o,a);return HE(pe.Buffer.from(c))},s.encode=(o,a,c)=>{const h=qE(o,n);return r(h,a,c)},s},yi=sI(8),tn=Object.freeze({Create:{index:0,layout:te([ie("instruction"),Xt("lamports"),Xt("space"),Ie("programId")])},Assign:{index:1,layout:te([ie("instruction"),Ie("programId")])},Transfer:{index:2,layout:te([ie("instruction"),yi("lamports")])},CreateWithSeed:{index:3,layout:te([ie("instruction"),Ie("base"),Zr("seed"),Xt("lamports"),Xt("space"),Ie("programId")])},AdvanceNonceAccount:{index:4,layout:te([ie("instruction")])},WithdrawNonceAccount:{index:5,layout:te([ie("instruction"),Xt("lamports")])},InitializeNonceAccount:{index:6,layout:te([ie("instruction"),Ie("authorized")])},AuthorizeNonceAccount:{index:7,layout:te([ie("instruction"),Ie("authorized")])},Allocate:{index:8,layout:te([ie("instruction"),Xt("space")])},AllocateWithSeed:{index:9,layout:te([ie("instruction"),Ie("base"),Zr("seed"),Xt("space"),Ie("programId")])},AssignWithSeed:{index:10,layout:te([ie("instruction"),Ie("base"),Zr("seed"),Ie("programId")])},TransferWithSeed:{index:11,layout:te([ie("instruction"),yi("lamports"),Zr("seed"),Ie("programId")])},UpgradeNonceAccount:{index:12,layout:te([ie("instruction")])}});class rs{constructor(){}static createAccount(e){const t=tn.Create,r=en(t,{lamports:e.lamports,space:e.space,programId:Nt(e.programId.toBuffer())});return new fn({keys:[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.newAccountPubkey,isSigner:!0,isWritable:!0}],programId:this.programId,data:r})}static transfer(e){let t,r;if("basePubkey"in e){const i=tn.TransferWithSeed;t=en(i,{lamports:BigInt(e.lamports),seed:e.seed,programId:Nt(e.programId.toBuffer())}),r=[{pubkey:e.fromPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0}]}else{const i=tn.Transfer;t=en(i,{lamports:BigInt(e.lamports)}),r=[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0}]}return new fn({keys:r,programId:this.programId,data:t})}static assign(e){let t,r;if("basePubkey"in e){const i=tn.AssignWithSeed;t=en(i,{base:Nt(e.basePubkey.toBuffer()),seed:e.seed,programId:Nt(e.programId.toBuffer())}),r=[{pubkey:e.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1}]}else{const i=tn.Assign;t=en(i,{programId:Nt(e.programId.toBuffer())}),r=[{pubkey:e.accountPubkey,isSigner:!0,isWritable:!0}]}return new fn({keys:r,programId:this.programId,data:t})}static createAccountWithSeed(e){const t=tn.CreateWithSeed,r=en(t,{base:Nt(e.basePubkey.toBuffer()),seed:e.seed,lamports:e.lamports,space:e.space,programId:Nt(e.programId.toBuffer())});let i=[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.newAccountPubkey,isSigner:!1,isWritable:!0}];return e.basePubkey.equals(e.fromPubkey)||i.push({pubkey:e.basePubkey,isSigner:!0,isWritable:!1}),new fn({keys:i,programId:this.programId,data:r})}static createNonceAccount(e){const t=new En;"basePubkey"in e&&"seed"in e?t.add(rs.createAccountWithSeed({fromPubkey:e.fromPubkey,newAccountPubkey:e.noncePubkey,basePubkey:e.basePubkey,seed:e.seed,lamports:e.lamports,space:Hh,programId:this.programId})):t.add(rs.createAccount({fromPubkey:e.fromPubkey,newAccountPubkey:e.noncePubkey,lamports:e.lamports,space:Hh,programId:this.programId}));const r={noncePubkey:e.noncePubkey,authorizedPubkey:e.authorizedPubkey};return t.add(this.nonceInitialize(r)),t}static nonceInitialize(e){const t=tn.InitializeNonceAccount,r=en(t,{authorized:Nt(e.authorizedPubkey.toBuffer())}),i={keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:Ya,isSigner:!1,isWritable:!1},{pubkey:Uh,isSigner:!1,isWritable:!1}],programId:this.programId,data:r};return new fn(i)}static nonceAdvance(e){const t=tn.AdvanceNonceAccount,r=en(t),i={keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:Ya,isSigner:!1,isWritable:!1},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:r};return new fn(i)}static nonceWithdraw(e){const t=tn.WithdrawNonceAccount,r=en(t,{lamports:e.lamports});return new fn({keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0},{pubkey:Ya,isSigner:!1,isWritable:!1},{pubkey:Uh,isSigner:!1,isWritable:!1},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:r})}static nonceAuthorize(e){const t=tn.AuthorizeNonceAccount,r=en(t,{authorized:Nt(e.newAuthorizedPubkey.toBuffer())});return new fn({keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:r})}static allocate(e){let t,r;if("basePubkey"in e){const i=tn.AllocateWithSeed;t=en(i,{base:Nt(e.basePubkey.toBuffer()),seed:e.seed,space:e.space,programId:Nt(e.programId.toBuffer())}),r=[{pubkey:e.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1}]}else{const i=tn.Allocate;t=en(i,{space:e.space}),r=[{pubkey:e.accountPubkey,isSigner:!0,isWritable:!0}]}return new fn({keys:r,programId:this.programId,data:t})}}rs.programId=new ce("11111111111111111111111111111111");new ce("BPFLoader2111111111111111111111111111111111");function oI(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ja,zh;function aI(){if(zh)return Ja;zh=1;var n=Object.prototype.toString,e=Object.keys||function(r){var i=[];for(var s in r)i.push(s);return i};function t(r,i){var s,o,a,c,h,g,y;if(r===!0)return"true";if(r===!1)return"false";switch(typeof r){case"object":if(r===null)return null;if(r.toJSON&&typeof r.toJSON=="function")return t(r.toJSON(),i);if(y=n.call(r),y==="[object Array]"){for(a="[",o=r.length-1,s=0;s<o;s++)a+=t(r[s],!0)+",";return o>-1&&(a+=t(r[s],!0)),a+"]"}else if(y==="[object Object]"){for(c=e(r).sort(),o=c.length,a="",s=0;s<o;)h=c[s],g=t(r[h],!1),g!==void 0&&(a&&(a+=","),a+=JSON.stringify(h)+":"+g),s++;return"{"+a+"}"}else return JSON.stringify(r);case"function":case"undefined":return i?null:void 0;case"string":return JSON.stringify(r);default:return isFinite(r)?r:null}}return Ja=function(r){var i=t(r,!1);if(i!==void 0)return""+i},Ja}var cI=aI(),$h=oI(cI);const Li=32;function Za(n){let e=0;for(;n>1;)n/=2,e++;return e}function lI(n){return n===0?1:(n--,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n|=n>>32,n+1)}class uI{constructor(e,t,r,i,s){this.slotsPerEpoch=void 0,this.leaderScheduleSlotOffset=void 0,this.warmup=void 0,this.firstNormalEpoch=void 0,this.firstNormalSlot=void 0,this.slotsPerEpoch=e,this.leaderScheduleSlotOffset=t,this.warmup=r,this.firstNormalEpoch=i,this.firstNormalSlot=s}getEpoch(e){return this.getEpochAndSlotIndex(e)[0]}getEpochAndSlotIndex(e){if(e<this.firstNormalSlot){const t=Za(lI(e+Li+1))-Za(Li)-1,r=this.getSlotsInEpoch(t),i=e-(r-Li);return[t,i]}else{const t=e-this.firstNormalSlot,r=Math.floor(t/this.slotsPerEpoch),i=this.firstNormalEpoch+r,s=t%this.slotsPerEpoch;return[i,s]}}getFirstSlotInEpoch(e){return e<=this.firstNormalEpoch?(Math.pow(2,e)-1)*Li:(e-this.firstNormalEpoch)*this.slotsPerEpoch+this.firstNormalSlot}getLastSlotInEpoch(e){return this.getFirstSlotInEpoch(e)+this.getSlotsInEpoch(e)-1}getSlotsInEpoch(e){return e<this.firstNormalEpoch?Math.pow(2,e+Za(Li)):this.slotsPerEpoch}}var hI=globalThis.fetch;class dI extends RS{constructor(e,t,r){const i=s=>{const o=CS(s,{autoconnect:!0,max_reconnects:5,reconnect:!0,reconnect_interval:1e3,...t});return"socket"in o?this.underlyingSocket=o.socket:this.underlyingSocket=o,o};super(i,e,t,r),this.underlyingSocket=void 0}call(...e){var r;const t=(r=this.underlyingSocket)==null?void 0:r.readyState;return t===1?super.call(...e):Promise.reject(new Error("Tried to call a JSON-RPC method `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}notify(...e){var r;const t=(r=this.underlyingSocket)==null?void 0:r.readyState;return t===1?super.notify(...e):Promise.reject(new Error("Tried to send a JSON-RPC notification `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}}function fI(n,e){let t;try{t=n.layout.decode(e)}catch(r){throw new Error("invalid instruction; "+r)}if(t.typeIndex!==n.index)throw new Error(`invalid account data; account type mismatch ${t.typeIndex} != ${n.index}`);return t}const qh=56;class Vh{constructor(e){this.key=void 0,this.state=void 0,this.key=e.key,this.state=e.state}isActive(){const e=BigInt("0xffffffffffffffff");return this.state.deactivationSlot===e}static deserialize(e){const t=fI(pI,e),r=e.length-qh;vt(r>=0,"lookup table is invalid"),vt(r%32===0,"lookup table is invalid");const i=r/32,{addresses:s}=te([$t(Ie(),i,"addresses")]).decode(e.slice(qh));return{deactivationSlot:t.deactivationSlot,lastExtendedSlot:t.lastExtendedSlot,lastExtendedSlotStartIndex:t.lastExtendedStartIndex,authority:t.authority.length!==0?new ce(t.authority[0]):void 0,addresses:s.map(o=>new ce(o))}}}const pI={index:1,layout:te([ie("typeIndex"),yi("deactivationSlot"),Mt("lastExtendedSlot"),Me("lastExtendedStartIndex"),Me(),$t(Ie(),kr(Me(),-1),"authority")])},gI=/^[^:]+:\/\/([^:[]+|\[[^\]]+\])(:\d+)?(.*)/i;function mI(n){const e=n.match(gI);if(e==null)throw TypeError(`Failed to validate endpoint URL \`${n}\``);const[t,r,i,s]=e,o=n.startsWith("https:")?"wss:":"ws:",a=i==null?null:parseInt(i.slice(1),10),c=a==null?"":`:${a+1}`;return`${o}//${r}${c}${s}`}const Ye=bs(Xl(ce),$(),n=>new ce(n)),yg=Ql([$(),je("base64")]),tu=bs(Xl(pe.Buffer),yg,n=>pe.Buffer.from(n[0],"base64")),yI=30*1e3;function _I(n){if(/^https?:/.test(n)===!1)throw new TypeError("Endpoint URL must start with `http:` or `https:`.");return n}function Ue(n){let e,t;if(typeof n=="string")e=n;else if(n){const{commitment:r,...i}=n;e=r,t=i}return{commitment:e,config:t}}function Gh(n){return n.map(e=>"memcmp"in e?{...e,memcmp:{...e.memcmp,encoding:e.memcmp.encoding??"base58"}}:e)}function _g(n){return Gt([W({jsonrpc:je("2.0"),id:$(),result:n}),W({jsonrpc:je("2.0"),id:$(),error:W({code:Ci(),message:$(),data:se(XE())})})])}const wI=_g(Ci());function _e(n){return bs(_g(n),wI,e=>"error"in e?e:{...e,result:G(e.result,n)})}function tt(n){return _e(W({context:W({slot:P()}),value:n}))}function Zo(n){return W({context:W({slot:P()}),value:n})}function Xa(n,e){return n===0?new wo({header:e.header,staticAccountKeys:e.accountKeys.map(t=>new ce(t)),recentBlockhash:e.recentBlockhash,compiledInstructions:e.instructions.map(t=>({programIdIndex:t.programIdIndex,accountKeyIndexes:t.accounts,data:Lt.decode(t.data)})),addressTableLookups:e.addressTableLookups}):new yr(e)}const bI=W({foundation:P(),foundationTerm:P(),initial:P(),taper:P(),terminal:P()}),vI=_e(K(J(W({epoch:P(),effectiveSlot:P(),amount:P(),postBalance:P(),commission:se(J(P()))})))),EI=K(W({slot:P(),prioritizationFee:P()})),SI=W({total:P(),validator:P(),foundation:P(),epoch:P()}),II=W({epoch:P(),slotIndex:P(),slotsInEpoch:P(),absoluteSlot:P(),blockHeight:se(P()),transactionCount:se(P())}),xI=W({slotsPerEpoch:P(),leaderScheduleSlotOffset:P(),warmup:kn(),firstNormalEpoch:P(),firstNormalSlot:P()}),kI=Xp($(),K(P())),Ur=J(Gt([W({}),$()])),AI=W({err:Ur}),CI=je("receivedSignature"),TI=W({"solana-core":$(),"feature-set":se(P())}),RI=W({program:$(),programId:Ye,parsed:Ci()}),MI=W({programId:Ye,accounts:K(Ye),data:$()}),jh=tt(W({err:J(Gt([W({}),$()])),logs:J(K($())),accounts:se(J(K(J(W({executable:kn(),owner:$(),lamports:P(),data:K($()),rentEpoch:se(P())}))))),unitsConsumed:se(P()),returnData:se(J(W({programId:$(),data:Ql([$(),je("base64")])}))),innerInstructions:se(J(K(W({index:P(),instructions:K(Gt([RI,MI]))}))))})),NI=tt(W({byIdentity:Xp($(),K(P())),range:W({firstSlot:P(),lastSlot:P()})}));function BI(n,e,t,r,i,s){const o=t||hI;let a;s!=null&&console.warn("You have supplied an `httpAgent` when creating a `Connection` in a browser environment.It has been ignored; `httpAgent` is only used in Node environments.");let c;return r&&(c=async(g,y)=>{const E=await new Promise((x,T)=>{try{r(g,y,(R,A)=>x([R,A]))}catch(R){T(R)}});return await o(...E)}),new xS(async(g,y)=>{const E={method:"POST",body:g,agent:a,headers:Object.assign({"Content-Type":"application/json"},e||{},Bx)};try{let x=5,T,R=500;for(;c?T=await c(n,E):T=await o(n,E),!(T.status!==429||i===!0||(x-=1,x===0));)console.error(`Server responded with ${T.status} ${T.statusText}.  Retrying after ${R}ms delay...`),await jr(R),R*=2;const A=await T.text();T.ok?y(null,A):y(new Error(`${T.status} ${T.statusText}: ${A}`))}catch(x){x instanceof Error&&y(x)}},{})}function PI(n){return(e,t)=>new Promise((r,i)=>{n.request(e,t,(s,o)=>{if(s){i(s);return}r(o)})})}function LI(n){return e=>new Promise((t,r)=>{e.length===0&&t([]);const i=e.map(s=>n.request(s.methodName,s.args));n.request(i,(s,o)=>{if(s){r(s);return}t(o)})})}const OI=_e(bI),DI=_e(SI),FI=_e(EI),UI=_e(II),WI=_e(xI),HI=_e(kI),zI=_e(P()),$I=tt(W({total:P(),circulating:P(),nonCirculating:P(),nonCirculatingAccounts:K(Ye)})),Bc=W({amount:$(),uiAmount:J(P()),decimals:P(),uiAmountString:se($())}),qI=tt(K(W({address:Ye,amount:$(),uiAmount:J(P()),decimals:P(),uiAmountString:se($())}))),VI=tt(K(W({pubkey:Ye,account:W({executable:kn(),owner:Ye,lamports:P(),data:tu,rentEpoch:P()})}))),Pc=W({program:$(),parsed:Ci(),space:P()}),GI=tt(K(W({pubkey:Ye,account:W({executable:kn(),owner:Ye,lamports:P(),data:Pc,rentEpoch:P()})}))),jI=tt(K(W({lamports:P(),address:Ye}))),is=W({executable:kn(),owner:Ye,lamports:P(),data:tu,rentEpoch:P()}),KI=W({pubkey:Ye,account:is}),YI=bs(Gt([Xl(pe.Buffer),Pc]),Gt([yg,Pc]),n=>Array.isArray(n)?G(n,tu):n),Lc=W({executable:kn(),owner:Ye,lamports:P(),data:YI,rentEpoch:P()}),JI=W({pubkey:Ye,account:Lc}),ZI=W({state:Gt([je("active"),je("inactive"),je("activating"),je("deactivating")]),active:P(),inactive:P()}),XI=_e(K(W({signature:$(),slot:P(),err:Ur,memo:J($()),blockTime:se(J(P()))}))),QI=_e(K(W({signature:$(),slot:P(),err:Ur,memo:J($()),blockTime:se(J(P()))}))),ex=W({subscription:P(),result:Zo(is)}),tx=W({pubkey:Ye,account:is}),nx=W({subscription:P(),result:Zo(tx)}),rx=W({parent:P(),slot:P(),root:P()}),ix=W({subscription:P(),result:rx}),sx=Gt([W({type:Gt([je("firstShredReceived"),je("completed"),je("optimisticConfirmation"),je("root")]),slot:P(),timestamp:P()}),W({type:je("createdBank"),parent:P(),slot:P(),timestamp:P()}),W({type:je("frozen"),slot:P(),timestamp:P(),stats:W({numTransactionEntries:P(),numSuccessfulTransactions:P(),numFailedTransactions:P(),maxTransactionsPerEntry:P()})}),W({type:je("dead"),slot:P(),timestamp:P(),err:$()})]),ox=W({subscription:P(),result:sx}),ax=W({subscription:P(),result:Zo(Gt([AI,CI]))}),cx=W({subscription:P(),result:P()}),lx=W({pubkey:$(),gossip:J($()),tpu:J($()),rpc:J($()),version:J($())}),Kh=W({votePubkey:$(),nodePubkey:$(),activatedStake:P(),epochVoteAccount:kn(),epochCredits:K(Ql([P(),P(),P()])),commission:P(),lastVote:P(),rootSlot:J(P())}),ux=_e(W({current:K(Kh),delinquent:K(Kh)})),hx=Gt([je("processed"),je("confirmed"),je("finalized")]),dx=W({slot:P(),confirmations:J(P()),err:Ur,confirmationStatus:se(hx)}),fx=tt(K(J(dx))),px=_e(P()),wg=W({accountKey:Ye,writableIndexes:K(P()),readonlyIndexes:K(P())}),nu=W({signatures:K($()),message:W({accountKeys:K($()),header:W({numRequiredSignatures:P(),numReadonlySignedAccounts:P(),numReadonlyUnsignedAccounts:P()}),instructions:K(W({accounts:K(P()),data:$(),programIdIndex:P()})),recentBlockhash:$(),addressTableLookups:se(K(wg))})}),bg=W({pubkey:Ye,signer:kn(),writable:kn(),source:se(Gt([je("transaction"),je("lookupTable")]))}),vg=W({accountKeys:K(bg),signatures:K($())}),Eg=W({parsed:Ci(),program:$(),programId:Ye}),Sg=W({accounts:K(Ye),data:$(),programId:Ye}),gx=Gt([Sg,Eg]),mx=Gt([W({parsed:Ci(),program:$(),programId:$()}),W({accounts:K($()),data:$(),programId:$()})]),Ig=bs(gx,mx,n=>"accounts"in n?G(n,Sg):G(n,Eg)),xg=W({signatures:K($()),message:W({accountKeys:K(bg),instructions:K(Ig),recentBlockhash:$(),addressTableLookups:se(J(K(wg)))})}),bo=W({accountIndex:P(),mint:$(),owner:se($()),programId:se($()),uiTokenAmount:Bc}),kg=W({writable:K(Ye),readonly:K(Ye)}),Xo=W({err:Ur,fee:P(),innerInstructions:se(J(K(W({index:P(),instructions:K(W({accounts:K(P()),data:$(),programIdIndex:P()}))})))),preBalances:K(P()),postBalances:K(P()),logMessages:se(J(K($()))),preTokenBalances:se(J(K(bo))),postTokenBalances:se(J(K(bo))),loadedAddresses:se(kg),computeUnitsConsumed:se(P())}),ru=W({err:Ur,fee:P(),innerInstructions:se(J(K(W({index:P(),instructions:K(Ig)})))),preBalances:K(P()),postBalances:K(P()),logMessages:se(J(K($()))),preTokenBalances:se(J(K(bo))),postTokenBalances:se(J(K(bo))),loadedAddresses:se(kg),computeUnitsConsumed:se(P())}),Ti=Gt([je(0),je("legacy")]),Wr=W({pubkey:$(),lamports:P(),postBalance:J(P()),rewardType:J($()),commission:se(J(P()))}),yx=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),transactions:K(W({transaction:nu,meta:J(Xo),version:se(Ti)})),rewards:se(K(Wr)),blockTime:J(P()),blockHeight:J(P())}))),_x=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),rewards:se(K(Wr)),blockTime:J(P()),blockHeight:J(P())}))),wx=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),transactions:K(W({transaction:vg,meta:J(Xo),version:se(Ti)})),rewards:se(K(Wr)),blockTime:J(P()),blockHeight:J(P())}))),bx=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),transactions:K(W({transaction:xg,meta:J(ru),version:se(Ti)})),rewards:se(K(Wr)),blockTime:J(P()),blockHeight:J(P())}))),vx=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),transactions:K(W({transaction:vg,meta:J(ru),version:se(Ti)})),rewards:se(K(Wr)),blockTime:J(P()),blockHeight:J(P())}))),Ex=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),rewards:se(K(Wr)),blockTime:J(P()),blockHeight:J(P())}))),Sx=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),transactions:K(W({transaction:nu,meta:J(Xo)})),rewards:se(K(Wr)),blockTime:J(P())}))),Yh=_e(J(W({blockhash:$(),previousBlockhash:$(),parentSlot:P(),signatures:K($()),blockTime:J(P())}))),Qa=_e(J(W({slot:P(),meta:J(Xo),blockTime:se(J(P())),transaction:nu,version:se(Ti)}))),Bs=_e(J(W({slot:P(),transaction:xg,meta:J(ru),blockTime:se(J(P())),version:se(Ti)}))),Ix=tt(W({blockhash:$(),lastValidBlockHeight:P()})),xx=tt(kn()),kx=W({slot:P(),numTransactions:P(),numSlots:P(),samplePeriodSecs:P()}),Ax=_e(K(kx)),Cx=tt(J(W({feeCalculator:W({lamportsPerSignature:P()})}))),Tx=_e($()),Rx=_e($()),Mx=W({err:Ur,logs:K($()),signature:$()}),Nx=W({result:Zo(Mx),subscription:P()}),Bx={"solana-client":"js/1.0.0-maintenance"};class Px{constructor(e,t){this._commitment=void 0,this._confirmTransactionInitialTimeout=void 0,this._rpcEndpoint=void 0,this._rpcWsEndpoint=void 0,this._rpcClient=void 0,this._rpcRequest=void 0,this._rpcBatchRequest=void 0,this._rpcWebSocket=void 0,this._rpcWebSocketConnected=!1,this._rpcWebSocketHeartbeat=null,this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketGeneration=0,this._disableBlockhashCaching=!1,this._pollingBlockhash=!1,this._blockhashInfo={latestBlockhash:null,lastFetch:0,transactionSignatures:[],simulatedSignatures:[]},this._nextClientSubscriptionId=0,this._subscriptionDisposeFunctionsByClientSubscriptionId={},this._subscriptionHashByClientSubscriptionId={},this._subscriptionStateChangeCallbacksByHash={},this._subscriptionCallbacksByServerSubscriptionId={},this._subscriptionsByHash={},this._subscriptionsAutoDisposedByRpc=new Set,this.getBlockHeight=(()=>{const h={};return async g=>{const{commitment:y,config:E}=Ue(g),x=this._buildArgs([],y,void 0,E),T=$h(x);return h[T]=h[T]??(async()=>{try{const R=await this._rpcRequest("getBlockHeight",x),A=G(R,_e(P()));if("error"in A)throw new ne(A.error,"failed to get block height information");return A.result}finally{delete h[T]}})(),await h[T]}})();let r,i,s,o,a,c;t&&typeof t=="string"?this._commitment=t:t&&(this._commitment=t.commitment,this._confirmTransactionInitialTimeout=t.confirmTransactionInitialTimeout,r=t.wsEndpoint,i=t.httpHeaders,s=t.fetch,o=t.fetchMiddleware,a=t.disableRetryOnRateLimit,c=t.httpAgent),this._rpcEndpoint=_I(e),this._rpcWsEndpoint=r||mI(e),this._rpcClient=BI(e,i,s,o,a,c),this._rpcRequest=PI(this._rpcClient),this._rpcBatchRequest=LI(this._rpcClient),this._rpcWebSocket=new dI(this._rpcWsEndpoint,{autoconnect:!1,max_reconnects:1/0}),this._rpcWebSocket.on("open",this._wsOnOpen.bind(this)),this._rpcWebSocket.on("error",this._wsOnError.bind(this)),this._rpcWebSocket.on("close",this._wsOnClose.bind(this)),this._rpcWebSocket.on("accountNotification",this._wsOnAccountNotification.bind(this)),this._rpcWebSocket.on("programNotification",this._wsOnProgramAccountNotification.bind(this)),this._rpcWebSocket.on("slotNotification",this._wsOnSlotNotification.bind(this)),this._rpcWebSocket.on("slotsUpdatesNotification",this._wsOnSlotUpdatesNotification.bind(this)),this._rpcWebSocket.on("signatureNotification",this._wsOnSignatureNotification.bind(this)),this._rpcWebSocket.on("rootNotification",this._wsOnRootNotification.bind(this)),this._rpcWebSocket.on("logsNotification",this._wsOnLogsNotification.bind(this))}get commitment(){return this._commitment}get rpcEndpoint(){return this._rpcEndpoint}async getBalanceAndContext(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],r,void 0,i),o=await this._rpcRequest("getBalance",s),a=G(o,tt(P()));if("error"in a)throw new ne(a.error,`failed to get balance for ${e.toBase58()}`);return a.result}async getBalance(e,t){return await this.getBalanceAndContext(e,t).then(r=>r.value).catch(r=>{throw new Error("failed to get balance of account "+e.toBase58()+": "+r)})}async getBlockTime(e){const t=await this._rpcRequest("getBlockTime",[e]),r=G(t,_e(J(P())));if("error"in r)throw new ne(r.error,`failed to get block time for slot ${e}`);return r.result}async getMinimumLedgerSlot(){const e=await this._rpcRequest("minimumLedgerSlot",[]),t=G(e,_e(P()));if("error"in t)throw new ne(t.error,"failed to get minimum ledger slot");return t.result}async getFirstAvailableBlock(){const e=await this._rpcRequest("getFirstAvailableBlock",[]),t=G(e,zI);if("error"in t)throw new ne(t.error,"failed to get first available block");return t.result}async getSupply(e){let t={};typeof e=="string"?t={commitment:e}:e?t={...e,commitment:e&&e.commitment||this.commitment}:t={commitment:this.commitment};const r=await this._rpcRequest("getSupply",[t]),i=G(r,$I);if("error"in i)throw new ne(i.error,"failed to get supply");return i.result}async getTokenSupply(e,t){const r=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenSupply",r),s=G(i,tt(Bc));if("error"in s)throw new ne(s.error,"failed to get token supply");return s.result}async getTokenAccountBalance(e,t){const r=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenAccountBalance",r),s=G(i,tt(Bc));if("error"in s)throw new ne(s.error,"failed to get token account balance");return s.result}async getTokenAccountsByOwner(e,t,r){const{commitment:i,config:s}=Ue(r);let o=[e.toBase58()];"mint"in t?o.push({mint:t.mint.toBase58()}):o.push({programId:t.programId.toBase58()});const a=this._buildArgs(o,i,"base64",s),c=await this._rpcRequest("getTokenAccountsByOwner",a),h=G(c,VI);if("error"in h)throw new ne(h.error,`failed to get token accounts owned by account ${e.toBase58()}`);return h.result}async getParsedTokenAccountsByOwner(e,t,r){let i=[e.toBase58()];"mint"in t?i.push({mint:t.mint.toBase58()}):i.push({programId:t.programId.toBase58()});const s=this._buildArgs(i,r,"jsonParsed"),o=await this._rpcRequest("getTokenAccountsByOwner",s),a=G(o,GI);if("error"in a)throw new ne(a.error,`failed to get token accounts owned by account ${e.toBase58()}`);return a.result}async getLargestAccounts(e){const t={...e,commitment:e&&e.commitment||this.commitment},r=t.filter||t.commitment?[t]:[],i=await this._rpcRequest("getLargestAccounts",r),s=G(i,jI);if("error"in s)throw new ne(s.error,"failed to get largest accounts");return s.result}async getTokenLargestAccounts(e,t){const r=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenLargestAccounts",r),s=G(i,qI);if("error"in s)throw new ne(s.error,"failed to get token largest accounts");return s.result}async getAccountInfoAndContext(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],r,"base64",i),o=await this._rpcRequest("getAccountInfo",s),a=G(o,tt(J(is)));if("error"in a)throw new ne(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getParsedAccountInfo(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],r,"jsonParsed",i),o=await this._rpcRequest("getAccountInfo",s),a=G(o,tt(J(Lc)));if("error"in a)throw new ne(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getAccountInfo(e,t){try{return(await this.getAccountInfoAndContext(e,t)).value}catch(r){throw new Error("failed to get info about account "+e.toBase58()+": "+r)}}async getMultipleParsedAccounts(e,t){const{commitment:r,config:i}=Ue(t),s=e.map(h=>h.toBase58()),o=this._buildArgs([s],r,"jsonParsed",i),a=await this._rpcRequest("getMultipleAccounts",o),c=G(a,tt(K(J(Lc))));if("error"in c)throw new ne(c.error,`failed to get info for accounts ${s}`);return c.result}async getMultipleAccountsInfoAndContext(e,t){const{commitment:r,config:i}=Ue(t),s=e.map(h=>h.toBase58()),o=this._buildArgs([s],r,"base64",i),a=await this._rpcRequest("getMultipleAccounts",o),c=G(a,tt(K(J(is))));if("error"in c)throw new ne(c.error,`failed to get info for accounts ${s}`);return c.result}async getMultipleAccountsInfo(e,t){return(await this.getMultipleAccountsInfoAndContext(e,t)).value}async getStakeActivation(e,t,r){const{commitment:i,config:s}=Ue(t),o=this._buildArgs([e.toBase58()],i,void 0,{...s,epoch:r??(s==null?void 0:s.epoch)}),a=await this._rpcRequest("getStakeActivation",o),c=G(a,_e(ZI));if("error"in c)throw new ne(c.error,`failed to get Stake Activation ${e.toBase58()}`);return c.result}async getProgramAccounts(e,t){const{commitment:r,config:i}=Ue(t),{encoding:s,...o}=i||{},a=this._buildArgs([e.toBase58()],r,s||"base64",{...o,...o.filters?{filters:Gh(o.filters)}:null}),c=await this._rpcRequest("getProgramAccounts",a),h=K(KI),g=o.withContext===!0?G(c,tt(h)):G(c,_e(h));if("error"in g)throw new ne(g.error,`failed to get accounts owned by program ${e.toBase58()}`);return g.result}async getParsedProgramAccounts(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],r,"jsonParsed",i),o=await this._rpcRequest("getProgramAccounts",s),a=G(o,_e(K(JI)));if("error"in a)throw new ne(a.error,`failed to get accounts owned by program ${e.toBase58()}`);return a.result}async confirmTransaction(e,t){var s;let r;if(typeof e=="string")r=e;else{const o=e;if((s=o.abortSignal)!=null&&s.aborted)return Promise.reject(o.abortSignal.reason);r=o.signature}let i;try{i=Lt.decode(r)}catch{throw new Error("signature must be base58 encoded: "+r)}return vt(i.length===64,"signature has invalid length"),typeof e=="string"?await this.confirmTransactionUsingLegacyTimeoutStrategy({commitment:t||this.commitment,signature:r}):"lastValidBlockHeight"in e?await this.confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:t||this.commitment,strategy:e}):await this.confirmTransactionUsingDurableNonceStrategy({commitment:t||this.commitment,strategy:e})}getCancellationPromise(e){return new Promise((t,r)=>{e!=null&&(e.aborted?r(e.reason):e.addEventListener("abort",()=>{r(e.reason)}))})}getTransactionConfirmationPromise({commitment:e,signature:t}){let r,i,s=!1;const o=new Promise((c,h)=>{try{r=this.onSignature(t,(y,E)=>{r=void 0;const x={context:E,value:y};c({__type:Qn.PROCESSED,response:x})},e);const g=new Promise(y=>{r==null?y():i=this._onSubscriptionStateChange(r,E=>{E==="subscribed"&&y()})});(async()=>{if(await g,s)return;const y=await this.getSignatureStatus(t);if(s||y==null)return;const{context:E,value:x}=y;if(x!=null)if(x!=null&&x.err)h(x.err);else{switch(e){case"confirmed":case"single":case"singleGossip":{if(x.confirmationStatus==="processed")return;break}case"finalized":case"max":case"root":{if(x.confirmationStatus==="processed"||x.confirmationStatus==="confirmed")return;break}case"processed":case"recent":}s=!0,c({__type:Qn.PROCESSED,response:{context:E,value:x}})}})()}catch(g){h(g)}});return{abortConfirmation:()=>{i&&(i(),i=void 0),r!=null&&(this.removeSignatureListener(r),r=void 0)},confirmationPromise:o}}async confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:e,strategy:{abortSignal:t,lastValidBlockHeight:r,signature:i}}){let s=!1;const o=new Promise(y=>{const E=async()=>{try{return await this.getBlockHeight(e)}catch{return-1}};(async()=>{let x=await E();if(!s){for(;x<=r;)if(await jr(1e3),s||(x=await E(),s))return;y({__type:Qn.BLOCKHEIGHT_EXCEEDED})}})()}),{abortConfirmation:a,confirmationPromise:c}=this.getTransactionConfirmationPromise({commitment:e,signature:i}),h=this.getCancellationPromise(t);let g;try{const y=await Promise.race([h,c,o]);if(y.__type===Qn.PROCESSED)g=y.response;else throw new dg(i)}finally{s=!0,a()}return g}async confirmTransactionUsingDurableNonceStrategy({commitment:e,strategy:{abortSignal:t,minContextSlot:r,nonceAccountPubkey:i,nonceValue:s,signature:o}}){let a=!1;const c=new Promise(x=>{let T=s,R=null;const A=async()=>{try{const{context:D,value:U}=await this.getNonceAndContext(i,{commitment:e,minContextSlot:r});return R=D.slot,U==null?void 0:U.nonce}catch{return T}};(async()=>{if(T=await A(),!a)for(;;){if(s!==T){x({__type:Qn.NONCE_INVALID,slotInWhichNonceDidAdvance:R});return}if(await jr(2e3),a||(T=await A(),a))return}})()}),{abortConfirmation:h,confirmationPromise:g}=this.getTransactionConfirmationPromise({commitment:e,signature:o}),y=this.getCancellationPromise(t);let E;try{const x=await Promise.race([y,g,c]);if(x.__type===Qn.PROCESSED)E=x.response;else{let T;for(;;){const R=await this.getSignatureStatus(o);if(R==null)break;if(R.context.slot<(x.slotInWhichNonceDidAdvance??r)){await jr(400);continue}T=R;break}if(T!=null&&T.value){const R=e||"finalized",{confirmationStatus:A}=T.value;switch(R){case"processed":case"recent":if(A!=="processed"&&A!=="confirmed"&&A!=="finalized")throw new Oi(o);break;case"confirmed":case"single":case"singleGossip":if(A!=="confirmed"&&A!=="finalized")throw new Oi(o);break;case"finalized":case"max":case"root":if(A!=="finalized")throw new Oi(o);break;default:}E={context:T.context,value:{err:T.value.err}}}else throw new Oi(o)}}finally{a=!0,h()}return E}async confirmTransactionUsingLegacyTimeoutStrategy({commitment:e,signature:t}){let r;const i=new Promise(c=>{let h=this._confirmTransactionInitialTimeout||6e4;switch(e){case"processed":case"recent":case"single":case"confirmed":case"singleGossip":{h=this._confirmTransactionInitialTimeout||3e4;break}}r=setTimeout(()=>c({__type:Qn.TIMED_OUT,timeoutMs:h}),h)}),{abortConfirmation:s,confirmationPromise:o}=this.getTransactionConfirmationPromise({commitment:e,signature:t});let a;try{const c=await Promise.race([o,i]);if(c.__type===Qn.PROCESSED)a=c.response;else throw new fg(t,c.timeoutMs/1e3)}finally{clearTimeout(r),s()}return a}async getClusterNodes(){const e=await this._rpcRequest("getClusterNodes",[]),t=G(e,_e(K(lx)));if("error"in t)throw new ne(t.error,"failed to get cluster nodes");return t.result}async getVoteAccounts(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getVoteAccounts",t),i=G(r,ux);if("error"in i)throw new ne(i.error,"failed to get vote accounts");return i.result}async getSlot(e){const{commitment:t,config:r}=Ue(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getSlot",i),o=G(s,_e(P()));if("error"in o)throw new ne(o.error,"failed to get slot");return o.result}async getSlotLeader(e){const{commitment:t,config:r}=Ue(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getSlotLeader",i),o=G(s,_e($()));if("error"in o)throw new ne(o.error,"failed to get slot leader");return o.result}async getSlotLeaders(e,t){const r=[e,t],i=await this._rpcRequest("getSlotLeaders",r),s=G(i,_e(K(Ye)));if("error"in s)throw new ne(s.error,"failed to get slot leaders");return s.result}async getSignatureStatus(e,t){const{context:r,value:i}=await this.getSignatureStatuses([e],t);vt(i.length===1);const s=i[0];return{context:r,value:s}}async getSignatureStatuses(e,t){const r=[e];t&&r.push(t);const i=await this._rpcRequest("getSignatureStatuses",r),s=G(i,fx);if("error"in s)throw new ne(s.error,"failed to get signature status");return s.result}async getTransactionCount(e){const{commitment:t,config:r}=Ue(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getTransactionCount",i),o=G(s,_e(P()));if("error"in o)throw new ne(o.error,"failed to get transaction count");return o.result}async getTotalSupply(e){return(await this.getSupply({commitment:e,excludeNonCirculatingAccountsList:!0})).value.total}async getInflationGovernor(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getInflationGovernor",t),i=G(r,OI);if("error"in i)throw new ne(i.error,"failed to get inflation");return i.result}async getInflationReward(e,t,r){const{commitment:i,config:s}=Ue(r),o=this._buildArgs([e.map(h=>h.toBase58())],i,void 0,{...s,epoch:t??(s==null?void 0:s.epoch)}),a=await this._rpcRequest("getInflationReward",o),c=G(a,vI);if("error"in c)throw new ne(c.error,"failed to get inflation reward");return c.result}async getInflationRate(){const e=await this._rpcRequest("getInflationRate",[]),t=G(e,DI);if("error"in t)throw new ne(t.error,"failed to get inflation rate");return t.result}async getEpochInfo(e){const{commitment:t,config:r}=Ue(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getEpochInfo",i),o=G(s,UI);if("error"in o)throw new ne(o.error,"failed to get epoch info");return o.result}async getEpochSchedule(){const e=await this._rpcRequest("getEpochSchedule",[]),t=G(e,WI);if("error"in t)throw new ne(t.error,"failed to get epoch schedule");const r=t.result;return new uI(r.slotsPerEpoch,r.leaderScheduleSlotOffset,r.warmup,r.firstNormalEpoch,r.firstNormalSlot)}async getLeaderSchedule(){const e=await this._rpcRequest("getLeaderSchedule",[]),t=G(e,HI);if("error"in t)throw new ne(t.error,"failed to get leader schedule");return t.result}async getMinimumBalanceForRentExemption(e,t){const r=this._buildArgs([e],t),i=await this._rpcRequest("getMinimumBalanceForRentExemption",r),s=G(i,px);return"error"in s?(console.warn("Unable to fetch minimum balance for rent exemption"),0):s.result}async getRecentBlockhashAndContext(e){const{context:t,value:{blockhash:r}}=await this.getLatestBlockhashAndContext(e);return{context:t,value:{blockhash:r,feeCalculator:{get lamportsPerSignature(){throw new Error("The capability to fetch `lamportsPerSignature` using the `getRecentBlockhash` API is no longer offered by the network. Use the `getFeeForMessage` API to obtain the fee for a given message.")},toJSON(){return{}}}}}}async getRecentPerformanceSamples(e){const t=await this._rpcRequest("getRecentPerformanceSamples",e?[e]:[]),r=G(t,Ax);if("error"in r)throw new ne(r.error,"failed to get recent performance samples");return r.result}async getFeeCalculatorForBlockhash(e,t){const r=this._buildArgs([e],t),i=await this._rpcRequest("getFeeCalculatorForBlockhash",r),s=G(i,Cx);if("error"in s)throw new ne(s.error,"failed to get fee calculator");const{context:o,value:a}=s.result;return{context:o,value:a!==null?a.feeCalculator:null}}async getFeeForMessage(e,t){const r=Nt(e.serialize()).toString("base64"),i=this._buildArgs([r],t),s=await this._rpcRequest("getFeeForMessage",i),o=G(s,tt(J(P())));if("error"in o)throw new ne(o.error,"failed to get fee for message");if(o.result===null)throw new Error("invalid blockhash");return o.result}async getRecentPrioritizationFees(e){var o;const t=(o=e==null?void 0:e.lockedWritableAccounts)==null?void 0:o.map(a=>a.toBase58()),r=t!=null&&t.length?[t]:[],i=await this._rpcRequest("getRecentPrioritizationFees",r),s=G(i,FI);if("error"in s)throw new ne(s.error,"failed to get recent prioritization fees");return s.result}async getRecentBlockhash(e){try{return(await this.getRecentBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhash(e){try{return(await this.getLatestBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhashAndContext(e){const{commitment:t,config:r}=Ue(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getLatestBlockhash",i),o=G(s,Ix);if("error"in o)throw new ne(o.error,"failed to get latest blockhash");return o.result}async isBlockhashValid(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgs([e],r,void 0,i),o=await this._rpcRequest("isBlockhashValid",s),a=G(o,xx);if("error"in a)throw new ne(a.error,"failed to determine if the blockhash `"+e+"`is valid");return a.result}async getVersion(){const e=await this._rpcRequest("getVersion",[]),t=G(e,_e(TI));if("error"in t)throw new ne(t.error,"failed to get version");return t.result}async getGenesisHash(){const e=await this._rpcRequest("getGenesisHash",[]),t=G(e,_e($()));if("error"in t)throw new ne(t.error,"failed to get genesis hash");return t.result}async getBlock(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],r,void 0,i),o=await this._rpcRequest("getBlock",s);try{switch(i==null?void 0:i.transactionDetails){case"accounts":{const a=G(o,wx);if("error"in a)throw a.error;return a.result}case"none":{const a=G(o,_x);if("error"in a)throw a.error;return a.result}default:{const a=G(o,yx);if("error"in a)throw a.error;const{result:c}=a;return c?{...c,transactions:c.transactions.map(({transaction:h,meta:g,version:y})=>({meta:g,transaction:{...h,message:Xa(y,h.message)},version:y}))}:null}}}catch(a){throw new ne(a,"failed to get confirmed block")}}async getParsedBlock(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],r,"jsonParsed",i),o=await this._rpcRequest("getBlock",s);try{switch(i==null?void 0:i.transactionDetails){case"accounts":{const a=G(o,vx);if("error"in a)throw a.error;return a.result}case"none":{const a=G(o,Ex);if("error"in a)throw a.error;return a.result}default:{const a=G(o,bx);if("error"in a)throw a.error;return a.result}}}catch(a){throw new ne(a,"failed to get block")}}async getBlockProduction(e){let t,r;if(typeof e=="string")r=e;else if(e){const{commitment:a,...c}=e;r=a,t=c}const i=this._buildArgs([],r,"base64",t),s=await this._rpcRequest("getBlockProduction",i),o=G(s,NI);if("error"in o)throw new ne(o.error,"failed to get block production information");return o.result}async getTransaction(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],r,void 0,i),o=await this._rpcRequest("getTransaction",s),a=G(o,Qa);if("error"in a)throw new ne(a.error,"failed to get transaction");const c=a.result;return c&&{...c,transaction:{...c.transaction,message:Xa(c.version,c.transaction.message)}}}async getParsedTransaction(e,t){const{commitment:r,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],r,"jsonParsed",i),o=await this._rpcRequest("getTransaction",s),a=G(o,Bs);if("error"in a)throw new ne(a.error,"failed to get transaction");return a.result}async getParsedTransactions(e,t){const{commitment:r,config:i}=Ue(t),s=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],r,"jsonParsed",i)}));return(await this._rpcBatchRequest(s)).map(c=>{const h=G(c,Bs);if("error"in h)throw new ne(h.error,"failed to get transactions");return h.result})}async getTransactions(e,t){const{commitment:r,config:i}=Ue(t),s=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],r,void 0,i)}));return(await this._rpcBatchRequest(s)).map(c=>{const h=G(c,Qa);if("error"in h)throw new ne(h.error,"failed to get transactions");const g=h.result;return g&&{...g,transaction:{...g.transaction,message:Xa(g.version,g.transaction.message)}}})}async getConfirmedBlock(e,t){const r=this._buildArgsAtLeastConfirmed([e],t),i=await this._rpcRequest("getBlock",r),s=G(i,Sx);if("error"in s)throw new ne(s.error,"failed to get confirmed block");const o=s.result;if(!o)throw new Error("Confirmed block "+e+" not found");const a={...o,transactions:o.transactions.map(({transaction:c,meta:h})=>{const g=new yr(c.message);return{meta:h,transaction:{...c,message:g}}})};return{...a,transactions:a.transactions.map(({transaction:c,meta:h})=>({meta:h,transaction:En.populate(c.message,c.signatures)}))}}async getBlocks(e,t,r){const i=this._buildArgsAtLeastConfirmed(t!==void 0?[e,t]:[e],r),s=await this._rpcRequest("getBlocks",i),o=G(s,_e(K(P())));if("error"in o)throw new ne(o.error,"failed to get blocks");return o.result}async getBlockSignatures(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),i=await this._rpcRequest("getBlock",r),s=G(i,Yh);if("error"in s)throw new ne(s.error,"failed to get block");const o=s.result;if(!o)throw new Error("Block "+e+" not found");return o}async getConfirmedBlockSignatures(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),i=await this._rpcRequest("getBlock",r),s=G(i,Yh);if("error"in s)throw new ne(s.error,"failed to get confirmed block");const o=s.result;if(!o)throw new Error("Confirmed block "+e+" not found");return o}async getConfirmedTransaction(e,t){const r=this._buildArgsAtLeastConfirmed([e],t),i=await this._rpcRequest("getTransaction",r),s=G(i,Qa);if("error"in s)throw new ne(s.error,"failed to get transaction");const o=s.result;if(!o)return o;const a=new yr(o.transaction.message),c=o.transaction.signatures;return{...o,transaction:En.populate(a,c)}}async getParsedConfirmedTransaction(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,"jsonParsed"),i=await this._rpcRequest("getTransaction",r),s=G(i,Bs);if("error"in s)throw new ne(s.error,"failed to get confirmed transaction");return s.result}async getParsedConfirmedTransactions(e,t){const r=e.map(o=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([o],t,"jsonParsed")}));return(await this._rpcBatchRequest(r)).map(o=>{const a=G(o,Bs);if("error"in a)throw new ne(a.error,"failed to get confirmed transactions");return a.result})}async getConfirmedSignaturesForAddress(e,t,r){let i={},s=await this.getFirstAvailableBlock();for(;!("until"in i)&&(t--,!(t<=0||t<s));)try{const c=await this.getConfirmedBlockSignatures(t,"finalized");c.signatures.length>0&&(i.until=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}let o=await this.getSlot("finalized");for(;!("before"in i)&&(r++,!(r>o));)try{const c=await this.getConfirmedBlockSignatures(r);c.signatures.length>0&&(i.before=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}return(await this.getConfirmedSignaturesForAddress2(e,i)).map(c=>c.signature)}async getConfirmedSignaturesForAddress2(e,t,r){const i=this._buildArgsAtLeastConfirmed([e.toBase58()],r,void 0,t),s=await this._rpcRequest("getConfirmedSignaturesForAddress2",i),o=G(s,XI);if("error"in o)throw new ne(o.error,"failed to get confirmed signatures for address");return o.result}async getSignaturesForAddress(e,t,r){const i=this._buildArgsAtLeastConfirmed([e.toBase58()],r,void 0,t),s=await this._rpcRequest("getSignaturesForAddress",i),o=G(s,QI);if("error"in o)throw new ne(o.error,"failed to get signatures for address");return o.result}async getAddressLookupTable(e,t){const{context:r,value:i}=await this.getAccountInfoAndContext(e,t);let s=null;return i!==null&&(s=new Vh({key:e,state:Vh.deserialize(i.data)})),{context:r,value:s}}async getNonceAndContext(e,t){const{context:r,value:i}=await this.getAccountInfoAndContext(e,t);let s=null;return i!==null&&(s=eu.fromAccountData(i.data)),{context:r,value:s}}async getNonce(e,t){return await this.getNonceAndContext(e,t).then(r=>r.value).catch(r=>{throw new Error("failed to get nonce for account "+e.toBase58()+": "+r)})}async requestAirdrop(e,t){const r=await this._rpcRequest("requestAirdrop",[e.toBase58(),t]),i=G(r,Tx);if("error"in i)throw new ne(i.error,`airdrop to ${e.toBase58()} failed`);return i.result}async _blockhashWithExpiryBlockHeight(e){if(!e){for(;this._pollingBlockhash;)await jr(100);const r=Date.now()-this._blockhashInfo.lastFetch>=yI;if(this._blockhashInfo.latestBlockhash!==null&&!r)return this._blockhashInfo.latestBlockhash}return await this._pollNewBlockhash()}async _pollNewBlockhash(){this._pollingBlockhash=!0;try{const e=Date.now(),t=this._blockhashInfo.latestBlockhash,r=t?t.blockhash:null;for(let i=0;i<50;i++){const s=await this.getLatestBlockhash("finalized");if(r!==s.blockhash)return this._blockhashInfo={latestBlockhash:s,lastFetch:Date.now(),transactionSignatures:[],simulatedSignatures:[]},s;await jr(nI/2)}throw new Error(`Unable to obtain a new blockhash after ${Date.now()-e}ms`)}finally{this._pollingBlockhash=!1}}async getStakeMinimumDelegation(e){const{commitment:t,config:r}=Ue(e),i=this._buildArgs([],t,"base64",r),s=await this._rpcRequest("getStakeMinimumDelegation",i),o=G(s,tt(P()));if("error"in o)throw new ne(o.error,"failed to get stake minimum delegation");return o.result}async simulateTransaction(e,t,r){if("message"in e){const R=e.serialize(),A=pe.Buffer.from(R).toString("base64");if(Array.isArray(t)||r!==void 0)throw new Error("Invalid arguments");const D=t||{};D.encoding="base64","commitment"in D||(D.commitment=this.commitment),t&&typeof t=="object"&&"innerInstructions"in t&&(D.innerInstructions=t.innerInstructions);const U=[A,D],L=await this._rpcRequest("simulateTransaction",U),q=G(L,jh);if("error"in q)throw new Error("failed to simulate transaction: "+q.error.message);return q.result}let i;if(e instanceof En){let T=e;i=new En,i.feePayer=T.feePayer,i.instructions=e.instructions,i.nonceInfo=T.nonceInfo,i.signatures=T.signatures}else i=En.populate(e),i._message=i._json=void 0;if(t!==void 0&&!Array.isArray(t))throw new Error("Invalid arguments");const s=t;if(i.nonceInfo&&s)i.sign(...s);else{let T=this._disableBlockhashCaching;for(;;){const R=await this._blockhashWithExpiryBlockHeight(T);if(i.lastValidBlockHeight=R.lastValidBlockHeight,i.recentBlockhash=R.blockhash,!s)break;if(i.sign(...s),!i.signature)throw new Error("!signature");const A=i.signature.toString("base64");if(!this._blockhashInfo.simulatedSignatures.includes(A)&&!this._blockhashInfo.transactionSignatures.includes(A)){this._blockhashInfo.simulatedSignatures.push(A);break}else T=!0}}const o=i._compile(),a=o.serialize(),h=i._serialize(a).toString("base64"),g={encoding:"base64",commitment:this.commitment};if(r){const T=(Array.isArray(r)?r:o.nonProgramIds()).map(R=>R.toBase58());g.accounts={encoding:"base64",addresses:T}}s&&(g.sigVerify=!0),t&&typeof t=="object"&&"innerInstructions"in t&&(g.innerInstructions=t.innerInstructions);const y=[h,g],E=await this._rpcRequest("simulateTransaction",y),x=G(E,jh);if("error"in x){let T;if("data"in x.error&&(T=x.error.data.logs,T&&Array.isArray(T))){const R=`
    `,A=R+T.join(R);console.error(x.error.message,A)}throw new Wh({action:"simulate",signature:"",transactionMessage:x.error.message,logs:T})}return x.result}async sendTransaction(e,t,r){if("version"in e){if(t&&Array.isArray(t))throw new Error("Invalid arguments");const o=e.serialize();return await this.sendRawTransaction(o,t)}if(t===void 0||!Array.isArray(t))throw new Error("Invalid arguments");const i=t;if(e.nonceInfo)e.sign(...i);else{let o=this._disableBlockhashCaching;for(;;){const a=await this._blockhashWithExpiryBlockHeight(o);if(e.lastValidBlockHeight=a.lastValidBlockHeight,e.recentBlockhash=a.blockhash,e.sign(...i),!e.signature)throw new Error("!signature");const c=e.signature.toString("base64");if(this._blockhashInfo.transactionSignatures.includes(c))o=!0;else{this._blockhashInfo.transactionSignatures.push(c);break}}}const s=e.serialize();return await this.sendRawTransaction(s,r)}async sendRawTransaction(e,t){const r=Nt(e).toString("base64");return await this.sendEncodedTransaction(r,t)}async sendEncodedTransaction(e,t){const r={encoding:"base64"},i=t&&t.skipPreflight,s=i===!0?"processed":t&&t.preflightCommitment||this.commitment;t&&t.maxRetries!=null&&(r.maxRetries=t.maxRetries),t&&t.minContextSlot!=null&&(r.minContextSlot=t.minContextSlot),i&&(r.skipPreflight=i),s&&(r.preflightCommitment=s);const o=[e,r],a=await this._rpcRequest("sendTransaction",o),c=G(a,Rx);if("error"in c){let h;throw"data"in c.error&&(h=c.error.data.logs),new Wh({action:i?"send":"simulate",signature:"",transactionMessage:c.error.message,logs:h})}return c.result}_wsOnOpen(){this._rpcWebSocketConnected=!0,this._rpcWebSocketHeartbeat=setInterval(()=>{(async()=>{try{await this._rpcWebSocket.notify("ping")}catch{}})()},5e3),this._updateSubscriptions()}_wsOnError(e){this._rpcWebSocketConnected=!1,console.error("ws error:",e.message)}_wsOnClose(e){if(this._rpcWebSocketConnected=!1,this._rpcWebSocketGeneration=(this._rpcWebSocketGeneration+1)%Number.MAX_SAFE_INTEGER,this._rpcWebSocketIdleTimeout&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null),this._rpcWebSocketHeartbeat&&(clearInterval(this._rpcWebSocketHeartbeat),this._rpcWebSocketHeartbeat=null),e===1e3){this._updateSubscriptions();return}this._subscriptionCallbacksByServerSubscriptionId={},Object.entries(this._subscriptionsByHash).forEach(([t,r])=>{this._setSubscription(t,{...r,state:"pending"})})}_setSubscription(e,t){var i;const r=(i=this._subscriptionsByHash[e])==null?void 0:i.state;if(this._subscriptionsByHash[e]=t,r!==t.state){const s=this._subscriptionStateChangeCallbacksByHash[e];s&&s.forEach(o=>{try{o(t.state)}catch{}})}}_onSubscriptionStateChange(e,t){var s;const r=this._subscriptionHashByClientSubscriptionId[e];if(r==null)return()=>{};const i=(s=this._subscriptionStateChangeCallbacksByHash)[r]||(s[r]=new Set);return i.add(t),()=>{i.delete(t),i.size===0&&delete this._subscriptionStateChangeCallbacksByHash[r]}}async _updateSubscriptions(){if(Object.keys(this._subscriptionsByHash).length===0){this._rpcWebSocketConnected&&(this._rpcWebSocketConnected=!1,this._rpcWebSocketIdleTimeout=setTimeout(()=>{this._rpcWebSocketIdleTimeout=null;try{this._rpcWebSocket.close()}catch(r){r instanceof Error&&console.log(`Error when closing socket connection: ${r.message}`)}},500));return}if(this._rpcWebSocketIdleTimeout!==null&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketConnected=!0),!this._rpcWebSocketConnected){this._rpcWebSocket.connect();return}const e=this._rpcWebSocketGeneration,t=()=>e===this._rpcWebSocketGeneration;await Promise.all(Object.keys(this._subscriptionsByHash).map(async r=>{const i=this._subscriptionsByHash[r];if(i!==void 0)switch(i.state){case"pending":case"unsubscribed":if(i.callbacks.size===0){delete this._subscriptionsByHash[r],i.state==="unsubscribed"&&delete this._subscriptionCallbacksByServerSubscriptionId[i.serverSubscriptionId],await this._updateSubscriptions();return}await(async()=>{const{args:s,method:o}=i;try{this._setSubscription(r,{...i,state:"subscribing"});const a=await this._rpcWebSocket.call(o,s);this._setSubscription(r,{...i,serverSubscriptionId:a,state:"subscribed"}),this._subscriptionCallbacksByServerSubscriptionId[a]=i.callbacks,await this._updateSubscriptions()}catch(a){if(console.error(`Received ${a instanceof Error?"":"JSON-RPC "}error calling \`${o}\``,{args:s,error:a}),!t())return;this._setSubscription(r,{...i,state:"pending"}),await this._updateSubscriptions()}})();break;case"subscribed":i.callbacks.size===0&&await(async()=>{const{serverSubscriptionId:s,unsubscribeMethod:o}=i;if(this._subscriptionsAutoDisposedByRpc.has(s))this._subscriptionsAutoDisposedByRpc.delete(s);else{this._setSubscription(r,{...i,state:"unsubscribing"}),this._setSubscription(r,{...i,state:"unsubscribing"});try{await this._rpcWebSocket.call(o,[s])}catch(a){if(a instanceof Error&&console.error(`${o} error:`,a.message),!t())return;this._setSubscription(r,{...i,state:"subscribed"}),await this._updateSubscriptions();return}}this._setSubscription(r,{...i,state:"unsubscribed"}),await this._updateSubscriptions()})();break}}))}_handleServerNotification(e,t){const r=this._subscriptionCallbacksByServerSubscriptionId[e];r!==void 0&&r.forEach(i=>{try{i(...t)}catch(s){console.error(s)}})}_wsOnAccountNotification(e){const{result:t,subscription:r}=G(e,ex);this._handleServerNotification(r,[t.value,t.context])}_makeSubscription(e,t){const r=this._nextClientSubscriptionId++,i=$h([e.method,t]),s=this._subscriptionsByHash[i];return s===void 0?this._subscriptionsByHash[i]={...e,args:t,callbacks:new Set([e.callback]),state:"pending"}:s.callbacks.add(e.callback),this._subscriptionHashByClientSubscriptionId[r]=i,this._subscriptionDisposeFunctionsByClientSubscriptionId[r]=async()=>{delete this._subscriptionDisposeFunctionsByClientSubscriptionId[r],delete this._subscriptionHashByClientSubscriptionId[r];const o=this._subscriptionsByHash[i];vt(o!==void 0,`Could not find a \`Subscription\` when tearing down client subscription #${r}`),o.callbacks.delete(e.callback),await this._updateSubscriptions()},this._updateSubscriptions(),r}onAccountChange(e,t,r){const{commitment:i,config:s}=Ue(r),o=this._buildArgs([e.toBase58()],i||this._commitment||"finalized","base64",s);return this._makeSubscription({callback:t,method:"accountSubscribe",unsubscribeMethod:"accountUnsubscribe"},o)}async removeAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"account change")}_wsOnProgramAccountNotification(e){const{result:t,subscription:r}=G(e,nx);this._handleServerNotification(r,[{accountId:t.value.pubkey,accountInfo:t.value.account},t.context])}onProgramAccountChange(e,t,r,i){const{commitment:s,config:o}=Ue(r),a=this._buildArgs([e.toBase58()],s||this._commitment||"finalized","base64",o||(i?{filters:Gh(i)}:void 0));return this._makeSubscription({callback:t,method:"programSubscribe",unsubscribeMethod:"programUnsubscribe"},a)}async removeProgramAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"program account change")}onLogs(e,t,r){const i=this._buildArgs([typeof e=="object"?{mentions:[e.toString()]}:e],r||this._commitment||"finalized");return this._makeSubscription({callback:t,method:"logsSubscribe",unsubscribeMethod:"logsUnsubscribe"},i)}async removeOnLogsListener(e){await this._unsubscribeClientSubscription(e,"logs")}_wsOnLogsNotification(e){const{result:t,subscription:r}=G(e,Nx);this._handleServerNotification(r,[t.value,t.context])}_wsOnSlotNotification(e){const{result:t,subscription:r}=G(e,ix);this._handleServerNotification(r,[t])}onSlotChange(e){return this._makeSubscription({callback:e,method:"slotSubscribe",unsubscribeMethod:"slotUnsubscribe"},[])}async removeSlotChangeListener(e){await this._unsubscribeClientSubscription(e,"slot change")}_wsOnSlotUpdatesNotification(e){const{result:t,subscription:r}=G(e,ox);this._handleServerNotification(r,[t])}onSlotUpdate(e){return this._makeSubscription({callback:e,method:"slotsUpdatesSubscribe",unsubscribeMethod:"slotsUpdatesUnsubscribe"},[])}async removeSlotUpdateListener(e){await this._unsubscribeClientSubscription(e,"slot update")}async _unsubscribeClientSubscription(e,t){const r=this._subscriptionDisposeFunctionsByClientSubscriptionId[e];r?await r():console.warn(`Ignored unsubscribe request because an active subscription with id \`${e}\` for '${t}' events could not be found.`)}_buildArgs(e,t,r,i){const s=t||this._commitment;if(s||r||i){let o={};r&&(o.encoding=r),s&&(o.commitment=s),i&&(o=Object.assign(o,i)),e.push(o)}return e}_buildArgsAtLeastConfirmed(e,t,r,i){const s=t||this._commitment;if(s&&!["confirmed","finalized"].includes(s))throw new Error("Using Connection with default commitment: `"+this._commitment+"`, but method requires at least `confirmed`");return this._buildArgs(e,t,r,i)}_wsOnSignatureNotification(e){const{result:t,subscription:r}=G(e,ax);t.value!=="receivedSignature"&&this._subscriptionsAutoDisposedByRpc.add(r),this._handleServerNotification(r,t.value==="receivedSignature"?[{type:"received"},t.context]:[{type:"status",result:t.value},t.context])}onSignature(e,t,r){const i=this._buildArgs([e],r||this._commitment||"finalized"),s=this._makeSubscription({callback:(o,a)=>{if(o.type==="status"){t(o.result,a);try{this.removeSignatureListener(s)}catch{}}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},i);return s}onSignatureWithOptions(e,t,r){const{commitment:i,...s}={...r,commitment:r&&r.commitment||this._commitment||"finalized"},o=this._buildArgs([e],i,void 0,s),a=this._makeSubscription({callback:(c,h)=>{t(c,h);try{this.removeSignatureListener(a)}catch{}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},o);return a}async removeSignatureListener(e){await this._unsubscribeClientSubscription(e,"signature result")}_wsOnRootNotification(e){const{result:t,subscription:r}=G(e,cx);this._handleServerNotification(r,[t])}onRootChange(e){return this._makeSubscription({callback:e,method:"rootSubscribe",unsubscribeMethod:"rootUnsubscribe"},[])}async removeRootChangeListener(e){await this._unsubscribeClientSubscription(e,"root change")}}Object.freeze({CreateLookupTable:{index:0,layout:te([ie("instruction"),yi("recentSlot"),Me("bumpSeed")])},FreezeLookupTable:{index:1,layout:te([ie("instruction")])},ExtendLookupTable:{index:2,layout:te([ie("instruction"),yi(),$t(Ie(),kr(ie(),-8),"addresses")])},DeactivateLookupTable:{index:3,layout:te([ie("instruction")])},CloseLookupTable:{index:4,layout:te([ie("instruction")])}});new ce("AddressLookupTab1e1111111111111111111111111");Object.freeze({RequestUnits:{index:0,layout:te([Me("instruction"),ie("units"),ie("additionalFee")])},RequestHeapFrame:{index:1,layout:te([Me("instruction"),ie("bytes")])},SetComputeUnitLimit:{index:2,layout:te([Me("instruction"),ie("units")])},SetComputeUnitPrice:{index:3,layout:te([Me("instruction"),yi("microLamports")])}});new ce("ComputeBudget111111111111111111111111111111");te([Me("numSignatures"),Me("padding"),rn("signatureOffset"),rn("signatureInstructionIndex"),rn("publicKeyOffset"),rn("publicKeyInstructionIndex"),rn("messageDataOffset"),rn("messageDataSize"),rn("messageInstructionIndex")]);new ce("Ed25519SigVerify111111111111111111111111111");zS.utils.isValidPrivateKey;te([Me("numSignatures"),rn("signatureOffset"),Me("signatureInstructionIndex"),rn("ethAddressOffset"),Me("ethAddressInstructionIndex"),rn("messageDataOffset"),rn("messageDataSize"),Me("messageInstructionIndex"),Xe(20,"ethAddress"),Xe(64,"signature"),Me("recoveryId")]);new ce("KeccakSecp256k11111111111111111111111111111");var Ag;new ce("StakeConfig11111111111111111111111111111111");class Cg{constructor(e,t,r){this.unixTimestamp=void 0,this.epoch=void 0,this.custodian=void 0,this.unixTimestamp=e,this.epoch=t,this.custodian=r}}Ag=Cg;Cg.default=new Ag(0,0,ce.default);Object.freeze({Initialize:{index:0,layout:te([ie("instruction"),KS(),YS()])},Authorize:{index:1,layout:te([ie("instruction"),Ie("newAuthorized"),ie("stakeAuthorizationType")])},Delegate:{index:2,layout:te([ie("instruction")])},Split:{index:3,layout:te([ie("instruction"),Xt("lamports")])},Withdraw:{index:4,layout:te([ie("instruction"),Xt("lamports")])},Deactivate:{index:5,layout:te([ie("instruction")])},Merge:{index:7,layout:te([ie("instruction")])},AuthorizeWithSeed:{index:8,layout:te([ie("instruction"),Ie("newAuthorized"),ie("stakeAuthorizationType"),Zr("authoritySeed"),Ie("authorityOwner")])}});new ce("Stake11111111111111111111111111111111111111");Object.freeze({InitializeAccount:{index:0,layout:te([ie("instruction"),JS()])},Authorize:{index:1,layout:te([ie("instruction"),Ie("newAuthorized"),ie("voteAuthorizationType")])},Withdraw:{index:3,layout:te([ie("instruction"),Xt("lamports")])},UpdateValidatorIdentity:{index:4,layout:te([ie("instruction")])},AuthorizeWithSeed:{index:10,layout:te([ie("instruction"),ZS()])}});new ce("Vote111111111111111111111111111111111111111");new ce("Va1idator1nfo111111111111111111111111111111");W({name:$(),website:se($()),details:se($()),iconUrl:se($()),keybaseUsername:se($())});new ce("Vote111111111111111111111111111111111111111");te([Ie("nodePubkey"),Ie("authorizedWithdrawer"),Me("commission"),Mt(),$t(te([Mt("slot"),ie("confirmationCount")]),kr(ie(),-8),"votes"),Me("rootSlotValid"),Mt("rootSlot"),Mt(),$t(te([Mt("epoch"),Ie("authorizedVoter")]),kr(ie(),-8),"authorizedVoters"),te([$t(te([Ie("authorizedPubkey"),Mt("epochOfLastAuthorizedSwitch"),Mt("targetEpoch")]),32,"buf"),Mt("idx"),Me("isEmpty")],"priorVoters"),Mt(),$t(te([Mt("epoch"),Mt("credits"),Mt("prevCredits")]),kr(ie(),-8),"epochCredits"),te([Mt("slot"),Mt("timestamp")],"lastTimestamp")]);const Lx=1e9,Ox="2uAgZQNBz5FJcqsK2xMUiE7Vn9SnJV7FpjauZyg77WFn",Dx="https://mainnet.helius-rpc.com/?api-key=accec2ce-a419-42db-a501-3d9ebd606b40";class Fx{constructor(){this.connection=new Px(Dx),this.wallet=null,this.onConnect=null}async connect(){try{if(!(window.solana&&window.solana.isPhantom)){alert("Please install Phantom wallet to play!"),window.open("https://phantom.app/","_blank");return}const t=await window.solana.connect();console.log("Wallet connected:",t.publicKey.toString()),this.wallet=window.solana;const r=document.getElementById("wallet-address");if(r){const s=t.publicKey.toString(),o=`${s.slice(0,4)}...${s.slice(-4)}`;r.textContent=o}const i=document.getElementById("connect-wallet");i&&(i.textContent="Connected"),this.onConnect&&this.onConnect()}catch(e){throw console.error("Error connecting to wallet:",e),e}}disconnect(){if(this.wallet){this.wallet.disconnect(),this.wallet=null;const e=document.getElementById("wallet-address");e&&(e.textContent="");const t=document.getElementById("connect-wallet");t&&(t.textContent="Connect Wallet")}}isConnected(){return this.wallet!==null}getPublicKey(){return this.wallet?this.wallet.publicKey:null}async payGameEntry(e){if(!this.wallet)throw new Error("Wallet not connected");try{const t=new En,{blockhash:r}=await this.connection.getLatestBlockhash();t.recentBlockhash=r,t.add(rs.transfer({fromPubkey:this.wallet.publicKey,toPubkey:new ce(Ox),lamports:.1*Lx})),t.feePayer=this.wallet.publicKey;const i=await this.wallet.signAndSendTransaction(t);return(await(void 0)().httpsCallable("verifyGameEntry")({transactionSignature:i,lobbyId:e})).data.success}catch(t){throw console.error("Error paying entry fee:",t),t}}}class Ux{constructor(e,t){this.gameService=e,this.walletManager=t,this.currentLobbyId=null,this.playerCount=0,this.maxPlayers=2,this.paymentRequested=!1}showGameModeSelection(e,t){const r=`
            <div class="mode-selection">
                <p>Select Game Mode:</p>
                <div class="button-container">
                    <button class="win95-button" id="single-player">Single Player</button>
                    <button class="win95-button" id="multi-player">Multiplayer (0.1 SOL Entry)</button>
                </div>
            </div>
        `,i=document.createElement("div");i.className="modal-overlay";const s=document.createElement("div");s.className="modal-content mode-select-modal";const o=document.createElement("h2");o.textContent="Select Game Mode";const a=document.createElement("div");a.className="modal-body",a.innerHTML=r,s.appendChild(o),s.appendChild(a),i.appendChild(s),document.body.appendChild(i),document.getElementById("single-player").onclick=()=>{i.remove(),e()},document.getElementById("multi-player").onclick=()=>{i.remove(),this.joinMultiplayerLobby(t)}}async joinMultiplayerLobby(e){try{console.log("Starting multiplayer lobby join process..."),this.showSearchingModal(),console.log("Joining or creating lobby...");const t=await this.gameService.joinLobby();this.currentLobbyId=t.lobbyId,console.log("Joined lobby:",this.currentLobbyId),console.log("Setting up lobby listener..."),this.gameService.subscribeLobbyUpdates(this.currentLobbyId,async r=>{console.log("Lobby state updated:",r),this.updateLobbyPlayers(r),r.status==="matched"&&!this.paymentRequested&&(this.paymentRequested=!0,ii.show("Payment Required",async()=>{try{await this.walletManager.payGameEntry(this.currentLobbyId),console.log("Entry fee payment successful"),await this.gameService.updatePaymentStatus(this.currentLobbyId,this.walletManager.getPublicKey().toString(),"paid")}catch(i){console.error("Payment failed:",i),await this.leaveLobby(),ii.show("Error",()=>{},`Failed to process payment. Error: ${i.message||"Unknown error"}`)}},`
                        <div class="payment-request">
                            <p>Match found! Please deposit 0.1 SOL to start the game.</p>
                            <p>Both players must deposit to begin.</p>
                        </div>
                    `)),r.status==="ready"&&e(r)})}catch(t){console.error("Detailed error in joinMultiplayerLobby:",t),this.hideSearchingModal(),ii.show("Error",()=>{},`Failed to join multiplayer. Error: ${t.message||"Unknown error"}`)}}showSearchingModal(){const e=document.createElement("div");e.className="modal-overlay",e.id="searching-modal";const t=document.createElement("div");t.className="modal-content searching-modal";const r=`
            <div class="lobby-container">
                <div class="lobby-header">
                    Multiplayer Lobby
                </div>
                <div class="lobby-players" id="lobby-players">
                    <div class="player-item current-user">
                        <div class="player-info">
                            <div class="player-address">${this.walletManager.getPublicKey().toString()}</div>
                            <div class="player-status">Searching...</div>
                        </div>
                    </div>
                </div>
                <div class="lobby-status" id="lobby-status">
                    Searching for opponent...
                </div>
                <button class="win95-button" id="cancel-search">Leave Lobby</button>
            </div>
        `;t.innerHTML=`
            <h2>Matchmaking</h2>
            <div class="modal-body">${r}</div>
        `,e.appendChild(t),document.body.appendChild(e),document.getElementById("cancel-search").onclick=()=>{this.leaveLobby(),this.hideSearchingModal()}}hideSearchingModal(){const e=document.getElementById("searching-modal");e&&e.remove()}async leaveLobby(){this.currentLobbyId&&(await this.gameService.leaveLobby(this.currentLobbyId),this.currentLobbyId=null)}updateLobbyPlayers(e){console.log("Updating lobby players:",e);const t=document.getElementById("lobby-players"),r=document.getElementById("lobby-status"),i=this.walletManager.getPublicKey().toString();if(t&&e.players&&(console.log("Current players:",e.players),t.innerHTML=e.players.map(s=>`
                <div class="player-item ${s.id===i?"current-user":""} 
                                        ${e.status==="matched"?"matched":""}">
                    <div class="player-info">
                        <div class="player-address">${this.formatAddress(s.id)}</div>
                        <div class="player-status">
                            ${this.getPlayerStatus(s,e.status)}
                        </div>
                    </div>
                </div>
            `).join(""),r)){const s=this.getLobbyStatus(e);console.log("Setting lobby status:",s),r.textContent=s}}formatAddress(e){return`${e.slice(0,6)}...${e.slice(-4)}`}getPlayerStatus(e,t){return t==="matched"?e.paymentStatus==="paid"?"Ready to Play":"Waiting for Payment":"Searching..."}getLobbyStatus(e){switch(e.status){case"waiting":return"Searching for opponent...";case"matched":return"Match found! Waiting for payments...";case"ready":return"Starting game...";default:return"Searching..."}}}document.addEventListener("DOMContentLoaded",async()=>{console.log("DOM Content Loaded");const n=new cp,e=new qv,t=new Fx,r=new Ux(n,t),i=document.createElement("div");i.id="wallet-message",i.textContent="Please connect your wallet to start the game",i.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 18px;
        text-align: center;
        background-color: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        z-index: 100;
    `,document.getElementById("game-container").appendChild(i);const s=document.getElementById("connect-wallet");s?s.addEventListener("click",async()=>{try{console.log("Connect wallet button clicked"),await t.connect(),n.setWallet(t)}catch(o){console.error("Error connecting wallet:",o),alert("Failed to connect wallet. Please try again.")}}):console.error("Connect wallet button not found in the DOM"),t.onConnect=async()=>{console.log("Wallet connected"),n.setWallet(t),i.remove(),r.showGameModeSelection(async()=>{try{await e.init()}catch(o){console.error("Error starting single player game:",o)}},async o=>{try{await e.initMultiplayer(o)}catch(a){console.error("Error starting multiplayer game:",a)}})}});
