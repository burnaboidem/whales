var Pg=Object.defineProperty;var Lg=(r,e,t)=>e in r?Pg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Et=(r,e,t)=>Lg(r,typeof e!="symbol"?e+"":e,t);import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();class fu{constructor(e,t,n){this.x=e,this.y=200,this.name=n,this.score=0,this.speed=5,this.isFishing=!1,this.hookPosition={x:0,y:0},this.lineLength=0,this.maxLineLength=600,this.fishingSpeed=2,this.retractionSpeed=4,this.isRetracting=!1,this.targetAngle=Math.PI/2,this.isAiming=!1,this.aimLineLength=100}update(){this.isFishing?(this.isRetracting?(this.lineLength=Math.max(0,this.lineLength-this.retractionSpeed),this.lineLength===0&&(this.isFishing=!1,this.isRetracting=!1)):this.lineLength<this.maxLineLength&&(this.lineLength+=this.fishingSpeed),this.updateHookPosition()):(this.lineLength=0,this.isRetracting=!1)}render(e){if(e.fillStyle="#8B4513",e.fillRect(this.x-25,this.y,50,20),e.fillStyle="#000000",e.fillRect(this.x-10,this.y-20,20,20),e.strokeStyle="#000000",e.beginPath(),e.moveTo(this.x,this.y-10),e.lineTo(this.x+30,this.y-30),e.stroke(),this.isFishing&&(e.beginPath(),e.moveTo(this.x+30,this.y-30),e.lineTo(this.hookPosition.x,this.hookPosition.y),e.stroke(),e.beginPath(),e.arc(this.hookPosition.x,this.hookPosition.y,5,0,Math.PI*2),e.stroke()),!this.isFishing){e.strokeStyle="rgba(255, 255, 255, 0.5)",e.setLineDash([5,5]),e.beginPath(),e.moveTo(this.x+30,this.y-30);const t=this.x+30+Math.cos(this.targetAngle)*this.aimLineLength,n=this.y-30+Math.sin(this.targetAngle)*this.aimLineLength;e.lineTo(t,n),e.stroke(),e.setLineDash([])}}moveLeft(){this.isFishing||(this.x=Math.max(50,this.x-this.speed))}moveRight(){this.isFishing||(this.x=Math.min(750,this.x+this.speed))}toggleFishing(){this.isFishing?this.isRetracting=!0:(this.isFishing=!0,this.isRetracting=!1,this.lineLength=0)}updateHookPosition(){this.hookPosition.x=this.x+30+Math.cos(this.targetAngle)*this.lineLength,this.hookPosition.y=this.y-30+Math.sin(this.targetAngle)*this.lineLength}updateTargetAngle(e,t){if(!this.isFishing){const n=e-(this.x+30),i=t-(this.y-30);this.targetAngle=Math.atan2(i,n);const s=Math.PI/4,o=Math.PI*3/4;this.targetAngle=Math.max(s,Math.min(o,this.targetAngle))}}updateScore(e){return this.score=Math.max(0,this.score+e),console.log(`Score updated: ${this.score} (${e>0?"+":""}${e})`),this.score}}class wa{constructor(e="regular"){switch(this.type=e,this.reset(),this.setInitialSpeed(),e){case"whale":this.size=100,this.value=-5;break;case"rainbow":this.size=40,this.value=5,this.zigzagAmplitude=50,this.zigzagFrequency=.02,this.timeOffset=Math.random()*Math.PI*2;break;default:this.size=30,this.value=1}}setInitialSpeed(){switch(this.type){case"whale":this.baseSpeed=2;break;case"rainbow":this.baseSpeed=4;break;default:this.baseSpeed=3}this.speed=this.baseSpeed}increaseSpeed(e){this.speed=this.baseSpeed*e}resetSpeed(){this.speed=this.baseSpeed}reset(){this.x=Math.random()<.5?-this.size:850,this.y=Math.random()*300+250,this.direction=this.x<0?1:-1,this.active=!0,this.startTime=Date.now()}update(){if(this.type==="rainbow"){const e=(Date.now()-this.startTime)*this.zigzagFrequency;this.x+=this.speed*this.direction,this.y=this.y+Math.sin(e+this.timeOffset)*this.zigzagAmplitude*.1,this.y=Math.max(250,Math.min(500,this.y))}else this.x+=this.speed*this.direction;(this.x>850||this.x<-50)&&this.reset()}render(e){if(!this.active)return;switch(e.save(),this.type){case"whale":e.fillStyle="#4A4A4A";break;case"rainbow":const n=e.createLinearGradient(this.x,this.y,this.x+this.size,this.y);n.addColorStop(0,"#FF0000"),n.addColorStop(.2,"#FFA500"),n.addColorStop(.4,"#FFFF00"),n.addColorStop(.6,"#00FF00"),n.addColorStop(.8,"#0000FF"),n.addColorStop(1,"#9400D3"),e.fillStyle=n;break;default:e.fillStyle="#FFD700"}e.fillRect(this.x,this.y,this.size,this.size/2),e.fillStyle="#000000";const t=this.direction>0?this.x+this.size*.8:this.x+this.size*.2;e.beginPath(),e.arc(t,this.y+this.size*.25,3,0,Math.PI*2),e.fill(),e.restore()}}class Og{constructor(){this.fishes=[],this.whales=[],this.rainbowFish=null,this.rainbowFishSpawned=!1,this.minSpacing=80,this.baseWhaleCount=2,this.currentSpeedMultiplier=1}addWhale(){const e=new wa("whale");this.ensureNoOverlap(e),this.whales.push(e),console.log("New whale added! Total whales:",this.whales.length)}increaseWhaleCount(){this.addWhale()}init(){for(let e=0;e<10;e++){const t=new wa("regular");this.ensureNoOverlap(t),this.fishes.push(t)}for(let e=0;e<this.baseWhaleCount;e++)this.addWhale();this.scheduleRainbowFish()}ensureNoOverlap(e){let t=0;const n=10;let i=!0;for(;i&&t<n;){e.reset(),i=!1;const s=[...this.fishes,...this.whales];for(const o of s)if(this.checkOverlap(e,o)){i=!0;break}t++}}checkOverlap(e,t){const n=this.minSpacing+(e.size+t.size)/2,i=this.minSpacing*1.5;return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<i}scheduleRainbowFish(){setTimeout(()=>{this.rainbowFishSpawned||(this.rainbowFish=new wa("rainbow"),this.rainbowFishSpawned=!0)},Math.random()*3e4+3e4)}update(){[...this.fishes,...this.whales].forEach(e=>{e.update(),(e.x>850||e.x<-50)&&this.ensureNoOverlap(e)}),this.rainbowFish&&this.rainbowFish.active&&this.rainbowFish.update()}render(e){[...this.fishes,...this.whales].forEach(t=>t.render(e)),this.rainbowFish&&this.rainbowFish.active&&this.rainbowFish.render(e)}checkFishingCollision(e){if(this.rainbowFish&&this.rainbowFish.active&&this.isColliding(e,this.rainbowFish))return console.log("Rainbow fish caught!"),this.rainbowFish.active=!1,"rainbow";for(const t of this.whales)if(this.isColliding(e,t))return console.log("Whale hit!"),"whale";for(const t of this.fishes)if(t.active&&this.isColliding(e,t))return console.log("Regular fish caught!"),t.active=!1,setTimeout(()=>{t.reset(),t.active=!0},1e3),"regular";return!1}isColliding(e,t){return e.x>t.x&&e.x<t.x+t.size&&e.y>t.y&&e.y<t.y+t.size/2}increaseSpeeds(){this.currentSpeedMultiplier++,console.log(`Increasing all fish speeds to ${this.currentSpeedMultiplier}x!`),[...this.fishes,...this.whales].forEach(e=>e.increaseSpeed(this.currentSpeedMultiplier)),this.rainbowFish&&this.rainbowFish.increaseSpeed(this.currentSpeedMultiplier)}resetSpeeds(){[...this.fishes,...this.whales].forEach(e=>e.resetSpeed()),this.rainbowFish&&this.rainbowFish.resetSpeed(),this.currentSpeedMultiplier=1}}class Zh{static async load(){const e={boat:"assets/sprites/boat.png",fisherman:"assets/sprites/fisherman.png",fish:"assets/sprites/fish.png",whale:"assets/sprites/whale.png",hook:"assets/sprites/hook.png"},t={splash:"assets/sounds/splash.mp3",catch:"assets/sounds/catch.mp3",whale:"assets/sounds/whale.mp3"},n=Object.entries(e).map(([s,o])=>new Promise((a,c)=>{const u=new Image;u.onload=()=>{this.assets.images[s]=u,a()},u.onerror=c,u.src=o})),i=Object.entries(t).map(([s,o])=>new Promise((a,c)=>{const u=new Audio;u.oncanplaythrough=()=>{this.assets.sounds[s]=u,a()},u.onerror=c,u.src=o}));try{await Promise.all([...n,...i]),console.log("All assets loaded successfully")}catch(s){console.error("Error loading assets:",s)}}static getImage(e){return this.assets.images[e]}static playSound(e){const t=this.assets.sounds[e];t&&(t.currentTime=0,t.play())}}Et(Zh,"assets",{images:{},sounds:{}});var pu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H=function(r,e){if(!r)throw Si(e)},Si=function(r){return new Error("Firebase Database ("+Xh.SDK_VERSION+") INTERNAL ASSERT FAILED: "+r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qh=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Dg=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=r[t++];e[n++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=r[t++],o=r[t++],a=r[t++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(c&1023))}else{const s=r[t++],o=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Dc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){const s=r[i],o=i+1<r.length,a=o?r[i+1]:0,c=i+2<r.length,u=c?r[i+2]:0,g=s>>2,y=(s&3)<<4|a>>4;let v=(a&15)<<2|u>>6,x=u&63;c||(x=64,o||(v=64)),n.push(t[g],t[y],t[v],t[x])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(Qh(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):Dg(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){const s=t[r.charAt(i++)],a=i<r.length?t[r.charAt(i)]:0;++i;const u=i<r.length?t[r.charAt(i)]:64;++i;const y=i<r.length?t[r.charAt(i)]:64;if(++i,s==null||a==null||u==null||y==null)throw new Fg;const v=s<<2|a>>4;if(n.push(v),u!==64){const x=a<<4&240|u>>2;if(n.push(x),y!==64){const T=u<<6&192|y;n.push(T)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Fg extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ed=function(r){const e=Qh(r);return Dc.encodeByteArray(e,!0)},$s=function(r){return ed(r).replace(/\./g,"")},Hs=function(r){try{return Dc.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ug(r){return td(void 0,r)}function td(r,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:r===void 0&&(r={});break;case Array:r=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Wg(t)||(r[t]=td(r[t],e[t]));return r}function Wg(r){return r!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $g(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hg=()=>$g().__FIREBASE_DEFAULTS__,qg=()=>{if(typeof process>"u"||typeof pu>"u")return;const r=pu.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},zg=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&Hs(r[1]);return e&&JSON.parse(e)},Fc=()=>{try{return Hg()||qg()||zg()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},nd=r=>{var e,t;return(t=(e=Fc())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},rd=r=>{const e=nd(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},id=()=>{var r;return(r=Fc())===null||r===void 0?void 0:r.config},sd=r=>{var e;return(e=Fc())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vg(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,s=r.sub||r.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},r);return[$s(JSON.stringify(t)),$s(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Uc(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Vt())}function Gg(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function jg(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function od(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Kg(){const r=Vt();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function Yg(){return Xh.NODE_ADMIN===!0}function Jg(){try{return typeof indexedDB=="object"}catch{return!1}}function Zg(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xg="FirebaseError";class Yn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Xg,Object.setPrototypeOf(this,Yn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hs.prototype.create)}}class hs{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Qg(s,n):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Yn(i,a,n)}}function Qg(r,e){return r.replace(em,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const em=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(r){return JSON.parse(r)}function It(r){return JSON.stringify(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad=function(r){let e={},t={},n={},i="";try{const s=r.split(".");e=Ki(Hs(s[0])||""),t=Ki(Hs(s[1])||""),i=s[2],n=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:n,signature:i}},tm=function(r){const e=ad(r),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},nm=function(r){const e=ad(r).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function di(r,e){if(Object.prototype.hasOwnProperty.call(r,e))return r[e]}function tc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function qs(r,e,t){const n={};for(const i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=e.call(t,r[i],i,r));return n}function zs(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const s=r[i],o=e[i];if(gu(s)&&gu(o)){if(!zs(s,o))return!1}else if(s!==o)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function gu(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if(typeof e=="string")for(let y=0;y<16;y++)n[y]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let y=0;y<16;y++)n[y]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let y=16;y<80;y++){const v=n[y-3]^n[y-8]^n[y-14]^n[y-16];n[y]=(v<<1|v>>>31)&4294967295}let i=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,g;for(let y=0;y<80;y++){y<40?y<20?(u=a^s&(o^a),g=1518500249):(u=s^o^a,g=1859775393):y<60?(u=s&o|a&(s|o),g=2400959708):(u=s^o^a,g=3395469782);const v=(i<<5|i>>>27)+u+c+g+n[y]&4294967295;c=a,a=o,o=(s<<30|s>>>2)&4294967295,s=i,i=v}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const n=t-this.blockSize;let i=0;const s=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(s[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}else for(;i<t;)if(s[o]=e[i],++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let s=24;s>=0;s-=8)e[n]=this.chain_[i]>>s&255,++n;return e}}function im(r,e){const t=new sm(r,e);return t.subscribe.bind(t)}class sm{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");om(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=ba),i.error===void 0&&(i.error=ba),i.complete===void 0&&(i.complete=ba);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function om(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function ba(){}function Eo(r,e){return`${r} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const am=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);if(i>=55296&&i<=56319){const s=i-55296;n++,H(n<r.length,"Surrogate pair missing trail surrogate.");const o=r.charCodeAt(n)-56320;i=65536+(s<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},So=function(r){let e=0;for(let t=0;t<r.length;t++){const n=r.charCodeAt(t);n<128?e++:n<2048?e+=2:n>=55296&&n<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(r){return r&&r._delegate?r._delegate:r}class mr{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new us;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(um(e))try{this.getOrInitializeService({instanceIdentifier:Er})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});n.resolve(s)}catch{}}}}clearInstance(e=Er){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Er){return this.instances.has(e)}getOptions(e=Er){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);n===a&&o.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:lm(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Er){return this.component?this.component.multipleInstances?e:Er:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lm(r){return r===Er?void 0:r}function um(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new cm(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pe;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Pe||(Pe={}));const dm={debug:Pe.DEBUG,verbose:Pe.VERBOSE,info:Pe.INFO,warn:Pe.WARN,error:Pe.ERROR,silent:Pe.SILENT},fm=Pe.INFO,pm={[Pe.DEBUG]:"log",[Pe.VERBOSE]:"log",[Pe.INFO]:"info",[Pe.WARN]:"warn",[Pe.ERROR]:"error"},gm=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),i=pm[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Wc{constructor(e){this.name=e,this._logLevel=fm,this._logHandler=gm,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Pe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?dm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Pe.DEBUG,...e),this._logHandler(this,Pe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Pe.VERBOSE,...e),this._logHandler(this,Pe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Pe.INFO,...e),this._logHandler(this,Pe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Pe.WARN,...e),this._logHandler(this,Pe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Pe.ERROR,...e),this._logHandler(this,Pe.ERROR,...e)}}const mm=(r,e)=>e.some(t=>r instanceof t);let mu,yu;function ym(){return mu||(mu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _m(){return yu||(yu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cd=new WeakMap,nc=new WeakMap,ld=new WeakMap,va=new WeakMap,$c=new WeakMap;function wm(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{t(hr(r.result)),i()},o=()=>{n(r.error),i()};r.addEventListener("success",s),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&cd.set(t,r)}).catch(()=>{}),$c.set(e,r),e}function bm(r){if(nc.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});nc.set(r,e)}let rc={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return nc.get(r);if(e==="objectStoreNames")return r.objectStoreNames||ld.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return hr(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function vm(r){rc=r(rc)}function Em(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(Ea(this),e,...t);return ld.set(n,e.sort?e.sort():[e]),hr(n)}:_m().includes(r)?function(...e){return r.apply(Ea(this),e),hr(cd.get(this))}:function(...e){return hr(r.apply(Ea(this),e))}}function Sm(r){return typeof r=="function"?Em(r):(r instanceof IDBTransaction&&bm(r),mm(r,ym())?new Proxy(r,rc):r)}function hr(r){if(r instanceof IDBRequest)return wm(r);if(va.has(r))return va.get(r);const e=Sm(r);return e!==r&&(va.set(r,e),$c.set(e,r)),e}const Ea=r=>$c.get(r);function Im(r,e,{blocked:t,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(r,e),a=hr(o);return n&&o.addEventListener("upgradeneeded",c=>{n(hr(o.result),c.oldVersion,c.newVersion,hr(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const xm=["get","getKey","getAll","getAllKeys","count"],km=["put","add","delete","clear"],Sa=new Map;function _u(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Sa.get(e))return Sa.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=km.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||xm.includes(t)))return;const s=async function(o,...a){const c=this.transaction(o,i?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),i&&c.done]))[0]};return Sa.set(e,s),s}vm(r=>({...r,get:(e,t,n)=>_u(e,t)||r.get(e,t,n),has:(e,t)=>!!_u(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Am(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Am(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ic="@firebase/app",wu="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vn=new Wc("@firebase/app"),Tm="@firebase/app-compat",Rm="@firebase/analytics-compat",Mm="@firebase/analytics",Nm="@firebase/app-check-compat",Bm="@firebase/app-check",Pm="@firebase/auth",Lm="@firebase/auth-compat",Om="@firebase/database",Dm="@firebase/data-connect",Fm="@firebase/database-compat",Um="@firebase/functions",Wm="@firebase/functions-compat",$m="@firebase/installations",Hm="@firebase/installations-compat",qm="@firebase/messaging",zm="@firebase/messaging-compat",Vm="@firebase/performance",Gm="@firebase/performance-compat",jm="@firebase/remote-config",Km="@firebase/remote-config-compat",Ym="@firebase/storage",Jm="@firebase/storage-compat",Zm="@firebase/firestore",Xm="@firebase/vertexai-preview",Qm="@firebase/firestore-compat",e0="firebase",t0="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc="[DEFAULT]",n0={[ic]:"fire-core",[Tm]:"fire-core-compat",[Mm]:"fire-analytics",[Rm]:"fire-analytics-compat",[Bm]:"fire-app-check",[Nm]:"fire-app-check-compat",[Pm]:"fire-auth",[Lm]:"fire-auth-compat",[Om]:"fire-rtdb",[Dm]:"fire-data-connect",[Fm]:"fire-rtdb-compat",[Um]:"fire-fn",[Wm]:"fire-fn-compat",[$m]:"fire-iid",[Hm]:"fire-iid-compat",[qm]:"fire-fcm",[zm]:"fire-fcm-compat",[Vm]:"fire-perf",[Gm]:"fire-perf-compat",[jm]:"fire-rc",[Km]:"fire-rc-compat",[Ym]:"fire-gcs",[Jm]:"fire-gcs-compat",[Zm]:"fire-fst",[Qm]:"fire-fst-compat",[Xm]:"fire-vertex","fire-js":"fire-js",[e0]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vs=new Map,r0=new Map,oc=new Map;function bu(r,e){try{r.container.addComponent(e)}catch(t){Vn.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Mr(r){const e=r.name;if(oc.has(e))return Vn.debug(`There were multiple attempts to register component ${e}.`),!1;oc.set(e,r);for(const t of Vs.values())bu(t,r);for(const t of r0.values())bu(t,r);return!0}function Io(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function ar(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i0={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},dr=new hs("app","Firebase",i0);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new mr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw dr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xi=t0;function Hc(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:sc,automaticDataCollectionEnabled:!1},e),i=n.name;if(typeof i!="string"||!i)throw dr.create("bad-app-name",{appName:String(i)});if(t||(t=id()),!t)throw dr.create("no-options");const s=Vs.get(i);if(s){if(zs(t,s.options)&&zs(n,s.config))return s;throw dr.create("duplicate-app",{appName:i})}const o=new hm(i);for(const c of oc.values())o.addComponent(c);const a=new s0(t,n,o);return Vs.set(i,a),a}function qc(r=sc){const e=Vs.get(r);if(!e&&r===sc&&id())return Hc();if(!e)throw dr.create("no-app",{appName:r});return e}function xn(r,e,t){var n;let i=(n=n0[r])!==null&&n!==void 0?n:r;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Vn.warn(a.join(" "));return}Mr(new mr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0="firebase-heartbeat-database",a0=1,Yi="firebase-heartbeat-store";let Ia=null;function ud(){return Ia||(Ia=Im(o0,a0,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(Yi)}catch(t){console.warn(t)}}}}).catch(r=>{throw dr.create("idb-open",{originalErrorMessage:r.message})})),Ia}async function c0(r){try{const t=(await ud()).transaction(Yi),n=await t.objectStore(Yi).get(hd(r));return await t.done,n}catch(e){if(e instanceof Yn)Vn.warn(e.message);else{const t=dr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Vn.warn(t.message)}}}async function vu(r,e){try{const n=(await ud()).transaction(Yi,"readwrite");await n.objectStore(Yi).put(e,hd(r)),await n.done}catch(t){if(t instanceof Yn)Vn.warn(t.message);else{const n=dr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Vn.warn(n.message)}}}function hd(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l0=1024,u0=30*24*60*60*1e3;class h0{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new f0(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Eu();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=u0}),this._storage.overwrite(this._heartbeatsCache))}catch(n){Vn.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Eu(),{heartbeatsToSend:n,unsentEntries:i}=d0(this._heartbeatsCache.heartbeats),s=$s(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Vn.warn(t),""}}}function Eu(){return new Date().toISOString().substring(0,10)}function d0(r,e=l0){const t=[];let n=r.slice();for(const i of r){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Su(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Su(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class f0{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Jg()?Zg().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await c0(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return vu(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return vu(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Su(r){return $s(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p0(r){Mr(new mr("platform-logger",e=>new Cm(e),"PRIVATE")),Mr(new mr("heartbeat",e=>new h0(e),"PRIVATE")),xn(ic,wu,r),xn(ic,wu,"esm2017"),xn("fire-js","")}p0("");var g0="firebase",m0="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xn(g0,m0,"app");var Iu={};const xu="@firebase/database",ku="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dd="";function y0(r){dd=r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),It(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ki(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Tn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fd=function(r){try{if(typeof window<"u"&&typeof window[r]<"u"){const e=window[r];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new _0(e)}}catch{}return new w0},Cr=fd("localStorage"),b0=fd("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii=new Wc("@firebase/database"),v0=function(){let r=1;return function(){return r++}}(),pd=function(r){const e=am(r),t=new rm;t.update(e);const n=t.digest();return Dc.encodeByteArray(n)},ds=function(...r){let e="";for(let t=0;t<r.length;t++){const n=r[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=ds.apply(null,n):typeof n=="object"?e+=It(n):e+=n,e+=" "}return e};let $i=null,Cu=!0;const E0=function(r,e){H(!0,"Can't turn on custom loggers persistently."),ii.logLevel=Pe.VERBOSE,$i=ii.log.bind(ii)},Pt=function(...r){if(Cu===!0&&(Cu=!1,$i===null&&b0.get("logging_enabled")===!0&&E0()),$i){const e=ds.apply(null,r);$i(e)}},fs=function(r){return function(...e){Pt(r,...e)}},ac=function(...r){const e="FIREBASE INTERNAL ERROR: "+ds(...r);ii.error(e)},Gn=function(...r){const e=`FIREBASE FATAL ERROR: ${ds(...r)}`;throw ii.error(e),new Error(e)},zt=function(...r){const e="FIREBASE WARNING: "+ds(...r);ii.warn(e)},S0=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&zt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},zc=function(r){return typeof r=="number"&&(r!==r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)},I0=function(r){if(document.readyState==="complete")r();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,r())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},fi="[MIN_NAME]",Nr="[MAX_NAME]",Ur=function(r,e){if(r===e)return 0;if(r===fi||e===Nr)return-1;if(e===fi||r===Nr)return 1;{const t=Au(r),n=Au(e);return t!==null?n!==null?t-n===0?r.length-e.length:t-n:-1:n!==null?1:r<e?-1:1}},x0=function(r,e){return r===e?0:r<e?-1:1},Li=function(r,e){if(e&&r in e)return e[r];throw new Error("Missing required key ("+r+") in object: "+It(e))},Vc=function(r){if(typeof r!="object"||r===null)return It(r);const e=[];for(const n in r)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=It(e[n]),t+=":",t+=Vc(r[e[n]]);return t+="}",t},gd=function(r,e){const t=r.length;if(t<=e)return[r];const n=[];for(let i=0;i<t;i+=e)i+e>t?n.push(r.substring(i,t)):n.push(r.substring(i,i+e));return n};function Ot(r,e){for(const t in r)r.hasOwnProperty(t)&&e(t,r[t])}const md=function(r){H(!zc(r),"Invalid JSON number");const e=11,t=52,n=(1<<e-1)-1;let i,s,o,a,c;r===0?(s=0,o=0,i=1/r===-1/0?1:0):(i=r<0,r=Math.abs(r),r>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(r)/Math.LN2),n),s=a+n,o=Math.round(r*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(r/Math.pow(2,1-n-t))));const u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(i?1:0),u.reverse();const g=u.join("");let y="";for(c=0;c<64;c+=8){let v=parseInt(g.substr(c,8),2).toString(16);v.length===1&&(v="0"+v),y=y+v}return y.toLowerCase()},k0=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},C0=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function A0(r,e){let t="Unknown Error";r==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":r==="permission_denied"?t="Client doesn't have permission to access the desired data.":r==="unavailable"&&(t="The service is unavailable");const n=new Error(r+" at "+e._path.toString()+": "+t);return n.code=r.toUpperCase(),n}const T0=new RegExp("^-?(0*)\\d{1,10}$"),R0=-2147483648,M0=2147483647,Au=function(r){if(T0.test(r)){const e=Number(r);if(e>=R0&&e<=M0)return e}return null},ki=function(r){try{r()}catch(e){setTimeout(()=>{const t=e.stack||"";throw zt("Exception was thrown by user callback.",t),e},Math.floor(0))}},N0=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Hi=function(r,e){const t=setTimeout(r,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){zt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Pt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',zt(e)}}class Ls{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ls.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gc="5",yd="v",_d="s",wd="r",bd="f",vd=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ed="ls",Sd="p",cc="ac",Id="websocket",xd="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd{constructor(e,t,n,i,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Cr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Cr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function L0(r){return r.host!==r.internalHost||r.isCustomHost()||r.includeNamespaceInQueryParams}function Cd(r,e,t){H(typeof e=="string","typeof type must == string"),H(typeof t=="object","typeof params must == object");let n;if(e===Id)n=(r.secure?"wss://":"ws://")+r.internalHost+"/.ws?";else if(e===xd)n=(r.secure?"https://":"http://")+r.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);L0(r)&&(t.ns=r.namespace);const i=[];return Ot(t,(s,o)=>{i.push(s+"="+o)}),n+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0{constructor(){this.counters_={}}incrementCounter(e,t=1){Tn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Ug(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa={},ka={};function jc(r){const e=r.toString();return xa[e]||(xa[e]=new O0),xa[e]}function D0(r,e){const t=r.toString();return ka[t]||(ka[t]=e()),ka[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<n.length;++i)n[i]&&ki(()=>{this.onMessage_(n[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tu="start",U0="close",W0="pLPCommand",$0="pRTLPCB",Ad="id",Td="pw",Rd="ser",H0="cb",q0="seg",z0="ts",V0="d",G0="dframe",Md=1870,Nd=30,j0=Md-Nd,K0=25e3,Y0=3e4;class ei{constructor(e,t,n,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=fs(e),this.stats_=jc(t),this.urlFn=c=>(this.appCheckToken&&(c[cc]=this.appCheckToken),Cd(t,xd,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new F0(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Y0)),I0(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Kc((...s)=>{const[o,a,c,u,g]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Tu)this.id=a,this.password=c;else if(o===U0)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const n={};n[Tu]="t",n[Rd]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[H0]=this.scriptTagHolder.uniqueCallbackIdentifier),n[yd]=Gc,this.transportSessionId&&(n[_d]=this.transportSessionId),this.lastSessionId&&(n[Ed]=this.lastSessionId),this.applicationId&&(n[Sd]=this.applicationId),this.appCheckToken&&(n[cc]=this.appCheckToken),typeof location<"u"&&location.hostname&&vd.test(location.hostname)&&(n[wd]=bd);const i=this.urlFn(n);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ei.forceAllow_=!0}static forceDisallow(){ei.forceDisallow_=!0}static isAvailable(){return ei.forceAllow_?!0:!ei.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!k0()&&!C0()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=It(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=ed(t),i=gd(n,j0);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={};n[G0]="t",n[Ad]=e,n[Td]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=It(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Kc{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=v0(),window[W0+this.uniqueCallbackIdentifier]=e,window[$0+this.uniqueCallbackIdentifier]=t,this.myIFrame=Kc.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Pt("frame writing exception"),a.stack&&Pt(a.stack),Pt(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Pt("No IE domain setting required")}catch{const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Ad]=this.myID,e[Td]=this.myPW,e[Rd]=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Nd+n.length<=Md;){const o=this.pendingSegs.shift();n=n+"&"+q0+i+"="+o.seg+"&"+z0+i+"="+o.ts+"&"+V0+i+"="+o.d,i++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(K0)),s=()=>{clearTimeout(i),n()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const i=n.readyState;(!i||i==="loaded"||i==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Pt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J0=16384,Z0=45e3;let Gs=null;typeof MozWebSocket<"u"?Gs=MozWebSocket:typeof WebSocket<"u"&&(Gs=WebSocket);class mn{constructor(e,t,n,i,s,o,a){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=fs(this.connId),this.stats_=jc(t),this.connURL=mn.connectionURL_(t,o,a,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,s){const o={};return o[yd]=Gc,typeof location<"u"&&location.hostname&&vd.test(location.hostname)&&(o[wd]=bd),t&&(o[_d]=t),n&&(o[Ed]=n),i&&(o[cc]=i),s&&(o[Sd]=s),Cd(e,Id,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Cr.set("previous_websocket_failure",!0);try{let n;Yg(),this.mySock=new Gs(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const i=n.message||n.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const i=n.message||n.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){mn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&Gs!==null&&!mn.forceDisallow_}static previouslyFailed(){return Cr.isInMemoryStorage||Cr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Cr.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const n=Ki(t);this.onMessage(n)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(H(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const n=this.extractFrameCount_(t);n!==null&&this.appendFrame_(n)}}send(e){this.resetKeepAlive();const t=It(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=gd(t,J0);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Z0))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}mn.responsesRequiredToBeHealthy=2;mn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[ei,mn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=mn&&mn.isAvailable();let n=t&&!mn.previouslyFailed();if(e.webSocketOnly&&(t||zt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[mn];else{const i=this.transports_=[];for(const s of Ji.ALL_TRANSPORTS)s&&s.isAvailable()&&i.push(s);Ji.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ji.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X0=6e4,Q0=5e3,ey=10*1024,ty=100*1024,Ca="t",Ru="d",ny="s",Mu="r",ry="e",Nu="o",Bu="a",Pu="n",Lu="p",iy="h";let sy=class{constructor(e,t,n,i,s,o,a,c,u,g){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=g,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=fs("c:"+this.id+":"),this.transportManager_=new Ji(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Hi(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ty?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>ey?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ca in e){const t=e[Ca];t===Bu?this.upgradeIfSecondaryHealthy_():t===Mu?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Nu&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Li("t",e),n=Li("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Lu,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Bu,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Pu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Li("t",e),n=Li("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Li(Ca,e);if(Ru in e){const n=e[Ru];if(t===iy){const i=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Pu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===ny?this.onConnectionShutdown_(n):t===Mu?this.onReset_(n):t===ry?ac("Server Error: "+n):t===Nu?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ac("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Gc!==n&&zt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Hi(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(X0))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Hi(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Q0))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Lu,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Cr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pd=class{constructor(e){this.allowedEvents_=e,this.listeners_={},H(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!n||n===i[s].context)){i.splice(s,1);return}}validateEventType_(e){H(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js extends Pd{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Uc()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new js}getInitialEvent(e){return H(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ou=32,Du=768;class Le{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[n]=this.pieces_[i],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Te(){return new Le("")}function ve(r){return r.pieceNum_>=r.pieces_.length?null:r.pieces_[r.pieceNum_]}function yr(r){return r.pieces_.length-r.pieceNum_}function $e(r){let e=r.pieceNum_;return e<r.pieces_.length&&e++,new Le(r.pieces_,e)}function Yc(r){return r.pieceNum_<r.pieces_.length?r.pieces_[r.pieces_.length-1]:null}function oy(r){let e="";for(let t=r.pieceNum_;t<r.pieces_.length;t++)r.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(r.pieces_[t])));return e||"/"}function Zi(r,e=0){return r.pieces_.slice(r.pieceNum_+e)}function Ld(r){if(r.pieceNum_>=r.pieces_.length)return null;const e=[];for(let t=r.pieceNum_;t<r.pieces_.length-1;t++)e.push(r.pieces_[t]);return new Le(e,0)}function Qe(r,e){const t=[];for(let n=r.pieceNum_;n<r.pieces_.length;n++)t.push(r.pieces_[n]);if(e instanceof Le)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{const n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new Le(t,0)}function xe(r){return r.pieceNum_>=r.pieces_.length}function $t(r,e){const t=ve(r),n=ve(e);if(t===null)return e;if(t===n)return $t($e(r),$e(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+r+")")}function ay(r,e){const t=Zi(r,0),n=Zi(e,0);for(let i=0;i<t.length&&i<n.length;i++){const s=Ur(t[i],n[i]);if(s!==0)return s}return t.length===n.length?0:t.length<n.length?-1:1}function Jc(r,e){if(yr(r)!==yr(e))return!1;for(let t=r.pieceNum_,n=e.pieceNum_;t<=r.pieces_.length;t++,n++)if(r.pieces_[t]!==e.pieces_[n])return!1;return!0}function hn(r,e){let t=r.pieceNum_,n=e.pieceNum_;if(yr(r)>yr(e))return!1;for(;t<r.pieces_.length;){if(r.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}class cy{constructor(e,t){this.errorPrefix_=t,this.parts_=Zi(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=So(this.parts_[n]);Od(this)}}function ly(r,e){r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(e),r.byteLength_+=So(e),Od(r)}function uy(r){const e=r.parts_.pop();r.byteLength_-=So(e),r.parts_.length>0&&(r.byteLength_-=1)}function Od(r){if(r.byteLength_>Du)throw new Error(r.errorPrefix_+"has a key path longer than "+Du+" bytes ("+r.byteLength_+").");if(r.parts_.length>Ou)throw new Error(r.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ou+") or object contains a cycle "+Sr(r))}function Sr(r){return r.parts_.length===0?"":"in property '"+r.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc extends Pd{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new Zc}getInitialEvent(e){return H(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi=1e3,hy=60*5*1e3,Fu=30*1e3,dy=1.3,fy=3e4,py="server_kill",Uu=3;class qn extends Bd{constructor(e,t,n,i,s,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=qn.nextPersistentConnectionId_++,this.log_=fs("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Oi,this.maxReconnectDelay_=hy,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Zc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&js.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_(It(s)),H(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new us,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),t.promise}listen(e,t,n,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),H(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n},o="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const c=a.d,u=a.s;qn.warnOnListenWarnings_(c,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(n,i),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Tn(e,"w")){const n=di(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();zt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||nm(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Fu)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=tm(e)?"auth":"gauth",n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(t,n,i=>{const s=i.s,o=i.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e},o="n";i&&(s.q=n,s.t=i),this.sendRequest(o,s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,s){this.initConnection_();const o={p:t,d:n};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,n=>{if(n.s!=="ok"){const s=n.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+It(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):ac("Unrecognized action received from server: "+It(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){H(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Oi,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Oi,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>fy&&(this.reconnectDelay_=Oi),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*dy)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+qn.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},u=function(y){H(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(y)};this.realtime_={close:c,sendRequest:u};const g=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[y,v]=await Promise.all([this.authTokenProvider_.getToken(g),this.appCheckTokenProvider_.getToken(g)]);o?Pt("getToken() completed but was canceled"):(Pt("getToken() completed. Creating connection."),this.authToken_=y&&y.accessToken,this.appCheckToken_=v&&v.token,a=new sy(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,x=>{zt(x+" ("+this.repoInfo_.toString()+")"),this.interrupt(py)},s))}catch(y){this.log_("Failed to get token: "+y),o||(this.repoInfo_.nodeAdmin&&zt(y),c())}}}interrupt(e){Pt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Pt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],tc(this.interruptReasons_)&&(this.reconnectDelay_=Oi,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;t?n=t.map(s=>Vc(s)).join("$"):n="default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new Le(e).toString();let i;if(this.listens.has(n)){const s=this.listens.get(n);i=s.get(t),s.delete(t),s.size===0&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){Pt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Uu&&(this.reconnectDelay_=Fu,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Pt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Uu&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+dd.replace(/\./g,"-")]=1,Uc()?e["framework.cordova"]=1:od()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=js.getInstance().currentlyOnline();return tc(this.interruptReasons_)&&e}}qn.nextPersistentConnectionId_=0;qn.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ee(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Ee(fi,e),i=new Ee(fi,t);return this.compare(n,i)!==0}minPost(){return Ee.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ks;class Dd extends xo{static get __EMPTY_NODE(){return ks}static set __EMPTY_NODE(e){ks=e}compare(e,t){return Ur(e.name,t.name)}isDefinedOn(e){throw Si("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ee.MIN}maxPost(){return new Ee(Nr,ks)}makePost(e,t){return H(typeof e=="string","KeyIndex indexValue must always be a string."),new Ee(e,ks)}toString(){return".key"}}const si=new Dd;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(e,t,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ct{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??Ct.RED,this.left=i??Qt.EMPTY_NODE,this.right=s??Qt.EMPTY_NODE}copy(e,t,n,i,s){return new Ct(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return s<0?i=i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Qt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),t(e,n.key)===0){if(n.right.isEmpty())return Qt.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ct.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ct.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ct.RED=!0;Ct.BLACK=!1;class gy{copy(e,t,n,i,s){return this}insert(e,t,n){return new Ct(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Qt{constructor(e,t=Qt.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Qt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ct.BLACK,null,null))}remove(e){return new Qt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ct.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(i=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Cs(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Cs(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Cs(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Cs(this.root_,null,this.comparator_,!0,e)}}Qt.EMPTY_NODE=new gy;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function my(r,e){return Ur(r.name,e.name)}function Xc(r,e){return Ur(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lc;function yy(r){lc=r}const Fd=function(r){return typeof r=="number"?"number:"+md(r):"string:"+r},Ud=function(r){if(r.isLeafNode()){const e=r.val();H(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Tn(e,".sv"),"Priority must be a string or number.")}else H(r===lc||r.isEmpty(),"priority of unexpected type.");H(r===lc||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wu;class kt{constructor(e,t=kt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,H(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Ud(this.priorityNode_)}static set __childrenNodeConstructor(e){Wu=e}static get __childrenNodeConstructor(){return Wu}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new kt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:kt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return xe(e)?this:ve(e)===".priority"?this.priorityNode_:kt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:kt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=ve(e);return n===null?t:t.isEmpty()&&n!==".priority"?this:(H(n!==".priority"||yr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,kt.__childrenNodeConstructor.EMPTY_NODE.updateChild($e(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Fd(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=md(this.value_):e+=this.value_,this.lazyHash_=pd(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===kt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof kt.__childrenNodeConstructor?-1:(H(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=kt.VALUE_TYPE_ORDER.indexOf(t),s=kt.VALUE_TYPE_ORDER.indexOf(n);return H(i>=0,"Unknown leaf type: "+t),H(s>=0,"Unknown leaf type: "+n),i===s?n==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}kt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wd,$d;function _y(r){Wd=r}function wy(r){$d=r}class by extends xo{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return s===0?Ur(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ee.MIN}maxPost(){return new Ee(Nr,new kt("[PRIORITY-POST]",$d))}makePost(e,t){const n=Wd(e);return new Ee(t,new kt("[PRIORITY-POST]",n))}toString(){return".priority"}}const et=new by;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vy=Math.log(2);class Ey{constructor(e){const t=s=>parseInt(Math.log(s)/vy,10),n=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=n(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ks=function(r,e,t,n){r.sort(e);const i=function(c,u){const g=u-c;let y,v;if(g===0)return null;if(g===1)return y=r[c],v=t?t(y):y,new Ct(v,y.node,Ct.BLACK,null,null);{const x=parseInt(g/2,10)+c,T=i(c,x),R=i(x+1,u);return y=r[x],v=t?t(y):y,new Ct(v,y.node,Ct.BLACK,T,R)}},s=function(c){let u=null,g=null,y=r.length;const v=function(T,R){const C=y-T,D=y;y-=T;const U=i(C+1,D),L=r[C],z=t?t(L):L;x(new Ct(z,L.node,R,null,U))},x=function(T){u?(u.left=T,u=T):(g=T,u=T)};for(let T=0;T<c.count;++T){const R=c.nextBitIsOne(),C=Math.pow(2,c.count-(T+1));R?v(C,Ct.BLACK):(v(C,Ct.BLACK),v(C,Ct.RED))}return g},o=new Ey(r.length),a=s(o);return new Qt(n||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Aa;const jr={};class Un{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return H(jr&&et,"ChildrenNode.ts has not been loaded"),Aa=Aa||new Un({".priority":jr},{".priority":et}),Aa}get(e){const t=di(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Qt?t:null}hasIndex(e){return Tn(this.indexSet_,e.toString())}addIndex(e,t){H(e!==si,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const s=t.getIterator(Ee.Wrap);let o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),n.push(o),o=s.getNext();let a;i?a=Ks(n,e.getCompare()):a=jr;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const g=Object.assign({},this.indexes_);return g[c]=a,new Un(g,u)}addToIndexes(e,t){const n=qs(this.indexes_,(i,s)=>{const o=di(this.indexSet_,s);if(H(o,"Missing index implementation for "+s),i===jr)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(Ee.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Ks(a,o.getCompare())}else return jr;else{const a=t.get(e.name);let c=i;return a&&(c=c.remove(new Ee(e.name,a))),c.insert(e,e.node)}});return new Un(n,this.indexSet_)}removeFromIndexes(e,t){const n=qs(this.indexes_,i=>{if(i===jr)return i;{const s=t.get(e.name);return s?i.remove(new Ee(e.name,s)):i}});return new Un(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Di;class ce{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ud(this.priorityNode_),this.children_.isEmpty()&&H(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Di||(Di=new ce(new Qt(Xc),null,Un.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Di}updatePriority(e){return this.children_.isEmpty()?this:new ce(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Di:t}}getChild(e){const t=ve(e);return t===null?this:this.getImmediateChild(t).getChild($e(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(H(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const n=new Ee(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(n,this.children_));const o=i.isEmpty()?Di:this.priorityNode_;return new ce(i,o,s)}}updateChild(e,t){const n=ve(e);if(n===null)return t;{H(ve(e)!==".priority"||yr(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild($e(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,s=!0;if(this.forEachChild(et,(o,a)=>{t[o]=a.val(e),n++,s&&ce.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!e&&s&&i<2*n){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Fd(this.getPriority().val())+":"),this.forEachChild(et,(t,n)=>{const i=n.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":pd(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const s=i.getPredecessorKey(new Ee(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ee(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ee(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ee.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)<0;)i.getNext(),s=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ee.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)>0;)i.getNext(),s=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ps?-1:0}withIndex(e){if(e===si||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ce(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===si||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const n=this.getIterator(et),i=t.getIterator(et);let s=n.getNext(),o=i.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=n.getNext(),o=i.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===si?null:this.indexMap_.get(e.toString())}}ce.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Sy extends ce{constructor(){super(new Qt(Xc),ce.EMPTY_NODE,Un.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ce.EMPTY_NODE}isEmpty(){return!1}}const ps=new Sy;Object.defineProperties(Ee,{MIN:{value:new Ee(fi,ce.EMPTY_NODE)},MAX:{value:new Ee(Nr,ps)}});Dd.__EMPTY_NODE=ce.EMPTY_NODE;kt.__childrenNodeConstructor=ce;yy(ps);wy(ps);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iy=!0;function St(r,e=null){if(r===null)return ce.EMPTY_NODE;if(typeof r=="object"&&".priority"in r&&(e=r[".priority"]),H(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof r=="object"&&".value"in r&&r[".value"]!==null&&(r=r[".value"]),typeof r!="object"||".sv"in r){const t=r;return new kt(t,St(e))}if(!(r instanceof Array)&&Iy){const t=[];let n=!1;if(Ot(r,(o,a)=>{if(o.substring(0,1)!=="."){const c=St(a);c.isEmpty()||(n=n||!c.getPriority().isEmpty(),t.push(new Ee(o,c)))}}),t.length===0)return ce.EMPTY_NODE;const s=Ks(t,my,o=>o.name,Xc);if(n){const o=Ks(t,et.getCompare());return new ce(s,St(e),new Un({".priority":o},{".priority":et}))}else return new ce(s,St(e),Un.Default)}else{let t=ce.EMPTY_NODE;return Ot(r,(n,i)=>{if(Tn(r,n)&&n.substring(0,1)!=="."){const s=St(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(n,s))}}),t.updatePriority(St(e))}}_y(St);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy extends xo{constructor(e){super(),this.indexPath_=e,H(!xe(e)&&ve(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return s===0?Ur(e.name,t.name):s}makePost(e,t){const n=St(e),i=ce.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ee(t,i)}maxPost(){const e=ce.EMPTY_NODE.updateChild(this.indexPath_,ps);return new Ee(Nr,e)}toString(){return Zi(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky extends xo{compare(e,t){const n=e.node.compareTo(t.node);return n===0?Ur(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ee.MIN}maxPost(){return Ee.MAX}makePost(e,t){const n=St(e);return new Ee(t,n)}toString(){return".value"}}const Cy=new ky;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(r){return{type:"value",snapshotNode:r}}function pi(r,e){return{type:"child_added",snapshotNode:e,childName:r}}function Xi(r,e){return{type:"child_removed",snapshotNode:e,childName:r}}function Qi(r,e,t){return{type:"child_changed",snapshotNode:e,childName:r,oldSnap:t}}function Ay(r,e){return{type:"child_moved",snapshotNode:e,childName:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e){this.index_=e}updateChild(e,t,n,i,s,o){H(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()||(o!=null&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Xi(t,a)):H(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(pi(t,n)):o.trackChildChange(Qi(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(et,(i,s)=>{t.hasChild(i)||n.trackChildChange(Xi(i,s))}),t.isLeafNode()||t.forEachChild(et,(i,s)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(s)||n.trackChildChange(Qi(i,s,o))}else n.trackChildChange(pi(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ce.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e){this.indexedFilter_=new Qc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=es.getStartPost_(e),this.endPost_=es.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,s,o){return this.matches(new Ee(t,n))||(n=ce.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,s,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ce.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(ce.EMPTY_NODE);const s=this;return t.forEachChild(et,(o,a)=>{s.matches(new Ee(o,a))||(i=i.updateImmediateChild(o,ce.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{const n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new es(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,s,o){return this.rangedFilter_.matches(new Ee(t,n))||(n=ce.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,s,o):this.fullLimitUpdateChild_(e,t,n,s,o)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=ce.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=ce.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(ce.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,ce.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,s){let o;if(this.reverse_){const y=this.index_.getCompare();o=(v,x)=>y(x,v)}else o=this.index_.getCompare();const a=e;H(a.numChildren()===this.limit_,"");const c=new Ee(t,n),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),g=this.rangedFilter_.matches(c);if(a.hasChild(t)){const y=a.getImmediateChild(t);let v=i.getChildAfterChild(this.index_,u,this.reverse_);for(;v!=null&&(v.name===t||a.hasChild(v.name));)v=i.getChildAfterChild(this.index_,v,this.reverse_);const x=v==null?1:o(v,c);if(g&&!n.isEmpty()&&x>=0)return s!=null&&s.trackChildChange(Qi(t,n,y)),a.updateImmediateChild(t,n);{s!=null&&s.trackChildChange(Xi(t,y));const R=a.updateImmediateChild(t,ce.EMPTY_NODE);return v!=null&&this.rangedFilter_.matches(v)?(s!=null&&s.trackChildChange(pi(v.name,v.node)),R.updateImmediateChild(v.name,v.node)):R}}else return n.isEmpty()?e:g&&o(u,c)>=0?(s!=null&&(s.trackChildChange(Xi(u.name,u.node)),s.trackChildChange(pi(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(u.name,ce.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=et}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return H(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return H(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fi}hasEnd(){return this.endSet_}getIndexEndValue(){return H(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return H(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Nr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return H(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===et}copy(){const e=new el;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Ry(r){return r.loadsAllData()?new Qc(r.getIndex()):r.hasLimit()?new Ty(r):new es(r)}function $u(r){const e={};if(r.isDefault())return e;let t;if(r.index_===et?t="$priority":r.index_===Cy?t="$value":r.index_===si?t="$key":(H(r.index_ instanceof xy,"Unrecognized index type!"),t=r.index_.toString()),e.orderBy=It(t),r.startSet_){const n=r.startAfterSet_?"startAfter":"startAt";e[n]=It(r.indexStartValue_),r.startNameSet_&&(e[n]+=","+It(r.indexStartName_))}if(r.endSet_){const n=r.endBeforeSet_?"endBefore":"endAt";e[n]=It(r.indexEndValue_),r.endNameSet_&&(e[n]+=","+It(r.indexEndName_))}return r.limitSet_&&(r.isViewFromLeft()?e.limitToFirst=r.limit_:e.limitToLast=r.limit_),e}function Hu(r){const e={};if(r.startSet_&&(e.sp=r.indexStartValue_,r.startNameSet_&&(e.sn=r.indexStartName_),e.sin=!r.startAfterSet_),r.endSet_&&(e.ep=r.indexEndValue_,r.endNameSet_&&(e.en=r.indexEndName_),e.ein=!r.endBeforeSet_),r.limitSet_){e.l=r.limit_;let t=r.viewFrom_;t===""&&(r.isViewFromLeft()?t="l":t="r"),e.vf=t}return r.index_!==et&&(e.i=r.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends Bd{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=fs("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(H(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=Ys.getListenId_(e,n),a={};this.listens_[o]=a;const c=$u(e._queryParams);this.restRequest_(s+".json",c,(u,g)=>{let y=g;if(u===404&&(y=null,u=null),u===null&&this.onDataUpdate_(s,y,!1,n),di(this.listens_,o)===a){let v;u?u===401?v="permission_denied":v="rest_error:"+u:v="ok",i(v,null)}})}unlisten(e,t){const n=Ys.getListenId_(e,t);delete this.listens_[n]}get(e){const t=$u(e._queryParams),n=e._path.toString(),i=new us;return this.restRequest_(n+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(n,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Ii(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Ki(a.responseText)}catch{zt("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,c)}else a.status!==401&&a.status!==404&&zt("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(){this.rootNode_=ce.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Js(){return{value:null,children:new Map}}function qd(r,e,t){if(xe(e))r.value=t,r.children.clear();else if(r.value!==null)r.value=r.value.updateChild(e,t);else{const n=ve(e);r.children.has(n)||r.children.set(n,Js());const i=r.children.get(n);e=$e(e),qd(i,e,t)}}function uc(r,e,t){r.value!==null?t(e,r.value):Ny(r,(n,i)=>{const s=new Le(e.toString()+"/"+n);uc(i,s,t)})}function Ny(r,e){r.children.forEach((t,n)=>{e(n,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ot(this.last_,(n,i)=>{t[n]=t[n]-i}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qu=10*1e3,Py=30*1e3,Ly=5*60*1e3;class Oy{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new By(e);const n=qu+(Py-qu)*Math.random();Hi(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Ot(e,(i,s)=>{s>0&&Tn(this.statsToReport_,i)&&(t[i]=s,n=!0)}),n&&this.server_.reportStats(t),Hi(this.reportStats_.bind(this),Math.floor(Math.random()*2*Ly))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yn;(function(r){r[r.OVERWRITE=0]="OVERWRITE",r[r.MERGE=1]="MERGE",r[r.ACK_USER_WRITE=2]="ACK_USER_WRITE",r[r.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(yn||(yn={}));function tl(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function nl(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function rl(r){return{fromUser:!1,fromServer:!0,queryId:r,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=yn.ACK_USER_WRITE,this.source=tl()}operationForChild(e){if(xe(this.path)){if(this.affectedTree.value!=null)return H(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Le(e));return new Zs(Te(),t,this.revert)}}else return H(ve(this.path)===e,"operationForChild called for unrelated child."),new Zs($e(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e,t){this.source=e,this.path=t,this.type=yn.LISTEN_COMPLETE}operationForChild(e){return xe(this.path)?new ts(this.source,Te()):new ts(this.source,$e(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=yn.OVERWRITE}operationForChild(e){return xe(this.path)?new Br(this.source,Te(),this.snap.getImmediateChild(e)):new Br(this.source,$e(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=yn.MERGE}operationForChild(e){if(xe(this.path)){const t=this.children.subtree(new Le(e));return t.isEmpty()?null:t.value?new Br(this.source,Te(),t.value):new gi(this.source,Te(),t)}else return H(ve(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new gi(this.source,$e(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(xe(e))return this.isFullyInitialized()&&!this.filtered_;const t=ve(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Fy(r,e,t,n){const i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&r.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Ay(o.childName,o.snapshotNode))}),Fi(r,i,"child_removed",e,n,t),Fi(r,i,"child_added",e,n,t),Fi(r,i,"child_moved",s,n,t),Fi(r,i,"child_changed",e,n,t),Fi(r,i,"value",e,n,t),i}function Fi(r,e,t,n,i,s){const o=n.filter(a=>a.type===t);o.sort((a,c)=>Wy(r,a,c)),o.forEach(a=>{const c=Uy(r,a,s);i.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,r.query_))})})}function Uy(r,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,r.index_)),e}function Wy(r,e,t){if(e.childName==null||t.childName==null)throw Si("Should only compare child_ events.");const n=new Ee(e.childName,e.snapshotNode),i=new Ee(t.childName,t.snapshotNode);return r.index_.compare(n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ko(r,e){return{eventCache:r,serverCache:e}}function qi(r,e,t,n){return ko(new _r(e,t,n),r.serverCache)}function zd(r,e,t,n){return ko(r.eventCache,new _r(e,t,n))}function Xs(r){return r.eventCache.isFullyInitialized()?r.eventCache.getNode():null}function Pr(r){return r.serverCache.isFullyInitialized()?r.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ta;const $y=()=>(Ta||(Ta=new Qt(x0)),Ta);class We{constructor(e,t=$y()){this.value=e,this.children=t}static fromObject(e){let t=new We(null);return Ot(e,(n,i)=>{t=t.set(new Le(n),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Te(),value:this.value};if(xe(e))return null;{const n=ve(e),i=this.children.get(n);if(i!==null){const s=i.findRootMostMatchingPathAndValue($e(e),t);return s!=null?{path:Qe(new Le(n),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(xe(e))return this;{const t=ve(e),n=this.children.get(t);return n!==null?n.subtree($e(e)):new We(null)}}set(e,t){if(xe(e))return new We(t,this.children);{const n=ve(e),s=(this.children.get(n)||new We(null)).set($e(e),t),o=this.children.insert(n,s);return new We(this.value,o)}}remove(e){if(xe(e))return this.children.isEmpty()?new We(null):new We(null,this.children);{const t=ve(e),n=this.children.get(t);if(n){const i=n.remove($e(e));let s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new We(null):new We(this.value,s)}else return this}}get(e){if(xe(e))return this.value;{const t=ve(e),n=this.children.get(t);return n?n.get($e(e)):null}}setTree(e,t){if(xe(e))return t;{const n=ve(e),s=(this.children.get(n)||new We(null)).setTree($e(e),t);let o;return s.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,s),new We(this.value,o)}}fold(e){return this.fold_(Te(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((i,s)=>{n[i]=s.fold_(Qe(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Te(),t)}findOnPath_(e,t,n){const i=this.value?n(t,this.value):!1;if(i)return i;if(xe(e))return null;{const s=ve(e),o=this.children.get(s);return o?o.findOnPath_($e(e),Qe(t,s),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Te(),t)}foreachOnPath_(e,t,n){if(xe(e))return this;{this.value&&n(t,this.value);const i=ve(e),s=this.children.get(i);return s?s.foreachOnPath_($e(e),Qe(t,i),n):new We(null)}}foreach(e){this.foreach_(Te(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(Qe(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e){this.writeTree_=e}static empty(){return new _n(new We(null))}}function zi(r,e,t){if(xe(e))return new _n(new We(t));{const n=r.writeTree_.findRootMostValueAndPath(e);if(n!=null){const i=n.path;let s=n.value;const o=$t(i,e);return s=s.updateChild(o,t),new _n(r.writeTree_.set(i,s))}else{const i=new We(t),s=r.writeTree_.setTree(e,i);return new _n(s)}}}function hc(r,e,t){let n=r;return Ot(t,(i,s)=>{n=zi(n,Qe(e,i),s)}),n}function zu(r,e){if(xe(e))return _n.empty();{const t=r.writeTree_.setTree(e,new We(null));return new _n(t)}}function dc(r,e){return Wr(r,e)!=null}function Wr(r,e){const t=r.writeTree_.findRootMostValueAndPath(e);return t!=null?r.writeTree_.get(t.path).getChild($t(t.path,e)):null}function Vu(r){const e=[],t=r.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(et,(n,i)=>{e.push(new Ee(n,i))}):r.writeTree_.children.inorderTraversal((n,i)=>{i.value!=null&&e.push(new Ee(n,i.value))}),e}function fr(r,e){if(xe(e))return r;{const t=Wr(r,e);return t!=null?new _n(new We(t)):new _n(r.writeTree_.subtree(e))}}function fc(r){return r.writeTree_.isEmpty()}function mi(r,e){return Vd(Te(),r.writeTree_,e)}function Vd(r,e,t){if(e.value!=null)return t.updateChild(r,e.value);{let n=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(H(s.value!==null,"Priority writes must always be leaf nodes"),n=s.value):t=Vd(Qe(r,i),s,t)}),!t.getChild(r).isEmpty()&&n!==null&&(t=t.updateChild(Qe(r,".priority"),n)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Co(r,e){return Yd(e,r)}function Hy(r,e,t,n,i){H(n>r.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),r.allWrites.push({path:e,snap:t,writeId:n,visible:i}),i&&(r.visibleWrites=zi(r.visibleWrites,e,t)),r.lastWriteId=n}function qy(r,e,t,n){H(n>r.lastWriteId,"Stacking an older merge on top of newer ones"),r.allWrites.push({path:e,children:t,writeId:n,visible:!0}),r.visibleWrites=hc(r.visibleWrites,e,t),r.lastWriteId=n}function zy(r,e){for(let t=0;t<r.allWrites.length;t++){const n=r.allWrites[t];if(n.writeId===e)return n}return null}function Vy(r,e){const t=r.allWrites.findIndex(a=>a.writeId===e);H(t>=0,"removeWrite called with nonexistent writeId.");const n=r.allWrites[t];r.allWrites.splice(t,1);let i=n.visible,s=!1,o=r.allWrites.length-1;for(;i&&o>=0;){const a=r.allWrites[o];a.visible&&(o>=t&&Gy(a,n.path)?i=!1:hn(n.path,a.path)&&(s=!0)),o--}if(i){if(s)return jy(r),!0;if(n.snap)r.visibleWrites=zu(r.visibleWrites,n.path);else{const a=n.children;Ot(a,c=>{r.visibleWrites=zu(r.visibleWrites,Qe(n.path,c))})}return!0}else return!1}function Gy(r,e){if(r.snap)return hn(r.path,e);for(const t in r.children)if(r.children.hasOwnProperty(t)&&hn(Qe(r.path,t),e))return!0;return!1}function jy(r){r.visibleWrites=Gd(r.allWrites,Ky,Te()),r.allWrites.length>0?r.lastWriteId=r.allWrites[r.allWrites.length-1].writeId:r.lastWriteId=-1}function Ky(r){return r.visible}function Gd(r,e,t){let n=_n.empty();for(let i=0;i<r.length;++i){const s=r[i];if(e(s)){const o=s.path;let a;if(s.snap)hn(t,o)?(a=$t(t,o),n=zi(n,a,s.snap)):hn(o,t)&&(a=$t(o,t),n=zi(n,Te(),s.snap.getChild(a)));else if(s.children){if(hn(t,o))a=$t(t,o),n=hc(n,a,s.children);else if(hn(o,t))if(a=$t(o,t),xe(a))n=hc(n,Te(),s.children);else{const c=di(s.children,ve(a));if(c){const u=c.getChild($e(a));n=zi(n,Te(),u)}}}else throw Si("WriteRecord should have .snap or .children")}}return n}function jd(r,e,t,n,i){if(!n&&!i){const s=Wr(r.visibleWrites,e);if(s!=null)return s;{const o=fr(r.visibleWrites,e);if(fc(o))return t;if(t==null&&!dc(o,Te()))return null;{const a=t||ce.EMPTY_NODE;return mi(o,a)}}}else{const s=fr(r.visibleWrites,e);if(!i&&fc(s))return t;if(!i&&t==null&&!dc(s,Te()))return null;{const o=function(u){return(u.visible||i)&&(!n||!~n.indexOf(u.writeId))&&(hn(u.path,e)||hn(e,u.path))},a=Gd(r.allWrites,o,e),c=t||ce.EMPTY_NODE;return mi(a,c)}}}function Yy(r,e,t){let n=ce.EMPTY_NODE;const i=Wr(r.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(et,(s,o)=>{n=n.updateImmediateChild(s,o)}),n;if(t){const s=fr(r.visibleWrites,e);return t.forEachChild(et,(o,a)=>{const c=mi(fr(s,new Le(o)),a);n=n.updateImmediateChild(o,c)}),Vu(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}else{const s=fr(r.visibleWrites,e);return Vu(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}}function Jy(r,e,t,n,i){H(n||i,"Either existingEventSnap or existingServerSnap must exist");const s=Qe(e,t);if(dc(r.visibleWrites,s))return null;{const o=fr(r.visibleWrites,s);return fc(o)?i.getChild(t):mi(o,i.getChild(t))}}function Zy(r,e,t,n){const i=Qe(e,t),s=Wr(r.visibleWrites,i);if(s!=null)return s;if(n.isCompleteForChild(t)){const o=fr(r.visibleWrites,i);return mi(o,n.getNode().getImmediateChild(t))}else return null}function Xy(r,e){return Wr(r.visibleWrites,e)}function Qy(r,e,t,n,i,s,o){let a;const c=fr(r.visibleWrites,e),u=Wr(c,Te());if(u!=null)a=u;else if(t!=null)a=mi(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const g=[],y=o.getCompare(),v=s?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o);let x=v.getNext();for(;x&&g.length<i;)y(x,n)!==0&&g.push(x),x=v.getNext();return g}else return[]}function e_(){return{visibleWrites:_n.empty(),allWrites:[],lastWriteId:-1}}function Qs(r,e,t,n){return jd(r.writeTree,r.treePath,e,t,n)}function il(r,e){return Yy(r.writeTree,r.treePath,e)}function Gu(r,e,t,n){return Jy(r.writeTree,r.treePath,e,t,n)}function eo(r,e){return Xy(r.writeTree,Qe(r.treePath,e))}function t_(r,e,t,n,i,s){return Qy(r.writeTree,r.treePath,e,t,n,i,s)}function sl(r,e,t){return Zy(r.writeTree,r.treePath,e,t)}function Kd(r,e){return Yd(Qe(r.treePath,e),r.writeTree)}function Yd(r,e){return{treePath:r,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;H(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),H(n!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(n,Qi(n,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(n,Xi(n,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(n,pi(n,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(n,Qi(n,e.snapshotNode,i.oldSnap));else throw Si("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r_{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}const Jd=new r_;class ol{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const n=this.optCompleteServerCache_!=null?new _r(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return sl(this.writes_,e,n)}}getChildAfterChild(e,t,n){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Pr(this.viewCache_),s=t_(this.writes_,i,t,1,n,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i_(r){return{filter:r}}function s_(r,e){H(e.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),H(e.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed")}function o_(r,e,t,n,i){const s=new n_;let o,a;if(t.type===yn.OVERWRITE){const u=t;u.source.fromUser?o=pc(r,e,u.path,u.snap,n,i,s):(H(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!xe(u.path),o=to(r,e,u.path,u.snap,n,i,a,s))}else if(t.type===yn.MERGE){const u=t;u.source.fromUser?o=c_(r,e,u.path,u.children,n,i,s):(H(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=gc(r,e,u.path,u.children,n,i,a,s))}else if(t.type===yn.ACK_USER_WRITE){const u=t;u.revert?o=h_(r,e,u.path,n,i,s):o=l_(r,e,u.path,u.affectedTree,n,i,s)}else if(t.type===yn.LISTEN_COMPLETE)o=u_(r,e,t.path,n,s);else throw Si("Unknown operation type: "+t.type);const c=s.getChanges();return a_(e,o,c),{viewCache:o,changes:c}}function a_(r,e,t){const n=e.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=Xs(r);(t.length>0||!r.eventCache.isFullyInitialized()||i&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&t.push(Hd(Xs(e)))}}function Zd(r,e,t,n,i,s){const o=e.eventCache;if(eo(n,t)!=null)return e;{let a,c;if(xe(t))if(H(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Pr(e),g=u instanceof ce?u:ce.EMPTY_NODE,y=il(n,g);a=r.filter.updateFullNode(e.eventCache.getNode(),y,s)}else{const u=Qs(n,Pr(e));a=r.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{const u=ve(t);if(u===".priority"){H(yr(t)===1,"Can't have a priority with additional path components");const g=o.getNode();c=e.serverCache.getNode();const y=Gu(n,t,g,c);y!=null?a=r.filter.updatePriority(g,y):a=o.getNode()}else{const g=$e(t);let y;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const v=Gu(n,t,o.getNode(),c);v!=null?y=o.getNode().getImmediateChild(u).updateChild(g,v):y=o.getNode().getImmediateChild(u)}else y=sl(n,u,e.serverCache);y!=null?a=r.filter.updateChild(o.getNode(),u,y,g,i,s):a=o.getNode()}}return qi(e,a,o.isFullyInitialized()||xe(t),r.filter.filtersNodes())}}function to(r,e,t,n,i,s,o,a){const c=e.serverCache;let u;const g=o?r.filter:r.filter.getIndexedFilter();if(xe(t))u=g.updateFullNode(c.getNode(),n,null);else if(g.filtersNodes()&&!c.isFiltered()){const x=c.getNode().updateChild(t,n);u=g.updateFullNode(c.getNode(),x,null)}else{const x=ve(t);if(!c.isCompleteForPath(t)&&yr(t)>1)return e;const T=$e(t),C=c.getNode().getImmediateChild(x).updateChild(T,n);x===".priority"?u=g.updatePriority(c.getNode(),C):u=g.updateChild(c.getNode(),x,C,T,Jd,null)}const y=zd(e,u,c.isFullyInitialized()||xe(t),g.filtersNodes()),v=new ol(i,y,s);return Zd(r,y,t,i,v,a)}function pc(r,e,t,n,i,s,o){const a=e.eventCache;let c,u;const g=new ol(i,e,s);if(xe(t))u=r.filter.updateFullNode(e.eventCache.getNode(),n,o),c=qi(e,u,!0,r.filter.filtersNodes());else{const y=ve(t);if(y===".priority")u=r.filter.updatePriority(e.eventCache.getNode(),n),c=qi(e,u,a.isFullyInitialized(),a.isFiltered());else{const v=$e(t),x=a.getNode().getImmediateChild(y);let T;if(xe(v))T=n;else{const R=g.getCompleteChild(y);R!=null?Yc(v)===".priority"&&R.getChild(Ld(v)).isEmpty()?T=R:T=R.updateChild(v,n):T=ce.EMPTY_NODE}if(x.equals(T))c=e;else{const R=r.filter.updateChild(a.getNode(),y,T,v,g,o);c=qi(e,R,a.isFullyInitialized(),r.filter.filtersNodes())}}}return c}function ju(r,e){return r.eventCache.isCompleteForChild(e)}function c_(r,e,t,n,i,s,o){let a=e;return n.foreach((c,u)=>{const g=Qe(t,c);ju(e,ve(g))&&(a=pc(r,a,g,u,i,s,o))}),n.foreach((c,u)=>{const g=Qe(t,c);ju(e,ve(g))||(a=pc(r,a,g,u,i,s,o))}),a}function Ku(r,e,t){return t.foreach((n,i)=>{e=e.updateChild(n,i)}),e}function gc(r,e,t,n,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;xe(t)?u=n:u=new We(null).setTree(t,n);const g=e.serverCache.getNode();return u.children.inorderTraversal((y,v)=>{if(g.hasChild(y)){const x=e.serverCache.getNode().getImmediateChild(y),T=Ku(r,x,v);c=to(r,c,new Le(y),T,i,s,o,a)}}),u.children.inorderTraversal((y,v)=>{const x=!e.serverCache.isCompleteForChild(y)&&v.value===null;if(!g.hasChild(y)&&!x){const T=e.serverCache.getNode().getImmediateChild(y),R=Ku(r,T,v);c=to(r,c,new Le(y),R,i,s,o,a)}}),c}function l_(r,e,t,n,i,s,o){if(eo(i,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(n.value!=null){if(xe(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return to(r,e,t,c.getNode().getChild(t),i,s,a,o);if(xe(t)){let u=new We(null);return c.getNode().forEachChild(si,(g,y)=>{u=u.set(new Le(g),y)}),gc(r,e,t,u,i,s,a,o)}else return e}else{let u=new We(null);return n.foreach((g,y)=>{const v=Qe(t,g);c.isCompleteForPath(v)&&(u=u.set(g,c.getNode().getChild(v)))}),gc(r,e,t,u,i,s,a,o)}}function u_(r,e,t,n,i){const s=e.serverCache,o=zd(e,s.getNode(),s.isFullyInitialized()||xe(t),s.isFiltered());return Zd(r,o,t,n,Jd,i)}function h_(r,e,t,n,i,s){let o;if(eo(n,t)!=null)return e;{const a=new ol(n,e,i),c=e.eventCache.getNode();let u;if(xe(t)||ve(t)===".priority"){let g;if(e.serverCache.isFullyInitialized())g=Qs(n,Pr(e));else{const y=e.serverCache.getNode();H(y instanceof ce,"serverChildren would be complete if leaf node"),g=il(n,y)}g=g,u=r.filter.updateFullNode(c,g,s)}else{const g=ve(t);let y=sl(n,g,e.serverCache);y==null&&e.serverCache.isCompleteForChild(g)&&(y=c.getImmediateChild(g)),y!=null?u=r.filter.updateChild(c,g,y,$e(t),a,s):e.eventCache.getNode().hasChild(g)?u=r.filter.updateChild(c,g,ce.EMPTY_NODE,$e(t),a,s):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Qs(n,Pr(e)),o.isLeafNode()&&(u=r.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||eo(n,Te())!=null,qi(e,u,o,r.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new Qc(n.getIndex()),s=Ry(n);this.processor_=i_(s);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(ce.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(ce.EMPTY_NODE,a.getNode(),null),g=new _r(c,o.isFullyInitialized(),i.filtersNodes()),y=new _r(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=ko(y,g),this.eventGenerator_=new Dy(this.query_)}get query(){return this.query_}}function f_(r){return r.viewCache_.serverCache.getNode()}function p_(r){return Xs(r.viewCache_)}function g_(r,e){const t=Pr(r.viewCache_);return t&&(r.query._queryParams.loadsAllData()||!xe(e)&&!t.getImmediateChild(ve(e)).isEmpty())?t.getChild(e):null}function Yu(r){return r.eventRegistrations_.length===0}function m_(r,e){r.eventRegistrations_.push(e)}function Ju(r,e,t){const n=[];if(t){H(e==null,"A cancel should cancel all event registrations.");const i=r.query._path;r.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(t,i);o&&n.push(o)})}if(e){let i=[];for(let s=0;s<r.eventRegistrations_.length;++s){const o=r.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(r.eventRegistrations_.slice(s+1));break}}r.eventRegistrations_=i}else r.eventRegistrations_=[];return n}function Zu(r,e,t,n){e.type===yn.MERGE&&e.source.queryId!==null&&(H(Pr(r.viewCache_),"We should always have a full cache before handling merges"),H(Xs(r.viewCache_),"Missing event cache, even though we have a server cache"));const i=r.viewCache_,s=o_(r.processor_,i,e,t,n);return s_(r.processor_,s.viewCache),H(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),r.viewCache_=s.viewCache,Xd(r,s.changes,s.viewCache.eventCache.getNode(),null)}function y_(r,e){const t=r.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(et,(s,o)=>{n.push(pi(s,o))}),t.isFullyInitialized()&&n.push(Hd(t.getNode())),Xd(r,n,t.getNode(),e)}function Xd(r,e,t,n){const i=n?[n]:r.eventRegistrations_;return Fy(r.eventGenerator_,e,t,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let no;class Qd{constructor(){this.views=new Map}}function __(r){H(!no,"__referenceConstructor has already been defined"),no=r}function w_(){return H(no,"Reference.ts has not been loaded"),no}function b_(r){return r.views.size===0}function al(r,e,t,n){const i=e.source.queryId;if(i!==null){const s=r.views.get(i);return H(s!=null,"SyncTree gave us an op for an invalid query."),Zu(s,e,t,n)}else{let s=[];for(const o of r.views.values())s=s.concat(Zu(o,e,t,n));return s}}function ef(r,e,t,n,i){const s=e._queryIdentifier,o=r.views.get(s);if(!o){let a=Qs(t,i?n:null),c=!1;a?c=!0:n instanceof ce?(a=il(t,n),c=!1):(a=ce.EMPTY_NODE,c=!1);const u=ko(new _r(a,c,!1),new _r(n,i,!1));return new d_(e,u)}return o}function v_(r,e,t,n,i,s){const o=ef(r,e,n,i,s);return r.views.has(e._queryIdentifier)||r.views.set(e._queryIdentifier,o),m_(o,t),y_(o,t)}function E_(r,e,t,n){const i=e._queryIdentifier,s=[];let o=[];const a=wr(r);if(i==="default")for(const[c,u]of r.views.entries())o=o.concat(Ju(u,t,n)),Yu(u)&&(r.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{const c=r.views.get(i);c&&(o=o.concat(Ju(c,t,n)),Yu(c)&&(r.views.delete(i),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!wr(r)&&s.push(new(w_())(e._repo,e._path)),{removed:s,events:o}}function tf(r){const e=[];for(const t of r.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function pr(r,e){let t=null;for(const n of r.views.values())t=t||g_(n,e);return t}function nf(r,e){if(e._queryParams.loadsAllData())return Ao(r);{const n=e._queryIdentifier;return r.views.get(n)}}function rf(r,e){return nf(r,e)!=null}function wr(r){return Ao(r)!=null}function Ao(r){for(const e of r.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ro;function S_(r){H(!ro,"__referenceConstructor has already been defined"),ro=r}function I_(){return H(ro,"Reference.ts has not been loaded"),ro}let x_=1;class Xu{constructor(e){this.listenProvider_=e,this.syncPointTree_=new We(null),this.pendingWriteTree_=e_(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function sf(r,e,t,n,i){return Hy(r.pendingWriteTree_,e,t,n,i),i?Ci(r,new Br(tl(),e,t)):[]}function k_(r,e,t,n){qy(r.pendingWriteTree_,e,t,n);const i=We.fromObject(t);return Ci(r,new gi(tl(),e,i))}function cr(r,e,t=!1){const n=zy(r.pendingWriteTree_,e);if(Vy(r.pendingWriteTree_,e)){let s=new We(null);return n.snap!=null?s=s.set(Te(),!0):Ot(n.children,o=>{s=s.set(new Le(o),!0)}),Ci(r,new Zs(n.path,s,t))}else return[]}function gs(r,e,t){return Ci(r,new Br(nl(),e,t))}function C_(r,e,t){const n=We.fromObject(t);return Ci(r,new gi(nl(),e,n))}function A_(r,e){return Ci(r,new ts(nl(),e))}function T_(r,e,t){const n=ll(r,t);if(n){const i=ul(n),s=i.path,o=i.queryId,a=$t(s,e),c=new ts(rl(o),a);return hl(r,s,c)}else return[]}function io(r,e,t,n,i=!1){const s=e._path,o=r.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||rf(o,e))){const c=E_(o,e,t,n);b_(o)&&(r.syncPointTree_=r.syncPointTree_.remove(s));const u=c.removed;if(a=c.events,!i){const g=u.findIndex(v=>v._queryParams.loadsAllData())!==-1,y=r.syncPointTree_.findOnPath(s,(v,x)=>wr(x));if(g&&!y){const v=r.syncPointTree_.subtree(s);if(!v.isEmpty()){const x=N_(v);for(let T=0;T<x.length;++T){const R=x[T],C=R.query,D=lf(r,R);r.listenProvider_.startListening(Vi(C),ns(r,C),D.hashFn,D.onComplete)}}}!y&&u.length>0&&!n&&(g?r.listenProvider_.stopListening(Vi(e),null):u.forEach(v=>{const x=r.queryToTagMap.get(To(v));r.listenProvider_.stopListening(Vi(v),x)}))}B_(r,u)}return a}function of(r,e,t,n){const i=ll(r,n);if(i!=null){const s=ul(i),o=s.path,a=s.queryId,c=$t(o,e),u=new Br(rl(a),c,t);return hl(r,o,u)}else return[]}function R_(r,e,t,n){const i=ll(r,n);if(i){const s=ul(i),o=s.path,a=s.queryId,c=$t(o,e),u=We.fromObject(t),g=new gi(rl(a),c,u);return hl(r,o,g)}else return[]}function mc(r,e,t,n=!1){const i=e._path;let s=null,o=!1;r.syncPointTree_.foreachOnPath(i,(v,x)=>{const T=$t(v,i);s=s||pr(x,T),o=o||wr(x)});let a=r.syncPointTree_.get(i);a?(o=o||wr(a),s=s||pr(a,Te())):(a=new Qd,r.syncPointTree_=r.syncPointTree_.set(i,a));let c;s!=null?c=!0:(c=!1,s=ce.EMPTY_NODE,r.syncPointTree_.subtree(i).foreachChild((x,T)=>{const R=pr(T,Te());R&&(s=s.updateImmediateChild(x,R))}));const u=rf(a,e);if(!u&&!e._queryParams.loadsAllData()){const v=To(e);H(!r.queryToTagMap.has(v),"View does not exist, but we have a tag");const x=P_();r.queryToTagMap.set(v,x),r.tagToQueryMap.set(x,v)}const g=Co(r.pendingWriteTree_,i);let y=v_(a,e,t,g,s,c);if(!u&&!o&&!n){const v=nf(a,e);y=y.concat(L_(r,e,v))}return y}function cl(r,e,t){const i=r.pendingWriteTree_,s=r.syncPointTree_.findOnPath(e,(o,a)=>{const c=$t(o,e),u=pr(a,c);if(u)return u});return jd(i,e,s,t,!0)}function M_(r,e){const t=e._path;let n=null;r.syncPointTree_.foreachOnPath(t,(u,g)=>{const y=$t(u,t);n=n||pr(g,y)});let i=r.syncPointTree_.get(t);i?n=n||pr(i,Te()):(i=new Qd,r.syncPointTree_=r.syncPointTree_.set(t,i));const s=n!=null,o=s?new _r(n,!0,!1):null,a=Co(r.pendingWriteTree_,e._path),c=ef(i,e,a,s?o.getNode():ce.EMPTY_NODE,s);return p_(c)}function Ci(r,e){return af(e,r.syncPointTree_,null,Co(r.pendingWriteTree_,Te()))}function af(r,e,t,n){if(xe(r.path))return cf(r,e,t,n);{const i=e.get(Te());t==null&&i!=null&&(t=pr(i,Te()));let s=[];const o=ve(r.path),a=r.operationForChild(o),c=e.children.get(o);if(c&&a){const u=t?t.getImmediateChild(o):null,g=Kd(n,o);s=s.concat(af(a,c,u,g))}return i&&(s=s.concat(al(i,r,n,t))),s}}function cf(r,e,t,n){const i=e.get(Te());t==null&&i!=null&&(t=pr(i,Te()));let s=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,u=Kd(n,o),g=r.operationForChild(o);g&&(s=s.concat(cf(g,a,c,u)))}),i&&(s=s.concat(al(i,r,n,t))),s}function lf(r,e){const t=e.query,n=ns(r,t);return{hashFn:()=>(f_(e)||ce.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return n?T_(r,t._path,n):A_(r,t._path);{const s=A0(i,t);return io(r,t,null,s)}}}}function ns(r,e){const t=To(e);return r.queryToTagMap.get(t)}function To(r){return r._path.toString()+"$"+r._queryIdentifier}function ll(r,e){return r.tagToQueryMap.get(e)}function ul(r){const e=r.indexOf("$");return H(e!==-1&&e<r.length-1,"Bad queryKey."),{queryId:r.substr(e+1),path:new Le(r.substr(0,e))}}function hl(r,e,t){const n=r.syncPointTree_.get(e);H(n,"Missing sync point for query tag that we're tracking");const i=Co(r.pendingWriteTree_,e);return al(n,t,i,null)}function N_(r){return r.fold((e,t,n)=>{if(t&&wr(t))return[Ao(t)];{let i=[];return t&&(i=tf(t)),Ot(n,(s,o)=>{i=i.concat(o)}),i}})}function Vi(r){return r._queryParams.loadsAllData()&&!r._queryParams.isDefault()?new(I_())(r._repo,r._path):r}function B_(r,e){for(let t=0;t<e.length;++t){const n=e[t];if(!n._queryParams.loadsAllData()){const i=To(n),s=r.queryToTagMap.get(i);r.queryToTagMap.delete(i),r.tagToQueryMap.delete(s)}}}function P_(){return x_++}function L_(r,e,t){const n=e._path,i=ns(r,e),s=lf(r,t),o=r.listenProvider_.startListening(Vi(e),i,s.hashFn,s.onComplete),a=r.syncPointTree_.subtree(n);if(i)H(!wr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,g,y)=>{if(!xe(u)&&g&&wr(g))return[Ao(g).query];{let v=[];return g&&(v=v.concat(tf(g).map(x=>x.query))),Ot(y,(x,T)=>{v=v.concat(T)}),v}});for(let u=0;u<c.length;++u){const g=c[u];r.listenProvider_.stopListening(Vi(g),ns(r,g))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new dl(t)}node(){return this.node_}}class fl{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Qe(this.path_,e);return new fl(this.syncTree_,t)}node(){return cl(this.syncTree_,this.path_)}}const O_=function(r){return r=r||{},r.timestamp=r.timestamp||new Date().getTime(),r},Qu=function(r,e,t){if(!r||typeof r!="object")return r;if(H(".sv"in r,"Unexpected leaf node or priority contents"),typeof r[".sv"]=="string")return D_(r[".sv"],e,t);if(typeof r[".sv"]=="object")return F_(r[".sv"],e);H(!1,"Unexpected server value: "+JSON.stringify(r,null,2))},D_=function(r,e,t){switch(r){case"timestamp":return t.timestamp;default:H(!1,"Unexpected server value: "+r)}},F_=function(r,e,t){r.hasOwnProperty("increment")||H(!1,"Unexpected server value: "+JSON.stringify(r,null,2));const n=r.increment;typeof n!="number"&&H(!1,"Unexpected increment value: "+n);const i=e.node();if(H(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const o=i.getValue();return typeof o!="number"?n:o+n},uf=function(r,e,t,n){return pl(e,new fl(t,r),n)},hf=function(r,e,t){return pl(r,new dl(e),t)};function pl(r,e,t){const n=r.getPriority().val(),i=Qu(n,e.getImmediateChild(".priority"),t);let s;if(r.isLeafNode()){const o=r,a=Qu(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new kt(a,St(i)):r}else{const o=r;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new kt(i))),o.forEachChild(et,(a,c)=>{const u=pl(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function ml(r,e){let t=e instanceof Le?e:new Le(e),n=r,i=ve(t);for(;i!==null;){const s=di(n.node.children,i)||{children:{},childCount:0};n=new gl(i,n,s),t=$e(t),i=ve(t)}return n}function Ai(r){return r.node.value}function df(r,e){r.node.value=e,yc(r)}function ff(r){return r.node.childCount>0}function U_(r){return Ai(r)===void 0&&!ff(r)}function Ro(r,e){Ot(r.node.children,(t,n)=>{e(new gl(t,r,n))})}function pf(r,e,t,n){t&&e(r),Ro(r,i=>{pf(i,e,!0)})}function W_(r,e,t){let n=r.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function ms(r){return new Le(r.parent===null?r.name:ms(r.parent)+"/"+r.name)}function yc(r){r.parent!==null&&$_(r.parent,r.name,r)}function $_(r,e,t){const n=U_(t),i=Tn(r.node.children,e);n&&i?(delete r.node.children[e],r.node.childCount--,yc(r)):!n&&!i&&(r.node.children[e]=t.node,r.node.childCount++,yc(r))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H_=/[\[\].#$\/\u0000-\u001F\u007F]/,q_=/[\[\].#$\u0000-\u001F\u007F]/,Ra=10*1024*1024,yl=function(r){return typeof r=="string"&&r.length!==0&&!H_.test(r)},gf=function(r){return typeof r=="string"&&r.length!==0&&!q_.test(r)},z_=function(r){return r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),gf(r)},V_=function(r){return r===null||typeof r=="string"||typeof r=="number"&&!zc(r)||r&&typeof r=="object"&&Tn(r,".sv")},G_=function(r,e,t,n){Mo(Eo(r,"value"),e,t)},Mo=function(r,e,t){const n=t instanceof Le?new cy(t,r):t;if(e===void 0)throw new Error(r+"contains undefined "+Sr(n));if(typeof e=="function")throw new Error(r+"contains a function "+Sr(n)+" with contents = "+e.toString());if(zc(e))throw new Error(r+"contains "+e.toString()+" "+Sr(n));if(typeof e=="string"&&e.length>Ra/3&&So(e)>Ra)throw new Error(r+"contains a string greater than "+Ra+" utf8 bytes "+Sr(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ot(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!yl(o)))throw new Error(r+" contains an invalid key ("+o+") "+Sr(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);ly(n,o),Mo(r,a,n),uy(n)}),i&&s)throw new Error(r+' contains ".value" child '+Sr(n)+" in addition to actual children.")}},j_=function(r,e){let t,n;for(t=0;t<e.length;t++){n=e[t];const s=Zi(n);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!yl(s[o]))throw new Error(r+"contains an invalid key ("+s[o]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(ay);let i=null;for(t=0;t<e.length;t++){if(n=e[t],i!==null&&hn(i,n))throw new Error(r+"contains a path "+i.toString()+" that is ancestor of another path "+n.toString());i=n}},K_=function(r,e,t,n){const i=Eo(r,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const s=[];Ot(e,(o,a)=>{const c=new Le(o);if(Mo(i,a,Qe(t,c)),Yc(c)===".priority"&&!V_(a))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),j_(i,s)},mf=function(r,e,t,n){if(!gf(t))throw new Error(Eo(r,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Y_=function(r,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),mf(r,e,t)},yf=function(r,e){if(ve(e)===".info")throw new Error(r+" failed = Can't modify data under /.info/")},J_=function(r,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!yl(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!z_(t))throw new Error(Eo(r,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function No(r,e){let t=null;for(let n=0;n<e.length;n++){const i=e[n],s=i.getPath();t!==null&&!Jc(s,t.path)&&(r.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&r.eventLists_.push(t)}function _f(r,e,t){No(r,t),wf(r,n=>Jc(n,e))}function fn(r,e,t){No(r,t),wf(r,n=>hn(n,e)||hn(e,n))}function wf(r,e){r.recursionDepth_++;let t=!0;for(let n=0;n<r.eventLists_.length;n++){const i=r.eventLists_[n];if(i){const s=i.path;e(s)?(X_(r.eventLists_[n]),r.eventLists_[n]=null):t=!1}}t&&(r.eventLists_=[]),r.recursionDepth_--}function X_(r){for(let e=0;e<r.events.length;e++){const t=r.events[e];if(t!==null){r.events[e]=null;const n=t.getEventRunner();$i&&Pt("event: "+t.toString()),ki(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q_="repo_interrupt",ew=25;class tw{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Z_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Js(),this.transactionQueueTree_=new gl,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function nw(r,e,t){if(r.stats_=jc(r.repoInfo_),r.forceRestClient_||N0())r.server_=new Ys(r.repoInfo_,(n,i,s,o)=>{eh(r,n,i,s,o)},r.authTokenProvider_,r.appCheckProvider_),setTimeout(()=>th(r,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{It(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}r.persistentConnection_=new qn(r.repoInfo_,e,(n,i,s,o)=>{eh(r,n,i,s,o)},n=>{th(r,n)},n=>{iw(r,n)},r.authTokenProvider_,r.appCheckProvider_,t),r.server_=r.persistentConnection_}r.authTokenProvider_.addTokenChangeListener(n=>{r.server_.refreshAuthToken(n)}),r.appCheckProvider_.addTokenChangeListener(n=>{r.server_.refreshAppCheckToken(n.token)}),r.statsReporter_=D0(r.repoInfo_,()=>new Oy(r.stats_,r.server_)),r.infoData_=new My,r.infoSyncTree_=new Xu({startListening:(n,i,s,o)=>{let a=[];const c=r.infoData_.getNode(n._path);return c.isEmpty()||(a=gs(r.infoSyncTree_,n._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),_l(r,"connected",!1),r.serverSyncTree_=new Xu({startListening:(n,i,s,o)=>(r.server_.listen(n,s,i,(a,c)=>{const u=o(a,c);fn(r.eventQueue_,n._path,u)}),[]),stopListening:(n,i)=>{r.server_.unlisten(n,i)}})}function rw(r){const t=r.infoData_.getNode(new Le(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Bo(r){return O_({timestamp:rw(r)})}function eh(r,e,t,n,i){r.dataUpdateCount++;const s=new Le(e);t=r.interceptServerDataCallback_?r.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(n){const c=qs(t,u=>St(u));o=R_(r.serverSyncTree_,s,c,i)}else{const c=St(t);o=of(r.serverSyncTree_,s,c,i)}else if(n){const c=qs(t,u=>St(u));o=C_(r.serverSyncTree_,s,c)}else{const c=St(t);o=gs(r.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=yi(r,s)),fn(r.eventQueue_,a,o)}function th(r,e){_l(r,"connected",e),e===!1&&cw(r)}function iw(r,e){Ot(e,(t,n)=>{_l(r,t,n)})}function _l(r,e,t){const n=new Le("/.info/"+e),i=St(t);r.infoData_.updateSnapshot(n,i);const s=gs(r.infoSyncTree_,n,i);fn(r.eventQueue_,n,s)}function wl(r){return r.nextWriteId_++}function sw(r,e,t){const n=M_(r.serverSyncTree_,e);return n!=null?Promise.resolve(n):r.server_.get(e).then(i=>{const s=St(i).withIndex(e._queryParams.getIndex());mc(r.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=gs(r.serverSyncTree_,e._path,s);else{const a=ns(r.serverSyncTree_,e);o=of(r.serverSyncTree_,e._path,s,a)}return fn(r.eventQueue_,e._path,o),io(r.serverSyncTree_,e,t,null,!0),s},i=>(ys(r,"get for query "+It(e)+" failed: "+i),Promise.reject(new Error(i))))}function ow(r,e,t,n,i){ys(r,"set",{path:e.toString(),value:t,priority:n});const s=Bo(r),o=St(t,n),a=cl(r.serverSyncTree_,e),c=hf(o,a,s),u=wl(r),g=sf(r.serverSyncTree_,e,c,u,!0);No(r.eventQueue_,g),r.server_.put(e.toString(),o.val(!0),(v,x)=>{const T=v==="ok";T||zt("set at "+e+" failed: "+v);const R=cr(r.serverSyncTree_,u,!T);fn(r.eventQueue_,e,R),_c(r,i,v,x)});const y=vl(r,e);yi(r,y),fn(r.eventQueue_,y,[])}function aw(r,e,t,n){ys(r,"update",{path:e.toString(),value:t});let i=!0;const s=Bo(r),o={};if(Ot(t,(a,c)=>{i=!1,o[a]=uf(Qe(e,a),St(c),r.serverSyncTree_,s)}),i)Pt("update() called with empty data.  Don't do anything."),_c(r,n,"ok",void 0);else{const a=wl(r),c=k_(r.serverSyncTree_,e,o,a);No(r.eventQueue_,c),r.server_.merge(e.toString(),t,(u,g)=>{const y=u==="ok";y||zt("update at "+e+" failed: "+u);const v=cr(r.serverSyncTree_,a,!y),x=v.length>0?yi(r,e):e;fn(r.eventQueue_,x,v),_c(r,n,u,g)}),Ot(t,u=>{const g=vl(r,Qe(e,u));yi(r,g)}),fn(r.eventQueue_,e,[])}}function cw(r){ys(r,"onDisconnectEvents");const e=Bo(r),t=Js();uc(r.onDisconnect_,Te(),(i,s)=>{const o=uf(i,s,r.serverSyncTree_,e);qd(t,i,o)});let n=[];uc(t,Te(),(i,s)=>{n=n.concat(gs(r.serverSyncTree_,i,s));const o=vl(r,i);yi(r,o)}),r.onDisconnect_=Js(),fn(r.eventQueue_,Te(),n)}function lw(r,e,t){let n;ve(e._path)===".info"?n=mc(r.infoSyncTree_,e,t):n=mc(r.serverSyncTree_,e,t),_f(r.eventQueue_,e._path,n)}function uw(r,e,t){let n;ve(e._path)===".info"?n=io(r.infoSyncTree_,e,t):n=io(r.serverSyncTree_,e,t),_f(r.eventQueue_,e._path,n)}function hw(r){r.persistentConnection_&&r.persistentConnection_.interrupt(Q_)}function ys(r,...e){let t="";r.persistentConnection_&&(t=r.persistentConnection_.id+":"),Pt(t,...e)}function _c(r,e,t,n){e&&ki(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let s=i;n&&(s+=": "+n);const o=new Error(s);o.code=i,e(o)}})}function bf(r,e,t){return cl(r.serverSyncTree_,e,t)||ce.EMPTY_NODE}function bl(r,e=r.transactionQueueTree_){if(e||Po(r,e),Ai(e)){const t=Ef(r,e);H(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&dw(r,ms(e),t)}else ff(e)&&Ro(e,t=>{bl(r,t)})}function dw(r,e,t){const n=t.map(u=>u.currentWriteId),i=bf(r,e,n);let s=i;const o=i.hash();for(let u=0;u<t.length;u++){const g=t[u];H(g.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),g.status=1,g.retryCount++;const y=$t(e,g.path);s=s.updateChild(y,g.currentOutputSnapshotRaw)}const a=s.val(!0),c=e;r.server_.put(c.toString(),a,u=>{ys(r,"transaction put response",{path:c.toString(),status:u});let g=[];if(u==="ok"){const y=[];for(let v=0;v<t.length;v++)t[v].status=2,g=g.concat(cr(r.serverSyncTree_,t[v].currentWriteId)),t[v].onComplete&&y.push(()=>t[v].onComplete(null,!0,t[v].currentOutputSnapshotResolved)),t[v].unwatcher();Po(r,ml(r.transactionQueueTree_,e)),bl(r,r.transactionQueueTree_),fn(r.eventQueue_,e,g);for(let v=0;v<y.length;v++)ki(y[v])}else{if(u==="datastale")for(let y=0;y<t.length;y++)t[y].status===3?t[y].status=4:t[y].status=0;else{zt("transaction at "+c.toString()+" failed: "+u);for(let y=0;y<t.length;y++)t[y].status=4,t[y].abortReason=u}yi(r,e)}},o)}function yi(r,e){const t=vf(r,e),n=ms(t),i=Ef(r,t);return fw(r,i,n),n}function fw(r,e,t){if(e.length===0)return;const n=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=$t(t,c.path);let g=!1,y;if(H(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)g=!0,y=c.abortReason,i=i.concat(cr(r.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=ew)g=!0,y="maxretry",i=i.concat(cr(r.serverSyncTree_,c.currentWriteId,!0));else{const v=bf(r,c.path,o);c.currentInputSnapshot=v;const x=e[a].update(v.val());if(x!==void 0){Mo("transaction failed: Data returned ",x,c.path);let T=St(x);typeof x=="object"&&x!=null&&Tn(x,".priority")||(T=T.updatePriority(v.getPriority()));const C=c.currentWriteId,D=Bo(r),U=hf(T,v,D);c.currentOutputSnapshotRaw=T,c.currentOutputSnapshotResolved=U,c.currentWriteId=wl(r),o.splice(o.indexOf(C),1),i=i.concat(sf(r.serverSyncTree_,c.path,U,c.currentWriteId,c.applyLocally)),i=i.concat(cr(r.serverSyncTree_,C,!0))}else g=!0,y="nodata",i=i.concat(cr(r.serverSyncTree_,c.currentWriteId,!0))}fn(r.eventQueue_,t,i),i=[],g&&(e[a].status=2,function(v){setTimeout(v,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(y==="nodata"?n.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):n.push(()=>e[a].onComplete(new Error(y),!1,null))))}Po(r,r.transactionQueueTree_);for(let a=0;a<n.length;a++)ki(n[a]);bl(r,r.transactionQueueTree_)}function vf(r,e){let t,n=r.transactionQueueTree_;for(t=ve(e);t!==null&&Ai(n)===void 0;)n=ml(n,t),e=$e(e),t=ve(e);return n}function Ef(r,e){const t=[];return Sf(r,e,t),t.sort((n,i)=>n.order-i.order),t}function Sf(r,e,t){const n=Ai(e);if(n)for(let i=0;i<n.length;i++)t.push(n[i]);Ro(e,i=>{Sf(r,i,t)})}function Po(r,e){const t=Ai(e);if(t){let n=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[n]=t[i],n++);t.length=n,df(e,t.length>0?t:void 0)}Ro(e,n=>{Po(r,n)})}function vl(r,e){const t=ms(vf(r,e)),n=ml(r.transactionQueueTree_,e);return W_(n,i=>{Ma(r,i)}),Ma(r,n),pf(n,i=>{Ma(r,i)}),t}function Ma(r,e){const t=Ai(e);if(t){const n=[];let i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(H(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(H(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(cr(r.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?df(e,void 0):t.length=s+1,fn(r.eventQueue_,ms(e),i);for(let o=0;o<n.length;o++)ki(n[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pw(r){let e="";const t=r.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let i=t[n];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function gw(r){const e={};r.charAt(0)==="?"&&(r=r.substring(1));for(const t of r.split("&")){if(t.length===0)continue;const n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):zt(`Invalid query segment '${t}' in query '${r}'`)}return e}const nh=function(r,e){const t=mw(r),n=t.namespace;t.domain==="firebase.com"&&Gn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&Gn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||S0();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new kd(t.host,t.secure,n,i,e,"",n!==t.subdomain),path:new Le(t.pathString)}},mw=function(r){let e="",t="",n="",i="",s="",o=!0,a="https",c=443;if(typeof r=="string"){let u=r.indexOf("//");u>=0&&(a=r.substring(0,u-1),r=r.substring(u+2));let g=r.indexOf("/");g===-1&&(g=r.length);let y=r.indexOf("?");y===-1&&(y=r.length),e=r.substring(0,Math.min(g,y)),g<y&&(i=pw(r.substring(g,y)));const v=gw(r.substring(Math.min(r.length,y)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const x=e.slice(0,u);if(x.toLowerCase()==="localhost")t="localhost";else if(x.split(".").length<=2)t=x;else{const T=e.indexOf(".");n=e.substring(0,T).toLowerCase(),t=e.substring(T+1),s=n}"ns"in v&&(s=v.ns)}return{host:e,port:c,domain:t,subdomain:n,secure:o,scheme:a,pathString:i,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+It(this.snapshot.exportVal())}}class _w{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return H(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class El{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return xe(this._path)?null:Yc(this._path)}get ref(){return new Jn(this._repo,this._path)}get _queryIdentifier(){const e=Hu(this._queryParams),t=Vc(e);return t==="{}"?"default":t}get _queryObject(){return Hu(this._queryParams)}isEqual(e){if(e=jt(e),!(e instanceof El))return!1;const t=this._repo===e._repo,n=Jc(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+oy(this._path)}}class Jn extends El{constructor(e,t){super(e,t,new el,!1)}get parent(){const e=Ld(this._path);return e===null?null:new Jn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class rs{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Le(e),n=wc(this.ref,e);return new rs(this._node.getChild(t),n,et)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,i)=>e(new rs(i,wc(this.ref,n),et)))}hasChild(e){const t=new Le(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Yt(r,e){return r=jt(r),r._checkNotDeleted("ref"),e!==void 0?wc(r._root,e):r._root}function wc(r,e){return r=jt(r),ve(r._path)===null?Y_("child","path",e):mf("child","path",e),new Jn(r._repo,Qe(r._path,e))}function ww(r){return yf("remove",r._path),xf(r,null)}function xf(r,e){r=jt(r),yf("set",r._path),G_("set",e,r._path);const t=new us;return ow(r._repo,r._path,e,null,t.wrapCallback(()=>{})),t.promise}function Bn(r,e){K_("update",e,r._path);const t=new us;return aw(r._repo,r._path,e,t.wrapCallback(()=>{})),t.promise}function vr(r){r=jt(r);const e=new If(()=>{}),t=new Lo(e);return sw(r._repo,r,t).then(n=>new rs(n,new Jn(r._repo,r._path),r._queryParams.getIndex()))}class Lo{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const n=t._queryParams.getIndex();return new yw("value",this,new rs(e.snapshotNode,new Jn(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new _w(this,e,t):null}matches(e){return e instanceof Lo?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function bw(r,e,t,n,i){const s=new If(t,void 0),o=new Lo(s);return lw(r._repo,r,o),()=>uw(r._repo,r,o)}function Na(r,e,t,n){return bw(r,"value",e)}__(Jn);S_(Jn);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw="FIREBASE_DATABASE_EMULATOR_HOST",bc={};let Ew=!1;function Sw(r,e,t,n){r.repoInfo_=new kd(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0),n&&(r.authTokenProvider_=n)}function Iw(r,e,t,n,i){let s=n||r.options.databaseURL;s===void 0&&(r.options.projectId||Gn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Pt("Using default host for project ",r.options.projectId),s=`${r.options.projectId}-default-rtdb.firebaseio.com`);let o=nh(s,i),a=o.repoInfo,c;typeof process<"u"&&Iu&&(c=Iu[vw]),c?(s=`http://${c}?ns=${a.namespace}`,o=nh(s,i),a=o.repoInfo):o.repoInfo.secure;const u=new P0(r.name,r.options,e);J_("Invalid Firebase Database URL",o),xe(o.path)||Gn("Database URL must point to the root of a Firebase Database (not including a child path).");const g=kw(a,r,u,new B0(r.name,t));return new Cw(g,r)}function xw(r,e){const t=bc[e];(!t||t[r.key]!==r)&&Gn(`Database ${e}(${r.repoInfo_}) has already been deleted.`),hw(r),delete t[r.key]}function kw(r,e,t,n){let i=bc[e.name];i||(i={},bc[e.name]=i);let s=i[r.toURLString()];return s&&Gn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new tw(r,Ew,t,n),i[r.toURLString()]=s,s}class Cw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(nw(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Jn(this._repo,Te())),this._rootInternal}_delete(){return this._rootInternal!==null&&(xw(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Gn("Cannot call "+e+" on a deleted database.")}}function Aw(r=qc(),e){const t=Io(r,"database").getImmediate({identifier:e});if(!t._instanceStarted){const n=rd("database");n&&Tw(t,...n)}return t}function Tw(r,e,t,n={}){r=jt(r),r._checkNotDeleted("useEmulator"),r._instanceStarted&&Gn("Cannot call useEmulator() after instance has already been initialized.");const i=r._repoInternal;let s;if(i.repoInfo_.nodeAdmin)n.mockUserToken&&Gn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Ls(Ls.OWNER);else if(n.mockUserToken){const o=typeof n.mockUserToken=="string"?n.mockUserToken:Vg(n.mockUserToken,r.app.options.projectId);s=new Ls(o)}Sw(i,e,t,s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rw(r){y0(xi),Mr(new mr("database",(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Iw(n,i,s,t)},"PUBLIC").setMultipleInstances(!0)),xn(xu,ku,r),xn(xu,ku,"esm2017")}qn.prototype.simpleListen=function(r,e){this.sendRequest("q",{p:r},e)};qn.prototype.echo=function(r,e){this.sendRequest("echo",{d:r},e)};Rw();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mw="type.googleapis.com/google.protobuf.Int64Value",Nw="type.googleapis.com/google.protobuf.UInt64Value";function kf(r,e){const t={};for(const n in r)r.hasOwnProperty(n)&&(t[n]=e(r[n]));return t}function vc(r){if(r==null)return null;if(r instanceof Number&&(r=r.valueOf()),typeof r=="number"&&isFinite(r)||r===!0||r===!1||Object.prototype.toString.call(r)==="[object String]")return r;if(r instanceof Date)return r.toISOString();if(Array.isArray(r))return r.map(e=>vc(e));if(typeof r=="function"||typeof r=="object")return kf(r,e=>vc(e));throw new Error("Data cannot be encoded in JSON: "+r)}function so(r){if(r==null)return r;if(r["@type"])switch(r["@type"]){case Mw:case Nw:{const e=Number(r.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+r);return e}default:throw new Error("Data cannot be decoded from JSON: "+r)}return Array.isArray(r)?r.map(e=>so(e)):typeof r=="function"||typeof r=="object"?kf(r,e=>so(e)):r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sl="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class oi extends Yn{constructor(e,t,n){super(`${Sl}/${e}`,t||""),this.details=n}}function Bw(r){if(r>=200&&r<300)return"ok";switch(r){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Pw(r,e){let t=Bw(r),n=t,i;try{const s=e&&e.error;if(s){const o=s.status;if(typeof o=="string"){if(!rh[o])return new oi("internal","internal");t=rh[o],n=o}const a=s.message;typeof a=="string"&&(n=a),i=s.details,i!==void 0&&(i=so(i))}}catch{}return t==="ok"?null:new oi(t,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(i=>this.auth=i,()=>{}),this.messaging||t.get().then(i=>this.messaging=i,()=>{}),this.appCheck||n.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),n=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:t,messagingToken:n,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ec="us-central1";function Ow(r){let e=null;return{promise:new Promise((t,n)=>{e=setTimeout(()=>{n(new oi("deadline-exceeded","deadline-exceeded"))},r)}),cancel:()=>{e&&clearTimeout(e)}}}class Dw{constructor(e,t,n,i,s=Ec,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new Lw(t,n,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(s);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=Ec}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function Fw(r,e,t){r.emulatorOrigin=`http://${e}:${t}`}function Uw(r,e,t){return n=>$w(r,e,n,{})}async function Ww(r,e,t,n){t["Content-Type"]="application/json";let i;try{i=await n(r,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let s=null;try{s=await i.json()}catch{}return{status:i.status,json:s}}function $w(r,e,t,n){const i=r._url(e);return Hw(r,i,t,n)}async function Hw(r,e,t,n){t=vc(t);const i={data:t},s={},o=await r.contextProvider.getContext(n.limitedUseAppCheckTokens);o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=n.timeout||7e4,c=Ow(a),u=await Promise.race([Ww(e,i,s,r.fetchImpl),c.promise,r.cancelAllRequests]);if(c.cancel(),!u)throw new oi("cancelled","Firebase Functions instance was deleted.");const g=Pw(u.status,u.json);if(g)throw g;if(!u.json)throw new oi("internal","Response is not valid JSON object.");let y=u.json.data;if(typeof y>"u"&&(y=u.json.result),typeof y>"u")throw new oi("internal","Response is missing data field.");return{data:so(y)}}const ih="@firebase/functions",sh="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qw="auth-internal",zw="app-check-internal",Vw="messaging-internal";function Gw(r,e){const t=(n,{instanceIdentifier:i})=>{const s=n.getProvider("app").getImmediate(),o=n.getProvider(qw),a=n.getProvider(Vw),c=n.getProvider(zw);return new Dw(s,o,a,c,i,r)};Mr(new mr(Sl,t,"PUBLIC").setMultipleInstances(!0)),xn(ih,sh,e),xn(ih,sh,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(r=qc(),e=Ec){const n=Io(jt(r),Sl).getImmediate({identifier:e}),i=rd("functions");return i&&Af(n,...i),n}function Af(r,e,t){Fw(jt(r),e,t)}function Kr(r,e,t){return Uw(jt(r),e)}Gw(fetch.bind(self));function Il(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t}function Tf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jw=Tf,Rf=new hs("auth","Firebase",Tf());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oo=new Wc("@firebase/auth");function Kw(r,...e){oo.logLevel<=Pe.WARN&&oo.warn(`Auth (${xi}): ${r}`,...e)}function Os(r,...e){oo.logLevel<=Pe.ERROR&&oo.error(`Auth (${xi}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(r,...e){throw xl(r,...e)}function kn(r,...e){return xl(r,...e)}function Mf(r,e,t){const n=Object.assign(Object.assign({},jw()),{[e]:t});return new hs("auth","Firebase",n).create(e,{appName:r.name})}function Ar(r){return Mf(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function xl(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return Rf.create(r,...e)}function ue(r,e,...t){if(!r)throw xl(e,...t)}function Wn(r){const e="INTERNAL ASSERTION FAILED: "+r;throw Os(e),new Error(e)}function Kn(r,e){r||Wn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sc(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function Yw(){return oh()==="http:"||oh()==="https:"}function oh(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Yw()||jg()||"connection"in navigator)?navigator.onLine:!0}function Zw(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e,t){this.shortDelay=e,this.longDelay=t,Kn(t>e,"Short delay should be less than long delay!"),this.isMobile=Uc()||od()}get(){return Jw()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(r,e){Kn(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Wn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Wn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Wn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qw=new _s(3e4,6e4);function Cl(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function Ti(r,e,t,n,i={}){return Bf(r,i,async()=>{let s={},o={};n&&(e==="GET"?o=n:s={body:JSON.stringify(n)});const a=Ii(Object.assign({key:r.config.apiKey},o)).slice(1),c=await r._getAdditionalHeaders();c["Content-Type"]="application/json",r.languageCode&&(c["X-Firebase-Locale"]=r.languageCode);const u=Object.assign({method:e,headers:c},s);return Gg()||(u.referrerPolicy="no-referrer"),Nf.fetch()(Pf(r,r.config.apiHost,t,a),u)})}async function Bf(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},Xw),e);try{const i=new tb(r),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw As(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw As(r,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw As(r,"email-already-in-use",o);if(c==="USER_DISABLED")throw As(r,"user-disabled",o);const g=n[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Mf(r,g,u);jn(r,g)}}catch(i){if(i instanceof Yn)throw i;jn(r,"network-request-failed",{message:String(i)})}}async function eb(r,e,t,n,i={}){const s=await Ti(r,e,t,n,i);return"mfaPendingCredential"in s&&jn(r,"multi-factor-auth-required",{_serverResponse:s}),s}function Pf(r,e,t,n){const i=`${e}${t}?${n}`;return r.config.emulator?kl(r.config,i):`${r.config.apiScheme}://${i}`}class tb{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(kn(this.auth,"network-request-failed")),Qw.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function As(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=kn(r,e,n);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nb(r,e){return Ti(r,"POST","/v1/accounts:delete",e)}async function Lf(r,e){return Ti(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gi(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function rb(r,e=!1){const t=jt(r),n=await t.getIdToken(e),i=Al(n);ue(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:Gi(Ba(i.auth_time)),issuedAtTime:Gi(Ba(i.iat)),expirationTime:Gi(Ba(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function Ba(r){return Number(r)*1e3}function Al(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return Os("JWT malformed, contained fewer than 3 sections"),null;try{const i=Hs(t);return i?JSON.parse(i):(Os("Failed to decode base64 JWT payload"),null)}catch(i){return Os("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function ah(r){const e=Al(r);return ue(e,"internal-error"),ue(typeof e.exp<"u","internal-error"),ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function is(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Yn&&ib(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function ib({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sb{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Gi(this.lastLoginAt),this.creationTime=Gi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ao(r){var e;const t=r.auth,n=await r.getIdToken(),i=await is(r,Lf(t,{idToken:n}));ue(i==null?void 0:i.users.length,t,"internal-error");const s=i.users[0];r._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Of(s.providerUserInfo):[],a=ab(r.providerData,o),c=r.isAnonymous,u=!(r.email&&s.passwordHash)&&!(a!=null&&a.length),g=c?u:!1,y={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Ic(s.createdAt,s.lastLoginAt),isAnonymous:g};Object.assign(r,y)}async function ob(r){const e=jt(r);await ao(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function ab(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function Of(r){return r.map(e=>{var{providerId:t}=e,n=Il(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cb(r,e){const t=await Bf(r,{},async()=>{const n=Ii({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=r.config,o=Pf(r,i,"/v1/token",`key=${s}`),a=await r._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Nf.fetch()(o,{method:"POST",headers:a,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function lb(r,e){return Ti(r,"POST","/v2/accounts:revokeToken",Cl(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ue(e.idToken,"internal-error"),ue(typeof e.idToken<"u","internal-error"),ue(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ah(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ue(e.length!==0,"internal-error");const t=ah(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await cb(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,o=new ai;return n&&(ue(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),i&&(ue(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(ue(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ai,this.toJSON())}_performRefresh(){return Wn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(r,e){ue(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class $n{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=Il(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new sb(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ic(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await is(this,this.stsTokenManager.getToken(this.auth,e));return ue(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return rb(this,e)}reload(){return ob(this)}_assign(e){this!==e&&(ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new $n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ao(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ar(this.auth.app))return Promise.reject(Ar(this.auth));const e=await this.getIdToken();return await is(this,nb(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,o,a,c,u,g;const y=(n=t.displayName)!==null&&n!==void 0?n:void 0,v=(i=t.email)!==null&&i!==void 0?i:void 0,x=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,T=(o=t.photoURL)!==null&&o!==void 0?o:void 0,R=(a=t.tenantId)!==null&&a!==void 0?a:void 0,C=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,D=(u=t.createdAt)!==null&&u!==void 0?u:void 0,U=(g=t.lastLoginAt)!==null&&g!==void 0?g:void 0,{uid:L,emailVerified:z,isAnonymous:Z,providerData:j,stsTokenManager:X}=t;ue(L&&X,e,"internal-error");const ee=ai.fromJSON(this.name,X);ue(typeof L=="string",e,"internal-error"),Zn(y,e.name),Zn(v,e.name),ue(typeof z=="boolean",e,"internal-error"),ue(typeof Z=="boolean",e,"internal-error"),Zn(x,e.name),Zn(T,e.name),Zn(R,e.name),Zn(C,e.name),Zn(D,e.name),Zn(U,e.name);const Q=new $n({uid:L,auth:e,email:v,emailVerified:z,displayName:y,isAnonymous:Z,photoURL:T,phoneNumber:x,tenantId:R,stsTokenManager:ee,createdAt:D,lastLoginAt:U});return j&&Array.isArray(j)&&(Q.providerData=j.map(Ce=>Object.assign({},Ce))),C&&(Q._redirectEventId=C),Q}static async _fromIdTokenResponse(e,t,n=!1){const i=new ai;i.updateFromServerResponse(t);const s=new $n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await ao(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];ue(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?Of(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),a=new ai;a.updateFromIdToken(n);const c=new $n({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Ic(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch=new Map;function Hn(r){Kn(r instanceof Function,"Expected a class definition");let e=ch.get(r);return e?(Kn(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,ch.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Df.type="NONE";const lh=Df;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ds(r,e,t){return`firebase:${r}:${e}:${t}`}class ci{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=Ds(this.userKey,i.apiKey,s),this.fullPersistenceKey=Ds("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?$n._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ci(Hn(lh),e,n);const i=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=i[0]||Hn(lh);const o=Ds(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{const g=await u._get(o);if(g){const y=$n._fromJSON(e,g);u!==s&&(a=y),s=u;break}}catch{}const c=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new ci(s,e,n):(s=c[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==s)try{await u._remove(o)}catch{}})),new ci(s,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uh(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($f(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ff(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(qf(e))return"Blackberry";if(zf(e))return"Webos";if(Uf(e))return"Safari";if((e.includes("chrome/")||Wf(e))&&!e.includes("edge/"))return"Chrome";if(Hf(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function Ff(r=Vt()){return/firefox\//i.test(r)}function Uf(r=Vt()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Wf(r=Vt()){return/crios\//i.test(r)}function $f(r=Vt()){return/iemobile/i.test(r)}function Hf(r=Vt()){return/android/i.test(r)}function qf(r=Vt()){return/blackberry/i.test(r)}function zf(r=Vt()){return/webos/i.test(r)}function Tl(r=Vt()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function ub(r=Vt()){var e;return Tl(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function hb(){return Kg()&&document.documentMode===10}function Vf(r=Vt()){return Tl(r)||Hf(r)||zf(r)||qf(r)||/windows phone/i.test(r)||$f(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gf(r,e=[]){let t;switch(r){case"Browser":t=uh(Vt());break;case"Worker":t=`${uh(Vt())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${xi}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class db{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=s=>new Promise((o,a)=>{try{const c=e(s);o(c)}catch(c){a(c)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fb(r,e={}){return Ti(r,"GET","/v2/passwordPolicy",Cl(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pb=6;class gb{constructor(e){var t,n,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:pb,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,s,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(n=c.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hh(this),this.idTokenSubscription=new hh(this),this.beforeStateQueue=new db(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Rf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Hn(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await ci.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Lf(this,{idToken:e}),n=await $n._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ar(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ao(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Zw()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ar(this.app))return Promise.reject(Ar(this));const t=e?jt(e):null;return t&&ue(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ar(this.app)?Promise.reject(Ar(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ar(this.app)?Promise.reject(Ar(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Hn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await fb(this),t=new gb(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new hs("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await lb(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Hn(e)||this._popupRedirectResolver;ue(t,this,"argument-error"),this.redirectPersistenceManager=await ci.create(this,[Hn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ue(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,n,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Gf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Kw(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Rl(r){return jt(r)}class hh{constructor(e){this.auth=e,this.observer=null,this.addObserver=im(t=>this.observer=t)}get next(){return ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ml={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function yb(r){Ml=r}function _b(r){return Ml.loadJS(r)}function wb(){return Ml.gapiScript}function bb(r){return`__${r}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vb(r,e){const t=Io(r,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(zs(s,e??{}))return i;jn(i,"already-initialized")}return t.initialize({options:e})}function Eb(r,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Hn);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function Sb(r,e,t){const n=Rl(r);ue(n._canInitEmulator,n,"emulator-config-failed"),ue(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,s=jf(e),{host:o,port:a}=Ib(e),c=a===null?"":`:${a}`;n.config.emulator={url:`${s}//${o}${c}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),xb()}function jf(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function Ib(r){const e=jf(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const s=i[1];return{host:s,port:dh(n.substr(s.length+1))}}else{const[s,o]=n.split(":");return{host:s,port:dh(o)}}}function dh(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function xb(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Wn("not implemented")}_getIdTokenResponse(e){return Wn("not implemented")}_linkToIdToken(e,t){return Wn("not implemented")}_getReauthenticationResolver(e){return Wn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function li(r,e){return eb(r,"POST","/v1/accounts:signInWithIdp",Cl(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kb="http://localhost";class Lr extends Kf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Lr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):jn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=Il(t,["providerId","signInMethod"]);if(!n||!i)return null;const o=new Lr(n,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return li(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,li(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,li(e,t)}buildRequest(){const e={requestUri:kb,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ii(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Yf{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr extends ws{constructor(){super("facebook.com")}static credential(e){return Lr._fromParams({providerId:rr.PROVIDER_ID,signInMethod:rr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rr.credentialFromTaggedObject(e)}static credentialFromError(e){return rr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rr.credential(e.oauthAccessToken)}catch{return null}}}rr.FACEBOOK_SIGN_IN_METHOD="facebook.com";rr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir extends ws{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Lr._fromParams({providerId:ir.PROVIDER_ID,signInMethod:ir.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ir.credentialFromTaggedObject(e)}static credentialFromError(e){return ir.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ir.credential(t,n)}catch{return null}}}ir.GOOGLE_SIGN_IN_METHOD="google.com";ir.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr extends ws{constructor(){super("github.com")}static credential(e){return Lr._fromParams({providerId:sr.PROVIDER_ID,signInMethod:sr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sr.credentialFromTaggedObject(e)}static credentialFromError(e){return sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sr.credential(e.oauthAccessToken)}catch{return null}}}sr.GITHUB_SIGN_IN_METHOD="github.com";sr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or extends ws{constructor(){super("twitter.com")}static credential(e,t){return Lr._fromParams({providerId:or.PROVIDER_ID,signInMethod:or.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return or.credentialFromTaggedObject(e)}static credentialFromError(e){return or.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return or.credential(t,n)}catch{return null}}}or.TWITTER_SIGN_IN_METHOD="twitter.com";or.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await $n._fromIdTokenResponse(e,n,i),o=fh(n);return new _i({user:s,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=fh(n);return new _i({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function fh(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co extends Yn{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,co.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new co(e,t,n,i)}}function Jf(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?co._fromErrorAndOperation(r,s,e,n):s})}async function Cb(r,e,t=!1){const n=await is(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return _i._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ab(r,e,t=!1){const{auth:n}=r;if(ar(n.app))return Promise.reject(Ar(n));const i="reauthenticate";try{const s=await is(r,Jf(n,i,e,r),t);ue(s.idToken,n,"internal-error");const o=Al(s.idToken);ue(o,n,"internal-error");const{sub:a}=o;return ue(r.uid===a,n,"user-mismatch"),_i._forOperation(r,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&jn(n,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tb(r,e,t=!1){if(ar(r.app))return Promise.reject(Ar(r));const n="signIn",i=await Jf(r,n,e),s=await _i._fromIdTokenResponse(r,n,i);return t||await r._updateCurrentUser(s.user),s}function Rb(r,e,t,n){return jt(r).onIdTokenChanged(e,t,n)}function Mb(r,e,t){return jt(r).beforeAuthStateChanged(e,t)}const lo="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(lo,"1"),this.storage.removeItem(lo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nb=1e3,Bb=10;class Xf extends Zf{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Vf(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},s=this.storage.getItem(n);hb()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Bb):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Nb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Xf.type="LOCAL";const Pb=Xf;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf extends Zf{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Qf.type="SESSION";const ep=Qf;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lb(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const n=new Oo(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const a=Array.from(o).map(async u=>u(t.origin,s)),c=await Lb(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Oo.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nl(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const u=Nl("",20);i.port1.start();const g=setTimeout(()=>{c(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(y){const v=y;if(v.data.eventId===u)switch(v.data.status){case"ack":clearTimeout(g),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(v.data.response);break;default:clearTimeout(g),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(){return window}function Db(r){Cn().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tp(){return typeof Cn().WorkerGlobalScope<"u"&&typeof Cn().importScripts=="function"}async function Fb(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ub(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function Wb(){return tp()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const np="firebaseLocalStorageDb",$b=1,uo="firebaseLocalStorage",rp="fbase_key";class bs{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Do(r,e){return r.transaction([uo],e?"readwrite":"readonly").objectStore(uo)}function Hb(){const r=indexedDB.deleteDatabase(np);return new bs(r).toPromise()}function xc(){const r=indexedDB.open(np,$b);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(uo,{keyPath:rp})}catch(i){t(i)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(uo)?e(n):(n.close(),await Hb(),e(await xc()))})})}async function ph(r,e,t){const n=Do(r,!0).put({[rp]:e,value:t});return new bs(n).toPromise()}async function qb(r,e){const t=Do(r,!1).get(e),n=await new bs(t).toPromise();return n===void 0?null:n.value}function gh(r,e){const t=Do(r,!0).delete(e);return new bs(t).toPromise()}const zb=800,Vb=3;class ip{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await xc(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>Vb)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Oo._getInstance(Wb()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Fb(),!this.activeServiceWorker)return;this.sender=new Ob(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ub()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await xc();return await ph(e,lo,"1"),await gh(e,lo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ph(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>qb(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>gh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Do(i,!1).getAll();return new bs(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),zb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ip.type="LOCAL";const Gb=ip;new _s(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jb(r,e){return e?Hn(e):(ue(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bl extends Kf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return li(e,this._buildIdpRequest())}_linkToIdToken(e,t){return li(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return li(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Kb(r){return Tb(r.auth,new Bl(r),r.bypassAuthState)}function Yb(r){const{auth:e,user:t}=r;return ue(t,e,"internal-error"),Ab(t,new Bl(r),r.bypassAuthState)}async function Jb(r){const{auth:e,user:t}=r;return ue(t,e,"internal-error"),Cb(t,new Bl(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Kb;case"linkViaPopup":case"linkViaRedirect":return Jb;case"reauthViaPopup":case"reauthViaRedirect":return Yb;default:jn(this.auth,"internal-error")}}resolve(e){Kn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zb=new _s(2e3,1e4);class ti extends sp{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,ti.currentPopupAction&&ti.currentPopupAction.cancel(),ti.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ue(e,this.auth,"internal-error"),e}async onExecution(){Kn(this.filter.length===1,"Popup operations only handle one event");const e=Nl();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(kn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(kn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ti.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Zb.get())};e()}}ti.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb="pendingRedirect",Fs=new Map;class Qb extends sp{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Fs.get(this.auth._key());if(!e){try{const n=await ev(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Fs.set(this.auth._key(),e)}return this.bypassAuthState||Fs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ev(r,e){const t=rv(e),n=nv(r);if(!await n._isAvailable())return!1;const i=await n._get(t)==="true";return await n._remove(t),i}function tv(r,e){Fs.set(r._key(),e)}function nv(r){return Hn(r._redirectPersistence)}function rv(r){return Ds(Xb,r.config.apiKey,r.name)}async function iv(r,e,t=!1){if(ar(r.app))return Promise.reject(Ar(r));const n=Rl(r),i=jb(n,e),o=await new Qb(n,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sv=10*60*1e3;class ov{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!av(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!op(e)){const i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(kn(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=sv&&this.cachedEventUids.clear(),this.cachedEventUids.has(mh(e))}saveEventToCache(e){this.cachedEventUids.add(mh(e)),this.lastProcessedEventTime=Date.now()}}function mh(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function op({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function av(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return op(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cv(r,e={}){return Ti(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uv=/^https?/;async function hv(r){if(r.config.emulator)return;const{authorizedDomains:e}=await cv(r);for(const t of e)try{if(dv(t))return}catch{}jn(r,"unauthorized-domain")}function dv(r){const e=Sc(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!uv.test(t))return!1;if(lv.test(r))return n===r;const i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fv=new _s(3e4,6e4);function yh(){const r=Cn().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function pv(r){return new Promise((e,t)=>{var n,i,s;function o(){yh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{yh(),t(kn(r,"network-request-failed"))},timeout:fv.get()})}if(!((i=(n=Cn().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Cn().gapi)===null||s===void 0)&&s.load)o();else{const a=bb("iframefcb");return Cn()[a]=()=>{gapi.load?o():t(kn(r,"network-request-failed"))},_b(`${wb()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Us=null,e})}let Us=null;function gv(r){return Us=Us||pv(r),Us}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv=new _s(5e3,15e3),yv="__/auth/iframe",_v="emulator/auth/iframe",wv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vv(r){const e=r.config;ue(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?kl(e,_v):`https://${r.config.authDomain}/${yv}`,n={apiKey:e.apiKey,appName:r.name,v:xi},i=bv.get(r.config.apiHost);i&&(n.eid=i);const s=r._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${Ii(n).slice(1)}`}async function Ev(r){const e=await gv(r),t=Cn().gapi;return ue(t,r,"internal-error"),e.open({where:document.body,url:vv(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:wv,dontclear:!0},n=>new Promise(async(i,s)=>{await n.restyle({setHideOnLeave:!1});const o=kn(r,"network-request-failed"),a=Cn().setTimeout(()=>{s(o)},mv.get());function c(){Cn().clearTimeout(a),i(n)}n.ping(c).then(c,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Iv=500,xv=600,kv="_blank",Cv="http://localhost";class _h{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Av(r,e,t,n=Iv,i=xv){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Sv),{width:n.toString(),height:i.toString(),top:s,left:o}),u=Vt().toLowerCase();t&&(a=Wf(u)?kv:t),Ff(u)&&(e=e||Cv,c.scrollbars="yes");const g=Object.entries(c).reduce((v,[x,T])=>`${v}${x}=${T},`,"");if(ub(u)&&a!=="_self")return Tv(e||"",a),new _h(null);const y=window.open(e||"",a,g);ue(y,r,"popup-blocked");try{y.focus()}catch{}return new _h(y)}function Tv(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv="__/auth/handler",Mv="emulator/auth/handler",Nv=encodeURIComponent("fac");async function wh(r,e,t,n,i,s){ue(r.config.authDomain,r,"auth-domain-config-required"),ue(r.config.apiKey,r,"invalid-api-key");const o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:xi,eventId:i};if(e instanceof Yf){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",tc(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,y]of Object.entries({}))o[g]=y}if(e instanceof ws){const g=e.getScopes().filter(y=>y!=="");g.length>0&&(o.scopes=g.join(","))}r.tenantId&&(o.tid=r.tenantId);const a=o;for(const g of Object.keys(a))a[g]===void 0&&delete a[g];const c=await r._getAppCheckToken(),u=c?`#${Nv}=${encodeURIComponent(c)}`:"";return`${Bv(r)}?${Ii(a).slice(1)}${u}`}function Bv({config:r}){return r.emulator?kl(r,Mv):`https://${r.authDomain}/${Rv}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pa="webStorageSupport";class Pv{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ep,this._completeRedirectFn=iv,this._overrideRedirectResult=tv}async _openPopup(e,t,n,i){var s;Kn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await wh(e,t,n,Sc(),i);return Av(e,o,Nl())}async _openRedirect(e,t,n,i){await this._originValidation(e);const s=await wh(e,t,n,Sc(),i);return Db(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Kn(s,"If manager is not set, promise should be"),s)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Ev(e),n=new ov(e);return t.register("authEvent",i=>(ue(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Pa,{type:Pa},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[Pa];o!==void 0&&t(!!o),jn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=hv(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vf()||Uf()||Tl()}}const Lv=Pv;var bh="@firebase/auth",vh="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ov{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dv(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Fv(r){Mr(new mr("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=n.options;ue(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const c={apiKey:o,authDomain:a,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gf(r)},u=new mb(n,i,s,c);return Eb(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Mr(new mr("auth-internal",e=>{const t=Rl(e.getProvider("auth").getImmediate());return(n=>new Ov(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),xn(bh,vh,Dv(r)),xn(bh,vh,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uv=5*60,Wv=sd("authIdTokenMaxAge")||Uv;let Eh=null;const $v=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Wv)return;const i=t==null?void 0:t.token;Eh!==i&&(Eh=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Hv(r=qc()){const e=Io(r,"auth");if(e.isInitialized())return e.getImmediate();const t=vb(r,{popupRedirectResolver:Lv,persistence:[Gb,Pb,ep]}),n=sd("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(n,location.origin);if(location.origin===s.origin){const o=$v(s.toString());Mb(t,o,()=>o(t.currentUser)),Rb(t,a=>o(a))}}const i=nd("auth");return i&&Sb(t,`http://${i}`),t}function qv(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}yb({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{const s=kn("internal-error");s.customData=i,t(s)},n.type="text/javascript",n.charset="UTF-8",qv().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Fv("Browser");const ap={apiKey:"your-api-key",authDomain:"whales-d0eeb.firebaseapp.com",databaseURL:"https://whales-d0eeb-default-rtdb.firebaseio.com",projectId:"whales-d0eeb",storageBucket:"whales-d0eeb.appspot.com",messagingSenderId:"your-messaging-sender-id",appId:"your-app-id"},cp=Hc(ap);Hv(cp);const zv=Cf(cp);location.hostname==="localhost"&&Af(zv,"localhost",5001);const lp="https://mainnet.helius-rpc.com/?api-key=accec2ce-a419-42db-a501-3d9ebd606b40",up="2uAgZQNBz5FJcqsK2xMUiE7Vn9SnJV7FpjauZyg77WFn",hp=Hc(ap),Jt=Aw(hp),Yr=Cf(hp);class dp{constructor(){this.gameRef=null,this.gameId=null,this.lobbyRef=null,this.lobbyListener=null,this.wallet=null}setWallet(e){this.wallet=e.wallet}async createGame(e,t){const i=await Kr(Yr,"createGame")({player1:e,player2:t});return this.gameId=i.data.gameId,this.gameRef=Yt(Jt,`games/${this.gameId}`),this.gameId}subscribeToGameUpdates(e){if(!this.gameRef)throw new Error("No active game");return Na(this.gameRef,t=>{const n=t.val();e(n)})}async updateGameState(e){if(!this.gameRef)throw new Error("No active game");await e(this.gameRef,e)}async updatePlayerScore(e,t){if(!this.gameRef)throw new Error("No active game");await Bn(this.gameRef,{[`scores/${e}`]:t})}async endGame(e){if(!this.gameRef)throw new Error("No active game");await Bn(this.gameRef,{status:"completed",winner:e,endTime:Date.now()})}async joinLobby(){if(!this.wallet)throw new Error("Wallet not initialized");try{console.log("Attempting to join lobby with wallet:",this.wallet.publicKey.toString());const t=await Kr(Yr,"joinLobby")({playerId:this.wallet.publicKey.toString()});console.log("Join lobby result:",t.data);const n=t.data.lobbyId;if(!n)throw new Error("No lobby ID returned from server");return this.lobbyRef=Yt(Jt,`lobbies/${n}`),Na(this.lobbyRef,i=>{const s=i.val();console.log("Real-time lobby update:",s)}),{lobbyId:n}}catch(e){throw console.error("Detailed error joining lobby:",e),e}}subscribeLobbyUpdates(e,t){this.lobbyListener&&off(this.lobbyListener),console.log("Setting up lobby listener for:",e),this.lobbyRef=Yt(Jt,`lobbies/${e}`),this.lobbyListener=Na(this.lobbyRef,n=>{const i=n.val();console.log("Lobby update received:",i),i&&t(i)})}async leaveLobby(e){try{if(this.lobbyListener&&(off(this.lobbyListener),this.lobbyListener=null),this.lobbyRef){const n=(await vr(this.lobbyRef)).val();if(n){const i=n.players.filter(s=>s.id!==this.wallet.publicKey.toString());i.length===0?await ww(this.lobbyRef):await Bn(this.lobbyRef,{players:i,status:"waiting"})}this.lobbyRef=null}}catch(t){throw console.error("Error leaving lobby:",t),t}}async startMultiplayerGame(e){try{const n=await Kr(Yr,"createMultiplayerGame")({lobbyId:e});return this.gameId=n.data.gameId,this.gameRef=Yt(Jt,`games/${this.gameId}`),await Bn(this.lobbyRef,{status:"in_game",gameId:this.gameId}),this.gameId}catch(t){throw console.error("Error starting multiplayer game:",t),t}}async updateMultiplayerScore(e,t){if(!this.gameRef)throw new Error("No active game");await Bn(this.gameRef,{[`scores/${e}`]:t,lastUpdated:Date.now()})}async updatePaymentStatus(e,t,n){try{await Kr(Yr,"updatePaymentStatus")({lobbyId:e,playerId:t,status:n})}catch(i){throw console.error("Error updating payment status:",i),i}}async recordTransaction(e,t,n){try{const i=Yt(Jt,`lobbies/${e}/transactions/${n}`),s=Yt(Jt,`lobbies/${e}`),o=await vr(Yt(Jt,`lobbies/${e}/transactions`));if(o.exists()){const g=o.val();if(Object.values(g).some(v=>v.transactionSignature===n))throw new Error("Transaction signature already used")}const a=Date.now();return await xf(i,{timestamp:a,amount:"0.1",walletAddress:t,status:"pending",transactionSignature:n}),(await vr(s)).val().firstTransactionTimestamp||await Bn(s,{firstTransactionTimestamp:a}),{transactionRef:i,timestamp:a}}catch(i){throw console.error("Error recording transaction:",i),i}}async updateTransactionStatus(e,t,n,i=null){try{const s=Yt(Jt,`lobbies/${e}/transactions/${t}`),o={status:n,...i&&{failureReason:i}};await Bn(s,o)}catch(s){throw console.error("Error updating transaction status:",s),s}}async getTransactions(e){try{const t=Yt(Jt,`lobbies/${e}/transactions`);return await vr(t)}catch(t){throw console.error("Error getting transactions:",t),t}}getEscrowAddress(){return up}async requestRefund(e,t){try{return await Kr(Yr,"requestRefund")({lobbyId:e,transactionSignature:t})}catch(n){throw console.error("Error requesting refund:",n),n}}async verifyPayment(e,t){try{return(await Kr(Yr,"verifyGameEntry")({lobbyId:e,transactionSignature:t})).data}catch(n){throw console.error("Error verifying payment:",n),n}}async updateLobbyPaymentStatus(e,t,n){try{const i=Yt(Jt,`lobbies/${e}`),o=(await vr(i)).val();if(!o||!o.players)throw new Error("Lobby not found");const a=o.players.findIndex(y=>y.id===t);if(a===-1)throw new Error("Player not found in lobby");await Bn(Yt(Jt,`lobbies/${e}/players/${a}`),{paymentStatus:n});const c=Yt(Jt,`lobbies/${e}/transactions`),g=(await vr(c)).val();if(g){const y=Object.entries(g).find(([v,x])=>x.walletAddress===t&&x.status==="pending");if(y){const[v,x]=y;await Bn(Yt(Jt,`lobbies/${e}/transactions/${v}`),{status:"confirmed"})}}}catch(i){throw console.error("Error updating lobby payment status:",i),i}}async getFirstTransactionTimestamp(e){try{const t=Yt(Jt,`lobbies/${e}`);return(await vr(t)).val().firstTransactionTimestamp||null}catch(t){throw console.error("Error getting first transaction timestamp:",t),t}}}class ji{static show(e,t,n=null,i=null){const s=document.createElement("div");s.className="modal-overlay";const o=document.createElement("div");o.className="modal-content";const a=document.createElement("h2");a.textContent=e;const c=document.createElement("div");c.className="modal-body",n?c.innerHTML=n:c.innerHTML=`
                <p>Welcome to Solana Fishing Game v1.0!</p>
                <div class="instructions-box">
                    <p>CONTROLS:</p>
                    <ul>
                        <li>← → or A/D - Move boat</li>
                        <li>Mouse - Aim fishing line</li>
                        <li>Click - Cast/Retract line</li>
                    </ul>
                    <p>SCORING:</p>
                    <ul>
                        <li>Fish = +1 point</li>
                        <li>Rainbow Fish = +5 points</li>
                        <li>Whale = -5 points</li>
                    </ul>
                </div>
            `;const u=document.createElement("button");u.textContent=i||(n?"Play Again":"START.EXE"),u.className="win95-button",o.appendChild(a),o.appendChild(c),o.appendChild(u),s.appendChild(o),document.body.appendChild(s),o.style.cssText=`
            padding: 2rem;
            max-width: 500px;
            position: relative;
        `;const g=document.createElement("button");g.className="stop-button",g.style.position="absolute",g.style.right="4px",g.style.top="4px",a.appendChild(g),u.onclick=()=>{s.remove(),t&&t()}}static showPaymentModal(e,t,n=null){const i=document.createElement("div");i.className="modal-overlay";const s=document.createElement("div");s.className="modal-content payment-modal";const o=document.createElement("h2");o.textContent=e;const a=document.createElement("div");a.className="modal-body",n?a.innerHTML=`
                <div class="payment-status">
                    <p>Transaction Status: ${n.status}</p>
                    ${n.transactionSignature?`<p>Transaction ID: <a href="https://solscan.io/tx/${n.transactionSignature}" 
                            target="_blank" rel="noopener noreferrer">
                            ${n.transactionSignature.slice(0,8)}...
                        </a></p>`:""}
                    ${n.failureReason?`<p class="error-message">Error: ${n.failureReason}</p>`:""}
                </div>
            `:a.innerHTML=`
                <div class="payment-request">
                    <p>Match found! Please deposit 0.1 SOL to start the game.</p>
                    <p>Both players must deposit to begin.</p>
                </div>
            `;const c=document.createElement("button");return c.className="win95-button",n&&n.status==="failed"?c.textContent="Try Again":n&&n.status==="success"?(c.textContent="Waiting for Opponent",c.disabled=!0):c.textContent="Add 0.1 SOL to pot",s.appendChild(o),s.appendChild(a),s.appendChild(c),i.appendChild(s),document.body.appendChild(i),c.disabled||(c.onclick=()=>{t&&t()}),i}}class Vv{constructor(e,t,n,i=!1){this.x=e,this.y=t,this.amount=n,this.isRainbow=i,this.startTime=Date.now(),this.yOffset=0}update(e){const t=(e-this.startTime)/1500;this.yOffset=-40*Math.pow(t,.7),this.opacity=Math.max(0,1-t)}render(e,t){if(!this.opacity)return;if(e.save(),e.imageSmoothingEnabled=!1,e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=0,e.shadowOffsetX=2,e.shadowOffsetY=2,this.isRainbow){const i=e.createLinearGradient(this.x-20,this.y+this.yOffset,this.x+20,this.y+this.yOffset);i.addColorStop(0,`rgba(255, 0, 0, ${this.opacity})`),i.addColorStop(.2,`rgba(255, 165, 0, ${this.opacity})`),i.addColorStop(.4,`rgba(255, 255, 0, ${this.opacity})`),i.addColorStop(.6,`rgba(0, 255, 0, ${this.opacity})`),i.addColorStop(.8,`rgba(0, 0, 255, ${this.opacity})`),i.addColorStop(1,`rgba(148, 0, 211, ${this.opacity})`),e.fillStyle=i,e.strokeStyle=`rgba(255, 255, 255, ${this.opacity})`}else this.amount>0?(e.fillStyle=`rgba(0, 255, 0, ${this.opacity})`,e.strokeStyle=`rgba(0, 128, 0, ${this.opacity})`):(e.fillStyle=`rgba(255, 0, 0, ${this.opacity})`,e.strokeStyle=`rgba(139, 0, 0, ${this.opacity})`);e.font="bold 24px 'VT323'",e.textAlign="center";const n=this.amount>0?`+${this.amount}`:this.amount;e.lineWidth=3,e.strokeText(n,this.x,this.y+this.yOffset),e.fillText(n,this.x,this.y+this.yOffset),e.restore()}}class Gv{constructor(){this.animations=new Set}createAnimation(e,t,n,i){const s=new Vv(e,t,n,i);this.animations.add(s),setTimeout(()=>{this.animations.delete(s)},1500),console.log("Created animation:",n,"at",e,t)}update(e){for(const t of this.animations)t.update(e)}render(e,t){for(const n of this.animations)n.render(e,t)}}class jv{constructor(){console.log("Game constructor called"),this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=800,this.canvas.height=600,this.players=[],this.fishManager=new Og,this.timeRemaining=150,this.isRunning=!1,this.gameService=new dp,this.mouseX=0,this.mouseY=0,this.activePlayer=null,this.player=null,this.animationManager=new Gv,this.notification=null,this.notificationTimeout=null,this.setupStopButton()}async init(){console.log("Game initialization started");try{await Zh.load(),this.player=new fu(400,200,"Player 1"),this.fishManager.init(),console.log("Fish manager initialized"),this.setupControls(),console.log("Controls setup");try{await this.gameService.createGame("Player 1","Player 2"),console.log("Firebase game created"),this.gameService.subscribeToGameUpdates(e=>{console.log("Game state update received:",e),this.handleGameStateUpdate(e)})}catch(e){console.error("Firebase initialization failed:",e)}ji.show("Welcome to Solana Fishing!",()=>{this.start()}),console.log("Game initialization completed")}catch(e){throw console.error("Error during game initialization:",e),e}this.testRender(),this.updateScoreDisplay()}handleGameStateUpdate(e){try{if(e.status==="completed"){this.endGame(e.winner);return}this.players.forEach((t,n)=>{const i=`Player ${n+1}`;t.score=e.scores[i]||0}),this.updateScoreDisplay()}catch(t){console.error("Error in handleGameStateUpdate:",t)}}async updatePlayerScore(e){try{const t=e.name;await this.gameService.updatePlayerScore(t,e.score)}catch(t){console.error("Error in updatePlayerScore:",t)}}start(){console.log("Game starting"),this.isRunning=!0,this.gameLoop(),this.startTimer(),console.log("Game started")}gameLoop(){if(!this.isRunning){console.log("Game loop stopped");return}try{this.update(),this.render(),requestAnimationFrame(()=>this.gameLoop())}catch(e){console.error("Error in game loop:",e),requestAnimationFrame(()=>this.gameLoop())}}update(){try{this.player.update(),this.fishManager.update(),this.checkCollisions(),this.animationManager.update(Date.now())}catch(e){console.error("Error in update:",e)}}render(){if(!this.ctx){console.error("Canvas context is not initialized");return}this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#87CEEB",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#1E90FF",this.ctx.fillRect(0,200,this.canvas.width,this.canvas.height-200),this.player.render(this.ctx),this.fishManager.render(this.ctx),this.animationManager.render(this.ctx,Date.now())}checkCollisions(){if(this.player.isFishing){const e=this.fishManager.checkFishingCollision(this.player.hookPosition);if(e){let t=0,n=!1;switch(e){case"rainbow":t=5,n=!0;break;case"whale":t=-5;break;case"regular":t=1;break}this.animationManager.createAnimation(this.player.hookPosition.x,this.player.hookPosition.y,t,n),this.player.updateScore(t),this.updateScoreDisplay(),this.player.toggleFishing()}}}startTimer(){const e=document.getElementById("timer"),t=setInterval(()=>{this.timeRemaining--;const n=Math.floor(this.timeRemaining/60),i=this.timeRemaining%60;if(e.textContent=`${n}:${i.toString().padStart(2,"0")}`,this.timeRemaining%30===0&&this.timeRemaining>0&&(this.fishManager.increaseWhaleCount(),this.showNotification("WARNING: New Whale Appeared! 🐋"),this.timeRemaining<150)){this.fishManager.increaseSpeeds();const s=this.fishManager.currentSpeedMultiplier;this.showNotification(`SPEED INCREASED TO ${s}x! 🐟💨`,3e3)}this.timeRemaining<=0&&(clearInterval(t),this.endGame())},1e3)}async endGame(){this.isRunning=!1,this.fishManager.resetSpeeds();const e=`
            <p class="end-score">Final Score: ${this.player.score} fish</p>
            <div class="score-breakdown">
                <p>Game Over!</p>
                ${this.player.score>10?'<p class="bonus-message">Great job!</p>':""}
            </div>
        `;try{await this.gameService.endGame(this.player.name)}catch(t){console.error("Error ending game:",t)}ji.show("Game Over",()=>{this.player.score=0,this.timeRemaining=150,this.updateScoreDisplay(),this.start()},e)}setupControls(){window.addEventListener("keydown",e=>{(e.key==="a"||e.key==="ArrowLeft")&&this.player.moveLeft(),(e.key==="d"||e.key==="ArrowRight")&&this.player.moveRight()}),this.canvas.addEventListener("mousemove",e=>{const t=this.canvas.getBoundingClientRect();this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top,this.player.isFishing||this.player.updateTargetAngle(this.mouseX,this.mouseY)}),this.canvas.addEventListener("click",()=>{this.player.toggleFishing()})}updateScoreDisplay(){const e=document.getElementById("player1-score");e&&(e.textContent=`Score: ${this.player.score} fish`)}testRender(){if(console.log("Testing canvas render"),!this.ctx){console.error("Canvas context is not initialized");return}this.ctx.fillStyle="red",this.ctx.fillRect(0,0,100,100),this.ctx.fillStyle="blue",this.ctx.fillRect(100,100,100,100),console.log("Test render completed")}setupStopButton(){const e=document.getElementById("stop-game");e&&e.addEventListener("click",()=>{const t=`
                    <p class="confirm-message">Are you sure you want to stop the game?</p>
                    <div class="button-container">
                        <button class="win95-button" id="confirm-stop">Yes</button>
                        <button class="win95-button" id="cancel-stop">No</button>
                    </div>
                `,n=document.createElement("div");n.className="modal-overlay";const i=document.createElement("div");i.className="modal-content confirm-modal";const s=document.createElement("h2");s.textContent="Confirm Stop";const o=document.createElement("div");o.className="modal-body",o.innerHTML=t,i.appendChild(s),i.appendChild(o),n.appendChild(i),document.body.appendChild(n),document.getElementById("confirm-stop").onclick=()=>{n.remove(),this.stopGame()},document.getElementById("cancel-stop").onclick=()=>{n.remove()}})}stopGame(){this.isRunning=!1,this.fishManager.resetSpeeds();const e=`
            <p class="end-score">Final Score: ${this.player.score} fish</p>
            <p>Game stopped</p>
        `;ji.show("Game Stopped",()=>{this.player.score=0,this.timeRemaining=150,this.updateScoreDisplay(),this.start()},e)}showNotification(e,t=2e3){this.notificationTimeout&&clearTimeout(this.notificationTimeout),this.notification||(this.notification=document.createElement("div"),this.notification.className="game-notification",document.getElementById("game-container").appendChild(this.notification)),this.notification.textContent=e,this.notification.classList.add("show"),this.notificationTimeout=setTimeout(()=>{this.notification.classList.remove("show")},t)}async initMultiplayer(){this.isMatchmaking=!0,this.showNotification("Waiting in lobby...",1e4);try{await this.gameService.joinLobby({wallet:this.playerWallet,timestamp:Date.now(),status:"waiting"}),this.gameService.onLobbyUpdate(t=>{this.updateLobbyPlayers(t)});const e=await this.gameService.findMatch(this.playerWallet);this.gameService.leaveLobby(this.playerWallet)}catch(e){throw console.error("Lobby error:",e),this.showNotification("Failed to join lobby. Please try again.",3e3),e}}updateLobbyPlayers(e){this.players=[],e.forEach((t,n)=>{const i=2*Math.PI*n/e.length,s=150,o=this.canvas.width/2,a=this.canvas.height/2,c=o+s*Math.cos(i),u=a+s*Math.sin(i),g=new fu(c,u,t.wallet);g.isLocal=t.wallet===this.playerWallet,this.players.push(g),g.isLocal&&(this.localPlayer=g)})}}var bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Pl(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var pe={},Uo={};Uo.byteLength=Jv;Uo.toByteArray=Xv;Uo.fromByteArray=t1;var Sn=[],sn=[],Kv=typeof Uint8Array<"u"?Uint8Array:Array,La="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Jr=0,Yv=La.length;Jr<Yv;++Jr)Sn[Jr]=La[Jr],sn[La.charCodeAt(Jr)]=Jr;sn[45]=62;sn[95]=63;function fp(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Jv(r){var e=fp(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Zv(r,e,t){return(e+t)*3/4-t}function Xv(r){var e,t=fp(r),n=t[0],i=t[1],s=new Kv(Zv(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=sn[r.charCodeAt(c)]<<18|sn[r.charCodeAt(c+1)]<<12|sn[r.charCodeAt(c+2)]<<6|sn[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=sn[r.charCodeAt(c)]<<2|sn[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=sn[r.charCodeAt(c)]<<10|sn[r.charCodeAt(c+1)]<<4|sn[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Qv(r){return Sn[r>>18&63]+Sn[r>>12&63]+Sn[r>>6&63]+Sn[r&63]}function e1(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(Qv(n));return i.join("")}function t1(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(e1(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(Sn[e>>2]+Sn[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(Sn[e>>10]+Sn[e>>4&63]+Sn[e<<2&63]+"=")),i.join("")}var Ll={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ll.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,u=c>>1,g=-7,y=t?i-1:0,v=t?-1:1,x=r[e+y];for(y+=v,s=x&(1<<-g)-1,x>>=-g,g+=a;g>0;s=s*256+r[e+y],y+=v,g-=8);for(o=s&(1<<-g)-1,s>>=-g,g+=n;g>0;o=o*256+r[e+y],y+=v,g-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(x?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(x?-1:1)*o*Math.pow(2,s-n)};Ll.write=function(r,e,t,n,i,s){var o,a,c,u=s*8-i-1,g=(1<<u)-1,y=g>>1,v=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=n?0:s-1,T=n?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=g):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+y>=1?e+=v/c:e+=v*Math.pow(2,1-y),e*c>=2&&(o++,c/=2),o+y>=g?(a=0,o=g):o+y>=1?(a=(e*c-1)*Math.pow(2,i),o=o+y):(a=e*Math.pow(2,y-1)*Math.pow(2,i),o=0));i>=8;r[t+x]=a&255,x+=T,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;r[t+x]=o&255,x+=T,o/=256,u-=8);r[t+x-T]|=R*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=Uo,t=Ll,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=U,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const _=new Uint8Array(1),h={foo:function(){return 42}};return Object.setPrototypeOf(h,Uint8Array.prototype),Object.setPrototypeOf(_,h),_.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(_){if(_>i)throw new RangeError('The value "'+_+'" is invalid for option "size"');const h=new Uint8Array(_);return Object.setPrototypeOf(h,a.prototype),h}function a(_,h,f){if(typeof _=="number"){if(typeof h=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(_)}return c(_,h,f)}a.poolSize=8192;function c(_,h,f){if(typeof _=="string")return v(_,h);if(ArrayBuffer.isView(_))return T(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(Tt(_,ArrayBuffer)||_&&Tt(_.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Tt(_,SharedArrayBuffer)||_&&Tt(_.buffer,SharedArrayBuffer)))return R(_,h,f);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const S=_.valueOf&&_.valueOf();if(S!=null&&S!==_)return a.from(S,h,f);const N=C(_);if(N)return N;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return a.from(_[Symbol.toPrimitive]("string"),h,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}a.from=function(_,h,f){return c(_,h,f)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function u(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function g(_,h,f){return u(_),_<=0?o(_):h!==void 0?typeof f=="string"?o(_).fill(h,f):o(_).fill(h):o(_)}a.alloc=function(_,h,f){return g(_,h,f)};function y(_){return u(_),o(_<0?0:D(_)|0)}a.allocUnsafe=function(_){return y(_)},a.allocUnsafeSlow=function(_){return y(_)};function v(_,h){if((typeof h!="string"||h==="")&&(h="utf8"),!a.isEncoding(h))throw new TypeError("Unknown encoding: "+h);const f=L(_,h)|0;let S=o(f);const N=S.write(_,h);return N!==f&&(S=S.slice(0,N)),S}function x(_){const h=_.length<0?0:D(_.length)|0,f=o(h);for(let S=0;S<h;S+=1)f[S]=_[S]&255;return f}function T(_){if(Tt(_,Uint8Array)){const h=new Uint8Array(_);return R(h.buffer,h.byteOffset,h.byteLength)}return x(_)}function R(_,h,f){if(h<0||_.byteLength<h)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<h+(f||0))throw new RangeError('"length" is outside of buffer bounds');let S;return h===void 0&&f===void 0?S=new Uint8Array(_):f===void 0?S=new Uint8Array(_,h):S=new Uint8Array(_,h,f),Object.setPrototypeOf(S,a.prototype),S}function C(_){if(a.isBuffer(_)){const h=D(_.length)|0,f=o(h);return f.length===0||_.copy(f,0,0,h),f}if(_.length!==void 0)return typeof _.length!="number"||Oe(_.length)?o(0):x(_);if(_.type==="Buffer"&&Array.isArray(_.data))return x(_.data)}function D(_){if(_>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return _|0}function U(_){return+_!=_&&(_=0),a.alloc(+_)}a.isBuffer=function(h){return h!=null&&h._isBuffer===!0&&h!==a.prototype},a.compare=function(h,f){if(Tt(h,Uint8Array)&&(h=a.from(h,h.offset,h.byteLength)),Tt(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),!a.isBuffer(h)||!a.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(h===f)return 0;let S=h.length,N=f.length;for(let B=0,F=Math.min(S,N);B<F;++B)if(h[B]!==f[B]){S=h[B],N=f[B];break}return S<N?-1:N<S?1:0},a.isEncoding=function(h){switch(String(h).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(h,f){if(!Array.isArray(h))throw new TypeError('"list" argument must be an Array of Buffers');if(h.length===0)return a.alloc(0);let S;if(f===void 0)for(f=0,S=0;S<h.length;++S)f+=h[S].length;const N=a.allocUnsafe(f);let B=0;for(S=0;S<h.length;++S){let F=h[S];if(Tt(F,Uint8Array))B+F.length>N.length?(a.isBuffer(F)||(F=a.from(F)),F.copy(N,B)):Uint8Array.prototype.set.call(N,F,B);else if(a.isBuffer(F))F.copy(N,B);else throw new TypeError('"list" argument must be an Array of Buffers');B+=F.length}return N};function L(_,h){if(a.isBuffer(_))return _.length;if(ArrayBuffer.isView(_)||Tt(_,ArrayBuffer))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);const f=_.length,S=arguments.length>2&&arguments[2]===!0;if(!S&&f===0)return 0;let N=!1;for(;;)switch(h){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return De(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f*2;case"hex":return f>>>1;case"base64":return Fe(_).length;default:if(N)return S?-1:De(_).length;h=(""+h).toLowerCase(),N=!0}}a.byteLength=L;function z(_,h,f){let S=!1;if((h===void 0||h<0)&&(h=0),h>this.length||((f===void 0||f>this.length)&&(f=this.length),f<=0)||(f>>>=0,h>>>=0,f<=h))return"";for(_||(_="utf8");;)switch(_){case"hex":return k(this,h,f);case"utf8":case"utf-8":return l(this,h,f);case"ascii":return w(this,h,f);case"latin1":case"binary":return E(this,h,f);case"base64":return A(this,h,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,h,f);default:if(S)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),S=!0}}a.prototype._isBuffer=!0;function Z(_,h,f){const S=_[h];_[h]=_[f],_[f]=S}a.prototype.swap16=function(){const h=this.length;if(h%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let f=0;f<h;f+=2)Z(this,f,f+1);return this},a.prototype.swap32=function(){const h=this.length;if(h%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let f=0;f<h;f+=4)Z(this,f,f+3),Z(this,f+1,f+2);return this},a.prototype.swap64=function(){const h=this.length;if(h%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let f=0;f<h;f+=8)Z(this,f,f+7),Z(this,f+1,f+6),Z(this,f+2,f+5),Z(this,f+3,f+4);return this},a.prototype.toString=function(){const h=this.length;return h===0?"":arguments.length===0?l(this,0,h):z.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(h){if(!a.isBuffer(h))throw new TypeError("Argument must be a Buffer");return this===h?!0:a.compare(this,h)===0},a.prototype.inspect=function(){let h="";const f=r.INSPECT_MAX_BYTES;return h=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(h+=" ... "),"<Buffer "+h+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(h,f,S,N,B){if(Tt(h,Uint8Array)&&(h=a.from(h,h.offset,h.byteLength)),!a.isBuffer(h))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof h);if(f===void 0&&(f=0),S===void 0&&(S=h?h.length:0),N===void 0&&(N=0),B===void 0&&(B=this.length),f<0||S>h.length||N<0||B>this.length)throw new RangeError("out of range index");if(N>=B&&f>=S)return 0;if(N>=B)return-1;if(f>=S)return 1;if(f>>>=0,S>>>=0,N>>>=0,B>>>=0,this===h)return 0;let F=B-N,me=S-f;const ge=Math.min(F,me),fe=this.slice(N,B),ze=h.slice(f,S);for(let le=0;le<ge;++le)if(fe[le]!==ze[le]){F=fe[le],me=ze[le];break}return F<me?-1:me<F?1:0};function j(_,h,f,S,N){if(_.length===0)return-1;if(typeof f=="string"?(S=f,f=0):f>2147483647?f=2147483647:f<-2147483648&&(f=-2147483648),f=+f,Oe(f)&&(f=N?0:_.length-1),f<0&&(f=_.length+f),f>=_.length){if(N)return-1;f=_.length-1}else if(f<0)if(N)f=0;else return-1;if(typeof h=="string"&&(h=a.from(h,S)),a.isBuffer(h))return h.length===0?-1:X(_,h,f,S,N);if(typeof h=="number")return h=h&255,typeof Uint8Array.prototype.indexOf=="function"?N?Uint8Array.prototype.indexOf.call(_,h,f):Uint8Array.prototype.lastIndexOf.call(_,h,f):X(_,[h],f,S,N);throw new TypeError("val must be string, number or Buffer")}function X(_,h,f,S,N){let B=1,F=_.length,me=h.length;if(S!==void 0&&(S=String(S).toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(_.length<2||h.length<2)return-1;B=2,F/=2,me/=2,f/=2}function ge(ze,le){return B===1?ze[le]:ze.readUInt16BE(le*B)}let fe;if(N){let ze=-1;for(fe=f;fe<F;fe++)if(ge(_,fe)===ge(h,ze===-1?0:fe-ze)){if(ze===-1&&(ze=fe),fe-ze+1===me)return ze*B}else ze!==-1&&(fe-=fe-ze),ze=-1}else for(f+me>F&&(f=F-me),fe=f;fe>=0;fe--){let ze=!0;for(let le=0;le<me;le++)if(ge(_,fe+le)!==ge(h,le)){ze=!1;break}if(ze)return fe}return-1}a.prototype.includes=function(h,f,S){return this.indexOf(h,f,S)!==-1},a.prototype.indexOf=function(h,f,S){return j(this,h,f,S,!0)},a.prototype.lastIndexOf=function(h,f,S){return j(this,h,f,S,!1)};function ee(_,h,f,S){f=Number(f)||0;const N=_.length-f;S?(S=Number(S),S>N&&(S=N)):S=N;const B=h.length;S>B/2&&(S=B/2);let F;for(F=0;F<S;++F){const me=parseInt(h.substr(F*2,2),16);if(Oe(me))return F;_[f+F]=me}return F}function Q(_,h,f,S){return Be(De(h,_.length-f),_,f,S)}function Ce(_,h,f,S){return Be(Ve(h),_,f,S)}function re(_,h,f,S){return Be(Fe(h),_,f,S)}function he(_,h,f,S){return Be(Gr(h,_.length-f),_,f,S)}a.prototype.write=function(h,f,S,N){if(f===void 0)N="utf8",S=this.length,f=0;else if(S===void 0&&typeof f=="string")N=f,S=this.length,f=0;else if(isFinite(f))f=f>>>0,isFinite(S)?(S=S>>>0,N===void 0&&(N="utf8")):(N=S,S=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const B=this.length-f;if((S===void 0||S>B)&&(S=B),h.length>0&&(S<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");N||(N="utf8");let F=!1;for(;;)switch(N){case"hex":return ee(this,h,f,S);case"utf8":case"utf-8":return Q(this,h,f,S);case"ascii":case"latin1":case"binary":return Ce(this,h,f,S);case"base64":return re(this,h,f,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,h,f,S);default:if(F)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),F=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(_,h,f){return h===0&&f===_.length?e.fromByteArray(_):e.fromByteArray(_.slice(h,f))}function l(_,h,f){f=Math.min(_.length,f);const S=[];let N=h;for(;N<f;){const B=_[N];let F=null,me=B>239?4:B>223?3:B>191?2:1;if(N+me<=f){let ge,fe,ze,le;switch(me){case 1:B<128&&(F=B);break;case 2:ge=_[N+1],(ge&192)===128&&(le=(B&31)<<6|ge&63,le>127&&(F=le));break;case 3:ge=_[N+1],fe=_[N+2],(ge&192)===128&&(fe&192)===128&&(le=(B&15)<<12|(ge&63)<<6|fe&63,le>2047&&(le<55296||le>57343)&&(F=le));break;case 4:ge=_[N+1],fe=_[N+2],ze=_[N+3],(ge&192)===128&&(fe&192)===128&&(ze&192)===128&&(le=(B&15)<<18|(ge&63)<<12|(fe&63)<<6|ze&63,le>65535&&le<1114112&&(F=le))}}F===null?(F=65533,me=1):F>65535&&(F-=65536,S.push(F>>>10&1023|55296),F=56320|F&1023),S.push(F),N+=me}return m(S)}const p=4096;function m(_){const h=_.length;if(h<=p)return String.fromCharCode.apply(String,_);let f="",S=0;for(;S<h;)f+=String.fromCharCode.apply(String,_.slice(S,S+=p));return f}function w(_,h,f){let S="";f=Math.min(_.length,f);for(let N=h;N<f;++N)S+=String.fromCharCode(_[N]&127);return S}function E(_,h,f){let S="";f=Math.min(_.length,f);for(let N=h;N<f;++N)S+=String.fromCharCode(_[N]);return S}function k(_,h,f){const S=_.length;(!h||h<0)&&(h=0),(!f||f<0||f>S)&&(f=S);let N="";for(let B=h;B<f;++B)N+=He[_[B]];return N}function M(_,h,f){const S=_.slice(h,f);let N="";for(let B=0;B<S.length-1;B+=2)N+=String.fromCharCode(S[B]+S[B+1]*256);return N}a.prototype.slice=function(h,f){const S=this.length;h=~~h,f=f===void 0?S:~~f,h<0?(h+=S,h<0&&(h=0)):h>S&&(h=S),f<0?(f+=S,f<0&&(f=0)):f>S&&(f=S),f<h&&(f=h);const N=this.subarray(h,f);return Object.setPrototypeOf(N,a.prototype),N};function b(_,h,f){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+h>f)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(h,f,S){h=h>>>0,f=f>>>0,S||b(h,f,this.length);let N=this[h],B=1,F=0;for(;++F<f&&(B*=256);)N+=this[h+F]*B;return N},a.prototype.readUintBE=a.prototype.readUIntBE=function(h,f,S){h=h>>>0,f=f>>>0,S||b(h,f,this.length);let N=this[h+--f],B=1;for(;f>0&&(B*=256);)N+=this[h+--f]*B;return N},a.prototype.readUint8=a.prototype.readUInt8=function(h,f){return h=h>>>0,f||b(h,1,this.length),this[h]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(h,f){return h=h>>>0,f||b(h,2,this.length),this[h]|this[h+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(h,f){return h=h>>>0,f||b(h,2,this.length),this[h]<<8|this[h+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(h,f){return h=h>>>0,f||b(h,4,this.length),(this[h]|this[h+1]<<8|this[h+2]<<16)+this[h+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(h,f){return h=h>>>0,f||b(h,4,this.length),this[h]*16777216+(this[h+1]<<16|this[h+2]<<8|this[h+3])},a.prototype.readBigUInt64LE=Kt(function(h){h=h>>>0,nt(h,"offset");const f=this[h],S=this[h+7];(f===void 0||S===void 0)&&ke(h,this.length-8);const N=f+this[++h]*2**8+this[++h]*2**16+this[++h]*2**24,B=this[++h]+this[++h]*2**8+this[++h]*2**16+S*2**24;return BigInt(N)+(BigInt(B)<<BigInt(32))}),a.prototype.readBigUInt64BE=Kt(function(h){h=h>>>0,nt(h,"offset");const f=this[h],S=this[h+7];(f===void 0||S===void 0)&&ke(h,this.length-8);const N=f*2**24+this[++h]*2**16+this[++h]*2**8+this[++h],B=this[++h]*2**24+this[++h]*2**16+this[++h]*2**8+S;return(BigInt(N)<<BigInt(32))+BigInt(B)}),a.prototype.readIntLE=function(h,f,S){h=h>>>0,f=f>>>0,S||b(h,f,this.length);let N=this[h],B=1,F=0;for(;++F<f&&(B*=256);)N+=this[h+F]*B;return B*=128,N>=B&&(N-=Math.pow(2,8*f)),N},a.prototype.readIntBE=function(h,f,S){h=h>>>0,f=f>>>0,S||b(h,f,this.length);let N=f,B=1,F=this[h+--N];for(;N>0&&(B*=256);)F+=this[h+--N]*B;return B*=128,F>=B&&(F-=Math.pow(2,8*f)),F},a.prototype.readInt8=function(h,f){return h=h>>>0,f||b(h,1,this.length),this[h]&128?(255-this[h]+1)*-1:this[h]},a.prototype.readInt16LE=function(h,f){h=h>>>0,f||b(h,2,this.length);const S=this[h]|this[h+1]<<8;return S&32768?S|4294901760:S},a.prototype.readInt16BE=function(h,f){h=h>>>0,f||b(h,2,this.length);const S=this[h+1]|this[h]<<8;return S&32768?S|4294901760:S},a.prototype.readInt32LE=function(h,f){return h=h>>>0,f||b(h,4,this.length),this[h]|this[h+1]<<8|this[h+2]<<16|this[h+3]<<24},a.prototype.readInt32BE=function(h,f){return h=h>>>0,f||b(h,4,this.length),this[h]<<24|this[h+1]<<16|this[h+2]<<8|this[h+3]},a.prototype.readBigInt64LE=Kt(function(h){h=h>>>0,nt(h,"offset");const f=this[h],S=this[h+7];(f===void 0||S===void 0)&&ke(h,this.length-8);const N=this[h+4]+this[h+5]*2**8+this[h+6]*2**16+(S<<24);return(BigInt(N)<<BigInt(32))+BigInt(f+this[++h]*2**8+this[++h]*2**16+this[++h]*2**24)}),a.prototype.readBigInt64BE=Kt(function(h){h=h>>>0,nt(h,"offset");const f=this[h],S=this[h+7];(f===void 0||S===void 0)&&ke(h,this.length-8);const N=(f<<24)+this[++h]*2**16+this[++h]*2**8+this[++h];return(BigInt(N)<<BigInt(32))+BigInt(this[++h]*2**24+this[++h]*2**16+this[++h]*2**8+S)}),a.prototype.readFloatLE=function(h,f){return h=h>>>0,f||b(h,4,this.length),t.read(this,h,!0,23,4)},a.prototype.readFloatBE=function(h,f){return h=h>>>0,f||b(h,4,this.length),t.read(this,h,!1,23,4)},a.prototype.readDoubleLE=function(h,f){return h=h>>>0,f||b(h,8,this.length),t.read(this,h,!0,52,8)},a.prototype.readDoubleBE=function(h,f){return h=h>>>0,f||b(h,8,this.length),t.read(this,h,!1,52,8)};function d(_,h,f,S,N,B){if(!a.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(h>N||h<B)throw new RangeError('"value" argument is out of bounds');if(f+S>_.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(h,f,S,N){if(h=+h,f=f>>>0,S=S>>>0,!N){const me=Math.pow(2,8*S)-1;d(this,h,f,S,me,0)}let B=1,F=0;for(this[f]=h&255;++F<S&&(B*=256);)this[f+F]=h/B&255;return f+S},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(h,f,S,N){if(h=+h,f=f>>>0,S=S>>>0,!N){const me=Math.pow(2,8*S)-1;d(this,h,f,S,me,0)}let B=S-1,F=1;for(this[f+B]=h&255;--B>=0&&(F*=256);)this[f+B]=h/F&255;return f+S},a.prototype.writeUint8=a.prototype.writeUInt8=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,1,255,0),this[f]=h&255,f+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,2,65535,0),this[f]=h&255,this[f+1]=h>>>8,f+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,2,65535,0),this[f]=h>>>8,this[f+1]=h&255,f+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,4,4294967295,0),this[f+3]=h>>>24,this[f+2]=h>>>16,this[f+1]=h>>>8,this[f]=h&255,f+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,4,4294967295,0),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=h&255,f+4};function I(_,h,f,S,N){we(h,S,N,_,f,7);let B=Number(h&BigInt(4294967295));_[f++]=B,B=B>>8,_[f++]=B,B=B>>8,_[f++]=B,B=B>>8,_[f++]=B;let F=Number(h>>BigInt(32)&BigInt(4294967295));return _[f++]=F,F=F>>8,_[f++]=F,F=F>>8,_[f++]=F,F=F>>8,_[f++]=F,f}function $(_,h,f,S,N){we(h,S,N,_,f,7);let B=Number(h&BigInt(4294967295));_[f+7]=B,B=B>>8,_[f+6]=B,B=B>>8,_[f+5]=B,B=B>>8,_[f+4]=B;let F=Number(h>>BigInt(32)&BigInt(4294967295));return _[f+3]=F,F=F>>8,_[f+2]=F,F=F>>8,_[f+1]=F,F=F>>8,_[f]=F,f+8}a.prototype.writeBigUInt64LE=Kt(function(h,f=0){return I(this,h,f,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Kt(function(h,f=0){return $(this,h,f,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(h,f,S,N){if(h=+h,f=f>>>0,!N){const ge=Math.pow(2,8*S-1);d(this,h,f,S,ge-1,-ge)}let B=0,F=1,me=0;for(this[f]=h&255;++B<S&&(F*=256);)h<0&&me===0&&this[f+B-1]!==0&&(me=1),this[f+B]=(h/F>>0)-me&255;return f+S},a.prototype.writeIntBE=function(h,f,S,N){if(h=+h,f=f>>>0,!N){const ge=Math.pow(2,8*S-1);d(this,h,f,S,ge-1,-ge)}let B=S-1,F=1,me=0;for(this[f+B]=h&255;--B>=0&&(F*=256);)h<0&&me===0&&this[f+B+1]!==0&&(me=1),this[f+B]=(h/F>>0)-me&255;return f+S},a.prototype.writeInt8=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,1,127,-128),h<0&&(h=255+h+1),this[f]=h&255,f+1},a.prototype.writeInt16LE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,2,32767,-32768),this[f]=h&255,this[f+1]=h>>>8,f+2},a.prototype.writeInt16BE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,2,32767,-32768),this[f]=h>>>8,this[f+1]=h&255,f+2},a.prototype.writeInt32LE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,4,2147483647,-2147483648),this[f]=h&255,this[f+1]=h>>>8,this[f+2]=h>>>16,this[f+3]=h>>>24,f+4},a.prototype.writeInt32BE=function(h,f,S){return h=+h,f=f>>>0,S||d(this,h,f,4,2147483647,-2147483648),h<0&&(h=4294967295+h+1),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=h&255,f+4},a.prototype.writeBigInt64LE=Kt(function(h,f=0){return I(this,h,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Kt(function(h,f=0){return $(this,h,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function V(_,h,f,S,N,B){if(f+S>_.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("Index out of range")}function Y(_,h,f,S,N){return h=+h,f=f>>>0,N||V(_,h,f,4),t.write(_,h,f,S,23,4),f+4}a.prototype.writeFloatLE=function(h,f,S){return Y(this,h,f,!0,S)},a.prototype.writeFloatBE=function(h,f,S){return Y(this,h,f,!1,S)};function be(_,h,f,S,N){return h=+h,f=f>>>0,N||V(_,h,f,8),t.write(_,h,f,S,52,8),f+8}a.prototype.writeDoubleLE=function(h,f,S){return be(this,h,f,!0,S)},a.prototype.writeDoubleBE=function(h,f,S){return be(this,h,f,!1,S)},a.prototype.copy=function(h,f,S,N){if(!a.isBuffer(h))throw new TypeError("argument should be a Buffer");if(S||(S=0),!N&&N!==0&&(N=this.length),f>=h.length&&(f=h.length),f||(f=0),N>0&&N<S&&(N=S),N===S||h.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(S<0||S>=this.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length),h.length-f<N-S&&(N=h.length-f+S);const B=N-S;return this===h&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(f,S,N):Uint8Array.prototype.set.call(h,this.subarray(S,N),f),B},a.prototype.fill=function(h,f,S,N){if(typeof h=="string"){if(typeof f=="string"?(N=f,f=0,S=this.length):typeof S=="string"&&(N=S,S=this.length),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!a.isEncoding(N))throw new TypeError("Unknown encoding: "+N);if(h.length===1){const F=h.charCodeAt(0);(N==="utf8"&&F<128||N==="latin1")&&(h=F)}}else typeof h=="number"?h=h&255:typeof h=="boolean"&&(h=Number(h));if(f<0||this.length<f||this.length<S)throw new RangeError("Out of range index");if(S<=f)return this;f=f>>>0,S=S===void 0?this.length:S>>>0,h||(h=0);let B;if(typeof h=="number")for(B=f;B<S;++B)this[B]=h;else{const F=a.isBuffer(h)?h:a.from(h,N),me=F.length;if(me===0)throw new TypeError('The value "'+h+'" is invalid for argument "value"');for(B=0;B<S-f;++B)this[B+f]=F[B%me]}return this};const oe={};function de(_,h,f){oe[_]=class extends f{constructor(){super(),Object.defineProperty(this,"message",{value:h.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${_}]`,this.stack,delete this.name}get code(){return _}set code(N){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:N,writable:!0})}toString(){return`${this.name} [${_}]: ${this.message}`}}}de("ERR_BUFFER_OUT_OF_BOUNDS",function(_){return _?`${_} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),de("ERR_INVALID_ARG_TYPE",function(_,h){return`The "${_}" argument must be of type number. Received type ${typeof h}`},TypeError),de("ERR_OUT_OF_RANGE",function(_,h,f){let S=`The value of "${_}" is out of range.`,N=f;return Number.isInteger(f)&&Math.abs(f)>2**32?N=Je(String(f)):typeof f=="bigint"&&(N=String(f),(f>BigInt(2)**BigInt(32)||f<-(BigInt(2)**BigInt(32)))&&(N=Je(N)),N+="n"),S+=` It must be ${h}. Received ${N}`,S},RangeError);function Je(_){let h="",f=_.length;const S=_[0]==="-"?1:0;for(;f>=S+4;f-=3)h=`_${_.slice(f-3,f)}${h}`;return`${_.slice(0,f)}${h}`}function Se(_,h,f){nt(h,"offset"),(_[h]===void 0||_[h+f]===void 0)&&ke(h,_.length-(f+1))}function we(_,h,f,S,N,B){if(_>f||_<h){const F=typeof h=="bigint"?"n":"";let me;throw h===0||h===BigInt(0)?me=`>= 0${F} and < 2${F} ** ${(B+1)*8}${F}`:me=`>= -(2${F} ** ${(B+1)*8-1}${F}) and < 2 ** ${(B+1)*8-1}${F}`,new oe.ERR_OUT_OF_RANGE("value",me,_)}Se(S,N,B)}function nt(_,h){if(typeof _!="number")throw new oe.ERR_INVALID_ARG_TYPE(h,"number",_)}function ke(_,h,f){throw Math.floor(_)!==_?(nt(_,f),new oe.ERR_OUT_OF_RANGE("offset","an integer",_)):h<0?new oe.ERR_BUFFER_OUT_OF_BOUNDS:new oe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${h}`,_)}const Ae=/[^+/0-9A-Za-z-_]/g;function Vr(_){if(_=_.split("=")[0],_=_.trim().replace(Ae,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function De(_,h){h=h||1/0;let f;const S=_.length;let N=null;const B=[];for(let F=0;F<S;++F){if(f=_.charCodeAt(F),f>55295&&f<57344){if(!N){if(f>56319){(h-=3)>-1&&B.push(239,191,189);continue}else if(F+1===S){(h-=3)>-1&&B.push(239,191,189);continue}N=f;continue}if(f<56320){(h-=3)>-1&&B.push(239,191,189),N=f;continue}f=(N-55296<<10|f-56320)+65536}else N&&(h-=3)>-1&&B.push(239,191,189);if(N=null,f<128){if((h-=1)<0)break;B.push(f)}else if(f<2048){if((h-=2)<0)break;B.push(f>>6|192,f&63|128)}else if(f<65536){if((h-=3)<0)break;B.push(f>>12|224,f>>6&63|128,f&63|128)}else if(f<1114112){if((h-=4)<0)break;B.push(f>>18|240,f>>12&63|128,f>>6&63|128,f&63|128)}else throw new Error("Invalid code point")}return B}function Ve(_){const h=[];for(let f=0;f<_.length;++f)h.push(_.charCodeAt(f)&255);return h}function Gr(_,h){let f,S,N;const B=[];for(let F=0;F<_.length&&!((h-=2)<0);++F)f=_.charCodeAt(F),S=f>>8,N=f%256,B.push(N),B.push(S);return B}function Fe(_){return e.toByteArray(Vr(_))}function Be(_,h,f,S){let N;for(N=0;N<S&&!(N+f>=h.length||N>=_.length);++N)h[N+f]=_[N];return N}function Tt(_,h){return _ instanceof h||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===h.name}function Oe(_){return _!==_}const He=function(){const _="0123456789abcdef",h=new Array(256);for(let f=0;f<16;++f){const S=f*16;for(let N=0;N<16;++N)h[S+N]=_[f]+_[N]}return h}();function Kt(_){return typeof BigInt>"u"?qe:_}function qe(){throw new Error("BigInt not supported")}})(pe);function Sh(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function n1(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Wo(r,...e){if(!n1(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function r1(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Sh(r.outputLen),Sh(r.blockLen)}function ho(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function i1(r,e){Wo(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Zr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Oa(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function En(r,e){return r<<32-e|r>>>e}function s1(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Ol(r){return typeof r=="string"&&(r=s1(r)),Wo(r),r}function o1(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];Wo(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}class pp{clone(){return this._cloneInto()}}function gp(r){const e=n=>r().update(Ol(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function mp(r=32){if(Zr&&typeof Zr.getRandomValues=="function")return Zr.getRandomValues(new Uint8Array(r));if(Zr&&typeof Zr.randomBytes=="function")return Zr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function a1(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,u=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+u,a,n)}function c1(r,e,t){return r&e^~r&t}function l1(r,e,t){return r&e^r&t^e&t}class yp extends pp{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Oa(this.buffer)}update(e){ho(this);const{view:t,buffer:n,blockLen:i}=this;e=Ol(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Oa(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ho(this),i1(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let y=o;y<i;y++)t[y]=0;a1(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Oa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,g=this.get();if(u>g.length)throw new Error("_sha2: outputLen bigger than state");for(let y=0;y<u;y++)a.setUint32(4*y,g[y],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}}const Ts=BigInt(2**32-1),kc=BigInt(32);function _p(r,e=!1){return e?{h:Number(r&Ts),l:Number(r>>kc&Ts)}:{h:Number(r>>kc&Ts)|0,l:Number(r&Ts)|0}}function u1(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=_p(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}const h1=(r,e)=>BigInt(r>>>0)<<kc|BigInt(e>>>0),d1=(r,e,t)=>r>>>t,f1=(r,e,t)=>r<<32-t|e>>>t,p1=(r,e,t)=>r>>>t|e<<32-t,g1=(r,e,t)=>r<<32-t|e>>>t,m1=(r,e,t)=>r<<64-t|e>>>t-32,y1=(r,e,t)=>r>>>t-32|e<<64-t,_1=(r,e)=>e,w1=(r,e)=>r,b1=(r,e,t)=>r<<t|e>>>32-t,v1=(r,e,t)=>e<<t|r>>>32-t,E1=(r,e,t)=>e<<t-32|r>>>64-t,S1=(r,e,t)=>r<<t-32|e>>>64-t;function I1(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const x1=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),k1=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,C1=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),A1=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,T1=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),R1=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,ye={fromBig:_p,split:u1,toBig:h1,shrSH:d1,shrSL:f1,rotrSH:p1,rotrSL:g1,rotrBH:m1,rotrBL:y1,rotr32H:_1,rotr32L:w1,rotlSH:b1,rotlSL:v1,rotlBH:E1,rotlBL:S1,add:I1,add3L:x1,add3H:k1,add4L:C1,add4H:A1,add5H:R1,add5L:T1},[M1,N1]=ye.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Xn=new Uint32Array(80),Qn=new Uint32Array(80);class B1 extends yp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:g,Fh:y,Fl:v,Gh:x,Gl:T,Hh:R,Hl:C}=this;return[e,t,n,i,s,o,a,c,u,g,y,v,x,T,R,C]}set(e,t,n,i,s,o,a,c,u,g,y,v,x,T,R,C){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=g|0,this.Fh=y|0,this.Fl=v|0,this.Gh=x|0,this.Gl=T|0,this.Hh=R|0,this.Hl=C|0}process(e,t){for(let L=0;L<16;L++,t+=4)Xn[L]=e.getUint32(t),Qn[L]=e.getUint32(t+=4);for(let L=16;L<80;L++){const z=Xn[L-15]|0,Z=Qn[L-15]|0,j=ye.rotrSH(z,Z,1)^ye.rotrSH(z,Z,8)^ye.shrSH(z,Z,7),X=ye.rotrSL(z,Z,1)^ye.rotrSL(z,Z,8)^ye.shrSL(z,Z,7),ee=Xn[L-2]|0,Q=Qn[L-2]|0,Ce=ye.rotrSH(ee,Q,19)^ye.rotrBH(ee,Q,61)^ye.shrSH(ee,Q,6),re=ye.rotrSL(ee,Q,19)^ye.rotrBL(ee,Q,61)^ye.shrSL(ee,Q,6),he=ye.add4L(X,re,Qn[L-7],Qn[L-16]),A=ye.add4H(he,j,Ce,Xn[L-7],Xn[L-16]);Xn[L]=A|0,Qn[L]=he|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:g,Eh:y,El:v,Fh:x,Fl:T,Gh:R,Gl:C,Hh:D,Hl:U}=this;for(let L=0;L<80;L++){const z=ye.rotrSH(y,v,14)^ye.rotrSH(y,v,18)^ye.rotrBH(y,v,41),Z=ye.rotrSL(y,v,14)^ye.rotrSL(y,v,18)^ye.rotrBL(y,v,41),j=y&x^~y&R,X=v&T^~v&C,ee=ye.add5L(U,Z,X,N1[L],Qn[L]),Q=ye.add5H(ee,D,z,j,M1[L],Xn[L]),Ce=ee|0,re=ye.rotrSH(n,i,28)^ye.rotrBH(n,i,34)^ye.rotrBH(n,i,39),he=ye.rotrSL(n,i,28)^ye.rotrBL(n,i,34)^ye.rotrBL(n,i,39),A=n&s^n&a^s&a,l=i&o^i&c^o&c;D=R|0,U=C|0,R=x|0,C=T|0,x=y|0,T=v|0,{h:y,l:v}=ye.add(u|0,g|0,Q|0,Ce|0),u=a|0,g=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const p=ye.add3L(Ce,he,l);n=ye.add3H(p,Q,re,A),i=p|0}({h:n,l:i}=ye.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=ye.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ye.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:g}=ye.add(this.Dh|0,this.Dl|0,u|0,g|0),{h:y,l:v}=ye.add(this.Eh|0,this.El|0,y|0,v|0),{h:x,l:T}=ye.add(this.Fh|0,this.Fl|0,x|0,T|0),{h:R,l:C}=ye.add(this.Gh|0,this.Gl|0,R|0,C|0),{h:D,l:U}=ye.add(this.Hh|0,this.Hl|0,D|0,U|0),this.set(n,i,s,o,a,c,u,g,y,v,x,T,R,C,D,U)}roundClean(){Xn.fill(0),Qn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const P1=gp(()=>new B1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $o=BigInt(0),Ho=BigInt(1),L1=BigInt(2);function Or(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function vs(r){if(!Or(r))throw new Error("Uint8Array expected")}function zn(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const O1=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Dr(r){vs(r);let e="";for(let t=0;t<r.length;t++)e+=O1[r[t]];return e}function ni(r){const e=r.toString(16);return e.length&1?"0"+e:e}function Dl(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?$o:BigInt("0x"+r)}const Pn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ih(r){if(r>=Pn._0&&r<=Pn._9)return r-Pn._0;if(r>=Pn.A&&r<=Pn.F)return r-(Pn.A-10);if(r>=Pn.a&&r<=Pn.f)return r-(Pn.a-10)}function wi(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=Ih(r.charCodeAt(s)),a=Ih(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Tr(r){return Dl(Dr(r))}function ui(r){return vs(r),Dl(Dr(Uint8Array.from(r).reverse()))}function bi(r,e){return wi(r.toString(16).padStart(e*2,"0"))}function ss(r,e){return bi(r,e).reverse()}function D1(r){return wi(ni(r))}function bt(r,e,t){let n;if(typeof e=="string")try{n=wi(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(Or(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return n}function Fr(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];vs(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}function F1(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}function U1(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}const Da=r=>typeof r=="bigint"&&$o<=r;function qo(r,e,t){return Da(r)&&Da(e)&&Da(t)&&e<=r&&r<t}function un(r,e,t,n){if(!qo(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function wp(r){let e;for(e=0;r>$o;r>>=Ho,e+=1);return e}function W1(r,e){return r>>BigInt(e)&Ho}function $1(r,e,t){return r|(t?Ho:$o)<<BigInt(e)}const Fl=r=>(L1<<BigInt(r-1))-Ho,Fa=r=>new Uint8Array(r),xh=r=>Uint8Array.from(r);function bp(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=Fa(r),i=Fa(r),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...y)=>t(i,n,...y),c=(y=Fa())=>{i=a(xh([0]),y),n=a(),y.length!==0&&(i=a(xh([1]),y),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let y=0;const v=[];for(;y<e;){n=a();const x=n.slice();v.push(x),y+=n.length}return Fr(...v)};return(y,v)=>{o(),c(y);let x;for(;!(x=v(u()));)c();return o(),x}}const H1={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Or(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Ri(r,e,t={}){const n=(i,s,o)=>{const a=H1[s];if(typeof a!="function")throw new Error("invalid validator function");const c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(t))n(i,s,!0);return r}const q1=()=>{throw new Error("not implemented")};function os(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}const z1=Object.freeze(Object.defineProperty({__proto__:null,aInRange:un,abool:zn,abytes:vs,bitGet:W1,bitLen:wp,bitMask:Fl,bitSet:$1,bytesToHex:Dr,bytesToNumberBE:Tr,bytesToNumberLE:ui,concatBytes:Fr,createHmacDrbg:bp,ensureBytes:bt,equalBytes:F1,hexToBytes:wi,hexToNumber:Dl,inRange:qo,isBytes:Or,memoized:os,notImplemented:q1,numberToBytesBE:bi,numberToBytesLE:ss,numberToHexUnpadded:ni,numberToVarBytesBE:D1,utf8ToBytes:U1,validateObject:Ri},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const At=BigInt(0),Ke=BigInt(1),Ir=BigInt(2),V1=BigInt(3),Cc=BigInt(4),kh=BigInt(5),Ch=BigInt(8);function Ge(r,e){const t=r%e;return t>=At?t:e+t}function G1(r,e,t){if(e<At)throw new Error("invalid exponent, negatives unsupported");if(t<=At)throw new Error("invalid modulus");if(t===Ke)return At;let n=Ke;for(;e>At;)e&Ke&&(n=n*r%t),r=r*r%t,e>>=Ke;return n}function Ze(r,e,t){let n=r;for(;e-- >At;)n*=n,n%=t;return n}function Ac(r,e){if(r===At)throw new Error("invert: expected non-zero number");if(e<=At)throw new Error("invert: expected positive modulus, got "+e);let t=Ge(r,e),n=e,i=At,s=Ke;for(;t!==At;){const a=n/t,c=n%t,u=i-s*a;n=t,t=c,i=s,s=u}if(n!==Ke)throw new Error("invert: does not exist");return Ge(i,e)}function j1(r){const e=(r-Ke)/Ir;let t,n,i;for(t=r-Ke,n=0;t%Ir===At;t/=Ir,n++);for(i=Ir;i<r&&G1(i,e,r)!==r-Ke;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+Ke)/Cc;return function(c,u){const g=c.pow(u,o);if(!c.eql(c.sqr(g),u))throw new Error("Cannot find square root");return g}}const s=(t+Ke)/Ir;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,g=a.pow(a.mul(a.ONE,i),t),y=a.pow(c,s),v=a.pow(c,t);for(;!a.eql(v,a.ONE);){if(a.eql(v,a.ZERO))return a.ZERO;let x=1;for(let R=a.sqr(v);x<u&&!a.eql(R,a.ONE);x++)R=a.sqr(R);const T=a.pow(g,Ke<<BigInt(u-x-1));g=a.sqr(T),y=a.mul(y,T),v=a.mul(v,g),u=x}return y}}function K1(r){if(r%Cc===V1){const e=(r+Ke)/Cc;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%Ch===kh){const e=(r-kh)/Ch;return function(n,i){const s=n.mul(i,Ir),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,Ir),o),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),i))throw new Error("Cannot find square root");return u}}return j1(r)}const Y1=(r,e)=>(Ge(r,e)&Ke)===Ke,J1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Z1(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=J1.reduce((n,i)=>(n[i]="function",n),e);return Ri(r,t)}function X1(r,e,t){if(t<At)throw new Error("invalid exponent, negatives unsupported");if(t===At)return r.ONE;if(t===Ke)return e;let n=r.ONE,i=e;for(;t>At;)t&Ke&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Ke;return n}function Q1(r,e){const t=new Array(e.length),n=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.inv(n);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function vp(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function zo(r,e,t=!1,n={}){if(r<=At)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:i,nByteLength:s}=vp(r,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:i,BYTES:s,MASK:Fl(i),ZERO:At,ONE:Ke,create:c=>Ge(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return At<=c&&c<r},is0:c=>c===At,isOdd:c=>(c&Ke)===Ke,neg:c=>Ge(-c,r),eql:(c,u)=>c===u,sqr:c=>Ge(c*c,r),add:(c,u)=>Ge(c+u,r),sub:(c,u)=>Ge(c-u,r),mul:(c,u)=>Ge(c*u,r),pow:(c,u)=>X1(a,c,u),div:(c,u)=>Ge(c*Ac(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ac(c,r),sqrt:n.sqrt||(c=>(o||(o=K1(r)),o(a,c))),invertBatch:c=>Q1(a,c),cmov:(c,u,g)=>g?u:c,toBytes:c=>t?ss(c,s):bi(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?ui(c):Tr(c)}});return Object.freeze(a)}function Ep(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function Sp(r){const e=Ep(r);return e+Math.ceil(e/2)}function eE(r,e,t=!1){const n=r.length,i=Ep(e),s=Sp(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?ui(r):Tr(r),a=Ge(o,e-Ke)+Ke;return t?ss(a,i):bi(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ah=BigInt(0),Rs=BigInt(1);function Ua(r,e){const t=e.negate();return r?t:e}function Ip(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Wa(r,e){Ip(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1);return{windows:t,windowSize:n}}function tE(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function nE(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const $a=new WeakMap,xp=new WeakMap;function Ha(r){return xp.get(r)||1}function kp(r,e){return{constTimeNegate:Ua,hasPrecomputes(t){return Ha(t)!==1},unsafeLadder(t,n,i=r.ZERO){let s=t;for(;n>Ah;)n&Rs&&(i=i.add(s)),s=s.double(),n>>=Rs;return i},precomputeWindow(t,n){const{windows:i,windowSize:s}=Wa(n,e),o=[];let a=t,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let g=1;g<s;g++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,i){const{windows:s,windowSize:o}=Wa(t,e);let a=r.ZERO,c=r.BASE;const u=BigInt(2**t-1),g=2**t,y=BigInt(t);for(let v=0;v<s;v++){const x=v*o;let T=Number(i&u);i>>=y,T>o&&(T-=g,i+=Rs);const R=x,C=x+Math.abs(T)-1,D=v%2!==0,U=T<0;T===0?c=c.add(Ua(D,n[R])):a=a.add(Ua(U,n[C]))}return{p:a,f:c}},wNAFUnsafe(t,n,i,s=r.ZERO){const{windows:o,windowSize:a}=Wa(t,e),c=BigInt(2**t-1),u=2**t,g=BigInt(t);for(let y=0;y<o;y++){const v=y*a;if(i===Ah)break;let x=Number(i&c);if(i>>=g,x>a&&(x-=u,i+=Rs),x===0)continue;let T=n[v+Math.abs(x)-1];x<0&&(T=T.negate()),s=s.add(T)}return s},getPrecomputes(t,n,i){let s=$a.get(n);return s||(s=this.precomputeWindow(n,t),t!==1&&$a.set(n,i(s))),s},wNAFCached(t,n,i){const s=Ha(t);return this.wNAF(s,this.getPrecomputes(s,t,i),n)},wNAFCachedUnsafe(t,n,i,s){const o=Ha(t);return o===1?this.unsafeLadder(t,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),n,s)},setWindowSize(t,n){Ip(n,e),xp.set(t,n),$a.delete(t)}}}function Cp(r,e,t,n){if(tE(t,r),nE(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=r.ZERO,s=wp(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let g=i;for(let y=u;y>=0;y-=o){c.fill(i);for(let x=0;x<n.length;x++){const T=n[x],R=Number(T>>BigInt(y)&BigInt(a));c[R]=c[R].add(t[x])}let v=i;for(let x=c.length-1,T=i;x>0;x--)T=T.add(c[x]),v=v.add(T);if(g=g.add(v),y!==0)for(let x=0;x<o;x++)g=g.double()}return g}function Ul(r){return Z1(r.Fp),Ri(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...vp(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const pn=BigInt(0),Zt=BigInt(1),Ms=BigInt(2),rE=BigInt(8),iE={zip215:!0};function sE(r){const e=Ul(r);return Ri(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function oE(r){const e=sE(r),{Fp:t,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Ms<<BigInt(a*8)-Zt,g=t.create,y=zo(e.n,e.nBitLength),v=e.uvRatio||((m,w)=>{try{return{isValid:!0,value:t.sqrt(m*t.inv(w))}}catch{return{isValid:!1,value:pn}}}),x=e.adjustScalarBytes||(m=>m),T=e.domain||((m,w,E)=>{if(zn("phflag",E),w.length||E)throw new Error("Contexts/pre-hash are not supported");return m});function R(m,w){un("coordinate "+m,w,pn,u)}function C(m){if(!(m instanceof L))throw new Error("ExtendedPoint expected")}const D=os((m,w)=>{const{ex:E,ey:k,ez:M}=m,b=m.is0();w==null&&(w=b?rE:t.inv(M));const d=g(E*w),I=g(k*w),$=g(M*w);if(b)return{x:pn,y:Zt};if($!==Zt)throw new Error("invZ was invalid");return{x:d,y:I}}),U=os(m=>{const{a:w,d:E}=e;if(m.is0())throw new Error("bad point: ZERO");const{ex:k,ey:M,ez:b,et:d}=m,I=g(k*k),$=g(M*M),V=g(b*b),Y=g(V*V),be=g(I*w),oe=g(V*g(be+$)),de=g(Y+g(E*g(I*$)));if(oe!==de)throw new Error("bad point: equation left != right (1)");const Je=g(k*M),Se=g(b*d);if(Je!==Se)throw new Error("bad point: equation left != right (2)");return!0});class L{constructor(w,E,k,M){this.ex=w,this.ey=E,this.ez=k,this.et=M,R("x",w),R("y",E),R("z",k),R("t",M),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof L)throw new Error("extended point not allowed");const{x:E,y:k}=w||{};return R("x",E),R("y",k),new L(E,k,Zt,g(E*k))}static normalizeZ(w){const E=t.invertBatch(w.map(k=>k.ez));return w.map((k,M)=>k.toAffine(E[M])).map(L.fromAffine)}static msm(w,E){return Cp(L,y,w,E)}_setWindowSize(w){j.setWindowSize(this,w)}assertValidity(){U(this)}equals(w){C(w);const{ex:E,ey:k,ez:M}=this,{ex:b,ey:d,ez:I}=w,$=g(E*I),V=g(b*M),Y=g(k*I),be=g(d*M);return $===V&&Y===be}is0(){return this.equals(L.ZERO)}negate(){return new L(g(-this.ex),this.ey,this.ez,g(-this.et))}double(){const{a:w}=e,{ex:E,ey:k,ez:M}=this,b=g(E*E),d=g(k*k),I=g(Ms*g(M*M)),$=g(w*b),V=E+k,Y=g(g(V*V)-b-d),be=$+d,oe=be-I,de=$-d,Je=g(Y*oe),Se=g(be*de),we=g(Y*de),nt=g(oe*be);return new L(Je,Se,nt,we)}add(w){C(w);const{a:E,d:k}=e,{ex:M,ey:b,ez:d,et:I}=this,{ex:$,ey:V,ez:Y,et:be}=w;if(E===BigInt(-1)){const Fe=g((b-M)*(V+$)),Be=g((b+M)*(V-$)),Tt=g(Be-Fe);if(Tt===pn)return this.double();const Oe=g(d*Ms*be),He=g(I*Ms*Y),Kt=He+Oe,qe=Be+Fe,_=He-Oe,h=g(Kt*Tt),f=g(qe*_),S=g(Kt*_),N=g(Tt*qe);return new L(h,f,N,S)}const oe=g(M*$),de=g(b*V),Je=g(I*k*be),Se=g(d*Y),we=g((M+b)*($+V)-oe-de),nt=Se-Je,ke=Se+Je,Ae=g(de-E*oe),Vr=g(we*nt),De=g(ke*Ae),Ve=g(we*Ae),Gr=g(nt*ke);return new L(Vr,De,Gr,Ve)}subtract(w){return this.add(w.negate())}wNAF(w){return j.wNAFCached(this,w,L.normalizeZ)}multiply(w){const E=w;un("scalar",E,Zt,n);const{p:k,f:M}=this.wNAF(E);return L.normalizeZ([k,M])[0]}multiplyUnsafe(w,E=L.ZERO){const k=w;return un("scalar",k,pn,n),k===pn?Z:this.is0()||k===Zt?this:j.wNAFCachedUnsafe(this,k,L.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return j.unsafeLadder(this,n).is0()}toAffine(w){return D(this,w)}clearCofactor(){const{h:w}=e;return w===Zt?this:this.multiplyUnsafe(w)}static fromHex(w,E=!1){const{d:k,a:M}=e,b=t.BYTES;w=bt("pointHex",w,b),zn("zip215",E);const d=w.slice(),I=w[b-1];d[b-1]=I&-129;const $=ui(d),V=E?u:t.ORDER;un("pointHex.y",$,pn,V);const Y=g($*$),be=g(Y-Zt),oe=g(k*Y-M);let{isValid:de,value:Je}=v(be,oe);if(!de)throw new Error("Point.fromHex: invalid y coordinate");const Se=(Je&Zt)===Zt,we=(I&128)!==0;if(!E&&Je===pn&&we)throw new Error("Point.fromHex: x=0 and x_0=1");return we!==Se&&(Je=g(-Je)),L.fromAffine({x:Je,y:$})}static fromPrivateKey(w){return Q(w).point}toRawBytes(){const{x:w,y:E}=this.toAffine(),k=ss(E,t.BYTES);return k[k.length-1]|=w&Zt?128:0,k}toHex(){return Dr(this.toRawBytes())}}L.BASE=new L(e.Gx,e.Gy,Zt,g(e.Gx*e.Gy)),L.ZERO=new L(pn,Zt,Zt,pn);const{BASE:z,ZERO:Z}=L,j=kp(L,a*8);function X(m){return Ge(m,n)}function ee(m){return X(ui(m))}function Q(m){const w=t.BYTES;m=bt("private key",m,w);const E=bt("hashed private key",s(m),2*w),k=x(E.slice(0,w)),M=E.slice(w,2*w),b=ee(k),d=z.multiply(b),I=d.toRawBytes();return{head:k,prefix:M,scalar:b,point:d,pointBytes:I}}function Ce(m){return Q(m).pointBytes}function re(m=new Uint8Array,...w){const E=Fr(...w);return ee(s(T(E,bt("context",m),!!i)))}function he(m,w,E={}){m=bt("message",m),i&&(m=i(m));const{prefix:k,scalar:M,pointBytes:b}=Q(w),d=re(E.context,k,m),I=z.multiply(d).toRawBytes(),$=re(E.context,I,b,m),V=X(d+$*M);un("signature.s",V,pn,n);const Y=Fr(I,ss(V,t.BYTES));return bt("result",Y,t.BYTES*2)}const A=iE;function l(m,w,E,k=A){const{context:M,zip215:b}=k,d=t.BYTES;m=bt("signature",m,2*d),w=bt("message",w),E=bt("publicKey",E,d),b!==void 0&&zn("zip215",b),i&&(w=i(w));const I=ui(m.slice(d,2*d));let $,V,Y;try{$=L.fromHex(E,b),V=L.fromHex(m.slice(0,d),b),Y=z.multiplyUnsafe(I)}catch{return!1}if(!b&&$.isSmallOrder())return!1;const be=re(M,V.toRawBytes(),$.toRawBytes(),w);return V.add($.multiplyUnsafe(be)).subtract(Y).clearCofactor().equals(L.ZERO)}return z._setWindowSize(8),{CURVE:e,getPublicKey:Ce,sign:he,verify:l,ExtendedPoint:L,utils:{getExtendedPublicKey:Q,randomPrivateKey:()=>o(t.BYTES),precompute(m=8,w=L.BASE){return w._setWindowSize(m),w.multiply(BigInt(3)),w}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Wl=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Th=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const aE=BigInt(1),Rh=BigInt(2);BigInt(3);const cE=BigInt(5),lE=BigInt(8);function uE(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),i=BigInt(80),s=Wl,a=r*r%s*r%s,c=Ze(a,Rh,s)*a%s,u=Ze(c,aE,s)*r%s,g=Ze(u,cE,s)*u%s,y=Ze(g,e,s)*g%s,v=Ze(y,t,s)*y%s,x=Ze(v,n,s)*v%s,T=Ze(x,i,s)*x%s,R=Ze(T,i,s)*x%s,C=Ze(R,e,s)*g%s;return{pow_p_5_8:Ze(C,Rh,s)*r%s,b2:a}}function hE(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function dE(r,e){const t=Wl,n=Ge(e*e*e,t),i=Ge(n*n*e,t),s=uE(r*i).pow_p_5_8;let o=Ge(r*n*s,t);const a=Ge(e*o*o,t),c=o,u=Ge(o*Th,t),g=a===r,y=a===Ge(-r,t),v=a===Ge(-r*Th,t);return g&&(o=c),(y||v)&&(o=u),Y1(o,t)&&(o=Ge(-o,t)),{isValid:g||y,value:o}}const fE=zo(Wl,void 0,!0),pE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:fE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:lE,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:P1,randomBytes:mp,adjustScalarBytes:hE,uvRatio:dE},$l=oE(pE);var Hl={exports:{}};const gE={},mE=Object.freeze(Object.defineProperty({__proto__:null,default:gE},Symbol.toStringTag,{value:"Module"})),yE=Pl(mE);Hl.exports;(function(r){(function(e,t){function n(A,l){if(!A)throw new Error(l||"Assertion failed")}function i(A,l){A.super_=l;var p=function(){};p.prototype=l.prototype,A.prototype=new p,A.prototype.constructor=A}function s(A,l,p){if(s.isBN(A))return A;this.negative=0,this.words=null,this.length=0,this.red=null,A!==null&&((l==="le"||l==="be")&&(p=l,l=10),this._init(A||0,l||10,p||"be"))}typeof e=="object"?e.exports=s:t.BN=s,s.BN=s,s.wordSize=26;var o;try{typeof window<"u"&&typeof window.Buffer<"u"?o=window.Buffer:o=yE.Buffer}catch{}s.isBN=function(l){return l instanceof s?!0:l!==null&&typeof l=="object"&&l.constructor.wordSize===s.wordSize&&Array.isArray(l.words)},s.max=function(l,p){return l.cmp(p)>0?l:p},s.min=function(l,p){return l.cmp(p)<0?l:p},s.prototype._init=function(l,p,m){if(typeof l=="number")return this._initNumber(l,p,m);if(typeof l=="object")return this._initArray(l,p,m);p==="hex"&&(p=16),n(p===(p|0)&&p>=2&&p<=36),l=l.toString().replace(/\s+/g,"");var w=0;l[0]==="-"&&(w++,this.negative=1),w<l.length&&(p===16?this._parseHex(l,w,m):(this._parseBase(l,p,w),m==="le"&&this._initArray(this.toArray(),p,m)))},s.prototype._initNumber=function(l,p,m){l<0&&(this.negative=1,l=-l),l<67108864?(this.words=[l&67108863],this.length=1):l<4503599627370496?(this.words=[l&67108863,l/67108864&67108863],this.length=2):(n(l<9007199254740992),this.words=[l&67108863,l/67108864&67108863,1],this.length=3),m==="le"&&this._initArray(this.toArray(),p,m)},s.prototype._initArray=function(l,p,m){if(n(typeof l.length=="number"),l.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(l.length/3),this.words=new Array(this.length);for(var w=0;w<this.length;w++)this.words[w]=0;var E,k,M=0;if(m==="be")for(w=l.length-1,E=0;w>=0;w-=3)k=l[w]|l[w-1]<<8|l[w-2]<<16,this.words[E]|=k<<M&67108863,this.words[E+1]=k>>>26-M&67108863,M+=24,M>=26&&(M-=26,E++);else if(m==="le")for(w=0,E=0;w<l.length;w+=3)k=l[w]|l[w+1]<<8|l[w+2]<<16,this.words[E]|=k<<M&67108863,this.words[E+1]=k>>>26-M&67108863,M+=24,M>=26&&(M-=26,E++);return this._strip()};function a(A,l){var p=A.charCodeAt(l);if(p>=48&&p<=57)return p-48;if(p>=65&&p<=70)return p-55;if(p>=97&&p<=102)return p-87;n(!1,"Invalid character in "+A)}function c(A,l,p){var m=a(A,p);return p-1>=l&&(m|=a(A,p-1)<<4),m}s.prototype._parseHex=function(l,p,m){this.length=Math.ceil((l.length-p)/6),this.words=new Array(this.length);for(var w=0;w<this.length;w++)this.words[w]=0;var E=0,k=0,M;if(m==="be")for(w=l.length-1;w>=p;w-=2)M=c(l,p,w)<<E,this.words[k]|=M&67108863,E>=18?(E-=18,k+=1,this.words[k]|=M>>>26):E+=8;else{var b=l.length-p;for(w=b%2===0?p+1:p;w<l.length;w+=2)M=c(l,p,w)<<E,this.words[k]|=M&67108863,E>=18?(E-=18,k+=1,this.words[k]|=M>>>26):E+=8}this._strip()};function u(A,l,p,m){for(var w=0,E=0,k=Math.min(A.length,p),M=l;M<k;M++){var b=A.charCodeAt(M)-48;w*=m,b>=49?E=b-49+10:b>=17?E=b-17+10:E=b,n(b>=0&&E<m,"Invalid character"),w+=E}return w}s.prototype._parseBase=function(l,p,m){this.words=[0],this.length=1;for(var w=0,E=1;E<=67108863;E*=p)w++;w--,E=E/p|0;for(var k=l.length-m,M=k%w,b=Math.min(k,k-M)+m,d=0,I=m;I<b;I+=w)d=u(l,I,I+w,p),this.imuln(E),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(M!==0){var $=1;for(d=u(l,I,l.length,p),I=0;I<M;I++)$*=p;this.imuln($),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}this._strip()},s.prototype.copy=function(l){l.words=new Array(this.length);for(var p=0;p<this.length;p++)l.words[p]=this.words[p];l.length=this.length,l.negative=this.negative,l.red=this.red};function g(A,l){A.words=l.words,A.length=l.length,A.negative=l.negative,A.red=l.red}if(s.prototype._move=function(l){g(l,this)},s.prototype.clone=function(){var l=new s(null);return this.copy(l),l},s.prototype._expand=function(l){for(;this.length<l;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=y}catch{s.prototype.inspect=y}else s.prototype.inspect=y;function y(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var v=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],x=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],T=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(l,p){l=l||10,p=p|0||1;var m;if(l===16||l==="hex"){m="";for(var w=0,E=0,k=0;k<this.length;k++){var M=this.words[k],b=((M<<w|E)&16777215).toString(16);E=M>>>24-w&16777215,w+=2,w>=26&&(w-=26,k--),E!==0||k!==this.length-1?m=v[6-b.length]+b+m:m=b+m}for(E!==0&&(m=E.toString(16)+m);m.length%p!==0;)m="0"+m;return this.negative!==0&&(m="-"+m),m}if(l===(l|0)&&l>=2&&l<=36){var d=x[l],I=T[l];m="";var $=this.clone();for($.negative=0;!$.isZero();){var V=$.modrn(I).toString(l);$=$.idivn(I),$.isZero()?m=V+m:m=v[d-V.length]+V+m}for(this.isZero()&&(m="0"+m);m.length%p!==0;)m="0"+m;return this.negative!==0&&(m="-"+m),m}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var l=this.words[0];return this.length===2?l+=this.words[1]*67108864:this.length===3&&this.words[2]===1?l+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-l:l},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(l,p){return this.toArrayLike(o,l,p)}),s.prototype.toArray=function(l,p){return this.toArrayLike(Array,l,p)};var R=function(l,p){return l.allocUnsafe?l.allocUnsafe(p):new l(p)};s.prototype.toArrayLike=function(l,p,m){this._strip();var w=this.byteLength(),E=m||Math.max(1,w);n(w<=E,"byte array longer than desired length"),n(E>0,"Requested array length <= 0");var k=R(l,E),M=p==="le"?"LE":"BE";return this["_toArrayLike"+M](k,w),k},s.prototype._toArrayLikeLE=function(l,p){for(var m=0,w=0,E=0,k=0;E<this.length;E++){var M=this.words[E]<<k|w;l[m++]=M&255,m<l.length&&(l[m++]=M>>8&255),m<l.length&&(l[m++]=M>>16&255),k===6?(m<l.length&&(l[m++]=M>>24&255),w=0,k=0):(w=M>>>24,k+=2)}if(m<l.length)for(l[m++]=w;m<l.length;)l[m++]=0},s.prototype._toArrayLikeBE=function(l,p){for(var m=l.length-1,w=0,E=0,k=0;E<this.length;E++){var M=this.words[E]<<k|w;l[m--]=M&255,m>=0&&(l[m--]=M>>8&255),m>=0&&(l[m--]=M>>16&255),k===6?(m>=0&&(l[m--]=M>>24&255),w=0,k=0):(w=M>>>24,k+=2)}if(m>=0)for(l[m--]=w;m>=0;)l[m--]=0},Math.clz32?s.prototype._countBits=function(l){return 32-Math.clz32(l)}:s.prototype._countBits=function(l){var p=l,m=0;return p>=4096&&(m+=13,p>>>=13),p>=64&&(m+=7,p>>>=7),p>=8&&(m+=4,p>>>=4),p>=2&&(m+=2,p>>>=2),m+p},s.prototype._zeroBits=function(l){if(l===0)return 26;var p=l,m=0;return p&8191||(m+=13,p>>>=13),p&127||(m+=7,p>>>=7),p&15||(m+=4,p>>>=4),p&3||(m+=2,p>>>=2),p&1||m++,m},s.prototype.bitLength=function(){var l=this.words[this.length-1],p=this._countBits(l);return(this.length-1)*26+p};function C(A){for(var l=new Array(A.bitLength()),p=0;p<l.length;p++){var m=p/26|0,w=p%26;l[p]=A.words[m]>>>w&1}return l}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var l=0,p=0;p<this.length;p++){var m=this._zeroBits(this.words[p]);if(l+=m,m!==26)break}return l},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(l){return this.negative!==0?this.abs().inotn(l).iaddn(1):this.clone()},s.prototype.fromTwos=function(l){return this.testn(l-1)?this.notn(l).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(l){for(;this.length<l.length;)this.words[this.length++]=0;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]|l.words[p];return this._strip()},s.prototype.ior=function(l){return n((this.negative|l.negative)===0),this.iuor(l)},s.prototype.or=function(l){return this.length>l.length?this.clone().ior(l):l.clone().ior(this)},s.prototype.uor=function(l){return this.length>l.length?this.clone().iuor(l):l.clone().iuor(this)},s.prototype.iuand=function(l){var p;this.length>l.length?p=l:p=this;for(var m=0;m<p.length;m++)this.words[m]=this.words[m]&l.words[m];return this.length=p.length,this._strip()},s.prototype.iand=function(l){return n((this.negative|l.negative)===0),this.iuand(l)},s.prototype.and=function(l){return this.length>l.length?this.clone().iand(l):l.clone().iand(this)},s.prototype.uand=function(l){return this.length>l.length?this.clone().iuand(l):l.clone().iuand(this)},s.prototype.iuxor=function(l){var p,m;this.length>l.length?(p=this,m=l):(p=l,m=this);for(var w=0;w<m.length;w++)this.words[w]=p.words[w]^m.words[w];if(this!==p)for(;w<p.length;w++)this.words[w]=p.words[w];return this.length=p.length,this._strip()},s.prototype.ixor=function(l){return n((this.negative|l.negative)===0),this.iuxor(l)},s.prototype.xor=function(l){return this.length>l.length?this.clone().ixor(l):l.clone().ixor(this)},s.prototype.uxor=function(l){return this.length>l.length?this.clone().iuxor(l):l.clone().iuxor(this)},s.prototype.inotn=function(l){n(typeof l=="number"&&l>=0);var p=Math.ceil(l/26)|0,m=l%26;this._expand(p),m>0&&p--;for(var w=0;w<p;w++)this.words[w]=~this.words[w]&67108863;return m>0&&(this.words[w]=~this.words[w]&67108863>>26-m),this._strip()},s.prototype.notn=function(l){return this.clone().inotn(l)},s.prototype.setn=function(l,p){n(typeof l=="number"&&l>=0);var m=l/26|0,w=l%26;return this._expand(m+1),p?this.words[m]=this.words[m]|1<<w:this.words[m]=this.words[m]&~(1<<w),this._strip()},s.prototype.iadd=function(l){var p;if(this.negative!==0&&l.negative===0)return this.negative=0,p=this.isub(l),this.negative^=1,this._normSign();if(this.negative===0&&l.negative!==0)return l.negative=0,p=this.isub(l),l.negative=1,p._normSign();var m,w;this.length>l.length?(m=this,w=l):(m=l,w=this);for(var E=0,k=0;k<w.length;k++)p=(m.words[k]|0)+(w.words[k]|0)+E,this.words[k]=p&67108863,E=p>>>26;for(;E!==0&&k<m.length;k++)p=(m.words[k]|0)+E,this.words[k]=p&67108863,E=p>>>26;if(this.length=m.length,E!==0)this.words[this.length]=E,this.length++;else if(m!==this)for(;k<m.length;k++)this.words[k]=m.words[k];return this},s.prototype.add=function(l){var p;return l.negative!==0&&this.negative===0?(l.negative=0,p=this.sub(l),l.negative^=1,p):l.negative===0&&this.negative!==0?(this.negative=0,p=l.sub(this),this.negative=1,p):this.length>l.length?this.clone().iadd(l):l.clone().iadd(this)},s.prototype.isub=function(l){if(l.negative!==0){l.negative=0;var p=this.iadd(l);return l.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(l),this.negative=1,this._normSign();var m=this.cmp(l);if(m===0)return this.negative=0,this.length=1,this.words[0]=0,this;var w,E;m>0?(w=this,E=l):(w=l,E=this);for(var k=0,M=0;M<E.length;M++)p=(w.words[M]|0)-(E.words[M]|0)+k,k=p>>26,this.words[M]=p&67108863;for(;k!==0&&M<w.length;M++)p=(w.words[M]|0)+k,k=p>>26,this.words[M]=p&67108863;if(k===0&&M<w.length&&w!==this)for(;M<w.length;M++)this.words[M]=w.words[M];return this.length=Math.max(this.length,M),w!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(l){return this.clone().isub(l)};function D(A,l,p){p.negative=l.negative^A.negative;var m=A.length+l.length|0;p.length=m,m=m-1|0;var w=A.words[0]|0,E=l.words[0]|0,k=w*E,M=k&67108863,b=k/67108864|0;p.words[0]=M;for(var d=1;d<m;d++){for(var I=b>>>26,$=b&67108863,V=Math.min(d,l.length-1),Y=Math.max(0,d-A.length+1);Y<=V;Y++){var be=d-Y|0;w=A.words[be]|0,E=l.words[Y]|0,k=w*E+$,I+=k/67108864|0,$=k&67108863}p.words[d]=$|0,b=I|0}return b!==0?p.words[d]=b|0:p.length--,p._strip()}var U=function(l,p,m){var w=l.words,E=p.words,k=m.words,M=0,b,d,I,$=w[0]|0,V=$&8191,Y=$>>>13,be=w[1]|0,oe=be&8191,de=be>>>13,Je=w[2]|0,Se=Je&8191,we=Je>>>13,nt=w[3]|0,ke=nt&8191,Ae=nt>>>13,Vr=w[4]|0,De=Vr&8191,Ve=Vr>>>13,Gr=w[5]|0,Fe=Gr&8191,Be=Gr>>>13,Tt=w[6]|0,Oe=Tt&8191,He=Tt>>>13,Kt=w[7]|0,qe=Kt&8191,_=Kt>>>13,h=w[8]|0,f=h&8191,S=h>>>13,N=w[9]|0,B=N&8191,F=N>>>13,me=E[0]|0,ge=me&8191,fe=me>>>13,ze=E[1]|0,le=ze&8191,rt=ze>>>13,su=E[2]|0,it=su&8191,st=su>>>13,ou=E[3]|0,ot=ou&8191,at=ou>>>13,au=E[4]|0,ct=au&8191,lt=au>>>13,cu=E[5]|0,ut=cu&8191,ht=cu>>>13,lu=E[6]|0,dt=lu&8191,ft=lu>>>13,uu=E[7]|0,pt=uu&8191,gt=uu>>>13,hu=E[8]|0,mt=hu&8191,yt=hu>>>13,du=E[9]|0,_t=du&8191,wt=du>>>13;m.negative=l.negative^p.negative,m.length=19,b=Math.imul(V,ge),d=Math.imul(V,fe),d=d+Math.imul(Y,ge)|0,I=Math.imul(Y,fe);var ea=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ea>>>26)|0,ea&=67108863,b=Math.imul(oe,ge),d=Math.imul(oe,fe),d=d+Math.imul(de,ge)|0,I=Math.imul(de,fe),b=b+Math.imul(V,le)|0,d=d+Math.imul(V,rt)|0,d=d+Math.imul(Y,le)|0,I=I+Math.imul(Y,rt)|0;var ta=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ta>>>26)|0,ta&=67108863,b=Math.imul(Se,ge),d=Math.imul(Se,fe),d=d+Math.imul(we,ge)|0,I=Math.imul(we,fe),b=b+Math.imul(oe,le)|0,d=d+Math.imul(oe,rt)|0,d=d+Math.imul(de,le)|0,I=I+Math.imul(de,rt)|0,b=b+Math.imul(V,it)|0,d=d+Math.imul(V,st)|0,d=d+Math.imul(Y,it)|0,I=I+Math.imul(Y,st)|0;var na=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(na>>>26)|0,na&=67108863,b=Math.imul(ke,ge),d=Math.imul(ke,fe),d=d+Math.imul(Ae,ge)|0,I=Math.imul(Ae,fe),b=b+Math.imul(Se,le)|0,d=d+Math.imul(Se,rt)|0,d=d+Math.imul(we,le)|0,I=I+Math.imul(we,rt)|0,b=b+Math.imul(oe,it)|0,d=d+Math.imul(oe,st)|0,d=d+Math.imul(de,it)|0,I=I+Math.imul(de,st)|0,b=b+Math.imul(V,ot)|0,d=d+Math.imul(V,at)|0,d=d+Math.imul(Y,ot)|0,I=I+Math.imul(Y,at)|0;var ra=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ra>>>26)|0,ra&=67108863,b=Math.imul(De,ge),d=Math.imul(De,fe),d=d+Math.imul(Ve,ge)|0,I=Math.imul(Ve,fe),b=b+Math.imul(ke,le)|0,d=d+Math.imul(ke,rt)|0,d=d+Math.imul(Ae,le)|0,I=I+Math.imul(Ae,rt)|0,b=b+Math.imul(Se,it)|0,d=d+Math.imul(Se,st)|0,d=d+Math.imul(we,it)|0,I=I+Math.imul(we,st)|0,b=b+Math.imul(oe,ot)|0,d=d+Math.imul(oe,at)|0,d=d+Math.imul(de,ot)|0,I=I+Math.imul(de,at)|0,b=b+Math.imul(V,ct)|0,d=d+Math.imul(V,lt)|0,d=d+Math.imul(Y,ct)|0,I=I+Math.imul(Y,lt)|0;var ia=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ia>>>26)|0,ia&=67108863,b=Math.imul(Fe,ge),d=Math.imul(Fe,fe),d=d+Math.imul(Be,ge)|0,I=Math.imul(Be,fe),b=b+Math.imul(De,le)|0,d=d+Math.imul(De,rt)|0,d=d+Math.imul(Ve,le)|0,I=I+Math.imul(Ve,rt)|0,b=b+Math.imul(ke,it)|0,d=d+Math.imul(ke,st)|0,d=d+Math.imul(Ae,it)|0,I=I+Math.imul(Ae,st)|0,b=b+Math.imul(Se,ot)|0,d=d+Math.imul(Se,at)|0,d=d+Math.imul(we,ot)|0,I=I+Math.imul(we,at)|0,b=b+Math.imul(oe,ct)|0,d=d+Math.imul(oe,lt)|0,d=d+Math.imul(de,ct)|0,I=I+Math.imul(de,lt)|0,b=b+Math.imul(V,ut)|0,d=d+Math.imul(V,ht)|0,d=d+Math.imul(Y,ut)|0,I=I+Math.imul(Y,ht)|0;var sa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(sa>>>26)|0,sa&=67108863,b=Math.imul(Oe,ge),d=Math.imul(Oe,fe),d=d+Math.imul(He,ge)|0,I=Math.imul(He,fe),b=b+Math.imul(Fe,le)|0,d=d+Math.imul(Fe,rt)|0,d=d+Math.imul(Be,le)|0,I=I+Math.imul(Be,rt)|0,b=b+Math.imul(De,it)|0,d=d+Math.imul(De,st)|0,d=d+Math.imul(Ve,it)|0,I=I+Math.imul(Ve,st)|0,b=b+Math.imul(ke,ot)|0,d=d+Math.imul(ke,at)|0,d=d+Math.imul(Ae,ot)|0,I=I+Math.imul(Ae,at)|0,b=b+Math.imul(Se,ct)|0,d=d+Math.imul(Se,lt)|0,d=d+Math.imul(we,ct)|0,I=I+Math.imul(we,lt)|0,b=b+Math.imul(oe,ut)|0,d=d+Math.imul(oe,ht)|0,d=d+Math.imul(de,ut)|0,I=I+Math.imul(de,ht)|0,b=b+Math.imul(V,dt)|0,d=d+Math.imul(V,ft)|0,d=d+Math.imul(Y,dt)|0,I=I+Math.imul(Y,ft)|0;var oa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(oa>>>26)|0,oa&=67108863,b=Math.imul(qe,ge),d=Math.imul(qe,fe),d=d+Math.imul(_,ge)|0,I=Math.imul(_,fe),b=b+Math.imul(Oe,le)|0,d=d+Math.imul(Oe,rt)|0,d=d+Math.imul(He,le)|0,I=I+Math.imul(He,rt)|0,b=b+Math.imul(Fe,it)|0,d=d+Math.imul(Fe,st)|0,d=d+Math.imul(Be,it)|0,I=I+Math.imul(Be,st)|0,b=b+Math.imul(De,ot)|0,d=d+Math.imul(De,at)|0,d=d+Math.imul(Ve,ot)|0,I=I+Math.imul(Ve,at)|0,b=b+Math.imul(ke,ct)|0,d=d+Math.imul(ke,lt)|0,d=d+Math.imul(Ae,ct)|0,I=I+Math.imul(Ae,lt)|0,b=b+Math.imul(Se,ut)|0,d=d+Math.imul(Se,ht)|0,d=d+Math.imul(we,ut)|0,I=I+Math.imul(we,ht)|0,b=b+Math.imul(oe,dt)|0,d=d+Math.imul(oe,ft)|0,d=d+Math.imul(de,dt)|0,I=I+Math.imul(de,ft)|0,b=b+Math.imul(V,pt)|0,d=d+Math.imul(V,gt)|0,d=d+Math.imul(Y,pt)|0,I=I+Math.imul(Y,gt)|0;var aa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(aa>>>26)|0,aa&=67108863,b=Math.imul(f,ge),d=Math.imul(f,fe),d=d+Math.imul(S,ge)|0,I=Math.imul(S,fe),b=b+Math.imul(qe,le)|0,d=d+Math.imul(qe,rt)|0,d=d+Math.imul(_,le)|0,I=I+Math.imul(_,rt)|0,b=b+Math.imul(Oe,it)|0,d=d+Math.imul(Oe,st)|0,d=d+Math.imul(He,it)|0,I=I+Math.imul(He,st)|0,b=b+Math.imul(Fe,ot)|0,d=d+Math.imul(Fe,at)|0,d=d+Math.imul(Be,ot)|0,I=I+Math.imul(Be,at)|0,b=b+Math.imul(De,ct)|0,d=d+Math.imul(De,lt)|0,d=d+Math.imul(Ve,ct)|0,I=I+Math.imul(Ve,lt)|0,b=b+Math.imul(ke,ut)|0,d=d+Math.imul(ke,ht)|0,d=d+Math.imul(Ae,ut)|0,I=I+Math.imul(Ae,ht)|0,b=b+Math.imul(Se,dt)|0,d=d+Math.imul(Se,ft)|0,d=d+Math.imul(we,dt)|0,I=I+Math.imul(we,ft)|0,b=b+Math.imul(oe,pt)|0,d=d+Math.imul(oe,gt)|0,d=d+Math.imul(de,pt)|0,I=I+Math.imul(de,gt)|0,b=b+Math.imul(V,mt)|0,d=d+Math.imul(V,yt)|0,d=d+Math.imul(Y,mt)|0,I=I+Math.imul(Y,yt)|0;var ca=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ca>>>26)|0,ca&=67108863,b=Math.imul(B,ge),d=Math.imul(B,fe),d=d+Math.imul(F,ge)|0,I=Math.imul(F,fe),b=b+Math.imul(f,le)|0,d=d+Math.imul(f,rt)|0,d=d+Math.imul(S,le)|0,I=I+Math.imul(S,rt)|0,b=b+Math.imul(qe,it)|0,d=d+Math.imul(qe,st)|0,d=d+Math.imul(_,it)|0,I=I+Math.imul(_,st)|0,b=b+Math.imul(Oe,ot)|0,d=d+Math.imul(Oe,at)|0,d=d+Math.imul(He,ot)|0,I=I+Math.imul(He,at)|0,b=b+Math.imul(Fe,ct)|0,d=d+Math.imul(Fe,lt)|0,d=d+Math.imul(Be,ct)|0,I=I+Math.imul(Be,lt)|0,b=b+Math.imul(De,ut)|0,d=d+Math.imul(De,ht)|0,d=d+Math.imul(Ve,ut)|0,I=I+Math.imul(Ve,ht)|0,b=b+Math.imul(ke,dt)|0,d=d+Math.imul(ke,ft)|0,d=d+Math.imul(Ae,dt)|0,I=I+Math.imul(Ae,ft)|0,b=b+Math.imul(Se,pt)|0,d=d+Math.imul(Se,gt)|0,d=d+Math.imul(we,pt)|0,I=I+Math.imul(we,gt)|0,b=b+Math.imul(oe,mt)|0,d=d+Math.imul(oe,yt)|0,d=d+Math.imul(de,mt)|0,I=I+Math.imul(de,yt)|0,b=b+Math.imul(V,_t)|0,d=d+Math.imul(V,wt)|0,d=d+Math.imul(Y,_t)|0,I=I+Math.imul(Y,wt)|0;var la=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(la>>>26)|0,la&=67108863,b=Math.imul(B,le),d=Math.imul(B,rt),d=d+Math.imul(F,le)|0,I=Math.imul(F,rt),b=b+Math.imul(f,it)|0,d=d+Math.imul(f,st)|0,d=d+Math.imul(S,it)|0,I=I+Math.imul(S,st)|0,b=b+Math.imul(qe,ot)|0,d=d+Math.imul(qe,at)|0,d=d+Math.imul(_,ot)|0,I=I+Math.imul(_,at)|0,b=b+Math.imul(Oe,ct)|0,d=d+Math.imul(Oe,lt)|0,d=d+Math.imul(He,ct)|0,I=I+Math.imul(He,lt)|0,b=b+Math.imul(Fe,ut)|0,d=d+Math.imul(Fe,ht)|0,d=d+Math.imul(Be,ut)|0,I=I+Math.imul(Be,ht)|0,b=b+Math.imul(De,dt)|0,d=d+Math.imul(De,ft)|0,d=d+Math.imul(Ve,dt)|0,I=I+Math.imul(Ve,ft)|0,b=b+Math.imul(ke,pt)|0,d=d+Math.imul(ke,gt)|0,d=d+Math.imul(Ae,pt)|0,I=I+Math.imul(Ae,gt)|0,b=b+Math.imul(Se,mt)|0,d=d+Math.imul(Se,yt)|0,d=d+Math.imul(we,mt)|0,I=I+Math.imul(we,yt)|0,b=b+Math.imul(oe,_t)|0,d=d+Math.imul(oe,wt)|0,d=d+Math.imul(de,_t)|0,I=I+Math.imul(de,wt)|0;var ua=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ua>>>26)|0,ua&=67108863,b=Math.imul(B,it),d=Math.imul(B,st),d=d+Math.imul(F,it)|0,I=Math.imul(F,st),b=b+Math.imul(f,ot)|0,d=d+Math.imul(f,at)|0,d=d+Math.imul(S,ot)|0,I=I+Math.imul(S,at)|0,b=b+Math.imul(qe,ct)|0,d=d+Math.imul(qe,lt)|0,d=d+Math.imul(_,ct)|0,I=I+Math.imul(_,lt)|0,b=b+Math.imul(Oe,ut)|0,d=d+Math.imul(Oe,ht)|0,d=d+Math.imul(He,ut)|0,I=I+Math.imul(He,ht)|0,b=b+Math.imul(Fe,dt)|0,d=d+Math.imul(Fe,ft)|0,d=d+Math.imul(Be,dt)|0,I=I+Math.imul(Be,ft)|0,b=b+Math.imul(De,pt)|0,d=d+Math.imul(De,gt)|0,d=d+Math.imul(Ve,pt)|0,I=I+Math.imul(Ve,gt)|0,b=b+Math.imul(ke,mt)|0,d=d+Math.imul(ke,yt)|0,d=d+Math.imul(Ae,mt)|0,I=I+Math.imul(Ae,yt)|0,b=b+Math.imul(Se,_t)|0,d=d+Math.imul(Se,wt)|0,d=d+Math.imul(we,_t)|0,I=I+Math.imul(we,wt)|0;var ha=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ha>>>26)|0,ha&=67108863,b=Math.imul(B,ot),d=Math.imul(B,at),d=d+Math.imul(F,ot)|0,I=Math.imul(F,at),b=b+Math.imul(f,ct)|0,d=d+Math.imul(f,lt)|0,d=d+Math.imul(S,ct)|0,I=I+Math.imul(S,lt)|0,b=b+Math.imul(qe,ut)|0,d=d+Math.imul(qe,ht)|0,d=d+Math.imul(_,ut)|0,I=I+Math.imul(_,ht)|0,b=b+Math.imul(Oe,dt)|0,d=d+Math.imul(Oe,ft)|0,d=d+Math.imul(He,dt)|0,I=I+Math.imul(He,ft)|0,b=b+Math.imul(Fe,pt)|0,d=d+Math.imul(Fe,gt)|0,d=d+Math.imul(Be,pt)|0,I=I+Math.imul(Be,gt)|0,b=b+Math.imul(De,mt)|0,d=d+Math.imul(De,yt)|0,d=d+Math.imul(Ve,mt)|0,I=I+Math.imul(Ve,yt)|0,b=b+Math.imul(ke,_t)|0,d=d+Math.imul(ke,wt)|0,d=d+Math.imul(Ae,_t)|0,I=I+Math.imul(Ae,wt)|0;var da=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(da>>>26)|0,da&=67108863,b=Math.imul(B,ct),d=Math.imul(B,lt),d=d+Math.imul(F,ct)|0,I=Math.imul(F,lt),b=b+Math.imul(f,ut)|0,d=d+Math.imul(f,ht)|0,d=d+Math.imul(S,ut)|0,I=I+Math.imul(S,ht)|0,b=b+Math.imul(qe,dt)|0,d=d+Math.imul(qe,ft)|0,d=d+Math.imul(_,dt)|0,I=I+Math.imul(_,ft)|0,b=b+Math.imul(Oe,pt)|0,d=d+Math.imul(Oe,gt)|0,d=d+Math.imul(He,pt)|0,I=I+Math.imul(He,gt)|0,b=b+Math.imul(Fe,mt)|0,d=d+Math.imul(Fe,yt)|0,d=d+Math.imul(Be,mt)|0,I=I+Math.imul(Be,yt)|0,b=b+Math.imul(De,_t)|0,d=d+Math.imul(De,wt)|0,d=d+Math.imul(Ve,_t)|0,I=I+Math.imul(Ve,wt)|0;var fa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(fa>>>26)|0,fa&=67108863,b=Math.imul(B,ut),d=Math.imul(B,ht),d=d+Math.imul(F,ut)|0,I=Math.imul(F,ht),b=b+Math.imul(f,dt)|0,d=d+Math.imul(f,ft)|0,d=d+Math.imul(S,dt)|0,I=I+Math.imul(S,ft)|0,b=b+Math.imul(qe,pt)|0,d=d+Math.imul(qe,gt)|0,d=d+Math.imul(_,pt)|0,I=I+Math.imul(_,gt)|0,b=b+Math.imul(Oe,mt)|0,d=d+Math.imul(Oe,yt)|0,d=d+Math.imul(He,mt)|0,I=I+Math.imul(He,yt)|0,b=b+Math.imul(Fe,_t)|0,d=d+Math.imul(Fe,wt)|0,d=d+Math.imul(Be,_t)|0,I=I+Math.imul(Be,wt)|0;var pa=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(pa>>>26)|0,pa&=67108863,b=Math.imul(B,dt),d=Math.imul(B,ft),d=d+Math.imul(F,dt)|0,I=Math.imul(F,ft),b=b+Math.imul(f,pt)|0,d=d+Math.imul(f,gt)|0,d=d+Math.imul(S,pt)|0,I=I+Math.imul(S,gt)|0,b=b+Math.imul(qe,mt)|0,d=d+Math.imul(qe,yt)|0,d=d+Math.imul(_,mt)|0,I=I+Math.imul(_,yt)|0,b=b+Math.imul(Oe,_t)|0,d=d+Math.imul(Oe,wt)|0,d=d+Math.imul(He,_t)|0,I=I+Math.imul(He,wt)|0;var ga=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ga>>>26)|0,ga&=67108863,b=Math.imul(B,pt),d=Math.imul(B,gt),d=d+Math.imul(F,pt)|0,I=Math.imul(F,gt),b=b+Math.imul(f,mt)|0,d=d+Math.imul(f,yt)|0,d=d+Math.imul(S,mt)|0,I=I+Math.imul(S,yt)|0,b=b+Math.imul(qe,_t)|0,d=d+Math.imul(qe,wt)|0,d=d+Math.imul(_,_t)|0,I=I+Math.imul(_,wt)|0;var ma=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ma>>>26)|0,ma&=67108863,b=Math.imul(B,mt),d=Math.imul(B,yt),d=d+Math.imul(F,mt)|0,I=Math.imul(F,yt),b=b+Math.imul(f,_t)|0,d=d+Math.imul(f,wt)|0,d=d+Math.imul(S,_t)|0,I=I+Math.imul(S,wt)|0;var ya=(M+b|0)+((d&8191)<<13)|0;M=(I+(d>>>13)|0)+(ya>>>26)|0,ya&=67108863,b=Math.imul(B,_t),d=Math.imul(B,wt),d=d+Math.imul(F,_t)|0,I=Math.imul(F,wt);var _a=(M+b|0)+((d&8191)<<13)|0;return M=(I+(d>>>13)|0)+(_a>>>26)|0,_a&=67108863,k[0]=ea,k[1]=ta,k[2]=na,k[3]=ra,k[4]=ia,k[5]=sa,k[6]=oa,k[7]=aa,k[8]=ca,k[9]=la,k[10]=ua,k[11]=ha,k[12]=da,k[13]=fa,k[14]=pa,k[15]=ga,k[16]=ma,k[17]=ya,k[18]=_a,M!==0&&(k[19]=M,m.length++),m};Math.imul||(U=D);function L(A,l,p){p.negative=l.negative^A.negative,p.length=A.length+l.length;for(var m=0,w=0,E=0;E<p.length-1;E++){var k=w;w=0;for(var M=m&67108863,b=Math.min(E,l.length-1),d=Math.max(0,E-A.length+1);d<=b;d++){var I=E-d,$=A.words[I]|0,V=l.words[d]|0,Y=$*V,be=Y&67108863;k=k+(Y/67108864|0)|0,be=be+M|0,M=be&67108863,k=k+(be>>>26)|0,w+=k>>>26,k&=67108863}p.words[E]=M,m=k,k=w}return m!==0?p.words[E]=m:p.length--,p._strip()}function z(A,l,p){return L(A,l,p)}s.prototype.mulTo=function(l,p){var m,w=this.length+l.length;return this.length===10&&l.length===10?m=U(this,l,p):w<63?m=D(this,l,p):w<1024?m=L(this,l,p):m=z(this,l,p),m},s.prototype.mul=function(l){var p=new s(null);return p.words=new Array(this.length+l.length),this.mulTo(l,p)},s.prototype.mulf=function(l){var p=new s(null);return p.words=new Array(this.length+l.length),z(this,l,p)},s.prototype.imul=function(l){return this.clone().mulTo(l,this)},s.prototype.imuln=function(l){var p=l<0;p&&(l=-l),n(typeof l=="number"),n(l<67108864);for(var m=0,w=0;w<this.length;w++){var E=(this.words[w]|0)*l,k=(E&67108863)+(m&67108863);m>>=26,m+=E/67108864|0,m+=k>>>26,this.words[w]=k&67108863}return m!==0&&(this.words[w]=m,this.length++),p?this.ineg():this},s.prototype.muln=function(l){return this.clone().imuln(l)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(l){var p=C(l);if(p.length===0)return new s(1);for(var m=this,w=0;w<p.length&&p[w]===0;w++,m=m.sqr());if(++w<p.length)for(var E=m.sqr();w<p.length;w++,E=E.sqr())p[w]!==0&&(m=m.mul(E));return m},s.prototype.iushln=function(l){n(typeof l=="number"&&l>=0);var p=l%26,m=(l-p)/26,w=67108863>>>26-p<<26-p,E;if(p!==0){var k=0;for(E=0;E<this.length;E++){var M=this.words[E]&w,b=(this.words[E]|0)-M<<p;this.words[E]=b|k,k=M>>>26-p}k&&(this.words[E]=k,this.length++)}if(m!==0){for(E=this.length-1;E>=0;E--)this.words[E+m]=this.words[E];for(E=0;E<m;E++)this.words[E]=0;this.length+=m}return this._strip()},s.prototype.ishln=function(l){return n(this.negative===0),this.iushln(l)},s.prototype.iushrn=function(l,p,m){n(typeof l=="number"&&l>=0);var w;p?w=(p-p%26)/26:w=0;var E=l%26,k=Math.min((l-E)/26,this.length),M=67108863^67108863>>>E<<E,b=m;if(w-=k,w=Math.max(0,w),b){for(var d=0;d<k;d++)b.words[d]=this.words[d];b.length=k}if(k!==0)if(this.length>k)for(this.length-=k,d=0;d<this.length;d++)this.words[d]=this.words[d+k];else this.words[0]=0,this.length=1;var I=0;for(d=this.length-1;d>=0&&(I!==0||d>=w);d--){var $=this.words[d]|0;this.words[d]=I<<26-E|$>>>E,I=$&M}return b&&I!==0&&(b.words[b.length++]=I),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(l,p,m){return n(this.negative===0),this.iushrn(l,p,m)},s.prototype.shln=function(l){return this.clone().ishln(l)},s.prototype.ushln=function(l){return this.clone().iushln(l)},s.prototype.shrn=function(l){return this.clone().ishrn(l)},s.prototype.ushrn=function(l){return this.clone().iushrn(l)},s.prototype.testn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,m=(l-p)/26,w=1<<p;if(this.length<=m)return!1;var E=this.words[m];return!!(E&w)},s.prototype.imaskn=function(l){n(typeof l=="number"&&l>=0);var p=l%26,m=(l-p)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=m)return this;if(p!==0&&m++,this.length=Math.min(m,this.length),p!==0){var w=67108863^67108863>>>p<<p;this.words[this.length-1]&=w}return this._strip()},s.prototype.maskn=function(l){return this.clone().imaskn(l)},s.prototype.iaddn=function(l){return n(typeof l=="number"),n(l<67108864),l<0?this.isubn(-l):this.negative!==0?this.length===1&&(this.words[0]|0)<=l?(this.words[0]=l-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(l),this.negative=1,this):this._iaddn(l)},s.prototype._iaddn=function(l){this.words[0]+=l;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},s.prototype.isubn=function(l){if(n(typeof l=="number"),n(l<67108864),l<0)return this.iaddn(-l);if(this.negative!==0)return this.negative=0,this.iaddn(l),this.negative=1,this;if(this.words[0]-=l,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this._strip()},s.prototype.addn=function(l){return this.clone().iaddn(l)},s.prototype.subn=function(l){return this.clone().isubn(l)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(l,p,m){var w=l.length+m,E;this._expand(w);var k,M=0;for(E=0;E<l.length;E++){k=(this.words[E+m]|0)+M;var b=(l.words[E]|0)*p;k-=b&67108863,M=(k>>26)-(b/67108864|0),this.words[E+m]=k&67108863}for(;E<this.length-m;E++)k=(this.words[E+m]|0)+M,M=k>>26,this.words[E+m]=k&67108863;if(M===0)return this._strip();for(n(M===-1),M=0,E=0;E<this.length;E++)k=-(this.words[E]|0)+M,M=k>>26,this.words[E]=k&67108863;return this.negative=1,this._strip()},s.prototype._wordDiv=function(l,p){var m=this.length-l.length,w=this.clone(),E=l,k=E.words[E.length-1]|0,M=this._countBits(k);m=26-M,m!==0&&(E=E.ushln(m),w.iushln(m),k=E.words[E.length-1]|0);var b=w.length-E.length,d;if(p!=="mod"){d=new s(null),d.length=b+1,d.words=new Array(d.length);for(var I=0;I<d.length;I++)d.words[I]=0}var $=w.clone()._ishlnsubmul(E,1,b);$.negative===0&&(w=$,d&&(d.words[b]=1));for(var V=b-1;V>=0;V--){var Y=(w.words[E.length+V]|0)*67108864+(w.words[E.length+V-1]|0);for(Y=Math.min(Y/k|0,67108863),w._ishlnsubmul(E,Y,V);w.negative!==0;)Y--,w.negative=0,w._ishlnsubmul(E,1,V),w.isZero()||(w.negative^=1);d&&(d.words[V]=Y)}return d&&d._strip(),w._strip(),p!=="div"&&m!==0&&w.iushrn(m),{div:d||null,mod:w}},s.prototype.divmod=function(l,p,m){if(n(!l.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var w,E,k;return this.negative!==0&&l.negative===0?(k=this.neg().divmod(l,p),p!=="mod"&&(w=k.div.neg()),p!=="div"&&(E=k.mod.neg(),m&&E.negative!==0&&E.iadd(l)),{div:w,mod:E}):this.negative===0&&l.negative!==0?(k=this.divmod(l.neg(),p),p!=="mod"&&(w=k.div.neg()),{div:w,mod:k.mod}):this.negative&l.negative?(k=this.neg().divmod(l.neg(),p),p!=="div"&&(E=k.mod.neg(),m&&E.negative!==0&&E.isub(l)),{div:k.div,mod:E}):l.length>this.length||this.cmp(l)<0?{div:new s(0),mod:this}:l.length===1?p==="div"?{div:this.divn(l.words[0]),mod:null}:p==="mod"?{div:null,mod:new s(this.modrn(l.words[0]))}:{div:this.divn(l.words[0]),mod:new s(this.modrn(l.words[0]))}:this._wordDiv(l,p)},s.prototype.div=function(l){return this.divmod(l,"div",!1).div},s.prototype.mod=function(l){return this.divmod(l,"mod",!1).mod},s.prototype.umod=function(l){return this.divmod(l,"mod",!0).mod},s.prototype.divRound=function(l){var p=this.divmod(l);if(p.mod.isZero())return p.div;var m=p.div.negative!==0?p.mod.isub(l):p.mod,w=l.ushrn(1),E=l.andln(1),k=m.cmp(w);return k<0||E===1&&k===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},s.prototype.modrn=function(l){var p=l<0;p&&(l=-l),n(l<=67108863);for(var m=(1<<26)%l,w=0,E=this.length-1;E>=0;E--)w=(m*w+(this.words[E]|0))%l;return p?-w:w},s.prototype.modn=function(l){return this.modrn(l)},s.prototype.idivn=function(l){var p=l<0;p&&(l=-l),n(l<=67108863);for(var m=0,w=this.length-1;w>=0;w--){var E=(this.words[w]|0)+m*67108864;this.words[w]=E/l|0,m=E%l}return this._strip(),p?this.ineg():this},s.prototype.divn=function(l){return this.clone().idivn(l)},s.prototype.egcd=function(l){n(l.negative===0),n(!l.isZero());var p=this,m=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var w=new s(1),E=new s(0),k=new s(0),M=new s(1),b=0;p.isEven()&&m.isEven();)p.iushrn(1),m.iushrn(1),++b;for(var d=m.clone(),I=p.clone();!p.isZero();){for(var $=0,V=1;!(p.words[0]&V)&&$<26;++$,V<<=1);if($>0)for(p.iushrn($);$-- >0;)(w.isOdd()||E.isOdd())&&(w.iadd(d),E.isub(I)),w.iushrn(1),E.iushrn(1);for(var Y=0,be=1;!(m.words[0]&be)&&Y<26;++Y,be<<=1);if(Y>0)for(m.iushrn(Y);Y-- >0;)(k.isOdd()||M.isOdd())&&(k.iadd(d),M.isub(I)),k.iushrn(1),M.iushrn(1);p.cmp(m)>=0?(p.isub(m),w.isub(k),E.isub(M)):(m.isub(p),k.isub(w),M.isub(E))}return{a:k,b:M,gcd:m.iushln(b)}},s.prototype._invmp=function(l){n(l.negative===0),n(!l.isZero());var p=this,m=l.clone();p.negative!==0?p=p.umod(l):p=p.clone();for(var w=new s(1),E=new s(0),k=m.clone();p.cmpn(1)>0&&m.cmpn(1)>0;){for(var M=0,b=1;!(p.words[0]&b)&&M<26;++M,b<<=1);if(M>0)for(p.iushrn(M);M-- >0;)w.isOdd()&&w.iadd(k),w.iushrn(1);for(var d=0,I=1;!(m.words[0]&I)&&d<26;++d,I<<=1);if(d>0)for(m.iushrn(d);d-- >0;)E.isOdd()&&E.iadd(k),E.iushrn(1);p.cmp(m)>=0?(p.isub(m),w.isub(E)):(m.isub(p),E.isub(w))}var $;return p.cmpn(1)===0?$=w:$=E,$.cmpn(0)<0&&$.iadd(l),$},s.prototype.gcd=function(l){if(this.isZero())return l.abs();if(l.isZero())return this.abs();var p=this.clone(),m=l.clone();p.negative=0,m.negative=0;for(var w=0;p.isEven()&&m.isEven();w++)p.iushrn(1),m.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;m.isEven();)m.iushrn(1);var E=p.cmp(m);if(E<0){var k=p;p=m,m=k}else if(E===0||m.cmpn(1)===0)break;p.isub(m)}while(!0);return m.iushln(w)},s.prototype.invm=function(l){return this.egcd(l).a.umod(l)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(l){return this.words[0]&l},s.prototype.bincn=function(l){n(typeof l=="number");var p=l%26,m=(l-p)/26,w=1<<p;if(this.length<=m)return this._expand(m+1),this.words[m]|=w,this;for(var E=w,k=m;E!==0&&k<this.length;k++){var M=this.words[k]|0;M+=E,E=M>>>26,M&=67108863,this.words[k]=M}return E!==0&&(this.words[k]=E,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(l){var p=l<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this._strip();var m;if(this.length>1)m=1;else{p&&(l=-l),n(l<=67108863,"Number is too big");var w=this.words[0]|0;m=w===l?0:w<l?-1:1}return this.negative!==0?-m|0:m},s.prototype.cmp=function(l){if(this.negative!==0&&l.negative===0)return-1;if(this.negative===0&&l.negative!==0)return 1;var p=this.ucmp(l);return this.negative!==0?-p|0:p},s.prototype.ucmp=function(l){if(this.length>l.length)return 1;if(this.length<l.length)return-1;for(var p=0,m=this.length-1;m>=0;m--){var w=this.words[m]|0,E=l.words[m]|0;if(w!==E){w<E?p=-1:w>E&&(p=1);break}}return p},s.prototype.gtn=function(l){return this.cmpn(l)===1},s.prototype.gt=function(l){return this.cmp(l)===1},s.prototype.gten=function(l){return this.cmpn(l)>=0},s.prototype.gte=function(l){return this.cmp(l)>=0},s.prototype.ltn=function(l){return this.cmpn(l)===-1},s.prototype.lt=function(l){return this.cmp(l)===-1},s.prototype.lten=function(l){return this.cmpn(l)<=0},s.prototype.lte=function(l){return this.cmp(l)<=0},s.prototype.eqn=function(l){return this.cmpn(l)===0},s.prototype.eq=function(l){return this.cmp(l)===0},s.red=function(l){return new re(l)},s.prototype.toRed=function(l){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),l.convertTo(this)._forceRed(l)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(l){return this.red=l,this},s.prototype.forceRed=function(l){return n(!this.red,"Already a number in reduction context"),this._forceRed(l)},s.prototype.redAdd=function(l){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,l)},s.prototype.redIAdd=function(l){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,l)},s.prototype.redSub=function(l){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,l)},s.prototype.redISub=function(l){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,l)},s.prototype.redShl=function(l){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,l)},s.prototype.redMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.mul(this,l)},s.prototype.redIMul=function(l){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,l),this.red.imul(this,l)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(l){return n(this.red&&!l.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,l)};var Z={k256:null,p224:null,p192:null,p25519:null};function j(A,l){this.name=A,this.p=new s(l,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}j.prototype._tmp=function(){var l=new s(null);return l.words=new Array(Math.ceil(this.n/13)),l},j.prototype.ireduce=function(l){var p=l,m;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),m=p.bitLength();while(m>this.n);var w=m<this.n?-1:p.ucmp(this.p);return w===0?(p.words[0]=0,p.length=1):w>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},j.prototype.split=function(l,p){l.iushrn(this.n,0,p)},j.prototype.imulK=function(l){return l.imul(this.k)};function X(){j.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}i(X,j),X.prototype.split=function(l,p){for(var m=4194303,w=Math.min(l.length,9),E=0;E<w;E++)p.words[E]=l.words[E];if(p.length=w,l.length<=9){l.words[0]=0,l.length=1;return}var k=l.words[9];for(p.words[p.length++]=k&m,E=10;E<l.length;E++){var M=l.words[E]|0;l.words[E-10]=(M&m)<<4|k>>>22,k=M}k>>>=22,l.words[E-10]=k,k===0&&l.length>10?l.length-=10:l.length-=9},X.prototype.imulK=function(l){l.words[l.length]=0,l.words[l.length+1]=0,l.length+=2;for(var p=0,m=0;m<l.length;m++){var w=l.words[m]|0;p+=w*977,l.words[m]=p&67108863,p=w*64+(p/67108864|0)}return l.words[l.length-1]===0&&(l.length--,l.words[l.length-1]===0&&l.length--),l};function ee(){j.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}i(ee,j);function Q(){j.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}i(Q,j);function Ce(){j.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}i(Ce,j),Ce.prototype.imulK=function(l){for(var p=0,m=0;m<l.length;m++){var w=(l.words[m]|0)*19+p,E=w&67108863;w>>>=26,l.words[m]=E,p=w}return p!==0&&(l.words[l.length++]=p),l},s._prime=function(l){if(Z[l])return Z[l];var p;if(l==="k256")p=new X;else if(l==="p224")p=new ee;else if(l==="p192")p=new Q;else if(l==="p25519")p=new Ce;else throw new Error("Unknown prime "+l);return Z[l]=p,p};function re(A){if(typeof A=="string"){var l=s._prime(A);this.m=l.p,this.prime=l}else n(A.gtn(1),"modulus must be greater than 1"),this.m=A,this.prime=null}re.prototype._verify1=function(l){n(l.negative===0,"red works only with positives"),n(l.red,"red works only with red numbers")},re.prototype._verify2=function(l,p){n((l.negative|p.negative)===0,"red works only with positives"),n(l.red&&l.red===p.red,"red works only with red numbers")},re.prototype.imod=function(l){return this.prime?this.prime.ireduce(l)._forceRed(this):(g(l,l.umod(this.m)._forceRed(this)),l)},re.prototype.neg=function(l){return l.isZero()?l.clone():this.m.sub(l)._forceRed(this)},re.prototype.add=function(l,p){this._verify2(l,p);var m=l.add(p);return m.cmp(this.m)>=0&&m.isub(this.m),m._forceRed(this)},re.prototype.iadd=function(l,p){this._verify2(l,p);var m=l.iadd(p);return m.cmp(this.m)>=0&&m.isub(this.m),m},re.prototype.sub=function(l,p){this._verify2(l,p);var m=l.sub(p);return m.cmpn(0)<0&&m.iadd(this.m),m._forceRed(this)},re.prototype.isub=function(l,p){this._verify2(l,p);var m=l.isub(p);return m.cmpn(0)<0&&m.iadd(this.m),m},re.prototype.shl=function(l,p){return this._verify1(l),this.imod(l.ushln(p))},re.prototype.imul=function(l,p){return this._verify2(l,p),this.imod(l.imul(p))},re.prototype.mul=function(l,p){return this._verify2(l,p),this.imod(l.mul(p))},re.prototype.isqr=function(l){return this.imul(l,l.clone())},re.prototype.sqr=function(l){return this.mul(l,l)},re.prototype.sqrt=function(l){if(l.isZero())return l.clone();var p=this.m.andln(3);if(n(p%2===1),p===3){var m=this.m.add(new s(1)).iushrn(2);return this.pow(l,m)}for(var w=this.m.subn(1),E=0;!w.isZero()&&w.andln(1)===0;)E++,w.iushrn(1);n(!w.isZero());var k=new s(1).toRed(this),M=k.redNeg(),b=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new s(2*d*d).toRed(this);this.pow(d,b).cmp(M)!==0;)d.redIAdd(M);for(var I=this.pow(d,w),$=this.pow(l,w.addn(1).iushrn(1)),V=this.pow(l,w),Y=E;V.cmp(k)!==0;){for(var be=V,oe=0;be.cmp(k)!==0;oe++)be=be.redSqr();n(oe<Y);var de=this.pow(I,new s(1).iushln(Y-oe-1));$=$.redMul(de),I=de.redSqr(),V=V.redMul(I),Y=oe}return $},re.prototype.invm=function(l){var p=l._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},re.prototype.pow=function(l,p){if(p.isZero())return new s(1).toRed(this);if(p.cmpn(1)===0)return l.clone();var m=4,w=new Array(1<<m);w[0]=new s(1).toRed(this),w[1]=l;for(var E=2;E<w.length;E++)w[E]=this.mul(w[E-1],l);var k=w[0],M=0,b=0,d=p.bitLength()%26;for(d===0&&(d=26),E=p.length-1;E>=0;E--){for(var I=p.words[E],$=d-1;$>=0;$--){var V=I>>$&1;if(k!==w[0]&&(k=this.sqr(k)),V===0&&M===0){b=0;continue}M<<=1,M|=V,b++,!(b!==m&&(E!==0||$!==0))&&(k=this.mul(k,w[M]),b=0,M=0)}d=26}return k},re.prototype.convertTo=function(l){var p=l.umod(this.m);return p===l?p.clone():p},re.prototype.convertFrom=function(l){var p=l.clone();return p.red=null,p},s.mont=function(l){return new he(l)};function he(A){re.call(this,A),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}i(he,re),he.prototype.convertTo=function(l){return this.imod(l.ushln(this.shift))},he.prototype.convertFrom=function(l){var p=this.imod(l.mul(this.rinv));return p.red=null,p},he.prototype.imul=function(l,p){if(l.isZero()||p.isZero())return l.words[0]=0,l.length=1,l;var m=l.imul(p),w=m.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),E=m.isub(w).iushrn(this.shift),k=E;return E.cmp(this.m)>=0?k=E.isub(this.m):E.cmpn(0)<0&&(k=E.iadd(this.m)),k._forceRed(this)},he.prototype.mul=function(l,p){if(l.isZero()||p.isZero())return new s(0)._forceRed(this);var m=l.mul(p),w=m.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),E=m.isub(w).iushrn(this.shift),k=E;return E.cmp(this.m)>=0?k=E.isub(this.m):E.cmpn(0)<0&&(k=E.iadd(this.m)),k._forceRed(this)},he.prototype.invm=function(l){var p=this.imod(l._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,bn)})(Hl);var Ap=Hl.exports;const Mh=Fo(Ap);var Tc={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(r,e){var t=pe,n=t.Buffer;function i(o,a){for(var c in o)a[c]=o[c]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?r.exports=t:(i(t,e),e.Buffer=s);function s(o,a,c){return n(o,a,c)}s.prototype=Object.create(n.prototype),i(n,s),s.from=function(o,a,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return n(o,a,c)},s.alloc=function(o,a,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var u=n(o);return a!==void 0?typeof c=="string"?u.fill(a,c):u.fill(a):u.fill(0),u},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return n(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}})(Tc,Tc.exports);var _E=Tc.exports,Ns=_E.Buffer;function wE(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var n=0;n<r.length;n++){var i=r.charAt(n),s=i.charCodeAt(0);if(e[s]!==255)throw new TypeError(i+" is ambiguous");e[s]=n}var o=r.length,a=r.charAt(0),c=Math.log(o)/Math.log(256),u=Math.log(256)/Math.log(o);function g(x){if((Array.isArray(x)||x instanceof Uint8Array)&&(x=Ns.from(x)),!Ns.isBuffer(x))throw new TypeError("Expected Buffer");if(x.length===0)return"";for(var T=0,R=0,C=0,D=x.length;C!==D&&x[C]===0;)C++,T++;for(var U=(D-C)*u+1>>>0,L=new Uint8Array(U);C!==D;){for(var z=x[C],Z=0,j=U-1;(z!==0||Z<R)&&j!==-1;j--,Z++)z+=256*L[j]>>>0,L[j]=z%o>>>0,z=z/o>>>0;if(z!==0)throw new Error("Non-zero carry");R=Z,C++}for(var X=U-R;X!==U&&L[X]===0;)X++;for(var ee=a.repeat(T);X<U;++X)ee+=r.charAt(L[X]);return ee}function y(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return Ns.alloc(0);for(var T=0,R=0,C=0;x[T]===a;)R++,T++;for(var D=(x.length-T)*c+1>>>0,U=new Uint8Array(D);T<x.length;){var L=e[x.charCodeAt(T)];if(L===255)return;for(var z=0,Z=D-1;(L!==0||z<C)&&Z!==-1;Z--,z++)L+=o*U[Z]>>>0,U[Z]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");C=z,T++}for(var j=D-C;j!==D&&U[j]===0;)j++;var X=Ns.allocUnsafe(R+(D-j));X.fill(0,0,R);for(var ee=R;j!==D;)X[ee++]=U[j++];return X}function v(x){var T=y(x);if(T)return T;throw new Error("Non-base"+o+" character")}return{encode:g,decodeUnsafe:y,decode:v}}var bE=wE,vE=bE,EE="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Tp=vE(EE);const Lt=Fo(Tp),SE=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),er=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),tr=new Uint32Array(64);class IE extends yp{constructor(){super(64,32,8,!1),this.A=er[0]|0,this.B=er[1]|0,this.C=er[2]|0,this.D=er[3]|0,this.E=er[4]|0,this.F=er[5]|0,this.G=er[6]|0,this.H=er[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let y=0;y<16;y++,t+=4)tr[y]=e.getUint32(t,!1);for(let y=16;y<64;y++){const v=tr[y-15],x=tr[y-2],T=En(v,7)^En(v,18)^v>>>3,R=En(x,17)^En(x,19)^x>>>10;tr[y]=R+tr[y-7]+T+tr[y-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:g}=this;for(let y=0;y<64;y++){const v=En(a,6)^En(a,11)^En(a,25),x=g+v+c1(a,c,u)+SE[y]+tr[y]|0,R=(En(n,2)^En(n,13)^En(n,22))+l1(n,i,s)|0;g=u,u=c,c=a,a=o+x|0,o=s,s=i,i=n,n=x+R|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,g=g+this.H|0,this.set(n,i,s,o,a,c,u,g)}roundClean(){tr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Rc=gp(()=>new IE);var Bt={};function On(r,e,t){return e<=r&&r<=t}function Vo(r){if(r===void 0)return{};if(r===Object(r))return r;throw TypeError("Could not convert argument to dictionary")}function xE(r){for(var e=String(r),t=e.length,n=0,i=[];n<t;){var s=e.charCodeAt(n);if(s<55296||s>57343)i.push(s);else if(56320<=s&&s<=57343)i.push(65533);else if(55296<=s&&s<=56319)if(n===t-1)i.push(65533);else{var o=r.charCodeAt(n+1);if(56320<=o&&o<=57343){var a=s&1023,c=o&1023;i.push(65536+(a<<10)+c),n+=1}else i.push(65533)}n+=1}return i}function kE(r){for(var e="",t=0;t<r.length;++t){var n=r[t];n<=65535?e+=String.fromCharCode(n):(n-=65536,e+=String.fromCharCode((n>>10)+55296,(n&1023)+56320))}return e}var fo=-1;function ql(r){this.tokens=[].slice.call(r)}ql.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():fo},prepend:function(r){if(Array.isArray(r))for(var e=r;e.length;)this.tokens.unshift(e.pop());else this.tokens.unshift(r)},push:function(r){if(Array.isArray(r))for(var e=r;e.length;)this.tokens.push(e.shift());else this.tokens.push(r)}};var vi=-1;function qa(r,e){if(r)throw TypeError("Decoder error");return e||65533}var po="utf-8";function go(r,e){if(!(this instanceof go))return new go(r,e);if(r=r!==void 0?String(r).toLowerCase():po,r!==po)throw new Error("Encoding not supported. Only utf-8 is supported");e=Vo(e),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=!!e.fatal,this._ignoreBOM=!!e.ignoreBOM,Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}go.prototype={decode:function(e,t){var n;typeof e=="object"&&e instanceof ArrayBuffer?n=new Uint8Array(e):typeof e=="object"&&"buffer"in e&&e.buffer instanceof ArrayBuffer?n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):n=new Uint8Array(0),t=Vo(t),this._streaming||(this._decoder=new CE({fatal:this._fatal}),this._BOMseen=!1),this._streaming=!!t.stream;for(var i=new ql(n),s=[],o;!i.endOfStream()&&(o=this._decoder.handler(i,i.read()),o!==vi);)o!==null&&(Array.isArray(o)?s.push.apply(s,o):s.push(o));if(!this._streaming){do{if(o=this._decoder.handler(i,i.read()),o===vi)break;o!==null&&(Array.isArray(o)?s.push.apply(s,o):s.push(o))}while(!i.endOfStream());this._decoder=null}return s.length&&["utf-8"].indexOf(this.encoding)!==-1&&!this._ignoreBOM&&!this._BOMseen&&(s[0]===65279?(this._BOMseen=!0,s.shift()):this._BOMseen=!0),kE(s)}};function mo(r,e){if(!(this instanceof mo))return new mo(r,e);if(r=r!==void 0?String(r).toLowerCase():po,r!==po)throw new Error("Encoding not supported. Only utf-8 is supported");e=Vo(e),this._streaming=!1,this._encoder=null,this._options={fatal:!!e.fatal},Object.defineProperty(this,"encoding",{value:"utf-8"})}mo.prototype={encode:function(e,t){e=e?String(e):"",t=Vo(t),this._streaming||(this._encoder=new AE(this._options)),this._streaming=!!t.stream;for(var n=[],i=new ql(xE(e)),s;!i.endOfStream()&&(s=this._encoder.handler(i,i.read()),s!==vi);)Array.isArray(s)?n.push.apply(n,s):n.push(s);if(!this._streaming){for(;s=this._encoder.handler(i,i.read()),s!==vi;)Array.isArray(s)?n.push.apply(n,s):n.push(s);this._encoder=null}return new Uint8Array(n)}};function CE(r){var e=r.fatal,t=0,n=0,i=0,s=128,o=191;this.handler=function(a,c){if(c===fo&&i!==0)return i=0,qa(e);if(c===fo)return vi;if(i===0){if(On(c,0,127))return c;if(On(c,194,223))i=1,t=c-192;else if(On(c,224,239))c===224&&(s=160),c===237&&(o=159),i=2,t=c-224;else if(On(c,240,244))c===240&&(s=144),c===244&&(o=143),i=3,t=c-240;else return qa(e);return t=t<<6*i,null}if(!On(c,s,o))return t=i=n=0,s=128,o=191,a.prepend(c),qa(e);if(s=128,o=191,n+=1,t+=c-128<<6*(i-n),n!==i)return null;var u=t;return t=i=n=0,u}}function AE(r){r.fatal,this.handler=function(e,t){if(t===fo)return vi;if(On(t,0,127))return t;var n,i;On(t,128,2047)?(n=1,i=192):On(t,2048,65535)?(n=2,i=224):On(t,65536,1114111)&&(n=3,i=240);for(var s=[(t>>6*n)+i];n>0;){var o=t>>6*(n-1);s.push(128|o&63),n-=1}return s}}const TE=Object.freeze(Object.defineProperty({__proto__:null,TextDecoder:go,TextEncoder:mo},Symbol.toStringTag,{value:"Module"})),RE=Pl(TE);var ME=bn&&bn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),NE=bn&&bn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Rn=bn&&bn.__decorate||function(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},BE=bn&&bn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.hasOwnProperty.call(r,t)&&ME(e,r,t);return NE(e,r),e},Rp=bn&&bn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Bt,"__esModule",{value:!0});var Mp=Bt.deserializeUnchecked=Dp=Bt.deserialize=Op=Bt.serialize=Bt.BinaryReader=Bt.BinaryWriter=Bt.BorshError=Bt.baseDecode=Bt.baseEncode=void 0;const lr=Rp(Ap),Np=Rp(Tp),PE=BE(RE),LE=typeof TextDecoder!="function"?PE.TextDecoder:TextDecoder,OE=new LE("utf-8",{fatal:!0});function DE(r){return typeof r=="string"&&(r=Buffer.from(r,"utf8")),Np.default.encode(Buffer.from(r))}Bt.baseEncode=DE;function FE(r){return Buffer.from(Np.default.decode(r))}Bt.baseDecode=FE;const za=1024;class Ht extends Error{constructor(e){super(e),this.fieldPath=[],this.originalMessage=e}addToFieldPath(e){this.fieldPath.splice(0,0,e),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}Bt.BorshError=Ht;class Bp{constructor(){this.buf=Buffer.alloc(za),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=Buffer.concat([this.buf,Buffer.alloc(za)]))}writeU8(e){this.maybeResize(),this.buf.writeUInt8(e,this.length),this.length+=1}writeU16(e){this.maybeResize(),this.buf.writeUInt16LE(e,this.length),this.length+=2}writeU32(e){this.maybeResize(),this.buf.writeUInt32LE(e,this.length),this.length+=4}writeU64(e){this.maybeResize(),this.writeBuffer(Buffer.from(new lr.default(e).toArray("le",8)))}writeU128(e){this.maybeResize(),this.writeBuffer(Buffer.from(new lr.default(e).toArray("le",16)))}writeU256(e){this.maybeResize(),this.writeBuffer(Buffer.from(new lr.default(e).toArray("le",32)))}writeU512(e){this.maybeResize(),this.writeBuffer(Buffer.from(new lr.default(e).toArray("le",64)))}writeBuffer(e){this.buf=Buffer.concat([Buffer.from(this.buf.subarray(0,this.length)),e,Buffer.alloc(za)]),this.length+=e.length}writeString(e){this.maybeResize();const t=Buffer.from(e,"utf8");this.writeU32(t.length),this.writeBuffer(t)}writeFixedArray(e){this.writeBuffer(Buffer.from(e))}writeArray(e,t){this.maybeResize(),this.writeU32(e.length);for(const n of e)this.maybeResize(),t(n)}toArray(){return this.buf.subarray(0,this.length)}}Bt.BinaryWriter=Bp;function Mn(r,e,t){const n=t.value;t.value=function(...i){try{return n.apply(this,i)}catch(s){if(s instanceof RangeError){const o=s.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(o)>=0)throw new Ht("Reached the end of buffer when deserializing")}throw s}}}class tn{constructor(e){this.buf=e,this.offset=0}readU8(){const e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readU16(){const e=this.buf.readUInt16LE(this.offset);return this.offset+=2,e}readU32(){const e=this.buf.readUInt32LE(this.offset);return this.offset+=4,e}readU64(){const e=this.readBuffer(8);return new lr.default(e,"le")}readU128(){const e=this.readBuffer(16);return new lr.default(e,"le")}readU256(){const e=this.readBuffer(32);return new lr.default(e,"le")}readU512(){const e=this.readBuffer(64);return new lr.default(e,"le")}readBuffer(e){if(this.offset+e>this.buf.length)throw new Ht(`Expected buffer length ${e} isn't within bounds`);const t=this.buf.slice(this.offset,this.offset+e);return this.offset+=e,t}readString(){const e=this.readU32(),t=this.readBuffer(e);try{return OE.decode(t)}catch(n){throw new Ht(`Error decoding UTF-8 string: ${n}`)}}readFixedArray(e){return new Uint8Array(this.readBuffer(e))}readArray(e){const t=this.readU32(),n=Array();for(let i=0;i<t;++i)n.push(e());return n}}Rn([Mn],tn.prototype,"readU8",null);Rn([Mn],tn.prototype,"readU16",null);Rn([Mn],tn.prototype,"readU32",null);Rn([Mn],tn.prototype,"readU64",null);Rn([Mn],tn.prototype,"readU128",null);Rn([Mn],tn.prototype,"readU256",null);Rn([Mn],tn.prototype,"readU512",null);Rn([Mn],tn.prototype,"readString",null);Rn([Mn],tn.prototype,"readFixedArray",null);Rn([Mn],tn.prototype,"readArray",null);Bt.BinaryReader=tn;function Pp(r){return r.charAt(0).toUpperCase()+r.slice(1)}function xr(r,e,t,n,i){try{if(typeof n=="string")i[`write${Pp(n)}`](t);else if(n instanceof Array)if(typeof n[0]=="number"){if(t.length!==n[0])throw new Ht(`Expecting byte array of length ${n[0]}, but got ${t.length} bytes`);i.writeFixedArray(t)}else if(n.length===2&&typeof n[1]=="number"){if(t.length!==n[1])throw new Ht(`Expecting byte array of length ${n[1]}, but got ${t.length} bytes`);for(let s=0;s<n[1];s++)xr(r,null,t[s],n[0],i)}else i.writeArray(t,s=>{xr(r,e,s,n[0],i)});else if(n.kind!==void 0)switch(n.kind){case"option":{t==null?i.writeU8(0):(i.writeU8(1),xr(r,e,t,n.type,i));break}case"map":{i.writeU32(t.size),t.forEach((s,o)=>{xr(r,e,o,n.key,i),xr(r,e,s,n.value,i)});break}default:throw new Ht(`FieldType ${n} unrecognized`)}else Lp(r,t,i)}catch(s){throw s instanceof Ht&&s.addToFieldPath(e),s}}function Lp(r,e,t){if(typeof e.borshSerialize=="function"){e.borshSerialize(t);return}const n=r.get(e.constructor);if(!n)throw new Ht(`Class ${e.constructor.name} is missing in schema`);if(n.kind==="struct")n.fields.map(([i,s])=>{xr(r,i,e[i],s,t)});else if(n.kind==="enum"){const i=e[n.field];for(let s=0;s<n.values.length;++s){const[o,a]=n.values[s];if(o===i){t.writeU8(s),xr(r,o,e[o],a,t);break}}}else throw new Ht(`Unexpected schema kind: ${n.kind} for ${e.constructor.name}`)}function UE(r,e,t=Bp){const n=new t;return Lp(r,e,n),n.toArray()}var Op=Bt.serialize=UE;function kr(r,e,t,n){try{if(typeof t=="string")return n[`read${Pp(t)}`]();if(t instanceof Array){if(typeof t[0]=="number")return n.readFixedArray(t[0]);if(typeof t[1]=="number"){const i=[];for(let s=0;s<t[1];s++)i.push(kr(r,null,t[0],n));return i}else return n.readArray(()=>kr(r,e,t[0],n))}if(t.kind==="option")return n.readU8()?kr(r,e,t.type,n):void 0;if(t.kind==="map"){let i=new Map;const s=n.readU32();for(let o=0;o<s;o++){const a=kr(r,e,t.key,n),c=kr(r,e,t.value,n);i.set(a,c)}return i}return zl(r,t,n)}catch(i){throw i instanceof Ht&&i.addToFieldPath(e),i}}function zl(r,e,t){if(typeof e.borshDeserialize=="function")return e.borshDeserialize(t);const n=r.get(e);if(!n)throw new Ht(`Class ${e.name} is missing in schema`);if(n.kind==="struct"){const i={};for(const[s,o]of r.get(e).fields)i[s]=kr(r,s,o,t);return new e(i)}if(n.kind==="enum"){const i=t.readU8();if(i>=n.values.length)throw new Ht(`Enum index: ${i} is out of range`);const[s,o]=n.values[i],a=kr(r,s,o,t);return new e({[s]:a})}throw new Ht(`Unexpected schema kind: ${n.kind} for ${e.constructor.name}`)}function WE(r,e,t,n=tn){const i=new n(t),s=zl(r,e,i);if(i.offset<t.length)throw new Ht(`Unexpected ${t.length-i.offset} bytes after deserialized data`);return s}var Dp=Bt.deserialize=WE;function $E(r,e,t,n=tn){const i=new n(t);return zl(r,e,i)}Mp=Bt.deserializeUnchecked=$E;var O={};Object.defineProperty(O,"__esModule",{value:!0});O.s16=O.s8=O.nu64be=O.u48be=O.u40be=O.u32be=O.u24be=O.u16be=Mt=O.nu64=O.u48=O.u40=ie=O.u32=O.u24=on=O.u16=Me=O.u8=Rr=O.offset=O.greedy=O.Constant=O.UTF8=O.CString=O.Blob=O.Boolean=O.BitField=O.BitStructure=O.VariantLayout=O.Union=O.UnionLayoutDiscriminator=O.UnionDiscriminator=O.Structure=O.Sequence=O.DoubleBE=O.Double=O.FloatBE=O.Float=O.NearInt64BE=O.NearInt64=O.NearUInt64BE=O.NearUInt64=O.IntBE=O.Int=O.UIntBE=O.UInt=O.OffsetLayout=O.GreedyCount=O.ExternalLayout=O.bindConstructorLayout=O.nameWithProperty=O.Layout=O.uint8ArrayToBuffer=O.checkUint8Array=void 0;O.constant=O.utf8=O.cstr=Xe=O.blob=O.unionLayoutDiscriminator=O.union=qt=O.seq=O.bits=te=O.struct=O.f64be=O.f64=O.f32be=O.f32=O.ns64be=O.s48be=O.s40be=O.s32be=O.s24be=O.s16be=en=O.ns64=O.s48=O.s40=O.s32=O.s24=void 0;const Vl=pe;function Mi(r){if(!(r instanceof Uint8Array))throw new TypeError("b must be a Uint8Array")}O.checkUint8Array=Mi;function Re(r){return Mi(r),Vl.Buffer.from(r.buffer,r.byteOffset,r.length)}O.uint8ArrayToBuffer=Re;class Ne{constructor(e,t){if(!Number.isInteger(e))throw new TypeError("span must be an integer");this.span=e,this.property=t}makeDestinationObject(){return{}}getSpan(e,t){if(0>this.span)throw new RangeError("indeterminate span");return this.span}replicate(e){const t=Object.create(this.constructor.prototype);return Object.assign(t,this),t.property=e,t}fromArray(e){}}O.Layout=Ne;function Gl(r,e){return e.property?r+"["+e.property+"]":r}O.nameWithProperty=Gl;function HE(r,e){if(typeof r!="function")throw new TypeError("Class must be constructor");if(Object.prototype.hasOwnProperty.call(r,"layout_"))throw new Error("Class is already bound to a layout");if(!(e&&e instanceof Ne))throw new TypeError("layout must be a Layout");if(Object.prototype.hasOwnProperty.call(e,"boundConstructor_"))throw new Error("layout is already bound to a constructor");r.layout_=e,e.boundConstructor_=r,e.makeDestinationObject=()=>new r,Object.defineProperty(r.prototype,"encode",{value(t,n){return e.encode(this,t,n)},writable:!0}),Object.defineProperty(r,"decode",{value(t,n){return e.decode(t,n)},writable:!0})}O.bindConstructorLayout=HE;class Xt extends Ne{isCount(){throw new Error("ExternalLayout is abstract")}}O.ExternalLayout=Xt;class Fp extends Xt{constructor(e=1,t){if(!Number.isInteger(e)||0>=e)throw new TypeError("elementSpan must be a (positive) integer");super(-1,t),this.elementSpan=e}isCount(){return!0}decode(e,t=0){Mi(e);const n=e.length-t;return Math.floor(n/this.elementSpan)}encode(e,t,n){return 0}}O.GreedyCount=Fp;class jl extends Xt{constructor(e,t=0,n){if(!(e instanceof Ne))throw new TypeError("layout must be a Layout");if(!Number.isInteger(t))throw new TypeError("offset must be integer or undefined");super(e.span,n||e.property),this.layout=e,this.offset=t}isCount(){return this.layout instanceof dn||this.layout instanceof wn}decode(e,t=0){return this.layout.decode(e,t+this.offset)}encode(e,t,n=0){return this.layout.encode(e,t,n+this.offset)}}O.OffsetLayout=jl;class dn extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readUIntLE(t,this.span)}encode(e,t,n=0){return Re(t).writeUIntLE(e,n,this.span),this.span}}O.UInt=dn;class wn extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readUIntBE(t,this.span)}encode(e,t,n=0){return Re(t).writeUIntBE(e,n,this.span),this.span}}O.UIntBE=wn;class $r extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readIntLE(t,this.span)}encode(e,t,n=0){return Re(t).writeIntLE(e,n,this.span),this.span}}O.Int=$r;class Ni extends Ne{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return Re(e).readIntBE(t,this.span)}encode(e,t,n=0){return Re(t).writeIntBE(e,n,this.span),this.span}}O.IntBE=Ni;const Mc=Math.pow(2,32);function Go(r){const e=Math.floor(r/Mc),t=r-e*Mc;return{hi32:e,lo32:t}}function jo(r,e){return r*Mc+e}class Up extends Ne{constructor(e){super(8,e)}decode(e,t=0){const n=Re(e),i=n.readUInt32LE(t),s=n.readUInt32LE(t+4);return jo(s,i)}encode(e,t,n=0){const i=Go(e),s=Re(t);return s.writeUInt32LE(i.lo32,n),s.writeUInt32LE(i.hi32,n+4),8}}O.NearUInt64=Up;class Wp extends Ne{constructor(e){super(8,e)}decode(e,t=0){const n=Re(e),i=n.readUInt32BE(t),s=n.readUInt32BE(t+4);return jo(i,s)}encode(e,t,n=0){const i=Go(e),s=Re(t);return s.writeUInt32BE(i.hi32,n),s.writeUInt32BE(i.lo32,n+4),8}}O.NearUInt64BE=Wp;class $p extends Ne{constructor(e){super(8,e)}decode(e,t=0){const n=Re(e),i=n.readUInt32LE(t),s=n.readInt32LE(t+4);return jo(s,i)}encode(e,t,n=0){const i=Go(e),s=Re(t);return s.writeUInt32LE(i.lo32,n),s.writeInt32LE(i.hi32,n+4),8}}O.NearInt64=$p;class Hp extends Ne{constructor(e){super(8,e)}decode(e,t=0){const n=Re(e),i=n.readInt32BE(t),s=n.readUInt32BE(t+4);return jo(i,s)}encode(e,t,n=0){const i=Go(e),s=Re(t);return s.writeInt32BE(i.hi32,n),s.writeUInt32BE(i.lo32,n+4),8}}O.NearInt64BE=Hp;class qp extends Ne{constructor(e){super(4,e)}decode(e,t=0){return Re(e).readFloatLE(t)}encode(e,t,n=0){return Re(t).writeFloatLE(e,n),4}}O.Float=qp;class zp extends Ne{constructor(e){super(4,e)}decode(e,t=0){return Re(e).readFloatBE(t)}encode(e,t,n=0){return Re(t).writeFloatBE(e,n),4}}O.FloatBE=zp;class Vp extends Ne{constructor(e){super(8,e)}decode(e,t=0){return Re(e).readDoubleLE(t)}encode(e,t,n=0){return Re(t).writeDoubleLE(e,n),8}}O.Double=Vp;class Gp extends Ne{constructor(e){super(8,e)}decode(e,t=0){return Re(e).readDoubleBE(t)}encode(e,t,n=0){return Re(t).writeDoubleBE(e,n),8}}O.DoubleBE=Gp;class jp extends Ne{constructor(e,t,n){if(!(e instanceof Ne))throw new TypeError("elementLayout must be a Layout");if(!(t instanceof Xt&&t.isCount()||Number.isInteger(t)&&0<=t))throw new TypeError("count must be non-negative integer or an unsigned integer ExternalLayout");let i=-1;!(t instanceof Xt)&&0<e.span&&(i=t*e.span),super(i,n),this.elementLayout=e,this.count=t}getSpan(e,t=0){if(0<=this.span)return this.span;let n=0,i=this.count;if(i instanceof Xt&&(i=i.decode(e,t)),0<this.elementLayout.span)n=i*this.elementLayout.span;else{let s=0;for(;s<i;)n+=this.elementLayout.getSpan(e,t+n),++s}return n}decode(e,t=0){const n=[];let i=0,s=this.count;for(s instanceof Xt&&(s=s.decode(e,t));i<s;)n.push(this.elementLayout.decode(e,t)),t+=this.elementLayout.getSpan(e,t),i+=1;return n}encode(e,t,n=0){const i=this.elementLayout,s=e.reduce((o,a)=>o+i.encode(a,t,n+o),0);return this.count instanceof Xt&&this.count.encode(e.length,t,n),s}}O.Sequence=jp;class Kp extends Ne{constructor(e,t,n){if(!(Array.isArray(e)&&e.reduce((s,o)=>s&&o instanceof Ne,!0)))throw new TypeError("fields must be array of Layout instances");typeof t=="boolean"&&n===void 0&&(n=t,t=void 0);for(const s of e)if(0>s.span&&s.property===void 0)throw new Error("fields cannot contain unnamed variable-length layout");let i=-1;try{i=e.reduce((s,o)=>s+o.getSpan(),0)}catch{}super(i,t),this.fields=e,this.decodePrefixes=!!n}getSpan(e,t=0){if(0<=this.span)return this.span;let n=0;try{n=this.fields.reduce((i,s)=>{const o=s.getSpan(e,t);return t+=o,i+o},0)}catch{throw new RangeError("indeterminate span")}return n}decode(e,t=0){Mi(e);const n=this.makeDestinationObject();for(const i of this.fields)if(i.property!==void 0&&(n[i.property]=i.decode(e,t)),t+=i.getSpan(e,t),this.decodePrefixes&&e.length===t)break;return n}encode(e,t,n=0){const i=n;let s=0,o=0;for(const a of this.fields){let c=a.span;if(o=0<c?c:0,a.property!==void 0){const u=e[a.property];u!==void 0&&(o=a.encode(u,t,n),0>c&&(c=a.getSpan(t,n)))}s=n,n+=c}return s+o-i}fromArray(e){const t=this.makeDestinationObject();for(const n of this.fields)n.property!==void 0&&0<e.length&&(t[n.property]=e.shift());return t}layoutFor(e){if(typeof e!="string")throw new TypeError("property must be string");for(const t of this.fields)if(t.property===e)return t}offsetOf(e){if(typeof e!="string")throw new TypeError("property must be string");let t=0;for(const n of this.fields){if(n.property===e)return t;0>n.span?t=-1:0<=t&&(t+=n.span)}}}O.Structure=Kp;class Kl{constructor(e){this.property=e}decode(e,t){throw new Error("UnionDiscriminator is abstract")}encode(e,t,n){throw new Error("UnionDiscriminator is abstract")}}O.UnionDiscriminator=Kl;class yo extends Kl{constructor(e,t){if(!(e instanceof Xt&&e.isCount()))throw new TypeError("layout must be an unsigned integer ExternalLayout");super(t||e.property||"variant"),this.layout=e}decode(e,t){return this.layout.decode(e,t)}encode(e,t,n){return this.layout.encode(e,t,n)}}O.UnionLayoutDiscriminator=yo;class Yl extends Ne{constructor(e,t,n){let i;if(e instanceof dn||e instanceof wn)i=new yo(new jl(e));else if(e instanceof Xt&&e.isCount())i=new yo(e);else if(e instanceof Kl)i=e;else throw new TypeError("discr must be a UnionDiscriminator or an unsigned integer layout");if(t===void 0&&(t=null),!(t===null||t instanceof Ne))throw new TypeError("defaultLayout must be null or a Layout");if(t!==null){if(0>t.span)throw new Error("defaultLayout must have constant span");t.property===void 0&&(t=t.replicate("content"))}let s=-1;t&&(s=t.span,0<=s&&(e instanceof dn||e instanceof wn)&&(s+=i.layout.span)),super(s,n),this.discriminator=i,this.usesPrefixDiscriminator=e instanceof dn||e instanceof wn,this.defaultLayout=t,this.registry={};let o=this.defaultGetSourceVariant.bind(this);this.getSourceVariant=function(a){return o(a)},this.configGetSourceVariant=function(a){o=a.bind(this)}}getSpan(e,t=0){if(0<=this.span)return this.span;const n=this.getVariant(e,t);if(!n)throw new Error("unable to determine span for unrecognized variant");return n.getSpan(e,t)}defaultGetSourceVariant(e){if(Object.prototype.hasOwnProperty.call(e,this.discriminator.property)){if(this.defaultLayout&&this.defaultLayout.property&&Object.prototype.hasOwnProperty.call(e,this.defaultLayout.property))return;const t=this.registry[e[this.discriminator.property]];if(t&&(!t.layout||t.property&&Object.prototype.hasOwnProperty.call(e,t.property)))return t}else for(const t in this.registry){const n=this.registry[t];if(n.property&&Object.prototype.hasOwnProperty.call(e,n.property))return n}throw new Error("unable to infer src variant")}decode(e,t=0){let n;const i=this.discriminator,s=i.decode(e,t),o=this.registry[s];if(o===void 0){const a=this.defaultLayout;let c=0;this.usesPrefixDiscriminator&&(c=i.layout.span),n=this.makeDestinationObject(),n[i.property]=s,n[a.property]=a.decode(e,t+c)}else n=o.decode(e,t);return n}encode(e,t,n=0){const i=this.getSourceVariant(e);if(i===void 0){const s=this.discriminator,o=this.defaultLayout;let a=0;return this.usesPrefixDiscriminator&&(a=s.layout.span),s.encode(e[s.property],t,n),a+o.encode(e[o.property],t,n+a)}return i.encode(e,t,n)}addVariant(e,t,n){const i=new Yp(this,e,t,n);return this.registry[e]=i,i}getVariant(e,t=0){let n;return e instanceof Uint8Array?n=this.discriminator.decode(e,t):n=e,this.registry[n]}}O.Union=Yl;class Yp extends Ne{constructor(e,t,n,i){if(!(e instanceof Yl))throw new TypeError("union must be a Union");if(!Number.isInteger(t)||0>t)throw new TypeError("variant must be a (non-negative) integer");if(typeof n=="string"&&i===void 0&&(i=n,n=null),n){if(!(n instanceof Ne))throw new TypeError("layout must be a Layout");if(e.defaultLayout!==null&&0<=n.span&&n.span>e.defaultLayout.span)throw new Error("variant span exceeds span of containing union");if(typeof i!="string")throw new TypeError("variant must have a String property")}let s=e.span;0>e.span&&(s=n?n.span:0,0<=s&&e.usesPrefixDiscriminator&&(s+=e.discriminator.layout.span)),super(s,i),this.union=e,this.variant=t,this.layout=n||null}getSpan(e,t=0){if(0<=this.span)return this.span;let n=0;this.union.usesPrefixDiscriminator&&(n=this.union.discriminator.layout.span);let i=0;return this.layout&&(i=this.layout.getSpan(e,t+n)),n+i}decode(e,t=0){const n=this.makeDestinationObject();if(this!==this.union.getVariant(e,t))throw new Error("variant mismatch");let i=0;return this.union.usesPrefixDiscriminator&&(i=this.union.discriminator.layout.span),this.layout?n[this.property]=this.layout.decode(e,t+i):this.property?n[this.property]=!0:this.union.usesPrefixDiscriminator&&(n[this.union.discriminator.property]=this.variant),n}encode(e,t,n=0){let i=0;if(this.union.usesPrefixDiscriminator&&(i=this.union.discriminator.layout.span),this.layout&&!Object.prototype.hasOwnProperty.call(e,this.property))throw new TypeError("variant lacks property "+this.property);this.union.discriminator.encode(this.variant,t,n);let s=i;if(this.layout&&(this.layout.encode(e[this.property],t,n+i),s+=this.layout.getSpan(t,n+i),0<=this.union.span&&s>this.union.span))throw new Error("encoded variant overruns containing union");return s}fromArray(e){if(this.layout)return this.layout.fromArray(e)}}O.VariantLayout=Yp;function Xr(r){return 0>r&&(r+=4294967296),r}class Jl extends Ne{constructor(e,t,n){if(!(e instanceof dn||e instanceof wn))throw new TypeError("word must be a UInt or UIntBE layout");if(typeof t=="string"&&n===void 0&&(n=t,t=!1),4<e.span)throw new RangeError("word cannot exceed 32 bits");super(e.span,n),this.word=e,this.msb=!!t,this.fields=[];let i=0;this._packedSetValue=function(s){return i=Xr(s),this},this._packedGetValue=function(){return i}}decode(e,t=0){const n=this.makeDestinationObject(),i=this.word.decode(e,t);this._packedSetValue(i);for(const s of this.fields)s.property!==void 0&&(n[s.property]=s.decode(e));return n}encode(e,t,n=0){const i=this.word.decode(t,n);this._packedSetValue(i);for(const s of this.fields)if(s.property!==void 0){const o=e[s.property];o!==void 0&&s.encode(o)}return this.word.encode(this._packedGetValue(),t,n)}addField(e,t){const n=new Zl(this,e,t);return this.fields.push(n),n}addBoolean(e){const t=new Jp(this,e);return this.fields.push(t),t}fieldFor(e){if(typeof e!="string")throw new TypeError("property must be string");for(const t of this.fields)if(t.property===e)return t}}O.BitStructure=Jl;class Zl{constructor(e,t,n){if(!(e instanceof Jl))throw new TypeError("container must be a BitStructure");if(!Number.isInteger(t)||0>=t)throw new TypeError("bits must be positive integer");const i=8*e.span,s=e.fields.reduce((o,a)=>o+a.bits,0);if(t+s>i)throw new Error("bits too long for span remainder ("+(i-s)+" of "+i+" remain)");this.container=e,this.bits=t,this.valueMask=(1<<t)-1,t===32&&(this.valueMask=4294967295),this.start=s,this.container.msb&&(this.start=i-s-t),this.wordMask=Xr(this.valueMask<<this.start),this.property=n}decode(e,t){const n=this.container._packedGetValue();return Xr(n&this.wordMask)>>>this.start}encode(e){if(typeof e!="number"||!Number.isInteger(e)||e!==Xr(e&this.valueMask))throw new TypeError(Gl("BitField.encode",this)+" value must be integer not exceeding "+this.valueMask);const t=this.container._packedGetValue(),n=Xr(e<<this.start);this.container._packedSetValue(Xr(t&~this.wordMask)|n)}}O.BitField=Zl;let Jp=class extends Zl{constructor(e,t){super(e,1,t)}decode(e,t){return!!super.decode(e,t)}encode(e){typeof e=="boolean"&&(e=+e),super.encode(e)}};O.Boolean=Jp;class Zp extends Ne{constructor(e,t){if(!(e instanceof Xt&&e.isCount()||Number.isInteger(e)&&0<=e))throw new TypeError("length must be positive integer or an unsigned integer ExternalLayout");let n=-1;e instanceof Xt||(n=e),super(n,t),this.length=e}getSpan(e,t){let n=this.span;return 0>n&&(n=this.length.decode(e,t)),n}decode(e,t=0){let n=this.span;return 0>n&&(n=this.length.decode(e,t)),Re(e).slice(t,t+n)}encode(e,t,n){let i=this.length;if(this.length instanceof Xt&&(i=e.length),!(e instanceof Uint8Array&&i===e.length))throw new TypeError(Gl("Blob.encode",this)+" requires (length "+i+") Uint8Array as src");if(n+i>t.length)throw new RangeError("encoding overruns Uint8Array");const s=Re(e);return Re(t).write(s.toString("hex"),n,i,"hex"),this.length instanceof Xt&&this.length.encode(i,t,n),i}}O.Blob=Zp;class Xp extends Ne{constructor(e){super(-1,e)}getSpan(e,t=0){Mi(e);let n=t;for(;n<e.length&&e[n]!==0;)n+=1;return 1+n-t}decode(e,t=0){const n=this.getSpan(e,t);return Re(e).slice(t,t+n-1).toString("utf-8")}encode(e,t,n=0){typeof e!="string"&&(e=String(e));const i=Vl.Buffer.from(e,"utf8"),s=i.length;if(n+s>t.length)throw new RangeError("encoding overruns Buffer");const o=Re(t);return i.copy(o,n),o[n+s]=0,s+1}}O.CString=Xp;class Qp extends Ne{constructor(e,t){if(typeof e=="string"&&t===void 0&&(t=e,e=void 0),e===void 0)e=-1;else if(!Number.isInteger(e))throw new TypeError("maxSpan must be an integer");super(-1,t),this.maxSpan=e}getSpan(e,t=0){return Mi(e),e.length-t}decode(e,t=0){const n=this.getSpan(e,t);if(0<=this.maxSpan&&this.maxSpan<n)throw new RangeError("text length exceeds maxSpan");return Re(e).slice(t,t+n).toString("utf-8")}encode(e,t,n=0){typeof e!="string"&&(e=String(e));const i=Vl.Buffer.from(e,"utf8"),s=i.length;if(0<=this.maxSpan&&this.maxSpan<s)throw new RangeError("text length exceeds maxSpan");if(n+s>t.length)throw new RangeError("encoding overruns Buffer");return i.copy(Re(t),n),s}}O.UTF8=Qp;class eg extends Ne{constructor(e,t){super(0,t),this.value=e}decode(e,t){return this.value}encode(e,t,n){return 0}}O.Constant=eg;O.greedy=(r,e)=>new Fp(r,e);var Rr=O.offset=(r,e,t)=>new jl(r,e,t),Me=O.u8=r=>new dn(1,r),on=O.u16=r=>new dn(2,r);O.u24=r=>new dn(3,r);var ie=O.u32=r=>new dn(4,r);O.u40=r=>new dn(5,r);O.u48=r=>new dn(6,r);var Mt=O.nu64=r=>new Up(r);O.u16be=r=>new wn(2,r);O.u24be=r=>new wn(3,r);O.u32be=r=>new wn(4,r);O.u40be=r=>new wn(5,r);O.u48be=r=>new wn(6,r);O.nu64be=r=>new Wp(r);O.s8=r=>new $r(1,r);O.s16=r=>new $r(2,r);O.s24=r=>new $r(3,r);O.s32=r=>new $r(4,r);O.s40=r=>new $r(5,r);O.s48=r=>new $r(6,r);var en=O.ns64=r=>new $p(r);O.s16be=r=>new Ni(2,r);O.s24be=r=>new Ni(3,r);O.s32be=r=>new Ni(4,r);O.s40be=r=>new Ni(5,r);O.s48be=r=>new Ni(6,r);O.ns64be=r=>new Hp(r);O.f32=r=>new qp(r);O.f32be=r=>new zp(r);O.f64=r=>new Vp(r);O.f64be=r=>new Gp(r);var te=O.struct=(r,e,t)=>new Kp(r,e,t);O.bits=(r,e,t)=>new Jl(r,e,t);var qt=O.seq=(r,e,t)=>new jp(r,e,t);O.union=(r,e,t)=>new Yl(r,e,t);O.unionLayoutDiscriminator=(r,e)=>new yo(r,e);var Xe=O.blob=(r,e)=>new Zp(r,e);O.cstr=r=>new Xp(r);O.utf8=(r,e)=>new Qp(r,e);O.constant=(r,e)=>new eg(r,e);var Es={};Object.defineProperty(Es,"__esModule",{value:!0});function qE(r){{const e=Buffer.from(r);e.reverse();const t=e.toString("hex");return t.length===0?BigInt(0):BigInt(`0x${t}`)}}var zE=Es.toBigIntLE=qE;function VE(r){{const e=r.toString("hex");return e.length===0?BigInt(0):BigInt(`0x${e}`)}}Es.toBigIntBE=VE;function GE(r,e){{const t=r.toString(16),n=Buffer.from(t.padStart(e*2,"0").slice(0,e*2),"hex");return n.reverse(),n}}var jE=Es.toBufferLE=GE;function KE(r,e){{const t=r.toString(16);return Buffer.from(t.padStart(e*2,"0").slice(0,e*2),"hex")}}Es.toBufferBE=KE;class YE extends TypeError{constructor(e,t){let n;const{message:i,explanation:s,...o}=e,{path:a}=e,c=a.length===0?i:`At path: ${a.join(".")} -- ${i}`;super(s??c),s!=null&&(this.cause=c),Object.assign(this,o),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}function JE(r){return Ss(r)&&typeof r[Symbol.iterator]=="function"}function Ss(r){return typeof r=="object"&&r!=null}function _o(r){return Ss(r)&&!Array.isArray(r)}function vn(r){return typeof r=="symbol"?r.toString():typeof r=="string"?JSON.stringify(r):`${r}`}function ZE(r){const{done:e,value:t}=r.next();return e?void 0:t}function XE(r,e,t,n){if(r===!0)return;r===!1?r={}:typeof r=="string"&&(r={message:r});const{path:i,branch:s}=e,{type:o}=t,{refinement:a,message:c=`Expected a value of type \`${o}\`${a?` with refinement \`${a}\``:""}, but received: \`${vn(n)}\``}=r;return{value:n,type:o,refinement:a,key:i[i.length-1],path:i,branch:s,...r,message:c}}function*Nh(r,e,t,n){JE(r)||(r=[r]);for(const i of r){const s=XE(i,e,t,n);s&&(yield s)}}function*Xl(r,e,t={}){const{path:n=[],branch:i=[r],coerce:s=!1,mask:o=!1}=t,a={path:n,branch:i,mask:o};s&&(r=e.coercer(r,a));let c="valid";for(const u of e.validator(r,a))u.explanation=t.message,c="not_valid",yield[u,void 0];for(let[u,g,y]of e.entries(r,a)){const v=Xl(g,y,{path:u===void 0?n:[...n,u],branch:u===void 0?i:[...i,g],coerce:s,mask:o,message:t.message});for(const x of v)x[0]?(c=x[0].refinement!=null?"not_refined":"not_valid",yield[x[0],void 0]):s&&(g=x[1],u===void 0?r=g:r instanceof Map?r.set(u,g):r instanceof Set?r.add(g):Ss(r)&&(g!==void 0||u in r)&&(r[u]=g))}if(c!=="not_valid")for(const u of e.refiner(r,a))u.explanation=t.message,c="not_refined",yield[u,void 0];c==="valid"&&(yield[void 0,r])}let Nn=class{constructor(e){const{type:t,schema:n,validator:i,refiner:s,coercer:o=c=>c,entries:a=function*(){}}=e;this.type=t,this.schema=n,this.entries=a,this.coercer=o,i?this.validator=(c,u)=>{const g=i(c,u);return Nh(g,u,this,c)}:this.validator=()=>[],s?this.refiner=(c,u)=>{const g=s(c,u);return Nh(g,u,this,c)}:this.refiner=()=>[]}assert(e,t){return QE(e,this,t)}create(e,t){return G(e,this,t)}is(e){return tg(e,this)}mask(e,t){return eS(e,this,t)}validate(e,t={}){return Is(e,this,t)}};function QE(r,e,t){const n=Is(r,e,{message:t});if(n[0])throw n[0]}function G(r,e,t){const n=Is(r,e,{coerce:!0,message:t});if(n[0])throw n[0];return n[1]}function eS(r,e,t){const n=Is(r,e,{coerce:!0,mask:!0,message:t});if(n[0])throw n[0];return n[1]}function tg(r,e){return!Is(r,e)[0]}function Is(r,e,t={}){const n=Xl(r,e,t),i=ZE(n);return i[0]?[new YE(i[0],function*(){for(const o of n)o[0]&&(yield o[0])}),void 0]:[void 0,i[1]]}function Hr(r,e){return new Nn({type:r,schema:null,validator:e})}function tS(){return Hr("any",()=>!0)}function K(r){return new Nn({type:"array",schema:r,*entries(e){if(r&&Array.isArray(e))for(const[t,n]of e.entries())yield[t,n,r]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||`Expected an array value, but received: ${vn(e)}`}})}function An(){return Hr("boolean",r=>typeof r=="boolean")}function Ql(r){return Hr("instance",e=>e instanceof r||`Expected a \`${r.name}\` instance, but received: ${vn(e)}`)}function je(r){const e=vn(r),t=typeof r;return new Nn({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?r:null,validator(n){return n===r||`Expected the literal \`${e}\`, but received: ${vn(n)}`}})}function nS(){return Hr("never",()=>!1)}function J(r){return new Nn({...r,validator:(e,t)=>e===null||r.validator(e,t),refiner:(e,t)=>e===null||r.refiner(e,t)})}function P(){return Hr("number",r=>typeof r=="number"&&!isNaN(r)||`Expected a number, but received: ${vn(r)}`)}function se(r){return new Nn({...r,validator:(e,t)=>e===void 0||r.validator(e,t),refiner:(e,t)=>e===void 0||r.refiner(e,t)})}function ng(r,e){return new Nn({type:"record",schema:null,*entries(t){if(Ss(t))for(const n in t){const i=t[n];yield[n,n,r],yield[n,i,e]}},validator(t){return _o(t)||`Expected an object, but received: ${vn(t)}`},coercer(t){return _o(t)?{...t}:t}})}function q(){return Hr("string",r=>typeof r=="string"||`Expected a string, but received: ${vn(r)}`)}function eu(r){const e=nS();return new Nn({type:"tuple",schema:null,*entries(t){if(Array.isArray(t)){const n=Math.max(r.length,t.length);for(let i=0;i<n;i++)yield[i,t[i],r[i]||e]}},validator(t){return Array.isArray(t)||`Expected an array, but received: ${vn(t)}`},coercer(t){return Array.isArray(t)?t.slice():t}})}function W(r){const e=Object.keys(r);return new Nn({type:"type",schema:r,*entries(t){if(Ss(t))for(const n of e)yield[n,t[n],r[n]]},validator(t){return _o(t)||`Expected an object, but received: ${vn(t)}`},coercer(t){return _o(t)?{...t}:t}})}function Gt(r){const e=r.map(t=>t.type).join(" | ");return new Nn({type:"union",schema:null,coercer(t,n){for(const i of r){const[s,o]=i.validate(t,{coerce:!0,mask:n.mask});if(!s)return o}return t},validator(t,n){const i=[];for(const s of r){const[...o]=Xl(t,s,n),[a]=o;if(a[0])for(const[c]of o)c&&i.push(c);else return[]}return[`Expected the value to satisfy a union of \`${e}\`, but received: ${vn(t)}`,...i]}})}function Bi(){return Hr("unknown",()=>!0)}function xs(r,e,t){return new Nn({...r,coercer:(n,i)=>tg(n,e)?r.coercer(t(n,i),i):r.coercer(n,i)})}var Bs,rS=new Uint8Array(16);function rg(){if(!Bs&&(Bs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Bs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Bs(rS)}const iS=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ko(r){return typeof r=="string"&&iS.test(r)}var Rt=[];for(var Va=0;Va<256;++Va)Rt.push((Va+256).toString(16).substr(1));function Yo(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Rt[r[e+0]]+Rt[r[e+1]]+Rt[r[e+2]]+Rt[r[e+3]]+"-"+Rt[r[e+4]]+Rt[r[e+5]]+"-"+Rt[r[e+6]]+Rt[r[e+7]]+"-"+Rt[r[e+8]]+Rt[r[e+9]]+"-"+Rt[r[e+10]]+Rt[r[e+11]]+Rt[r[e+12]]+Rt[r[e+13]]+Rt[r[e+14]]+Rt[r[e+15]]).toLowerCase();if(!Ko(t))throw TypeError("Stringified UUID is invalid");return t}var Bh,Ga,ja=0,Ka=0;function sS(r,e,t){var n=e&&t||0,i=e||new Array(16);r=r||{};var s=r.node||Bh,o=r.clockseq!==void 0?r.clockseq:Ga;if(s==null||o==null){var a=r.random||(r.rng||rg)();s==null&&(s=Bh=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=Ga=(a[6]<<8|a[7])&16383)}var c=r.msecs!==void 0?r.msecs:Date.now(),u=r.nsecs!==void 0?r.nsecs:Ka+1,g=c-ja+(u-Ka)/1e4;if(g<0&&r.clockseq===void 0&&(o=o+1&16383),(g<0||c>ja)&&r.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ja=c,Ka=u,Ga=o,c+=122192928e5;var y=((c&268435455)*1e4+u)%4294967296;i[n++]=y>>>24&255,i[n++]=y>>>16&255,i[n++]=y>>>8&255,i[n++]=y&255;var v=c/4294967296*1e4&268435455;i[n++]=v>>>8&255,i[n++]=v&255,i[n++]=v>>>24&15|16,i[n++]=v>>>16&255,i[n++]=o>>>8|128,i[n++]=o&255;for(var x=0;x<6;++x)i[n+x]=s[x];return e||Yo(i)}function ig(r){if(!Ko(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function oS(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var aS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",cS="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function sg(r,e,t){function n(i,s,o,a){if(typeof i=="string"&&(i=oS(i)),typeof s=="string"&&(s=ig(s)),s.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(var u=0;u<16;++u)o[a+u]=c[u];return o}return Yo(c)}try{n.name=r}catch{}return n.DNS=aS,n.URL=cS,n}function lS(r){if(typeof r=="string"){var e=unescape(encodeURIComponent(r));r=new Uint8Array(e.length);for(var t=0;t<e.length;++t)r[t]=e.charCodeAt(t)}return uS(hS(dS(r),r.length*8))}function uS(r){for(var e=[],t=r.length*32,n="0123456789abcdef",i=0;i<t;i+=8){var s=r[i>>5]>>>i%32&255,o=parseInt(n.charAt(s>>>4&15)+n.charAt(s&15),16);e.push(o)}return e}function og(r){return(r+64>>>9<<4)+14+1}function hS(r,e){r[e>>5]|=128<<e%32,r[og(e)-1]=e;for(var t=1732584193,n=-271733879,i=-1732584194,s=271733878,o=0;o<r.length;o+=16){var a=t,c=n,u=i,g=s;t=Dt(t,n,i,s,r[o],7,-680876936),s=Dt(s,t,n,i,r[o+1],12,-389564586),i=Dt(i,s,t,n,r[o+2],17,606105819),n=Dt(n,i,s,t,r[o+3],22,-1044525330),t=Dt(t,n,i,s,r[o+4],7,-176418897),s=Dt(s,t,n,i,r[o+5],12,1200080426),i=Dt(i,s,t,n,r[o+6],17,-1473231341),n=Dt(n,i,s,t,r[o+7],22,-45705983),t=Dt(t,n,i,s,r[o+8],7,1770035416),s=Dt(s,t,n,i,r[o+9],12,-1958414417),i=Dt(i,s,t,n,r[o+10],17,-42063),n=Dt(n,i,s,t,r[o+11],22,-1990404162),t=Dt(t,n,i,s,r[o+12],7,1804603682),s=Dt(s,t,n,i,r[o+13],12,-40341101),i=Dt(i,s,t,n,r[o+14],17,-1502002290),n=Dt(n,i,s,t,r[o+15],22,1236535329),t=Ft(t,n,i,s,r[o+1],5,-165796510),s=Ft(s,t,n,i,r[o+6],9,-1069501632),i=Ft(i,s,t,n,r[o+11],14,643717713),n=Ft(n,i,s,t,r[o],20,-373897302),t=Ft(t,n,i,s,r[o+5],5,-701558691),s=Ft(s,t,n,i,r[o+10],9,38016083),i=Ft(i,s,t,n,r[o+15],14,-660478335),n=Ft(n,i,s,t,r[o+4],20,-405537848),t=Ft(t,n,i,s,r[o+9],5,568446438),s=Ft(s,t,n,i,r[o+14],9,-1019803690),i=Ft(i,s,t,n,r[o+3],14,-187363961),n=Ft(n,i,s,t,r[o+8],20,1163531501),t=Ft(t,n,i,s,r[o+13],5,-1444681467),s=Ft(s,t,n,i,r[o+2],9,-51403784),i=Ft(i,s,t,n,r[o+7],14,1735328473),n=Ft(n,i,s,t,r[o+12],20,-1926607734),t=Ut(t,n,i,s,r[o+5],4,-378558),s=Ut(s,t,n,i,r[o+8],11,-2022574463),i=Ut(i,s,t,n,r[o+11],16,1839030562),n=Ut(n,i,s,t,r[o+14],23,-35309556),t=Ut(t,n,i,s,r[o+1],4,-1530992060),s=Ut(s,t,n,i,r[o+4],11,1272893353),i=Ut(i,s,t,n,r[o+7],16,-155497632),n=Ut(n,i,s,t,r[o+10],23,-1094730640),t=Ut(t,n,i,s,r[o+13],4,681279174),s=Ut(s,t,n,i,r[o],11,-358537222),i=Ut(i,s,t,n,r[o+3],16,-722521979),n=Ut(n,i,s,t,r[o+6],23,76029189),t=Ut(t,n,i,s,r[o+9],4,-640364487),s=Ut(s,t,n,i,r[o+12],11,-421815835),i=Ut(i,s,t,n,r[o+15],16,530742520),n=Ut(n,i,s,t,r[o+2],23,-995338651),t=Wt(t,n,i,s,r[o],6,-198630844),s=Wt(s,t,n,i,r[o+7],10,1126891415),i=Wt(i,s,t,n,r[o+14],15,-1416354905),n=Wt(n,i,s,t,r[o+5],21,-57434055),t=Wt(t,n,i,s,r[o+12],6,1700485571),s=Wt(s,t,n,i,r[o+3],10,-1894986606),i=Wt(i,s,t,n,r[o+10],15,-1051523),n=Wt(n,i,s,t,r[o+1],21,-2054922799),t=Wt(t,n,i,s,r[o+8],6,1873313359),s=Wt(s,t,n,i,r[o+15],10,-30611744),i=Wt(i,s,t,n,r[o+6],15,-1560198380),n=Wt(n,i,s,t,r[o+13],21,1309151649),t=Wt(t,n,i,s,r[o+4],6,-145523070),s=Wt(s,t,n,i,r[o+11],10,-1120210379),i=Wt(i,s,t,n,r[o+2],15,718787259),n=Wt(n,i,s,t,r[o+9],21,-343485551),t=ur(t,a),n=ur(n,c),i=ur(i,u),s=ur(s,g)}return[t,n,i,s]}function dS(r){if(r.length===0)return[];for(var e=r.length*8,t=new Uint32Array(og(e)),n=0;n<e;n+=8)t[n>>5]|=(r[n/8]&255)<<n%32;return t}function ur(r,e){var t=(r&65535)+(e&65535),n=(r>>16)+(e>>16)+(t>>16);return n<<16|t&65535}function fS(r,e){return r<<e|r>>>32-e}function Jo(r,e,t,n,i,s){return ur(fS(ur(ur(e,r),ur(n,s)),i),t)}function Dt(r,e,t,n,i,s,o){return Jo(e&t|~e&n,r,e,i,s,o)}function Ft(r,e,t,n,i,s,o){return Jo(e&n|t&~n,r,e,i,s,o)}function Ut(r,e,t,n,i,s,o){return Jo(e^t^n,r,e,i,s,o)}function Wt(r,e,t,n,i,s,o){return Jo(t^(e|~n),r,e,i,s,o)}var pS=sg("v3",48,lS);function gS(r,e,t){r=r||{};var n=r.random||(r.rng||rg)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return Yo(n)}function mS(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function Ya(r,e){return r<<e|r>>>32-e}function yS(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var i=0;i<n.length;++i)r.push(n.charCodeAt(i))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var s=r.length/4+2,o=Math.ceil(s/16),a=new Array(o),c=0;c<o;++c){for(var u=new Uint32Array(16),g=0;g<16;++g)u[g]=r[c*64+g*4]<<24|r[c*64+g*4+1]<<16|r[c*64+g*4+2]<<8|r[c*64+g*4+3];a[c]=u}a[o-1][14]=(r.length-1)*8/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=(r.length-1)*8&4294967295;for(var y=0;y<o;++y){for(var v=new Uint32Array(80),x=0;x<16;++x)v[x]=a[y][x];for(var T=16;T<80;++T)v[T]=Ya(v[T-3]^v[T-8]^v[T-14]^v[T-16],1);for(var R=t[0],C=t[1],D=t[2],U=t[3],L=t[4],z=0;z<80;++z){var Z=Math.floor(z/20),j=Ya(R,5)+mS(Z,C,D,U)+L+e[Z]+v[z]>>>0;L=U,U=D,D=Ya(C,30)>>>0,C=R,R=j}t[0]=t[0]+R>>>0,t[1]=t[1]+C>>>0,t[2]=t[2]+D>>>0,t[3]=t[3]+U>>>0,t[4]=t[4]+L>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var _S=sg("v5",80,yS);const wS="00000000-0000-0000-0000-000000000000";function bS(r){if(!Ko(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}const vS=Object.freeze(Object.defineProperty({__proto__:null,NIL:wS,parse:ig,stringify:Yo,v1:sS,v3:pS,v4:gS,v5:_S,validate:Ko,version:bS},Symbol.toStringTag,{value:"Module"})),ag=Pl(vS),ES=ag.v4,SS=function(r,e,t,n){if(typeof r!="string")throw new TypeError(r+" must be a string");n=n||{};const i=typeof n.version=="number"?n.version:2;if(i!==1&&i!==2)throw new TypeError(i+" must be 1 or 2");const s={method:r};if(i===2&&(s.jsonrpc="2.0"),e){if(typeof e!="object"&&!Array.isArray(e))throw new TypeError(e+" must be an object, array or omitted");s.params=e}if(typeof t>"u"){const o=typeof n.generator=="function"?n.generator:function(){return ES()};s.id=o(s,n)}else i===2&&t===null?n.notificationIdNull&&(s.id=null):s.id=t;return s};var IS=SS;const xS=ag.v4,kS=IS,as=function(r,e){if(!(this instanceof as))return new as(r,e);e||(e={}),this.options={reviver:typeof e.reviver<"u"?e.reviver:null,replacer:typeof e.replacer<"u"?e.replacer:null,generator:typeof e.generator<"u"?e.generator:function(){return xS()},version:typeof e.version<"u"?e.version:2,notificationIdNull:typeof e.notificationIdNull=="boolean"?e.notificationIdNull:!1},this.callServer=r};var CS=as;as.prototype.request=function(r,e,t,n){const i=this;let s=null;const o=Array.isArray(r)&&typeof e=="function";if(this.options.version===1&&o)throw new TypeError("JSON-RPC 1.0 does not support batching");if(o||!o&&r&&typeof r=="object"&&typeof e=="function")n=e,s=r;else{typeof t=="function"&&(n=t,t=void 0);const u=typeof n=="function";try{s=kS(r,e,t,{generator:this.options.generator,version:this.options.version,notificationIdNull:this.options.notificationIdNull})}catch(g){if(u)return n(g);throw g}if(!u)return s}let c;try{c=JSON.stringify(s,this.options.replacer)}catch(u){return n(u)}return this.callServer(c,function(u,g){i._parseResponse(u,g,n)}),s};as.prototype._parseResponse=function(r,e,t){if(r){t(r);return}if(!e)return t();let n;try{n=JSON.parse(e,this.options.reviver)}catch(i){return t(i)}if(t.length===3)if(Array.isArray(n)){const i=function(o){return typeof o.error<"u"},s=function(o){return!i(o)};return t(null,n.filter(i),n.filter(s))}else return t(null,n.error,n.result);t(null,n)};const AS=Fo(CS);var cg={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,u,g){this.fn=c,this.context=u,this.once=g||!1}function s(c,u,g,y,v){if(typeof g!="function")throw new TypeError("The listener must be a function");var x=new i(g,y||c,v),T=t?t+u:u;return c._events[T]?c._events[T].fn?c._events[T]=[c._events[T],x]:c._events[T].push(x):(c._events[T]=x,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],g,y;if(this._eventsCount===0)return u;for(y in g=this._events)e.call(g,y)&&u.push(t?y.slice(1):y);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(g)):u},a.prototype.listeners=function(u){var g=t?t+u:u,y=this._events[g];if(!y)return[];if(y.fn)return[y.fn];for(var v=0,x=y.length,T=new Array(x);v<x;v++)T[v]=y[v].fn;return T},a.prototype.listenerCount=function(u){var g=t?t+u:u,y=this._events[g];return y?y.fn?1:y.length:0},a.prototype.emit=function(u,g,y,v,x,T){var R=t?t+u:u;if(!this._events[R])return!1;var C=this._events[R],D=arguments.length,U,L;if(C.fn){switch(C.once&&this.removeListener(u,C.fn,void 0,!0),D){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,g),!0;case 3:return C.fn.call(C.context,g,y),!0;case 4:return C.fn.call(C.context,g,y,v),!0;case 5:return C.fn.call(C.context,g,y,v,x),!0;case 6:return C.fn.call(C.context,g,y,v,x,T),!0}for(L=1,U=new Array(D-1);L<D;L++)U[L-1]=arguments[L];C.fn.apply(C.context,U)}else{var z=C.length,Z;for(L=0;L<z;L++)switch(C[L].once&&this.removeListener(u,C[L].fn,void 0,!0),D){case 1:C[L].fn.call(C[L].context);break;case 2:C[L].fn.call(C[L].context,g);break;case 3:C[L].fn.call(C[L].context,g,y);break;case 4:C[L].fn.call(C[L].context,g,y,v);break;default:if(!U)for(Z=1,U=new Array(D-1);Z<D;Z++)U[Z-1]=arguments[Z];C[L].fn.apply(C[L].context,U)}}return!0},a.prototype.on=function(u,g,y){return s(this,u,g,y,!1)},a.prototype.once=function(u,g,y){return s(this,u,g,y,!0)},a.prototype.removeListener=function(u,g,y,v){var x=t?t+u:u;if(!this._events[x])return this;if(!g)return o(this,x),this;var T=this._events[x];if(T.fn)T.fn===g&&(!v||T.once)&&(!y||T.context===y)&&o(this,x);else{for(var R=0,C=[],D=T.length;R<D;R++)(T[R].fn!==g||v&&!T[R].once||y&&T[R].context!==y)&&C.push(T[R]);C.length?this._events[x]=C.length===1?C[0]:C:o(this,x)}return this},a.prototype.removeAllListeners=function(u){var g;return u?(g=t?t+u:u,this._events[g]&&o(this,g)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(cg);var TS=cg.exports;const lg=Fo(TS);var RS=class extends lg{constructor(e,t,n){super();Et(this,"socket");this.socket=new window.WebSocket(e,n),this.socket.onopen=()=>this.emit("open"),this.socket.onmessage=i=>this.emit("message",i.data),this.socket.onerror=i=>this.emit("error",i),this.socket.onclose=i=>{this.emit("close",i.code,i.reason)}}send(e,t,n){const i=n||t;try{this.socket.send(e),i()}catch(s){i(s)}}close(e,t){this.socket.close(e,t)}addEventListener(e,t,n){this.socket.addEventListener(e,t,n)}};function MS(r,e){return new RS(r,e)}var NS=class{encode(r){return JSON.stringify(r)}decode(r){return JSON.parse(r)}},BS=class extends lg{constructor(e,t="ws://localhost:8080",{autoconnect:n=!0,reconnect:i=!0,reconnect_interval:s=1e3,max_reconnects:o=5,...a}={},c,u){super();Et(this,"address");Et(this,"rpc_id");Et(this,"queue");Et(this,"options");Et(this,"autoconnect");Et(this,"ready");Et(this,"reconnect");Et(this,"reconnect_timer_id");Et(this,"reconnect_interval");Et(this,"max_reconnects");Et(this,"rest_options");Et(this,"current_reconnects");Et(this,"generate_request_id");Et(this,"socket");Et(this,"webSocketFactory");Et(this,"dataPack");this.webSocketFactory=e,this.queue={},this.rpc_id=0,this.address=t,this.autoconnect=n,this.ready=!1,this.reconnect=i,this.reconnect_timer_id=void 0,this.reconnect_interval=s,this.max_reconnects=o,this.rest_options=a,this.current_reconnects=0,this.generate_request_id=c||(()=>++this.rpc_id),u?this.dataPack=u:this.dataPack=new NS,this.autoconnect&&this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects,...this.rest_options})}connect(){this.socket||this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects,...this.rest_options})}call(e,t,n,i){return!i&&typeof n=="object"&&(i=n,n=null),new Promise((s,o)=>{if(!this.ready)return o(new Error("socket not ready"));const a=this.generate_request_id(e,t),c={jsonrpc:"2.0",method:e,params:t||void 0,id:a};this.socket.send(this.dataPack.encode(c),i,u=>{if(u)return o(u);this.queue[a]={promise:[s,o]},n&&(this.queue[a].timeout=setTimeout(()=>{delete this.queue[a],o(new Error("reply timeout"))},n))})})}async login(e){const t=await this.call("rpc.login",e);if(!t)throw new Error("authentication failed");return t}async listMethods(){return await this.call("__listMethods")}notify(e,t){return new Promise((n,i)=>{if(!this.ready)return i(new Error("socket not ready"));const s={jsonrpc:"2.0",method:e,params:t};this.socket.send(this.dataPack.encode(s),o=>{if(o)return i(o);n()})})}async subscribe(e){typeof e=="string"&&(e=[e]);const t=await this.call("rpc.on",e);if(typeof e=="string"&&t[e]!=="ok")throw new Error("Failed subscribing to an event '"+e+"' with: "+t[e]);return t}async unsubscribe(e){typeof e=="string"&&(e=[e]);const t=await this.call("rpc.off",e);if(typeof e=="string"&&t[e]!=="ok")throw new Error("Failed unsubscribing from an event with: "+t);return t}close(e,t){this.socket.close(e||1e3,t)}setAutoReconnect(e){this.reconnect=e}setReconnectInterval(e){this.reconnect_interval=e}setMaxReconnects(e){this.max_reconnects=e}_connect(e,t){clearTimeout(this.reconnect_timer_id),this.socket=this.webSocketFactory(e,t),this.socket.addEventListener("open",()=>{this.ready=!0,this.emit("open"),this.current_reconnects=0}),this.socket.addEventListener("message",({data:n})=>{n instanceof ArrayBuffer&&(n=pe.Buffer.from(n).toString());try{n=this.dataPack.decode(n)}catch{return}if(n.notification&&this.listeners(n.notification).length){if(!Object.keys(n.params).length)return this.emit(n.notification);const i=[n.notification];if(n.params.constructor===Object)i.push(n.params);else for(let s=0;s<n.params.length;s++)i.push(n.params[s]);return Promise.resolve().then(()=>{this.emit.apply(this,i)})}if(!this.queue[n.id])return n.method?Promise.resolve().then(()=>{this.emit(n.method,n==null?void 0:n.params)}):void 0;"error"in n=="result"in n&&this.queue[n.id].promise[1](new Error('Server response malformed. Response must include either "result" or "error", but not both.')),this.queue[n.id].timeout&&clearTimeout(this.queue[n.id].timeout),n.error?this.queue[n.id].promise[1](n.error):this.queue[n.id].promise[0](n.result),delete this.queue[n.id]}),this.socket.addEventListener("error",n=>this.emit("error",n)),this.socket.addEventListener("close",({code:n,reason:i})=>{this.ready&&setTimeout(()=>this.emit("close",n,i),0),this.ready=!1,this.socket=void 0,n!==1e3&&(this.current_reconnects++,this.reconnect&&(this.max_reconnects>this.current_reconnects||this.max_reconnects===0)&&(this.reconnect_timer_id=setTimeout(()=>this._connect(e,t),this.reconnect_interval)))})}};class ug extends pp{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,r1(e);const n=Ol(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return ho(this),this.iHash.update(e),this}digestInto(e){ho(this),Wo(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hg=(r,e,t)=>new ug(r,e).update(t).digest();hg.create=(r,e)=>new ug(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ph(r){r.lowS!==void 0&&zn("lowS",r.lowS),r.prehash!==void 0&&zn("prehash",r.prehash)}function PS(r){const e=Ul(r);Ri(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:LS,hexToBytes:OS}=z1;class DS extends Error{constructor(e=""){super(e)}}const Ln={Err:DS,_tlv:{encode:(r,e)=>{const{Err:t}=Ln;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=ni(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?ni(i.length/2|128):"";return ni(r)+s+i+e},decode(r,e){const{Err:t}=Ln;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const g of u)o=o<<8|g;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=Ln;if(r<Dn)throw new e("integer: negative integers are not allowed");let t=ni(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Ln;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return LS(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=Ln,i=typeof r=="string"?OS(r):r;vs(i);const{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l:g}=n.decode(2,c);if(g.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(r){const{_tlv:e,_int:t}=Ln,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},Dn=BigInt(0),xt=BigInt(1);BigInt(2);const Lh=BigInt(3);BigInt(4);function FS(r){const e=PS(r),{Fp:t}=e,n=zo(e.n,e.nBitLength),i=e.toBytes||((R,C,D)=>{const U=C.toAffine();return Fr(Uint8Array.from([4]),t.toBytes(U.x),t.toBytes(U.y))}),s=e.fromBytes||(R=>{const C=R.subarray(1),D=t.fromBytes(C.subarray(0,t.BYTES)),U=t.fromBytes(C.subarray(t.BYTES,2*t.BYTES));return{x:D,y:U}});function o(R){const{a:C,b:D}=e,U=t.sqr(R),L=t.mul(U,R);return t.add(t.add(L,t.mul(R,C)),D)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(R){return qo(R,xt,e.n)}function c(R){const{allowedPrivateKeyLengths:C,nByteLength:D,wrapPrivateKey:U,n:L}=e;if(C&&typeof R!="bigint"){if(Or(R)&&(R=Dr(R)),typeof R!="string"||!C.includes(R.length))throw new Error("invalid private key");R=R.padStart(D*2,"0")}let z;try{z=typeof R=="bigint"?R:Tr(bt("private key",R,D))}catch{throw new Error("invalid private key, expected hex or "+D+" bytes, got "+typeof R)}return U&&(z=Ge(z,L)),un("private key",z,xt,L),z}function u(R){if(!(R instanceof v))throw new Error("ProjectivePoint expected")}const g=os((R,C)=>{const{px:D,py:U,pz:L}=R;if(t.eql(L,t.ONE))return{x:D,y:U};const z=R.is0();C==null&&(C=z?t.ONE:t.inv(L));const Z=t.mul(D,C),j=t.mul(U,C),X=t.mul(L,C);if(z)return{x:t.ZERO,y:t.ZERO};if(!t.eql(X,t.ONE))throw new Error("invZ was invalid");return{x:Z,y:j}}),y=os(R=>{if(R.is0()){if(e.allowInfinityPoint&&!t.is0(R.py))return;throw new Error("bad point: ZERO")}const{x:C,y:D}=R.toAffine();if(!t.isValid(C)||!t.isValid(D))throw new Error("bad point: x or y not FE");const U=t.sqr(D),L=o(C);if(!t.eql(U,L))throw new Error("bad point: equation left != right");if(!R.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class v{constructor(C,D,U){if(this.px=C,this.py=D,this.pz=U,C==null||!t.isValid(C))throw new Error("x required");if(D==null||!t.isValid(D))throw new Error("y required");if(U==null||!t.isValid(U))throw new Error("z required");Object.freeze(this)}static fromAffine(C){const{x:D,y:U}=C||{};if(!C||!t.isValid(D)||!t.isValid(U))throw new Error("invalid affine point");if(C instanceof v)throw new Error("projective point not allowed");const L=z=>t.eql(z,t.ZERO);return L(D)&&L(U)?v.ZERO:new v(D,U,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(C){const D=t.invertBatch(C.map(U=>U.pz));return C.map((U,L)=>U.toAffine(D[L])).map(v.fromAffine)}static fromHex(C){const D=v.fromAffine(s(bt("pointHex",C)));return D.assertValidity(),D}static fromPrivateKey(C){return v.BASE.multiply(c(C))}static msm(C,D){return Cp(v,n,C,D)}_setWindowSize(C){T.setWindowSize(this,C)}assertValidity(){y(this)}hasEvenY(){const{y:C}=this.toAffine();if(t.isOdd)return!t.isOdd(C);throw new Error("Field doesn't support isOdd")}equals(C){u(C);const{px:D,py:U,pz:L}=this,{px:z,py:Z,pz:j}=C,X=t.eql(t.mul(D,j),t.mul(z,L)),ee=t.eql(t.mul(U,j),t.mul(Z,L));return X&&ee}negate(){return new v(this.px,t.neg(this.py),this.pz)}double(){const{a:C,b:D}=e,U=t.mul(D,Lh),{px:L,py:z,pz:Z}=this;let j=t.ZERO,X=t.ZERO,ee=t.ZERO,Q=t.mul(L,L),Ce=t.mul(z,z),re=t.mul(Z,Z),he=t.mul(L,z);return he=t.add(he,he),ee=t.mul(L,Z),ee=t.add(ee,ee),j=t.mul(C,ee),X=t.mul(U,re),X=t.add(j,X),j=t.sub(Ce,X),X=t.add(Ce,X),X=t.mul(j,X),j=t.mul(he,j),ee=t.mul(U,ee),re=t.mul(C,re),he=t.sub(Q,re),he=t.mul(C,he),he=t.add(he,ee),ee=t.add(Q,Q),Q=t.add(ee,Q),Q=t.add(Q,re),Q=t.mul(Q,he),X=t.add(X,Q),re=t.mul(z,Z),re=t.add(re,re),Q=t.mul(re,he),j=t.sub(j,Q),ee=t.mul(re,Ce),ee=t.add(ee,ee),ee=t.add(ee,ee),new v(j,X,ee)}add(C){u(C);const{px:D,py:U,pz:L}=this,{px:z,py:Z,pz:j}=C;let X=t.ZERO,ee=t.ZERO,Q=t.ZERO;const Ce=e.a,re=t.mul(e.b,Lh);let he=t.mul(D,z),A=t.mul(U,Z),l=t.mul(L,j),p=t.add(D,U),m=t.add(z,Z);p=t.mul(p,m),m=t.add(he,A),p=t.sub(p,m),m=t.add(D,L);let w=t.add(z,j);return m=t.mul(m,w),w=t.add(he,l),m=t.sub(m,w),w=t.add(U,L),X=t.add(Z,j),w=t.mul(w,X),X=t.add(A,l),w=t.sub(w,X),Q=t.mul(Ce,m),X=t.mul(re,l),Q=t.add(X,Q),X=t.sub(A,Q),Q=t.add(A,Q),ee=t.mul(X,Q),A=t.add(he,he),A=t.add(A,he),l=t.mul(Ce,l),m=t.mul(re,m),A=t.add(A,l),l=t.sub(he,l),l=t.mul(Ce,l),m=t.add(m,l),he=t.mul(A,m),ee=t.add(ee,he),he=t.mul(w,m),X=t.mul(p,X),X=t.sub(X,he),he=t.mul(p,A),Q=t.mul(w,Q),Q=t.add(Q,he),new v(X,ee,Q)}subtract(C){return this.add(C.negate())}is0(){return this.equals(v.ZERO)}wNAF(C){return T.wNAFCached(this,C,v.normalizeZ)}multiplyUnsafe(C){const{endo:D,n:U}=e;un("scalar",C,Dn,U);const L=v.ZERO;if(C===Dn)return L;if(this.is0()||C===xt)return this;if(!D||T.hasPrecomputes(this))return T.wNAFCachedUnsafe(this,C,v.normalizeZ);let{k1neg:z,k1:Z,k2neg:j,k2:X}=D.splitScalar(C),ee=L,Q=L,Ce=this;for(;Z>Dn||X>Dn;)Z&xt&&(ee=ee.add(Ce)),X&xt&&(Q=Q.add(Ce)),Ce=Ce.double(),Z>>=xt,X>>=xt;return z&&(ee=ee.negate()),j&&(Q=Q.negate()),Q=new v(t.mul(Q.px,D.beta),Q.py,Q.pz),ee.add(Q)}multiply(C){const{endo:D,n:U}=e;un("scalar",C,xt,U);let L,z;if(D){const{k1neg:Z,k1:j,k2neg:X,k2:ee}=D.splitScalar(C);let{p:Q,f:Ce}=this.wNAF(j),{p:re,f:he}=this.wNAF(ee);Q=T.constTimeNegate(Z,Q),re=T.constTimeNegate(X,re),re=new v(t.mul(re.px,D.beta),re.py,re.pz),L=Q.add(re),z=Ce.add(he)}else{const{p:Z,f:j}=this.wNAF(C);L=Z,z=j}return v.normalizeZ([L,z])[0]}multiplyAndAddUnsafe(C,D,U){const L=v.BASE,z=(j,X)=>X===Dn||X===xt||!j.equals(L)?j.multiplyUnsafe(X):j.multiply(X),Z=z(this,D).add(z(C,U));return Z.is0()?void 0:Z}toAffine(C){return g(this,C)}isTorsionFree(){const{h:C,isTorsionFree:D}=e;if(C===xt)return!0;if(D)return D(v,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:C,clearCofactor:D}=e;return C===xt?this:D?D(v,this):this.multiplyUnsafe(e.h)}toRawBytes(C=!0){return zn("isCompressed",C),this.assertValidity(),i(v,this,C)}toHex(C=!0){return zn("isCompressed",C),Dr(this.toRawBytes(C))}}v.BASE=new v(e.Gx,e.Gy,t.ONE),v.ZERO=new v(t.ZERO,t.ONE,t.ZERO);const x=e.nBitLength,T=kp(v,e.endo?Math.ceil(x/2):x);return{CURVE:e,ProjectivePoint:v,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function US(r){const e=Ul(r);return Ri(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function WS(r){const e=US(r),{Fp:t,n}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(l){return Ge(l,n)}function a(l){return Ac(l,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:g,isWithinCurveOrder:y}=FS({...e,toBytes(l,p,m){const w=p.toAffine(),E=t.toBytes(w.x),k=Fr;return zn("isCompressed",m),m?k(Uint8Array.from([p.hasEvenY()?2:3]),E):k(Uint8Array.from([4]),E,t.toBytes(w.y))},fromBytes(l){const p=l.length,m=l[0],w=l.subarray(1);if(p===i&&(m===2||m===3)){const E=Tr(w);if(!qo(E,xt,t.ORDER))throw new Error("Point is not on curve");const k=g(E);let M;try{M=t.sqrt(k)}catch(I){const $=I instanceof Error?": "+I.message:"";throw new Error("Point is not on curve"+$)}const b=(M&xt)===xt;return(m&1)===1!==b&&(M=t.neg(M)),{x:E,y:M}}else if(p===s&&m===4){const E=t.fromBytes(w.subarray(0,t.BYTES)),k=t.fromBytes(w.subarray(t.BYTES,2*t.BYTES));return{x:E,y:k}}else{const E=i,k=s;throw new Error("invalid Point, expected length of "+E+", or uncompressed "+k+", got "+p)}}}),v=l=>Dr(bi(l,e.nByteLength));function x(l){const p=n>>xt;return l>p}function T(l){return x(l)?o(-l):l}const R=(l,p,m)=>Tr(l.slice(p,m));class C{constructor(p,m,w){this.r=p,this.s=m,this.recovery=w,this.assertValidity()}static fromCompact(p){const m=e.nByteLength;return p=bt("compactSignature",p,m*2),new C(R(p,0,m),R(p,m,2*m))}static fromDER(p){const{r:m,s:w}=Ln.toSig(bt("DER",p));return new C(m,w)}assertValidity(){un("r",this.r,xt,n),un("s",this.s,xt,n)}addRecoveryBit(p){return new C(this.r,this.s,p)}recoverPublicKey(p){const{r:m,s:w,recovery:E}=this,k=j(bt("msgHash",p));if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");const M=E===2||E===3?m+e.n:m;if(M>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const b=E&1?"03":"02",d=c.fromHex(b+v(M)),I=a(M),$=o(-k*I),V=o(w*I),Y=c.BASE.multiplyAndAddUnsafe(d,$,V);if(!Y)throw new Error("point at infinify");return Y.assertValidity(),Y}hasHighS(){return x(this.s)}normalizeS(){return this.hasHighS()?new C(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return wi(this.toDERHex())}toDERHex(){return Ln.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return wi(this.toCompactHex())}toCompactHex(){return v(this.r)+v(this.s)}}const D={isValidPrivateKey(l){try{return u(l),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const l=Sp(e.n);return eE(e.randomBytes(l),e.n)},precompute(l=8,p=c.BASE){return p._setWindowSize(l),p.multiply(BigInt(3)),p}};function U(l,p=!0){return c.fromPrivateKey(l).toRawBytes(p)}function L(l){const p=Or(l),m=typeof l=="string",w=(p||m)&&l.length;return p?w===i||w===s:m?w===2*i||w===2*s:l instanceof c}function z(l,p,m=!0){if(L(l))throw new Error("first arg must be private key");if(!L(p))throw new Error("second arg must be public key");return c.fromHex(p).multiply(u(l)).toRawBytes(m)}const Z=e.bits2int||function(l){if(l.length>8192)throw new Error("input is too large");const p=Tr(l),m=l.length*8-e.nBitLength;return m>0?p>>BigInt(m):p},j=e.bits2int_modN||function(l){return o(Z(l))},X=Fl(e.nBitLength);function ee(l){return un("num < 2^"+e.nBitLength,l,Dn,X),bi(l,e.nByteLength)}function Q(l,p,m=Ce){if(["recovered","canonical"].some(oe=>oe in m))throw new Error("sign() legacy options not supported");const{hash:w,randomBytes:E}=e;let{lowS:k,prehash:M,extraEntropy:b}=m;k==null&&(k=!0),l=bt("msgHash",l),Ph(m),M&&(l=bt("prehashed msgHash",w(l)));const d=j(l),I=u(p),$=[ee(I),ee(d)];if(b!=null&&b!==!1){const oe=b===!0?E(t.BYTES):b;$.push(bt("extraEntropy",oe))}const V=Fr(...$),Y=d;function be(oe){const de=Z(oe);if(!y(de))return;const Je=a(de),Se=c.BASE.multiply(de).toAffine(),we=o(Se.x);if(we===Dn)return;const nt=o(Je*o(Y+we*I));if(nt===Dn)return;let ke=(Se.x===we?0:2)|Number(Se.y&xt),Ae=nt;return k&&x(nt)&&(Ae=T(nt),ke^=1),new C(we,Ae,ke)}return{seed:V,k2sig:be}}const Ce={lowS:e.lowS,prehash:!1},re={lowS:e.lowS,prehash:!1};function he(l,p,m=Ce){const{seed:w,k2sig:E}=Q(l,p,m),k=e;return bp(k.hash.outputLen,k.nByteLength,k.hmac)(w,E)}c.BASE._setWindowSize(8);function A(l,p,m,w=re){var ke;const E=l;p=bt("msgHash",p),m=bt("publicKey",m);const{lowS:k,prehash:M,format:b}=w;if(Ph(w),"strict"in w)throw new Error("options.strict was renamed to lowS");if(b!==void 0&&b!=="compact"&&b!=="der")throw new Error("format must be compact or der");const d=typeof E=="string"||Or(E),I=!d&&!b&&typeof E=="object"&&E!==null&&typeof E.r=="bigint"&&typeof E.s=="bigint";if(!d&&!I)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let $,V;try{if(I&&($=new C(E.r,E.s)),d){try{b!=="compact"&&($=C.fromDER(E))}catch(Ae){if(!(Ae instanceof Ln.Err))throw Ae}!$&&b!=="der"&&($=C.fromCompact(E))}V=c.fromHex(m)}catch{return!1}if(!$||k&&$.hasHighS())return!1;M&&(p=e.hash(p));const{r:Y,s:be}=$,oe=j(p),de=a(be),Je=o(oe*de),Se=o(Y*de),we=(ke=c.BASE.multiplyAndAddUnsafe(V,Je,Se))==null?void 0:ke.toAffine();return we?o(we.x)===Y:!1}return{CURVE:e,getPublicKey:U,getSharedSecret:z,sign:he,verify:A,ProjectivePoint:c,Signature:C,utils:D}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $S(r){return{hash:r,hmac:(e,...t)=>hg(r,e,o1(...t)),randomBytes:mp}}function HS(r,e){const t=n=>WS({...r,...$S(n)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dg=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Oh=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),qS=BigInt(1),Nc=BigInt(2),Dh=(r,e)=>(r+e/Nc)/e;function zS(r){const e=dg,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=r*r*r%e,g=u*u*r%e,y=Ze(g,t,e)*g%e,v=Ze(y,t,e)*g%e,x=Ze(v,Nc,e)*u%e,T=Ze(x,i,e)*x%e,R=Ze(T,s,e)*T%e,C=Ze(R,a,e)*R%e,D=Ze(C,c,e)*C%e,U=Ze(D,a,e)*R%e,L=Ze(U,t,e)*g%e,z=Ze(L,o,e)*T%e,Z=Ze(z,n,e)*u%e,j=Ze(Z,Nc,e);if(!Bc.eql(Bc.sqr(j),r))throw new Error("Cannot find square root");return j}const Bc=zo(dg,void 0,void 0,{sqrt:zS}),VS=HS({a:BigInt(0),b:BigInt(7),Fp:Bc,n:Oh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=Oh,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-qS*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=Dh(s*r,e),c=Dh(-n*r,e);let u=Ge(r-a*t-c*i,e),g=Ge(-a*n-c*s,e);const y=u>o,v=g>o;if(y&&(u=e-u),v&&(g=e-g),u>o||g>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:y,k1:u,k2neg:v,k2:g}}}},Rc);BigInt(0);function Fh(r){try{return $l.ExtendedPoint.fromHex(r),!0}catch{return!1}}const GS=(r,e)=>$l.sign(r,e.slice(0,32)),jS=$l.verify,Nt=r=>pe.Buffer.isBuffer(r)?r:r instanceof Uint8Array?pe.Buffer.from(r.buffer,r.byteOffset,r.byteLength):pe.Buffer.from(r);class KS{constructor(e){Object.assign(this,e)}encode(){return pe.Buffer.from(Op(Ws,this))}static decode(e){return Dp(Ws,this,e)}static decodeUnchecked(e){return Mp(Ws,this,e)}}const Ws=new Map;var fg;const YS=32,gr=32;function JS(r){return r._bn!==void 0}let Uh=1;class ae extends KS{constructor(e){if(super({}),this._bn=void 0,JS(e))this._bn=e._bn;else{if(typeof e=="string"){const t=Lt.decode(e);if(t.length!=gr)throw new Error("Invalid public key input");this._bn=new Mh(t)}else this._bn=new Mh(e);if(this._bn.byteLength()>gr)throw new Error("Invalid public key input")}}static unique(){const e=new ae(Uh);return Uh+=1,new ae(e.toBuffer())}equals(e){return this._bn.eq(e._bn)}toBase58(){return Lt.encode(this.toBytes())}toJSON(){return this.toBase58()}toBytes(){const e=this.toBuffer();return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}toBuffer(){const e=this._bn.toArrayLike(pe.Buffer);if(e.length===gr)return e;const t=pe.Buffer.alloc(32);return e.copy(t,32-e.length),t}get[Symbol.toStringTag](){return`PublicKey(${this.toString()})`}toString(){return this.toBase58()}static async createWithSeed(e,t,n){const i=pe.Buffer.concat([e.toBuffer(),pe.Buffer.from(t),n.toBuffer()]),s=Rc(i);return new ae(s)}static createProgramAddressSync(e,t){let n=pe.Buffer.alloc(0);e.forEach(function(s){if(s.length>YS)throw new TypeError("Max seed length exceeded");n=pe.Buffer.concat([n,Nt(s)])}),n=pe.Buffer.concat([n,t.toBuffer(),pe.Buffer.from("ProgramDerivedAddress")]);const i=Rc(n);if(Fh(i))throw new Error("Invalid seeds, address must fall off the curve");return new ae(i)}static async createProgramAddress(e,t){return this.createProgramAddressSync(e,t)}static findProgramAddressSync(e,t){let n=255,i;for(;n!=0;){try{const s=e.concat(pe.Buffer.from([n]));i=this.createProgramAddressSync(s,t)}catch(s){if(s instanceof TypeError)throw s;n--;continue}return[i,n]}throw new Error("Unable to find a viable program address nonce")}static async findProgramAddress(e,t){return this.findProgramAddressSync(e,t)}static isOnCurve(e){const t=new ae(e);return Fh(t.toBytes())}}fg=ae;ae.default=new fg("11111111111111111111111111111111");Ws.set(ae,{kind:"struct",fields:[["_bn","u256"]]});new ae("BPFLoader1111111111111111111111111111111111");const hi=1232,pg=127,gg=64;class mg extends Error{constructor(e){super(`Signature ${e} has expired: block height exceeded.`),this.signature=void 0,this.signature=e}}Object.defineProperty(mg.prototype,"name",{value:"TransactionExpiredBlockheightExceededError"});class yg extends Error{constructor(e,t){super(`Transaction was not confirmed in ${t.toFixed(2)} seconds. It is unknown if it succeeded or failed. Check signature ${e} using the Solana Explorer or CLI tools.`),this.signature=void 0,this.signature=e}}Object.defineProperty(yg.prototype,"name",{value:"TransactionExpiredTimeoutError"});class Wi extends Error{constructor(e){super(`Signature ${e} has expired: the nonce is no longer valid.`),this.signature=void 0,this.signature=e}}Object.defineProperty(Wi.prototype,"name",{value:"TransactionExpiredNonceInvalidError"});class wo{constructor(e,t){this.staticAccountKeys=void 0,this.accountKeysFromLookups=void 0,this.staticAccountKeys=e,this.accountKeysFromLookups=t}keySegments(){const e=[this.staticAccountKeys];return this.accountKeysFromLookups&&(e.push(this.accountKeysFromLookups.writable),e.push(this.accountKeysFromLookups.readonly)),e}get(e){for(const t of this.keySegments()){if(e<t.length)return t[e];e-=t.length}}get length(){return this.keySegments().flat().length}compileInstructions(e){if(this.length>256)throw new Error("Account index overflow encountered during compilation");const n=new Map;this.keySegments().flat().forEach((s,o)=>{n.set(s.toBase58(),o)});const i=s=>{const o=n.get(s.toBase58());if(o===void 0)throw new Error("Encountered an unknown instruction account key during compilation");return o};return e.map(s=>({programIdIndex:i(s.programId),accountKeyIndexes:s.keys.map(o=>i(o.pubkey)),data:s.data}))}}const Ie=(r="publicKey")=>Xe(32,r),ri=(r="string")=>{const e=te([ie("length"),ie("lengthPadding"),Xe(Rr(ie(),-8),"chars")],r),t=e.decode.bind(e),n=e.encode.bind(e),i=e;return i.decode=(s,o)=>t(s,o).chars.toString(),i.encode=(s,o,a)=>{const c={chars:pe.Buffer.from(s,"utf8")};return n(c,o,a)},i.alloc=s=>ie().span+ie().span+pe.Buffer.from(s,"utf8").length,i},ZS=(r="authorized")=>te([Ie("staker"),Ie("withdrawer")],r),XS=(r="lockup")=>te([en("unixTimestamp"),en("epoch"),Ie("custodian")],r),QS=(r="voteInit")=>te([Ie("nodePubkey"),Ie("authorizedVoter"),Ie("authorizedWithdrawer"),Me("commission")],r),eI=(r="voteAuthorizeWithSeedArgs")=>te([ie("voteAuthorizationType"),Ie("currentAuthorityDerivedKeyOwnerPubkey"),ri("currentAuthorityDerivedKeySeed"),Ie("newAuthorized")],r);function _g(r,e){const t=i=>{if(i.span>=0)return i.span;if(typeof i.alloc=="function")return i.alloc(e[i.property]);if("count"in i&&"elementLayout"in i){const s=e[i.property];if(Array.isArray(s))return s.length*t(i.elementLayout)}else if("fields"in i)return _g({layout:i},e[i.property]);return 0};let n=0;return r.layout.fields.forEach(i=>{n+=t(i)}),n}function an(r){let e=0,t=0;for(;;){let n=r.shift();if(e|=(n&127)<<t*7,t+=1,!(n&128))break}return e}function cn(r,e){let t=e;for(;;){let n=t&127;if(t>>=7,t==0){r.push(n);break}else n|=128,r.push(n)}}function vt(r,e){if(!r)throw new Error(e||"Assertion failed")}class Zo{constructor(e,t){this.payer=void 0,this.keyMetaMap=void 0,this.payer=e,this.keyMetaMap=t}static compile(e,t){const n=new Map,i=o=>{const a=o.toBase58();let c=n.get(a);return c===void 0&&(c={isSigner:!1,isWritable:!1,isInvoked:!1},n.set(a,c)),c},s=i(t);s.isSigner=!0,s.isWritable=!0;for(const o of e){i(o.programId).isInvoked=!0;for(const a of o.keys){const c=i(a.pubkey);c.isSigner||(c.isSigner=a.isSigner),c.isWritable||(c.isWritable=a.isWritable)}}return new Zo(t,n)}getMessageComponents(){const e=[...this.keyMetaMap.entries()];vt(e.length<=256,"Max static account keys length exceeded");const t=e.filter(([,c])=>c.isSigner&&c.isWritable),n=e.filter(([,c])=>c.isSigner&&!c.isWritable),i=e.filter(([,c])=>!c.isSigner&&c.isWritable),s=e.filter(([,c])=>!c.isSigner&&!c.isWritable),o={numRequiredSignatures:t.length+n.length,numReadonlySignedAccounts:n.length,numReadonlyUnsignedAccounts:s.length};{vt(t.length>0,"Expected at least one writable signer key");const[c]=t[0];vt(c===this.payer.toBase58(),"Expected first writable signer key to be the fee payer")}const a=[...t.map(([c])=>new ae(c)),...n.map(([c])=>new ae(c)),...i.map(([c])=>new ae(c)),...s.map(([c])=>new ae(c))];return[o,a]}extractTableLookup(e){const[t,n]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&o.isWritable),[i,s]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&!o.isWritable);if(!(t.length===0&&i.length===0))return[{accountKey:e.key,writableIndexes:t,readonlyIndexes:i},{writable:n,readonly:s}]}drainKeysFoundInLookupTable(e,t){const n=new Array,i=new Array;for(const[s,o]of this.keyMetaMap.entries())if(t(o)){const a=new ae(s),c=e.findIndex(u=>u.equals(a));c>=0&&(vt(c<256,"Max lookup table index exceeded"),n.push(c),i.push(a),this.keyMetaMap.delete(s))}return[n,i]}}const wg="Reached end of buffer unexpectedly";function Fn(r){if(r.length===0)throw new Error(wg);return r.shift()}function ln(r,...e){const[t]=e;if(e.length===2?t+(e[1]??0)>r.length:t>=r.length)throw new Error(wg);return r.splice(...e)}class br{constructor(e){this.header=void 0,this.accountKeys=void 0,this.recentBlockhash=void 0,this.instructions=void 0,this.indexToProgramIds=new Map,this.header=e.header,this.accountKeys=e.accountKeys.map(t=>new ae(t)),this.recentBlockhash=e.recentBlockhash,this.instructions=e.instructions,this.instructions.forEach(t=>this.indexToProgramIds.set(t.programIdIndex,this.accountKeys[t.programIdIndex]))}get version(){return"legacy"}get staticAccountKeys(){return this.accountKeys}get compiledInstructions(){return this.instructions.map(e=>({programIdIndex:e.programIdIndex,accountKeyIndexes:e.accounts,data:Lt.decode(e.data)}))}get addressTableLookups(){return[]}getAccountKeys(){return new wo(this.staticAccountKeys)}static compile(e){const t=Zo.compile(e.instructions,e.payerKey),[n,i]=t.getMessageComponents(),o=new wo(i).compileInstructions(e.instructions).map(a=>({programIdIndex:a.programIdIndex,accounts:a.accountKeyIndexes,data:Lt.encode(a.data)}));return new br({header:n,accountKeys:i,recentBlockhash:e.recentBlockhash,instructions:o})}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures;if(e>=this.header.numRequiredSignatures){const n=e-t,s=this.accountKeys.length-t-this.header.numReadonlyUnsignedAccounts;return n<s}else{const n=t-this.header.numReadonlySignedAccounts;return e<n}}isProgramId(e){return this.indexToProgramIds.has(e)}programIds(){return[...this.indexToProgramIds.values()]}nonProgramIds(){return this.accountKeys.filter((e,t)=>!this.isProgramId(t))}serialize(){const e=this.accountKeys.length;let t=[];cn(t,e);const n=this.instructions.map(y=>{const{accounts:v,programIdIndex:x}=y,T=Array.from(Lt.decode(y.data));let R=[];cn(R,v.length);let C=[];return cn(C,T.length),{programIdIndex:x,keyIndicesCount:pe.Buffer.from(R),keyIndices:v,dataLength:pe.Buffer.from(C),data:T}});let i=[];cn(i,n.length);let s=pe.Buffer.alloc(hi);pe.Buffer.from(i).copy(s);let o=i.length;n.forEach(y=>{const x=te([Me("programIdIndex"),Xe(y.keyIndicesCount.length,"keyIndicesCount"),qt(Me("keyIndex"),y.keyIndices.length,"keyIndices"),Xe(y.dataLength.length,"dataLength"),qt(Me("userdatum"),y.data.length,"data")]).encode(y,s,o);o+=x}),s=s.slice(0,o);const a=te([Xe(1,"numRequiredSignatures"),Xe(1,"numReadonlySignedAccounts"),Xe(1,"numReadonlyUnsignedAccounts"),Xe(t.length,"keyCount"),qt(Ie("key"),e,"keys"),Ie("recentBlockhash")]),c={numRequiredSignatures:pe.Buffer.from([this.header.numRequiredSignatures]),numReadonlySignedAccounts:pe.Buffer.from([this.header.numReadonlySignedAccounts]),numReadonlyUnsignedAccounts:pe.Buffer.from([this.header.numReadonlyUnsignedAccounts]),keyCount:pe.Buffer.from(t),keys:this.accountKeys.map(y=>Nt(y.toBytes())),recentBlockhash:Lt.decode(this.recentBlockhash)};let u=pe.Buffer.alloc(2048);const g=a.encode(c,u);return s.copy(u,g),u.slice(0,g+s.length)}static from(e){let t=[...e];const n=Fn(t);if(n!==(n&pg))throw new Error("Versioned messages must be deserialized with VersionedMessage.deserialize()");const i=Fn(t),s=Fn(t),o=an(t);let a=[];for(let v=0;v<o;v++){const x=ln(t,0,gr);a.push(new ae(pe.Buffer.from(x)))}const c=ln(t,0,gr),u=an(t);let g=[];for(let v=0;v<u;v++){const x=Fn(t),T=an(t),R=ln(t,0,T),C=an(t),D=ln(t,0,C),U=Lt.encode(pe.Buffer.from(D));g.push({programIdIndex:x,accounts:R,data:U})}const y={header:{numRequiredSignatures:n,numReadonlySignedAccounts:i,numReadonlyUnsignedAccounts:s},recentBlockhash:Lt.encode(pe.Buffer.from(c)),accountKeys:a,instructions:g};return new br(y)}}class bo{constructor(e){this.header=void 0,this.staticAccountKeys=void 0,this.recentBlockhash=void 0,this.compiledInstructions=void 0,this.addressTableLookups=void 0,this.header=e.header,this.staticAccountKeys=e.staticAccountKeys,this.recentBlockhash=e.recentBlockhash,this.compiledInstructions=e.compiledInstructions,this.addressTableLookups=e.addressTableLookups}get version(){return 0}get numAccountKeysFromLookups(){let e=0;for(const t of this.addressTableLookups)e+=t.readonlyIndexes.length+t.writableIndexes.length;return e}getAccountKeys(e){let t;if(e&&"accountKeysFromLookups"in e&&e.accountKeysFromLookups){if(this.numAccountKeysFromLookups!=e.accountKeysFromLookups.writable.length+e.accountKeysFromLookups.readonly.length)throw new Error("Failed to get account keys because of a mismatch in the number of account keys from lookups");t=e.accountKeysFromLookups}else if(e&&"addressLookupTableAccounts"in e&&e.addressLookupTableAccounts)t=this.resolveAddressTableLookups(e.addressLookupTableAccounts);else if(this.addressTableLookups.length>0)throw new Error("Failed to get account keys because address table lookups were not resolved");return new wo(this.staticAccountKeys,t)}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures,n=this.staticAccountKeys.length;if(e>=n){const i=e-n,s=this.addressTableLookups.reduce((o,a)=>o+a.writableIndexes.length,0);return i<s}else if(e>=this.header.numRequiredSignatures){const i=e-t,o=n-t-this.header.numReadonlyUnsignedAccounts;return i<o}else{const i=t-this.header.numReadonlySignedAccounts;return e<i}}resolveAddressTableLookups(e){const t={writable:[],readonly:[]};for(const n of this.addressTableLookups){const i=e.find(s=>s.key.equals(n.accountKey));if(!i)throw new Error(`Failed to find address lookup table account for table key ${n.accountKey.toBase58()}`);for(const s of n.writableIndexes)if(s<i.state.addresses.length)t.writable.push(i.state.addresses[s]);else throw new Error(`Failed to find address for index ${s} in address lookup table ${n.accountKey.toBase58()}`);for(const s of n.readonlyIndexes)if(s<i.state.addresses.length)t.readonly.push(i.state.addresses[s]);else throw new Error(`Failed to find address for index ${s} in address lookup table ${n.accountKey.toBase58()}`)}return t}static compile(e){const t=Zo.compile(e.instructions,e.payerKey),n=new Array,i={writable:new Array,readonly:new Array},s=e.addressLookupTableAccounts||[];for(const g of s){const y=t.extractTableLookup(g);if(y!==void 0){const[v,{writable:x,readonly:T}]=y;n.push(v),i.writable.push(...x),i.readonly.push(...T)}}const[o,a]=t.getMessageComponents(),u=new wo(a,i).compileInstructions(e.instructions);return new bo({header:o,staticAccountKeys:a,recentBlockhash:e.recentBlockhash,compiledInstructions:u,addressTableLookups:n})}serialize(){const e=Array();cn(e,this.staticAccountKeys.length);const t=this.serializeInstructions(),n=Array();cn(n,this.compiledInstructions.length);const i=this.serializeAddressTableLookups(),s=Array();cn(s,this.addressTableLookups.length);const o=te([Me("prefix"),te([Me("numRequiredSignatures"),Me("numReadonlySignedAccounts"),Me("numReadonlyUnsignedAccounts")],"header"),Xe(e.length,"staticAccountKeysLength"),qt(Ie(),this.staticAccountKeys.length,"staticAccountKeys"),Ie("recentBlockhash"),Xe(n.length,"instructionsLength"),Xe(t.length,"serializedInstructions"),Xe(s.length,"addressTableLookupsLength"),Xe(i.length,"serializedAddressTableLookups")]),a=new Uint8Array(hi),u=o.encode({prefix:128,header:this.header,staticAccountKeysLength:new Uint8Array(e),staticAccountKeys:this.staticAccountKeys.map(g=>g.toBytes()),recentBlockhash:Lt.decode(this.recentBlockhash),instructionsLength:new Uint8Array(n),serializedInstructions:t,addressTableLookupsLength:new Uint8Array(s),serializedAddressTableLookups:i},a);return a.slice(0,u)}serializeInstructions(){let e=0;const t=new Uint8Array(hi);for(const n of this.compiledInstructions){const i=Array();cn(i,n.accountKeyIndexes.length);const s=Array();cn(s,n.data.length);const o=te([Me("programIdIndex"),Xe(i.length,"encodedAccountKeyIndexesLength"),qt(Me(),n.accountKeyIndexes.length,"accountKeyIndexes"),Xe(s.length,"encodedDataLength"),Xe(n.data.length,"data")]);e+=o.encode({programIdIndex:n.programIdIndex,encodedAccountKeyIndexesLength:new Uint8Array(i),accountKeyIndexes:n.accountKeyIndexes,encodedDataLength:new Uint8Array(s),data:n.data},t,e)}return t.slice(0,e)}serializeAddressTableLookups(){let e=0;const t=new Uint8Array(hi);for(const n of this.addressTableLookups){const i=Array();cn(i,n.writableIndexes.length);const s=Array();cn(s,n.readonlyIndexes.length);const o=te([Ie("accountKey"),Xe(i.length,"encodedWritableIndexesLength"),qt(Me(),n.writableIndexes.length,"writableIndexes"),Xe(s.length,"encodedReadonlyIndexesLength"),qt(Me(),n.readonlyIndexes.length,"readonlyIndexes")]);e+=o.encode({accountKey:n.accountKey.toBytes(),encodedWritableIndexesLength:new Uint8Array(i),writableIndexes:n.writableIndexes,encodedReadonlyIndexesLength:new Uint8Array(s),readonlyIndexes:n.readonlyIndexes},t,e)}return t.slice(0,e)}static deserialize(e){let t=[...e];const n=Fn(t),i=n&pg;vt(n!==i,"Expected versioned message but received legacy message");const s=i;vt(s===0,`Expected versioned message with version 0 but found version ${s}`);const o={numRequiredSignatures:Fn(t),numReadonlySignedAccounts:Fn(t),numReadonlyUnsignedAccounts:Fn(t)},a=[],c=an(t);for(let T=0;T<c;T++)a.push(new ae(ln(t,0,gr)));const u=Lt.encode(ln(t,0,gr)),g=an(t),y=[];for(let T=0;T<g;T++){const R=Fn(t),C=an(t),D=ln(t,0,C),U=an(t),L=new Uint8Array(ln(t,0,U));y.push({programIdIndex:R,accountKeyIndexes:D,data:L})}const v=an(t),x=[];for(let T=0;T<v;T++){const R=new ae(ln(t,0,gr)),C=an(t),D=ln(t,0,C),U=an(t),L=ln(t,0,U);x.push({accountKey:R,writableIndexes:D,readonlyIndexes:L})}return new bo({header:o,staticAccountKeys:a,recentBlockhash:u,compiledInstructions:y,addressTableLookups:x})}}let nr=function(r){return r[r.BLOCKHEIGHT_EXCEEDED=0]="BLOCKHEIGHT_EXCEEDED",r[r.PROCESSED=1]="PROCESSED",r[r.TIMED_OUT=2]="TIMED_OUT",r[r.NONCE_INVALID=3]="NONCE_INVALID",r}({});const tI=pe.Buffer.alloc(gg).fill(0);class gn{constructor(e){this.keys=void 0,this.programId=void 0,this.data=pe.Buffer.alloc(0),this.programId=e.programId,this.keys=e.keys,e.data&&(this.data=e.data)}toJSON(){return{keys:this.keys.map(({pubkey:e,isSigner:t,isWritable:n})=>({pubkey:e.toJSON(),isSigner:t,isWritable:n})),programId:this.programId.toJSON(),data:[...this.data]}}}class In{get signature(){return this.signatures.length>0?this.signatures[0].signature:null}constructor(e){if(this.signatures=[],this.feePayer=void 0,this.instructions=[],this.recentBlockhash=void 0,this.lastValidBlockHeight=void 0,this.nonceInfo=void 0,this.minNonceContextSlot=void 0,this._message=void 0,this._json=void 0,!!e)if(e.feePayer&&(this.feePayer=e.feePayer),e.signatures&&(this.signatures=e.signatures),Object.prototype.hasOwnProperty.call(e,"nonceInfo")){const{minContextSlot:t,nonceInfo:n}=e;this.minNonceContextSlot=t,this.nonceInfo=n}else if(Object.prototype.hasOwnProperty.call(e,"lastValidBlockHeight")){const{blockhash:t,lastValidBlockHeight:n}=e;this.recentBlockhash=t,this.lastValidBlockHeight=n}else{const{recentBlockhash:t,nonceInfo:n}=e;n&&(this.nonceInfo=n),this.recentBlockhash=t}}toJSON(){return{recentBlockhash:this.recentBlockhash||null,feePayer:this.feePayer?this.feePayer.toJSON():null,nonceInfo:this.nonceInfo?{nonce:this.nonceInfo.nonce,nonceInstruction:this.nonceInfo.nonceInstruction.toJSON()}:null,instructions:this.instructions.map(e=>e.toJSON()),signers:this.signatures.map(({publicKey:e})=>e.toJSON())}}add(...e){if(e.length===0)throw new Error("No instructions");return e.forEach(t=>{"instructions"in t?this.instructions=this.instructions.concat(t.instructions):"data"in t&&"programId"in t&&"keys"in t?this.instructions.push(t):this.instructions.push(new gn(t))}),this}compileMessage(){if(this._message&&JSON.stringify(this.toJSON())===JSON.stringify(this._json))return this._message;let e,t;if(this.nonceInfo?(e=this.nonceInfo.nonce,this.instructions[0]!=this.nonceInfo.nonceInstruction?t=[this.nonceInfo.nonceInstruction,...this.instructions]:t=this.instructions):(e=this.recentBlockhash,t=this.instructions),!e)throw new Error("Transaction recentBlockhash required");t.length<1&&console.warn("No instructions provided");let n;if(this.feePayer)n=this.feePayer;else if(this.signatures.length>0&&this.signatures[0].publicKey)n=this.signatures[0].publicKey;else throw new Error("Transaction fee payer required");for(let R=0;R<t.length;R++)if(t[R].programId===void 0)throw new Error(`Transaction instruction index ${R} has undefined program id`);const i=[],s=[];t.forEach(R=>{R.keys.forEach(D=>{s.push({...D})});const C=R.programId.toString();i.includes(C)||i.push(C)}),i.forEach(R=>{s.push({pubkey:new ae(R),isSigner:!1,isWritable:!1})});const o=[];s.forEach(R=>{const C=R.pubkey.toString(),D=o.findIndex(U=>U.pubkey.toString()===C);D>-1?(o[D].isWritable=o[D].isWritable||R.isWritable,o[D].isSigner=o[D].isSigner||R.isSigner):o.push(R)}),o.sort(function(R,C){if(R.isSigner!==C.isSigner)return R.isSigner?-1:1;if(R.isWritable!==C.isWritable)return R.isWritable?-1:1;const D={localeMatcher:"best fit",usage:"sort",sensitivity:"variant",ignorePunctuation:!1,numeric:!1,caseFirst:"lower"};return R.pubkey.toBase58().localeCompare(C.pubkey.toBase58(),"en",D)});const a=o.findIndex(R=>R.pubkey.equals(n));if(a>-1){const[R]=o.splice(a,1);R.isSigner=!0,R.isWritable=!0,o.unshift(R)}else o.unshift({pubkey:n,isSigner:!0,isWritable:!0});for(const R of this.signatures){const C=o.findIndex(D=>D.pubkey.equals(R.publicKey));if(C>-1)o[C].isSigner||(o[C].isSigner=!0,console.warn("Transaction references a signature that is unnecessary, only the fee payer and instruction signer accounts should sign a transaction. This behavior is deprecated and will throw an error in the next major version release."));else throw new Error(`unknown signer: ${R.publicKey.toString()}`)}let c=0,u=0,g=0;const y=[],v=[];o.forEach(({pubkey:R,isSigner:C,isWritable:D})=>{C?(y.push(R.toString()),c+=1,D||(u+=1)):(v.push(R.toString()),D||(g+=1))});const x=y.concat(v),T=t.map(R=>{const{data:C,programId:D}=R;return{programIdIndex:x.indexOf(D.toString()),accounts:R.keys.map(U=>x.indexOf(U.pubkey.toString())),data:Lt.encode(C)}});return T.forEach(R=>{vt(R.programIdIndex>=0),R.accounts.forEach(C=>vt(C>=0))}),new br({header:{numRequiredSignatures:c,numReadonlySignedAccounts:u,numReadonlyUnsignedAccounts:g},accountKeys:x,recentBlockhash:e,instructions:T})}_compile(){const e=this.compileMessage(),t=e.accountKeys.slice(0,e.header.numRequiredSignatures);return this.signatures.length===t.length&&this.signatures.every((i,s)=>t[s].equals(i.publicKey))||(this.signatures=t.map(n=>({signature:null,publicKey:n}))),e}serializeMessage(){return this._compile().serialize()}async getEstimatedFee(e){return(await e.getFeeForMessage(this.compileMessage())).value}setSigners(...e){if(e.length===0)throw new Error("No signers");const t=new Set;this.signatures=e.filter(n=>{const i=n.toString();return t.has(i)?!1:(t.add(i),!0)}).map(n=>({signature:null,publicKey:n}))}sign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,n=[];for(const s of e){const o=s.publicKey.toString();t.has(o)||(t.add(o),n.push(s))}this.signatures=n.map(s=>({signature:null,publicKey:s.publicKey}));const i=this._compile();this._partialSign(i,...n)}partialSign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,n=[];for(const s of e){const o=s.publicKey.toString();t.has(o)||(t.add(o),n.push(s))}const i=this._compile();this._partialSign(i,...n)}_partialSign(e,...t){const n=e.serialize();t.forEach(i=>{const s=GS(n,i.secretKey);this._addSignature(i.publicKey,Nt(s))})}addSignature(e,t){this._compile(),this._addSignature(e,t)}_addSignature(e,t){vt(t.length===64);const n=this.signatures.findIndex(i=>e.equals(i.publicKey));if(n<0)throw new Error(`unknown signer: ${e.toString()}`);this.signatures[n].signature=pe.Buffer.from(t)}verifySignatures(e=!0){return!this._getMessageSignednessErrors(this.serializeMessage(),e)}_getMessageSignednessErrors(e,t){const n={};for(const{signature:i,publicKey:s}of this.signatures)i===null?t&&(n.missing||(n.missing=[])).push(s):jS(i,e,s.toBytes())||(n.invalid||(n.invalid=[])).push(s);return n.invalid||n.missing?n:void 0}serialize(e){const{requireAllSignatures:t,verifySignatures:n}=Object.assign({requireAllSignatures:!0,verifySignatures:!0},e),i=this.serializeMessage();if(n){const s=this._getMessageSignednessErrors(i,t);if(s){let o="Signature verification failed.";throw s.invalid&&(o+=`
Invalid signature for public key${s.invalid.length===1?"":"(s)"} [\`${s.invalid.map(a=>a.toBase58()).join("`, `")}\`].`),s.missing&&(o+=`
Missing signature for public key${s.missing.length===1?"":"(s)"} [\`${s.missing.map(a=>a.toBase58()).join("`, `")}\`].`),new Error(o)}}return this._serialize(i)}_serialize(e){const{signatures:t}=this,n=[];cn(n,t.length);const i=n.length+t.length*64+e.length,s=pe.Buffer.alloc(i);return vt(t.length<256),pe.Buffer.from(n).copy(s,0),t.forEach(({signature:o},a)=>{o!==null&&(vt(o.length===64,"signature has invalid length"),pe.Buffer.from(o).copy(s,n.length+a*64))}),e.copy(s,n.length+t.length*64),vt(s.length<=hi,`Transaction too large: ${s.length} > ${hi}`),s}get keys(){return vt(this.instructions.length===1),this.instructions[0].keys.map(e=>e.pubkey)}get programId(){return vt(this.instructions.length===1),this.instructions[0].programId}get data(){return vt(this.instructions.length===1),this.instructions[0].data}static from(e){let t=[...e];const n=an(t);let i=[];for(let s=0;s<n;s++){const o=ln(t,0,gg);i.push(Lt.encode(pe.Buffer.from(o)))}return In.populate(br.from(t),i)}static populate(e,t=[]){const n=new In;return n.recentBlockhash=e.recentBlockhash,e.header.numRequiredSignatures>0&&(n.feePayer=e.accountKeys[0]),t.forEach((i,s)=>{const o={signature:i==Lt.encode(tI)?null:Lt.decode(i),publicKey:e.accountKeys[s]};n.signatures.push(o)}),e.instructions.forEach(i=>{const s=i.accounts.map(o=>{const a=e.accountKeys[o];return{pubkey:a,isSigner:n.signatures.some(c=>c.publicKey.toString()===a.toString())||e.isAccountSigner(o),isWritable:e.isAccountWritable(o)}});n.instructions.push(new gn({keys:s,programId:e.accountKeys[i.programIdIndex],data:Lt.decode(i.data)}))}),n._message=e,n._json=n.toJSON(),n}}const nI=160,rI=64,iI=nI/rI,sI=1e3/iI;new ae("SysvarC1ock11111111111111111111111111111111");new ae("SysvarEpochSchedu1e111111111111111111111111");new ae("Sysvar1nstructions1111111111111111111111111");const Ja=new ae("SysvarRecentB1ockHashes11111111111111111111"),Wh=new ae("SysvarRent111111111111111111111111111111111");new ae("SysvarRewards111111111111111111111111111111");new ae("SysvarS1otHashes111111111111111111111111111");new ae("SysvarS1otHistory11111111111111111111111111");new ae("SysvarStakeHistory1111111111111111111111111");class $h extends Error{constructor({action:e,signature:t,transactionMessage:n,logs:i}){const s=i?`Logs: 
${JSON.stringify(i.slice(-10),null,2)}. `:"",o="\nCatch the `SendTransactionError` and call `getLogs()` on it for full details.";let a;switch(e){case"send":a=`Transaction ${t} resulted in an error. 
${n}. `+s+o;break;case"simulate":a=`Simulation failed. 
Message: ${n}. 
`+s+o;break;default:a=`Unknown action '${(c=>c)(e)}'`}super(a),this.signature=void 0,this.transactionMessage=void 0,this.transactionLogs=void 0,this.signature=t,this.transactionMessage=n,this.transactionLogs=i||void 0}get transactionError(){return{message:this.transactionMessage,logs:Array.isArray(this.transactionLogs)?this.transactionLogs:void 0}}get logs(){const e=this.transactionLogs;if(!(e!=null&&typeof e=="object"&&"then"in e))return e}async getLogs(e){return Array.isArray(this.transactionLogs)||(this.transactionLogs=new Promise((t,n)=>{e.getTransaction(this.signature).then(i=>{if(i&&i.meta&&i.meta.logMessages){const s=i.meta.logMessages;this.transactionLogs=s,t(s)}else n(new Error("Log messages not found"))}).catch(n)})),await this.transactionLogs}}class ne extends Error{constructor({code:e,message:t,data:n},i){super(i!=null?`${i}: ${t}`:t),this.code=void 0,this.data=void 0,this.code=e,this.data=n,this.name="SolanaJSONRPCError"}}function Qr(r){return new Promise(e=>setTimeout(e,r))}function nn(r,e){const t=r.layout.span>=0?r.layout.span:_g(r,e),n=pe.Buffer.alloc(t),i=Object.assign({instruction:r.index},e);return r.layout.encode(i,n),n}const oI=Mt("lamportsPerSignature"),bg=te([ie("version"),ie("state"),Ie("authorizedPubkey"),Ie("nonce"),te([oI],"feeCalculator")]),Hh=bg.span;class tu{constructor(e){this.authorizedPubkey=void 0,this.nonce=void 0,this.feeCalculator=void 0,this.authorizedPubkey=e.authorizedPubkey,this.nonce=e.nonce,this.feeCalculator=e.feeCalculator}static fromAccountData(e){const t=bg.decode(Nt(e),0);return new tu({authorizedPubkey:new ae(t.authorizedPubkey),nonce:new ae(t.nonce).toString(),feeCalculator:t.feeCalculator})}}const aI=r=>{const e=r.decode.bind(r),t=r.encode.bind(r);return{decode:e,encode:t}},cI=r=>e=>{const t=Xe(r,e),{encode:n,decode:i}=aI(t),s=t;return s.decode=(o,a)=>{const c=i(o,a);return zE(pe.Buffer.from(c))},s.encode=(o,a,c)=>{const u=jE(o,r);return n(u,a,c)},s},Ei=cI(8),rn=Object.freeze({Create:{index:0,layout:te([ie("instruction"),en("lamports"),en("space"),Ie("programId")])},Assign:{index:1,layout:te([ie("instruction"),Ie("programId")])},Transfer:{index:2,layout:te([ie("instruction"),Ei("lamports")])},CreateWithSeed:{index:3,layout:te([ie("instruction"),Ie("base"),ri("seed"),en("lamports"),en("space"),Ie("programId")])},AdvanceNonceAccount:{index:4,layout:te([ie("instruction")])},WithdrawNonceAccount:{index:5,layout:te([ie("instruction"),en("lamports")])},InitializeNonceAccount:{index:6,layout:te([ie("instruction"),Ie("authorized")])},AuthorizeNonceAccount:{index:7,layout:te([ie("instruction"),Ie("authorized")])},Allocate:{index:8,layout:te([ie("instruction"),en("space")])},AllocateWithSeed:{index:9,layout:te([ie("instruction"),Ie("base"),ri("seed"),en("space"),Ie("programId")])},AssignWithSeed:{index:10,layout:te([ie("instruction"),Ie("base"),ri("seed"),Ie("programId")])},TransferWithSeed:{index:11,layout:te([ie("instruction"),Ei("lamports"),ri("seed"),Ie("programId")])},UpgradeNonceAccount:{index:12,layout:te([ie("instruction")])}});class cs{constructor(){}static createAccount(e){const t=rn.Create,n=nn(t,{lamports:e.lamports,space:e.space,programId:Nt(e.programId.toBuffer())});return new gn({keys:[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.newAccountPubkey,isSigner:!0,isWritable:!0}],programId:this.programId,data:n})}static transfer(e){let t,n;if("basePubkey"in e){const i=rn.TransferWithSeed;t=nn(i,{lamports:BigInt(e.lamports),seed:e.seed,programId:Nt(e.programId.toBuffer())}),n=[{pubkey:e.fromPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0}]}else{const i=rn.Transfer;t=nn(i,{lamports:BigInt(e.lamports)}),n=[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0}]}return new gn({keys:n,programId:this.programId,data:t})}static assign(e){let t,n;if("basePubkey"in e){const i=rn.AssignWithSeed;t=nn(i,{base:Nt(e.basePubkey.toBuffer()),seed:e.seed,programId:Nt(e.programId.toBuffer())}),n=[{pubkey:e.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1}]}else{const i=rn.Assign;t=nn(i,{programId:Nt(e.programId.toBuffer())}),n=[{pubkey:e.accountPubkey,isSigner:!0,isWritable:!0}]}return new gn({keys:n,programId:this.programId,data:t})}static createAccountWithSeed(e){const t=rn.CreateWithSeed,n=nn(t,{base:Nt(e.basePubkey.toBuffer()),seed:e.seed,lamports:e.lamports,space:e.space,programId:Nt(e.programId.toBuffer())});let i=[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.newAccountPubkey,isSigner:!1,isWritable:!0}];return e.basePubkey.equals(e.fromPubkey)||i.push({pubkey:e.basePubkey,isSigner:!0,isWritable:!1}),new gn({keys:i,programId:this.programId,data:n})}static createNonceAccount(e){const t=new In;"basePubkey"in e&&"seed"in e?t.add(cs.createAccountWithSeed({fromPubkey:e.fromPubkey,newAccountPubkey:e.noncePubkey,basePubkey:e.basePubkey,seed:e.seed,lamports:e.lamports,space:Hh,programId:this.programId})):t.add(cs.createAccount({fromPubkey:e.fromPubkey,newAccountPubkey:e.noncePubkey,lamports:e.lamports,space:Hh,programId:this.programId}));const n={noncePubkey:e.noncePubkey,authorizedPubkey:e.authorizedPubkey};return t.add(this.nonceInitialize(n)),t}static nonceInitialize(e){const t=rn.InitializeNonceAccount,n=nn(t,{authorized:Nt(e.authorizedPubkey.toBuffer())}),i={keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:Ja,isSigner:!1,isWritable:!1},{pubkey:Wh,isSigner:!1,isWritable:!1}],programId:this.programId,data:n};return new gn(i)}static nonceAdvance(e){const t=rn.AdvanceNonceAccount,n=nn(t),i={keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:Ja,isSigner:!1,isWritable:!1},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:n};return new gn(i)}static nonceWithdraw(e){const t=rn.WithdrawNonceAccount,n=nn(t,{lamports:e.lamports});return new gn({keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0},{pubkey:Ja,isSigner:!1,isWritable:!1},{pubkey:Wh,isSigner:!1,isWritable:!1},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:n})}static nonceAuthorize(e){const t=rn.AuthorizeNonceAccount,n=nn(t,{authorized:Nt(e.newAuthorizedPubkey.toBuffer())});return new gn({keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:n})}static allocate(e){let t,n;if("basePubkey"in e){const i=rn.AllocateWithSeed;t=nn(i,{base:Nt(e.basePubkey.toBuffer()),seed:e.seed,space:e.space,programId:Nt(e.programId.toBuffer())}),n=[{pubkey:e.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1}]}else{const i=rn.Allocate;t=nn(i,{space:e.space}),n=[{pubkey:e.accountPubkey,isSigner:!0,isWritable:!0}]}return new gn({keys:n,programId:this.programId,data:t})}}cs.programId=new ae("11111111111111111111111111111111");new ae("BPFLoader2111111111111111111111111111111111");function lI(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Za,qh;function uI(){if(qh)return Za;qh=1;var r=Object.prototype.toString,e=Object.keys||function(n){var i=[];for(var s in n)i.push(s);return i};function t(n,i){var s,o,a,c,u,g,y;if(n===!0)return"true";if(n===!1)return"false";switch(typeof n){case"object":if(n===null)return null;if(n.toJSON&&typeof n.toJSON=="function")return t(n.toJSON(),i);if(y=r.call(n),y==="[object Array]"){for(a="[",o=n.length-1,s=0;s<o;s++)a+=t(n[s],!0)+",";return o>-1&&(a+=t(n[s],!0)),a+"]"}else if(y==="[object Object]"){for(c=e(n).sort(),o=c.length,a="",s=0;s<o;)u=c[s],g=t(n[u],!1),g!==void 0&&(a&&(a+=","),a+=JSON.stringify(u)+":"+g),s++;return"{"+a+"}"}else return JSON.stringify(n);case"function":case"undefined":return i?null:void 0;case"string":return JSON.stringify(n);default:return isFinite(n)?n:null}}return Za=function(n){var i=t(n,!1);if(i!==void 0)return""+i},Za}var hI=uI(),zh=lI(hI);const Ui=32;function Xa(r){let e=0;for(;r>1;)r/=2,e++;return e}function dI(r){return r===0?1:(r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r|=r>>32,r+1)}class fI{constructor(e,t,n,i,s){this.slotsPerEpoch=void 0,this.leaderScheduleSlotOffset=void 0,this.warmup=void 0,this.firstNormalEpoch=void 0,this.firstNormalSlot=void 0,this.slotsPerEpoch=e,this.leaderScheduleSlotOffset=t,this.warmup=n,this.firstNormalEpoch=i,this.firstNormalSlot=s}getEpoch(e){return this.getEpochAndSlotIndex(e)[0]}getEpochAndSlotIndex(e){if(e<this.firstNormalSlot){const t=Xa(dI(e+Ui+1))-Xa(Ui)-1,n=this.getSlotsInEpoch(t),i=e-(n-Ui);return[t,i]}else{const t=e-this.firstNormalSlot,n=Math.floor(t/this.slotsPerEpoch),i=this.firstNormalEpoch+n,s=t%this.slotsPerEpoch;return[i,s]}}getFirstSlotInEpoch(e){return e<=this.firstNormalEpoch?(Math.pow(2,e)-1)*Ui:(e-this.firstNormalEpoch)*this.slotsPerEpoch+this.firstNormalSlot}getLastSlotInEpoch(e){return this.getFirstSlotInEpoch(e)+this.getSlotsInEpoch(e)-1}getSlotsInEpoch(e){return e<this.firstNormalEpoch?Math.pow(2,e+Xa(Ui)):this.slotsPerEpoch}}var pI=globalThis.fetch;class gI extends BS{constructor(e,t,n){const i=s=>{const o=MS(s,{autoconnect:!0,max_reconnects:5,reconnect:!0,reconnect_interval:1e3,...t});return"socket"in o?this.underlyingSocket=o.socket:this.underlyingSocket=o,o};super(i,e,t,n),this.underlyingSocket=void 0}call(...e){var n;const t=(n=this.underlyingSocket)==null?void 0:n.readyState;return t===1?super.call(...e):Promise.reject(new Error("Tried to call a JSON-RPC method `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}notify(...e){var n;const t=(n=this.underlyingSocket)==null?void 0:n.readyState;return t===1?super.notify(...e):Promise.reject(new Error("Tried to send a JSON-RPC notification `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}}function mI(r,e){let t;try{t=r.layout.decode(e)}catch(n){throw new Error("invalid instruction; "+n)}if(t.typeIndex!==r.index)throw new Error(`invalid account data; account type mismatch ${t.typeIndex} != ${r.index}`);return t}const Vh=56;class Gh{constructor(e){this.key=void 0,this.state=void 0,this.key=e.key,this.state=e.state}isActive(){const e=BigInt("0xffffffffffffffff");return this.state.deactivationSlot===e}static deserialize(e){const t=mI(yI,e),n=e.length-Vh;vt(n>=0,"lookup table is invalid"),vt(n%32===0,"lookup table is invalid");const i=n/32,{addresses:s}=te([qt(Ie(),i,"addresses")]).decode(e.slice(Vh));return{deactivationSlot:t.deactivationSlot,lastExtendedSlot:t.lastExtendedSlot,lastExtendedSlotStartIndex:t.lastExtendedStartIndex,authority:t.authority.length!==0?new ae(t.authority[0]):void 0,addresses:s.map(o=>new ae(o))}}}const yI={index:1,layout:te([ie("typeIndex"),Ei("deactivationSlot"),Mt("lastExtendedSlot"),Me("lastExtendedStartIndex"),Me(),qt(Ie(),Rr(Me(),-1),"authority")])},_I=/^[^:]+:\/\/([^:[]+|\[[^\]]+\])(:\d+)?(.*)/i;function wI(r){const e=r.match(_I);if(e==null)throw TypeError(`Failed to validate endpoint URL \`${r}\``);const[t,n,i,s]=e,o=r.startsWith("https:")?"wss:":"ws:",a=i==null?null:parseInt(i.slice(1),10),c=a==null?"":`:${a+1}`;return`${o}//${n}${c}${s}`}const Ye=xs(Ql(ae),q(),r=>new ae(r)),vg=eu([q(),je("base64")]),nu=xs(Ql(pe.Buffer),vg,r=>pe.Buffer.from(r[0],"base64")),bI=30*1e3;function vI(r){if(/^https?:/.test(r)===!1)throw new TypeError("Endpoint URL must start with `http:` or `https:`.");return r}function Ue(r){let e,t;if(typeof r=="string")e=r;else if(r){const{commitment:n,...i}=r;e=n,t=i}return{commitment:e,config:t}}function jh(r){return r.map(e=>"memcmp"in e?{...e,memcmp:{...e.memcmp,encoding:e.memcmp.encoding??"base58"}}:e)}function Eg(r){return Gt([W({jsonrpc:je("2.0"),id:q(),result:r}),W({jsonrpc:je("2.0"),id:q(),error:W({code:Bi(),message:q(),data:se(tS())})})])}const EI=Eg(Bi());function _e(r){return xs(Eg(r),EI,e=>"error"in e?e:{...e,result:G(e.result,r)})}function tt(r){return _e(W({context:W({slot:P()}),value:r}))}function Xo(r){return W({context:W({slot:P()}),value:r})}function Qa(r,e){return r===0?new bo({header:e.header,staticAccountKeys:e.accountKeys.map(t=>new ae(t)),recentBlockhash:e.recentBlockhash,compiledInstructions:e.instructions.map(t=>({programIdIndex:t.programIdIndex,accountKeyIndexes:t.accounts,data:Lt.decode(t.data)})),addressTableLookups:e.addressTableLookups}):new br(e)}const SI=W({foundation:P(),foundationTerm:P(),initial:P(),taper:P(),terminal:P()}),II=_e(K(J(W({epoch:P(),effectiveSlot:P(),amount:P(),postBalance:P(),commission:se(J(P()))})))),xI=K(W({slot:P(),prioritizationFee:P()})),kI=W({total:P(),validator:P(),foundation:P(),epoch:P()}),CI=W({epoch:P(),slotIndex:P(),slotsInEpoch:P(),absoluteSlot:P(),blockHeight:se(P()),transactionCount:se(P())}),AI=W({slotsPerEpoch:P(),leaderScheduleSlotOffset:P(),warmup:An(),firstNormalEpoch:P(),firstNormalSlot:P()}),TI=ng(q(),K(P())),qr=J(Gt([W({}),q()])),RI=W({err:qr}),MI=je("receivedSignature"),NI=W({"solana-core":q(),"feature-set":se(P())}),BI=W({program:q(),programId:Ye,parsed:Bi()}),PI=W({programId:Ye,accounts:K(Ye),data:q()}),Kh=tt(W({err:J(Gt([W({}),q()])),logs:J(K(q())),accounts:se(J(K(J(W({executable:An(),owner:q(),lamports:P(),data:K(q()),rentEpoch:se(P())}))))),unitsConsumed:se(P()),returnData:se(J(W({programId:q(),data:eu([q(),je("base64")])}))),innerInstructions:se(J(K(W({index:P(),instructions:K(Gt([BI,PI]))}))))})),LI=tt(W({byIdentity:ng(q(),K(P())),range:W({firstSlot:P(),lastSlot:P()})}));function OI(r,e,t,n,i,s){const o=t||pI;let a;s!=null&&console.warn("You have supplied an `httpAgent` when creating a `Connection` in a browser environment.It has been ignored; `httpAgent` is only used in Node environments.");let c;return n&&(c=async(g,y)=>{const v=await new Promise((x,T)=>{try{n(g,y,(R,C)=>x([R,C]))}catch(R){T(R)}});return await o(...v)}),new AS(async(g,y)=>{const v={method:"POST",body:g,agent:a,headers:Object.assign({"Content-Type":"application/json"},e||{},Ox)};try{let x=5,T,R=500;for(;c?T=await c(r,v):T=await o(r,v),!(T.status!==429||i===!0||(x-=1,x===0));)console.error(`Server responded with ${T.status} ${T.statusText}.  Retrying after ${R}ms delay...`),await Qr(R),R*=2;const C=await T.text();T.ok?y(null,C):y(new Error(`${T.status} ${T.statusText}: ${C}`))}catch(x){x instanceof Error&&y(x)}},{})}function DI(r){return(e,t)=>new Promise((n,i)=>{r.request(e,t,(s,o)=>{if(s){i(s);return}n(o)})})}function FI(r){return e=>new Promise((t,n)=>{e.length===0&&t([]);const i=e.map(s=>r.request(s.methodName,s.args));r.request(i,(s,o)=>{if(s){n(s);return}t(o)})})}const UI=_e(SI),WI=_e(kI),$I=_e(xI),HI=_e(CI),qI=_e(AI),zI=_e(TI),VI=_e(P()),GI=tt(W({total:P(),circulating:P(),nonCirculating:P(),nonCirculatingAccounts:K(Ye)})),Pc=W({amount:q(),uiAmount:J(P()),decimals:P(),uiAmountString:se(q())}),jI=tt(K(W({address:Ye,amount:q(),uiAmount:J(P()),decimals:P(),uiAmountString:se(q())}))),KI=tt(K(W({pubkey:Ye,account:W({executable:An(),owner:Ye,lamports:P(),data:nu,rentEpoch:P()})}))),Lc=W({program:q(),parsed:Bi(),space:P()}),YI=tt(K(W({pubkey:Ye,account:W({executable:An(),owner:Ye,lamports:P(),data:Lc,rentEpoch:P()})}))),JI=tt(K(W({lamports:P(),address:Ye}))),ls=W({executable:An(),owner:Ye,lamports:P(),data:nu,rentEpoch:P()}),ZI=W({pubkey:Ye,account:ls}),XI=xs(Gt([Ql(pe.Buffer),Lc]),Gt([vg,Lc]),r=>Array.isArray(r)?G(r,nu):r),Oc=W({executable:An(),owner:Ye,lamports:P(),data:XI,rentEpoch:P()}),QI=W({pubkey:Ye,account:Oc}),ex=W({state:Gt([je("active"),je("inactive"),je("activating"),je("deactivating")]),active:P(),inactive:P()}),tx=_e(K(W({signature:q(),slot:P(),err:qr,memo:J(q()),blockTime:se(J(P()))}))),nx=_e(K(W({signature:q(),slot:P(),err:qr,memo:J(q()),blockTime:se(J(P()))}))),rx=W({subscription:P(),result:Xo(ls)}),ix=W({pubkey:Ye,account:ls}),sx=W({subscription:P(),result:Xo(ix)}),ox=W({parent:P(),slot:P(),root:P()}),ax=W({subscription:P(),result:ox}),cx=Gt([W({type:Gt([je("firstShredReceived"),je("completed"),je("optimisticConfirmation"),je("root")]),slot:P(),timestamp:P()}),W({type:je("createdBank"),parent:P(),slot:P(),timestamp:P()}),W({type:je("frozen"),slot:P(),timestamp:P(),stats:W({numTransactionEntries:P(),numSuccessfulTransactions:P(),numFailedTransactions:P(),maxTransactionsPerEntry:P()})}),W({type:je("dead"),slot:P(),timestamp:P(),err:q()})]),lx=W({subscription:P(),result:cx}),ux=W({subscription:P(),result:Xo(Gt([RI,MI]))}),hx=W({subscription:P(),result:P()}),dx=W({pubkey:q(),gossip:J(q()),tpu:J(q()),rpc:J(q()),version:J(q())}),Yh=W({votePubkey:q(),nodePubkey:q(),activatedStake:P(),epochVoteAccount:An(),epochCredits:K(eu([P(),P(),P()])),commission:P(),lastVote:P(),rootSlot:J(P())}),fx=_e(W({current:K(Yh),delinquent:K(Yh)})),px=Gt([je("processed"),je("confirmed"),je("finalized")]),gx=W({slot:P(),confirmations:J(P()),err:qr,confirmationStatus:se(px)}),mx=tt(K(J(gx))),yx=_e(P()),Sg=W({accountKey:Ye,writableIndexes:K(P()),readonlyIndexes:K(P())}),ru=W({signatures:K(q()),message:W({accountKeys:K(q()),header:W({numRequiredSignatures:P(),numReadonlySignedAccounts:P(),numReadonlyUnsignedAccounts:P()}),instructions:K(W({accounts:K(P()),data:q(),programIdIndex:P()})),recentBlockhash:q(),addressTableLookups:se(K(Sg))})}),Ig=W({pubkey:Ye,signer:An(),writable:An(),source:se(Gt([je("transaction"),je("lookupTable")]))}),xg=W({accountKeys:K(Ig),signatures:K(q())}),kg=W({parsed:Bi(),program:q(),programId:Ye}),Cg=W({accounts:K(Ye),data:q(),programId:Ye}),_x=Gt([Cg,kg]),wx=Gt([W({parsed:Bi(),program:q(),programId:q()}),W({accounts:K(q()),data:q(),programId:q()})]),Ag=xs(_x,wx,r=>"accounts"in r?G(r,Cg):G(r,kg)),Tg=W({signatures:K(q()),message:W({accountKeys:K(Ig),instructions:K(Ag),recentBlockhash:q(),addressTableLookups:se(J(K(Sg)))})}),vo=W({accountIndex:P(),mint:q(),owner:se(q()),programId:se(q()),uiTokenAmount:Pc}),Rg=W({writable:K(Ye),readonly:K(Ye)}),Qo=W({err:qr,fee:P(),innerInstructions:se(J(K(W({index:P(),instructions:K(W({accounts:K(P()),data:q(),programIdIndex:P()}))})))),preBalances:K(P()),postBalances:K(P()),logMessages:se(J(K(q()))),preTokenBalances:se(J(K(vo))),postTokenBalances:se(J(K(vo))),loadedAddresses:se(Rg),computeUnitsConsumed:se(P())}),iu=W({err:qr,fee:P(),innerInstructions:se(J(K(W({index:P(),instructions:K(Ag)})))),preBalances:K(P()),postBalances:K(P()),logMessages:se(J(K(q()))),preTokenBalances:se(J(K(vo))),postTokenBalances:se(J(K(vo))),loadedAddresses:se(Rg),computeUnitsConsumed:se(P())}),Pi=Gt([je(0),je("legacy")]),zr=W({pubkey:q(),lamports:P(),postBalance:J(P()),rewardType:J(q()),commission:se(J(P()))}),bx=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),transactions:K(W({transaction:ru,meta:J(Qo),version:se(Pi)})),rewards:se(K(zr)),blockTime:J(P()),blockHeight:J(P())}))),vx=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),rewards:se(K(zr)),blockTime:J(P()),blockHeight:J(P())}))),Ex=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),transactions:K(W({transaction:xg,meta:J(Qo),version:se(Pi)})),rewards:se(K(zr)),blockTime:J(P()),blockHeight:J(P())}))),Sx=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),transactions:K(W({transaction:Tg,meta:J(iu),version:se(Pi)})),rewards:se(K(zr)),blockTime:J(P()),blockHeight:J(P())}))),Ix=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),transactions:K(W({transaction:xg,meta:J(iu),version:se(Pi)})),rewards:se(K(zr)),blockTime:J(P()),blockHeight:J(P())}))),xx=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),rewards:se(K(zr)),blockTime:J(P()),blockHeight:J(P())}))),kx=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),transactions:K(W({transaction:ru,meta:J(Qo)})),rewards:se(K(zr)),blockTime:J(P())}))),Jh=_e(J(W({blockhash:q(),previousBlockhash:q(),parentSlot:P(),signatures:K(q()),blockTime:J(P())}))),ec=_e(J(W({slot:P(),meta:J(Qo),blockTime:se(J(P())),transaction:ru,version:se(Pi)}))),Ps=_e(J(W({slot:P(),transaction:Tg,meta:J(iu),blockTime:se(J(P())),version:se(Pi)}))),Cx=tt(W({blockhash:q(),lastValidBlockHeight:P()})),Ax=tt(An()),Tx=W({slot:P(),numTransactions:P(),numSlots:P(),samplePeriodSecs:P()}),Rx=_e(K(Tx)),Mx=tt(J(W({feeCalculator:W({lamportsPerSignature:P()})}))),Nx=_e(q()),Bx=_e(q()),Px=W({err:qr,logs:K(q()),signature:q()}),Lx=W({result:Xo(Px),subscription:P()}),Ox={"solana-client":"js/1.0.0-maintenance"};class Mg{constructor(e,t){this._commitment=void 0,this._confirmTransactionInitialTimeout=void 0,this._rpcEndpoint=void 0,this._rpcWsEndpoint=void 0,this._rpcClient=void 0,this._rpcRequest=void 0,this._rpcBatchRequest=void 0,this._rpcWebSocket=void 0,this._rpcWebSocketConnected=!1,this._rpcWebSocketHeartbeat=null,this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketGeneration=0,this._disableBlockhashCaching=!1,this._pollingBlockhash=!1,this._blockhashInfo={latestBlockhash:null,lastFetch:0,transactionSignatures:[],simulatedSignatures:[]},this._nextClientSubscriptionId=0,this._subscriptionDisposeFunctionsByClientSubscriptionId={},this._subscriptionHashByClientSubscriptionId={},this._subscriptionStateChangeCallbacksByHash={},this._subscriptionCallbacksByServerSubscriptionId={},this._subscriptionsByHash={},this._subscriptionsAutoDisposedByRpc=new Set,this.getBlockHeight=(()=>{const u={};return async g=>{const{commitment:y,config:v}=Ue(g),x=this._buildArgs([],y,void 0,v),T=zh(x);return u[T]=u[T]??(async()=>{try{const R=await this._rpcRequest("getBlockHeight",x),C=G(R,_e(P()));if("error"in C)throw new ne(C.error,"failed to get block height information");return C.result}finally{delete u[T]}})(),await u[T]}})();let n,i,s,o,a,c;t&&typeof t=="string"?this._commitment=t:t&&(this._commitment=t.commitment,this._confirmTransactionInitialTimeout=t.confirmTransactionInitialTimeout,n=t.wsEndpoint,i=t.httpHeaders,s=t.fetch,o=t.fetchMiddleware,a=t.disableRetryOnRateLimit,c=t.httpAgent),this._rpcEndpoint=vI(e),this._rpcWsEndpoint=n||wI(e),this._rpcClient=OI(e,i,s,o,a,c),this._rpcRequest=DI(this._rpcClient),this._rpcBatchRequest=FI(this._rpcClient),this._rpcWebSocket=new gI(this._rpcWsEndpoint,{autoconnect:!1,max_reconnects:1/0}),this._rpcWebSocket.on("open",this._wsOnOpen.bind(this)),this._rpcWebSocket.on("error",this._wsOnError.bind(this)),this._rpcWebSocket.on("close",this._wsOnClose.bind(this)),this._rpcWebSocket.on("accountNotification",this._wsOnAccountNotification.bind(this)),this._rpcWebSocket.on("programNotification",this._wsOnProgramAccountNotification.bind(this)),this._rpcWebSocket.on("slotNotification",this._wsOnSlotNotification.bind(this)),this._rpcWebSocket.on("slotsUpdatesNotification",this._wsOnSlotUpdatesNotification.bind(this)),this._rpcWebSocket.on("signatureNotification",this._wsOnSignatureNotification.bind(this)),this._rpcWebSocket.on("rootNotification",this._wsOnRootNotification.bind(this)),this._rpcWebSocket.on("logsNotification",this._wsOnLogsNotification.bind(this))}get commitment(){return this._commitment}get rpcEndpoint(){return this._rpcEndpoint}async getBalanceAndContext(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],n,void 0,i),o=await this._rpcRequest("getBalance",s),a=G(o,tt(P()));if("error"in a)throw new ne(a.error,`failed to get balance for ${e.toBase58()}`);return a.result}async getBalance(e,t){return await this.getBalanceAndContext(e,t).then(n=>n.value).catch(n=>{throw new Error("failed to get balance of account "+e.toBase58()+": "+n)})}async getBlockTime(e){const t=await this._rpcRequest("getBlockTime",[e]),n=G(t,_e(J(P())));if("error"in n)throw new ne(n.error,`failed to get block time for slot ${e}`);return n.result}async getMinimumLedgerSlot(){const e=await this._rpcRequest("minimumLedgerSlot",[]),t=G(e,_e(P()));if("error"in t)throw new ne(t.error,"failed to get minimum ledger slot");return t.result}async getFirstAvailableBlock(){const e=await this._rpcRequest("getFirstAvailableBlock",[]),t=G(e,VI);if("error"in t)throw new ne(t.error,"failed to get first available block");return t.result}async getSupply(e){let t={};typeof e=="string"?t={commitment:e}:e?t={...e,commitment:e&&e.commitment||this.commitment}:t={commitment:this.commitment};const n=await this._rpcRequest("getSupply",[t]),i=G(n,GI);if("error"in i)throw new ne(i.error,"failed to get supply");return i.result}async getTokenSupply(e,t){const n=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenSupply",n),s=G(i,tt(Pc));if("error"in s)throw new ne(s.error,"failed to get token supply");return s.result}async getTokenAccountBalance(e,t){const n=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenAccountBalance",n),s=G(i,tt(Pc));if("error"in s)throw new ne(s.error,"failed to get token account balance");return s.result}async getTokenAccountsByOwner(e,t,n){const{commitment:i,config:s}=Ue(n);let o=[e.toBase58()];"mint"in t?o.push({mint:t.mint.toBase58()}):o.push({programId:t.programId.toBase58()});const a=this._buildArgs(o,i,"base64",s),c=await this._rpcRequest("getTokenAccountsByOwner",a),u=G(c,KI);if("error"in u)throw new ne(u.error,`failed to get token accounts owned by account ${e.toBase58()}`);return u.result}async getParsedTokenAccountsByOwner(e,t,n){let i=[e.toBase58()];"mint"in t?i.push({mint:t.mint.toBase58()}):i.push({programId:t.programId.toBase58()});const s=this._buildArgs(i,n,"jsonParsed"),o=await this._rpcRequest("getTokenAccountsByOwner",s),a=G(o,YI);if("error"in a)throw new ne(a.error,`failed to get token accounts owned by account ${e.toBase58()}`);return a.result}async getLargestAccounts(e){const t={...e,commitment:e&&e.commitment||this.commitment},n=t.filter||t.commitment?[t]:[],i=await this._rpcRequest("getLargestAccounts",n),s=G(i,JI);if("error"in s)throw new ne(s.error,"failed to get largest accounts");return s.result}async getTokenLargestAccounts(e,t){const n=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenLargestAccounts",n),s=G(i,jI);if("error"in s)throw new ne(s.error,"failed to get token largest accounts");return s.result}async getAccountInfoAndContext(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],n,"base64",i),o=await this._rpcRequest("getAccountInfo",s),a=G(o,tt(J(ls)));if("error"in a)throw new ne(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getParsedAccountInfo(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],n,"jsonParsed",i),o=await this._rpcRequest("getAccountInfo",s),a=G(o,tt(J(Oc)));if("error"in a)throw new ne(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getAccountInfo(e,t){try{return(await this.getAccountInfoAndContext(e,t)).value}catch(n){throw new Error("failed to get info about account "+e.toBase58()+": "+n)}}async getMultipleParsedAccounts(e,t){const{commitment:n,config:i}=Ue(t),s=e.map(u=>u.toBase58()),o=this._buildArgs([s],n,"jsonParsed",i),a=await this._rpcRequest("getMultipleAccounts",o),c=G(a,tt(K(J(Oc))));if("error"in c)throw new ne(c.error,`failed to get info for accounts ${s}`);return c.result}async getMultipleAccountsInfoAndContext(e,t){const{commitment:n,config:i}=Ue(t),s=e.map(u=>u.toBase58()),o=this._buildArgs([s],n,"base64",i),a=await this._rpcRequest("getMultipleAccounts",o),c=G(a,tt(K(J(ls))));if("error"in c)throw new ne(c.error,`failed to get info for accounts ${s}`);return c.result}async getMultipleAccountsInfo(e,t){return(await this.getMultipleAccountsInfoAndContext(e,t)).value}async getStakeActivation(e,t,n){const{commitment:i,config:s}=Ue(t),o=this._buildArgs([e.toBase58()],i,void 0,{...s,epoch:n??(s==null?void 0:s.epoch)}),a=await this._rpcRequest("getStakeActivation",o),c=G(a,_e(ex));if("error"in c)throw new ne(c.error,`failed to get Stake Activation ${e.toBase58()}`);return c.result}async getProgramAccounts(e,t){const{commitment:n,config:i}=Ue(t),{encoding:s,...o}=i||{},a=this._buildArgs([e.toBase58()],n,s||"base64",{...o,...o.filters?{filters:jh(o.filters)}:null}),c=await this._rpcRequest("getProgramAccounts",a),u=K(ZI),g=o.withContext===!0?G(c,tt(u)):G(c,_e(u));if("error"in g)throw new ne(g.error,`failed to get accounts owned by program ${e.toBase58()}`);return g.result}async getParsedProgramAccounts(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgs([e.toBase58()],n,"jsonParsed",i),o=await this._rpcRequest("getProgramAccounts",s),a=G(o,_e(K(QI)));if("error"in a)throw new ne(a.error,`failed to get accounts owned by program ${e.toBase58()}`);return a.result}async confirmTransaction(e,t){var s;let n;if(typeof e=="string")n=e;else{const o=e;if((s=o.abortSignal)!=null&&s.aborted)return Promise.reject(o.abortSignal.reason);n=o.signature}let i;try{i=Lt.decode(n)}catch{throw new Error("signature must be base58 encoded: "+n)}return vt(i.length===64,"signature has invalid length"),typeof e=="string"?await this.confirmTransactionUsingLegacyTimeoutStrategy({commitment:t||this.commitment,signature:n}):"lastValidBlockHeight"in e?await this.confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:t||this.commitment,strategy:e}):await this.confirmTransactionUsingDurableNonceStrategy({commitment:t||this.commitment,strategy:e})}getCancellationPromise(e){return new Promise((t,n)=>{e!=null&&(e.aborted?n(e.reason):e.addEventListener("abort",()=>{n(e.reason)}))})}getTransactionConfirmationPromise({commitment:e,signature:t}){let n,i,s=!1;const o=new Promise((c,u)=>{try{n=this.onSignature(t,(y,v)=>{n=void 0;const x={context:v,value:y};c({__type:nr.PROCESSED,response:x})},e);const g=new Promise(y=>{n==null?y():i=this._onSubscriptionStateChange(n,v=>{v==="subscribed"&&y()})});(async()=>{if(await g,s)return;const y=await this.getSignatureStatus(t);if(s||y==null)return;const{context:v,value:x}=y;if(x!=null)if(x!=null&&x.err)u(x.err);else{switch(e){case"confirmed":case"single":case"singleGossip":{if(x.confirmationStatus==="processed")return;break}case"finalized":case"max":case"root":{if(x.confirmationStatus==="processed"||x.confirmationStatus==="confirmed")return;break}case"processed":case"recent":}s=!0,c({__type:nr.PROCESSED,response:{context:v,value:x}})}})()}catch(g){u(g)}});return{abortConfirmation:()=>{i&&(i(),i=void 0),n!=null&&(this.removeSignatureListener(n),n=void 0)},confirmationPromise:o}}async confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:e,strategy:{abortSignal:t,lastValidBlockHeight:n,signature:i}}){let s=!1;const o=new Promise(y=>{const v=async()=>{try{return await this.getBlockHeight(e)}catch{return-1}};(async()=>{let x=await v();if(!s){for(;x<=n;)if(await Qr(1e3),s||(x=await v(),s))return;y({__type:nr.BLOCKHEIGHT_EXCEEDED})}})()}),{abortConfirmation:a,confirmationPromise:c}=this.getTransactionConfirmationPromise({commitment:e,signature:i}),u=this.getCancellationPromise(t);let g;try{const y=await Promise.race([u,c,o]);if(y.__type===nr.PROCESSED)g=y.response;else throw new mg(i)}finally{s=!0,a()}return g}async confirmTransactionUsingDurableNonceStrategy({commitment:e,strategy:{abortSignal:t,minContextSlot:n,nonceAccountPubkey:i,nonceValue:s,signature:o}}){let a=!1;const c=new Promise(x=>{let T=s,R=null;const C=async()=>{try{const{context:D,value:U}=await this.getNonceAndContext(i,{commitment:e,minContextSlot:n});return R=D.slot,U==null?void 0:U.nonce}catch{return T}};(async()=>{if(T=await C(),!a)for(;;){if(s!==T){x({__type:nr.NONCE_INVALID,slotInWhichNonceDidAdvance:R});return}if(await Qr(2e3),a||(T=await C(),a))return}})()}),{abortConfirmation:u,confirmationPromise:g}=this.getTransactionConfirmationPromise({commitment:e,signature:o}),y=this.getCancellationPromise(t);let v;try{const x=await Promise.race([y,g,c]);if(x.__type===nr.PROCESSED)v=x.response;else{let T;for(;;){const R=await this.getSignatureStatus(o);if(R==null)break;if(R.context.slot<(x.slotInWhichNonceDidAdvance??n)){await Qr(400);continue}T=R;break}if(T!=null&&T.value){const R=e||"finalized",{confirmationStatus:C}=T.value;switch(R){case"processed":case"recent":if(C!=="processed"&&C!=="confirmed"&&C!=="finalized")throw new Wi(o);break;case"confirmed":case"single":case"singleGossip":if(C!=="confirmed"&&C!=="finalized")throw new Wi(o);break;case"finalized":case"max":case"root":if(C!=="finalized")throw new Wi(o);break;default:}v={context:T.context,value:{err:T.value.err}}}else throw new Wi(o)}}finally{a=!0,u()}return v}async confirmTransactionUsingLegacyTimeoutStrategy({commitment:e,signature:t}){let n;const i=new Promise(c=>{let u=this._confirmTransactionInitialTimeout||6e4;switch(e){case"processed":case"recent":case"single":case"confirmed":case"singleGossip":{u=this._confirmTransactionInitialTimeout||3e4;break}}n=setTimeout(()=>c({__type:nr.TIMED_OUT,timeoutMs:u}),u)}),{abortConfirmation:s,confirmationPromise:o}=this.getTransactionConfirmationPromise({commitment:e,signature:t});let a;try{const c=await Promise.race([o,i]);if(c.__type===nr.PROCESSED)a=c.response;else throw new yg(t,c.timeoutMs/1e3)}finally{clearTimeout(n),s()}return a}async getClusterNodes(){const e=await this._rpcRequest("getClusterNodes",[]),t=G(e,_e(K(dx)));if("error"in t)throw new ne(t.error,"failed to get cluster nodes");return t.result}async getVoteAccounts(e){const t=this._buildArgs([],e),n=await this._rpcRequest("getVoteAccounts",t),i=G(n,fx);if("error"in i)throw new ne(i.error,"failed to get vote accounts");return i.result}async getSlot(e){const{commitment:t,config:n}=Ue(e),i=this._buildArgs([],t,void 0,n),s=await this._rpcRequest("getSlot",i),o=G(s,_e(P()));if("error"in o)throw new ne(o.error,"failed to get slot");return o.result}async getSlotLeader(e){const{commitment:t,config:n}=Ue(e),i=this._buildArgs([],t,void 0,n),s=await this._rpcRequest("getSlotLeader",i),o=G(s,_e(q()));if("error"in o)throw new ne(o.error,"failed to get slot leader");return o.result}async getSlotLeaders(e,t){const n=[e,t],i=await this._rpcRequest("getSlotLeaders",n),s=G(i,_e(K(Ye)));if("error"in s)throw new ne(s.error,"failed to get slot leaders");return s.result}async getSignatureStatus(e,t){const{context:n,value:i}=await this.getSignatureStatuses([e],t);vt(i.length===1);const s=i[0];return{context:n,value:s}}async getSignatureStatuses(e,t){const n=[e];t&&n.push(t);const i=await this._rpcRequest("getSignatureStatuses",n),s=G(i,mx);if("error"in s)throw new ne(s.error,"failed to get signature status");return s.result}async getTransactionCount(e){const{commitment:t,config:n}=Ue(e),i=this._buildArgs([],t,void 0,n),s=await this._rpcRequest("getTransactionCount",i),o=G(s,_e(P()));if("error"in o)throw new ne(o.error,"failed to get transaction count");return o.result}async getTotalSupply(e){return(await this.getSupply({commitment:e,excludeNonCirculatingAccountsList:!0})).value.total}async getInflationGovernor(e){const t=this._buildArgs([],e),n=await this._rpcRequest("getInflationGovernor",t),i=G(n,UI);if("error"in i)throw new ne(i.error,"failed to get inflation");return i.result}async getInflationReward(e,t,n){const{commitment:i,config:s}=Ue(n),o=this._buildArgs([e.map(u=>u.toBase58())],i,void 0,{...s,epoch:t??(s==null?void 0:s.epoch)}),a=await this._rpcRequest("getInflationReward",o),c=G(a,II);if("error"in c)throw new ne(c.error,"failed to get inflation reward");return c.result}async getInflationRate(){const e=await this._rpcRequest("getInflationRate",[]),t=G(e,WI);if("error"in t)throw new ne(t.error,"failed to get inflation rate");return t.result}async getEpochInfo(e){const{commitment:t,config:n}=Ue(e),i=this._buildArgs([],t,void 0,n),s=await this._rpcRequest("getEpochInfo",i),o=G(s,HI);if("error"in o)throw new ne(o.error,"failed to get epoch info");return o.result}async getEpochSchedule(){const e=await this._rpcRequest("getEpochSchedule",[]),t=G(e,qI);if("error"in t)throw new ne(t.error,"failed to get epoch schedule");const n=t.result;return new fI(n.slotsPerEpoch,n.leaderScheduleSlotOffset,n.warmup,n.firstNormalEpoch,n.firstNormalSlot)}async getLeaderSchedule(){const e=await this._rpcRequest("getLeaderSchedule",[]),t=G(e,zI);if("error"in t)throw new ne(t.error,"failed to get leader schedule");return t.result}async getMinimumBalanceForRentExemption(e,t){const n=this._buildArgs([e],t),i=await this._rpcRequest("getMinimumBalanceForRentExemption",n),s=G(i,yx);return"error"in s?(console.warn("Unable to fetch minimum balance for rent exemption"),0):s.result}async getRecentBlockhashAndContext(e){const{context:t,value:{blockhash:n}}=await this.getLatestBlockhashAndContext(e);return{context:t,value:{blockhash:n,feeCalculator:{get lamportsPerSignature(){throw new Error("The capability to fetch `lamportsPerSignature` using the `getRecentBlockhash` API is no longer offered by the network. Use the `getFeeForMessage` API to obtain the fee for a given message.")},toJSON(){return{}}}}}}async getRecentPerformanceSamples(e){const t=await this._rpcRequest("getRecentPerformanceSamples",e?[e]:[]),n=G(t,Rx);if("error"in n)throw new ne(n.error,"failed to get recent performance samples");return n.result}async getFeeCalculatorForBlockhash(e,t){const n=this._buildArgs([e],t),i=await this._rpcRequest("getFeeCalculatorForBlockhash",n),s=G(i,Mx);if("error"in s)throw new ne(s.error,"failed to get fee calculator");const{context:o,value:a}=s.result;return{context:o,value:a!==null?a.feeCalculator:null}}async getFeeForMessage(e,t){const n=Nt(e.serialize()).toString("base64"),i=this._buildArgs([n],t),s=await this._rpcRequest("getFeeForMessage",i),o=G(s,tt(J(P())));if("error"in o)throw new ne(o.error,"failed to get fee for message");if(o.result===null)throw new Error("invalid blockhash");return o.result}async getRecentPrioritizationFees(e){var o;const t=(o=e==null?void 0:e.lockedWritableAccounts)==null?void 0:o.map(a=>a.toBase58()),n=t!=null&&t.length?[t]:[],i=await this._rpcRequest("getRecentPrioritizationFees",n),s=G(i,$I);if("error"in s)throw new ne(s.error,"failed to get recent prioritization fees");return s.result}async getRecentBlockhash(e){try{return(await this.getRecentBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhash(e){try{return(await this.getLatestBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhashAndContext(e){const{commitment:t,config:n}=Ue(e),i=this._buildArgs([],t,void 0,n),s=await this._rpcRequest("getLatestBlockhash",i),o=G(s,Cx);if("error"in o)throw new ne(o.error,"failed to get latest blockhash");return o.result}async isBlockhashValid(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgs([e],n,void 0,i),o=await this._rpcRequest("isBlockhashValid",s),a=G(o,Ax);if("error"in a)throw new ne(a.error,"failed to determine if the blockhash `"+e+"`is valid");return a.result}async getVersion(){const e=await this._rpcRequest("getVersion",[]),t=G(e,_e(NI));if("error"in t)throw new ne(t.error,"failed to get version");return t.result}async getGenesisHash(){const e=await this._rpcRequest("getGenesisHash",[]),t=G(e,_e(q()));if("error"in t)throw new ne(t.error,"failed to get genesis hash");return t.result}async getBlock(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],n,void 0,i),o=await this._rpcRequest("getBlock",s);try{switch(i==null?void 0:i.transactionDetails){case"accounts":{const a=G(o,Ex);if("error"in a)throw a.error;return a.result}case"none":{const a=G(o,vx);if("error"in a)throw a.error;return a.result}default:{const a=G(o,bx);if("error"in a)throw a.error;const{result:c}=a;return c?{...c,transactions:c.transactions.map(({transaction:u,meta:g,version:y})=>({meta:g,transaction:{...u,message:Qa(y,u.message)},version:y}))}:null}}}catch(a){throw new ne(a,"failed to get confirmed block")}}async getParsedBlock(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],n,"jsonParsed",i),o=await this._rpcRequest("getBlock",s);try{switch(i==null?void 0:i.transactionDetails){case"accounts":{const a=G(o,Ix);if("error"in a)throw a.error;return a.result}case"none":{const a=G(o,xx);if("error"in a)throw a.error;return a.result}default:{const a=G(o,Sx);if("error"in a)throw a.error;return a.result}}}catch(a){throw new ne(a,"failed to get block")}}async getBlockProduction(e){let t,n;if(typeof e=="string")n=e;else if(e){const{commitment:a,...c}=e;n=a,t=c}const i=this._buildArgs([],n,"base64",t),s=await this._rpcRequest("getBlockProduction",i),o=G(s,LI);if("error"in o)throw new ne(o.error,"failed to get block production information");return o.result}async getTransaction(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],n,void 0,i),o=await this._rpcRequest("getTransaction",s),a=G(o,ec);if("error"in a)throw new ne(a.error,"failed to get transaction");const c=a.result;return c&&{...c,transaction:{...c.transaction,message:Qa(c.version,c.transaction.message)}}}async getParsedTransaction(e,t){const{commitment:n,config:i}=Ue(t),s=this._buildArgsAtLeastConfirmed([e],n,"jsonParsed",i),o=await this._rpcRequest("getTransaction",s),a=G(o,Ps);if("error"in a)throw new ne(a.error,"failed to get transaction");return a.result}async getParsedTransactions(e,t){const{commitment:n,config:i}=Ue(t),s=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],n,"jsonParsed",i)}));return(await this._rpcBatchRequest(s)).map(c=>{const u=G(c,Ps);if("error"in u)throw new ne(u.error,"failed to get transactions");return u.result})}async getTransactions(e,t){const{commitment:n,config:i}=Ue(t),s=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],n,void 0,i)}));return(await this._rpcBatchRequest(s)).map(c=>{const u=G(c,ec);if("error"in u)throw new ne(u.error,"failed to get transactions");const g=u.result;return g&&{...g,transaction:{...g.transaction,message:Qa(g.version,g.transaction.message)}}})}async getConfirmedBlock(e,t){const n=this._buildArgsAtLeastConfirmed([e],t),i=await this._rpcRequest("getBlock",n),s=G(i,kx);if("error"in s)throw new ne(s.error,"failed to get confirmed block");const o=s.result;if(!o)throw new Error("Confirmed block "+e+" not found");const a={...o,transactions:o.transactions.map(({transaction:c,meta:u})=>{const g=new br(c.message);return{meta:u,transaction:{...c,message:g}}})};return{...a,transactions:a.transactions.map(({transaction:c,meta:u})=>({meta:u,transaction:In.populate(c.message,c.signatures)}))}}async getBlocks(e,t,n){const i=this._buildArgsAtLeastConfirmed(t!==void 0?[e,t]:[e],n),s=await this._rpcRequest("getBlocks",i),o=G(s,_e(K(P())));if("error"in o)throw new ne(o.error,"failed to get blocks");return o.result}async getBlockSignatures(e,t){const n=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),i=await this._rpcRequest("getBlock",n),s=G(i,Jh);if("error"in s)throw new ne(s.error,"failed to get block");const o=s.result;if(!o)throw new Error("Block "+e+" not found");return o}async getConfirmedBlockSignatures(e,t){const n=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),i=await this._rpcRequest("getBlock",n),s=G(i,Jh);if("error"in s)throw new ne(s.error,"failed to get confirmed block");const o=s.result;if(!o)throw new Error("Confirmed block "+e+" not found");return o}async getConfirmedTransaction(e,t){const n=this._buildArgsAtLeastConfirmed([e],t),i=await this._rpcRequest("getTransaction",n),s=G(i,ec);if("error"in s)throw new ne(s.error,"failed to get transaction");const o=s.result;if(!o)return o;const a=new br(o.transaction.message),c=o.transaction.signatures;return{...o,transaction:In.populate(a,c)}}async getParsedConfirmedTransaction(e,t){const n=this._buildArgsAtLeastConfirmed([e],t,"jsonParsed"),i=await this._rpcRequest("getTransaction",n),s=G(i,Ps);if("error"in s)throw new ne(s.error,"failed to get confirmed transaction");return s.result}async getParsedConfirmedTransactions(e,t){const n=e.map(o=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([o],t,"jsonParsed")}));return(await this._rpcBatchRequest(n)).map(o=>{const a=G(o,Ps);if("error"in a)throw new ne(a.error,"failed to get confirmed transactions");return a.result})}async getConfirmedSignaturesForAddress(e,t,n){let i={},s=await this.getFirstAvailableBlock();for(;!("until"in i)&&(t--,!(t<=0||t<s));)try{const c=await this.getConfirmedBlockSignatures(t,"finalized");c.signatures.length>0&&(i.until=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}let o=await this.getSlot("finalized");for(;!("before"in i)&&(n++,!(n>o));)try{const c=await this.getConfirmedBlockSignatures(n);c.signatures.length>0&&(i.before=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}return(await this.getConfirmedSignaturesForAddress2(e,i)).map(c=>c.signature)}async getConfirmedSignaturesForAddress2(e,t,n){const i=this._buildArgsAtLeastConfirmed([e.toBase58()],n,void 0,t),s=await this._rpcRequest("getConfirmedSignaturesForAddress2",i),o=G(s,tx);if("error"in o)throw new ne(o.error,"failed to get confirmed signatures for address");return o.result}async getSignaturesForAddress(e,t,n){const i=this._buildArgsAtLeastConfirmed([e.toBase58()],n,void 0,t),s=await this._rpcRequest("getSignaturesForAddress",i),o=G(s,nx);if("error"in o)throw new ne(o.error,"failed to get signatures for address");return o.result}async getAddressLookupTable(e,t){const{context:n,value:i}=await this.getAccountInfoAndContext(e,t);let s=null;return i!==null&&(s=new Gh({key:e,state:Gh.deserialize(i.data)})),{context:n,value:s}}async getNonceAndContext(e,t){const{context:n,value:i}=await this.getAccountInfoAndContext(e,t);let s=null;return i!==null&&(s=tu.fromAccountData(i.data)),{context:n,value:s}}async getNonce(e,t){return await this.getNonceAndContext(e,t).then(n=>n.value).catch(n=>{throw new Error("failed to get nonce for account "+e.toBase58()+": "+n)})}async requestAirdrop(e,t){const n=await this._rpcRequest("requestAirdrop",[e.toBase58(),t]),i=G(n,Nx);if("error"in i)throw new ne(i.error,`airdrop to ${e.toBase58()} failed`);return i.result}async _blockhashWithExpiryBlockHeight(e){if(!e){for(;this._pollingBlockhash;)await Qr(100);const n=Date.now()-this._blockhashInfo.lastFetch>=bI;if(this._blockhashInfo.latestBlockhash!==null&&!n)return this._blockhashInfo.latestBlockhash}return await this._pollNewBlockhash()}async _pollNewBlockhash(){this._pollingBlockhash=!0;try{const e=Date.now(),t=this._blockhashInfo.latestBlockhash,n=t?t.blockhash:null;for(let i=0;i<50;i++){const s=await this.getLatestBlockhash("finalized");if(n!==s.blockhash)return this._blockhashInfo={latestBlockhash:s,lastFetch:Date.now(),transactionSignatures:[],simulatedSignatures:[]},s;await Qr(sI/2)}throw new Error(`Unable to obtain a new blockhash after ${Date.now()-e}ms`)}finally{this._pollingBlockhash=!1}}async getStakeMinimumDelegation(e){const{commitment:t,config:n}=Ue(e),i=this._buildArgs([],t,"base64",n),s=await this._rpcRequest("getStakeMinimumDelegation",i),o=G(s,tt(P()));if("error"in o)throw new ne(o.error,"failed to get stake minimum delegation");return o.result}async simulateTransaction(e,t,n){if("message"in e){const R=e.serialize(),C=pe.Buffer.from(R).toString("base64");if(Array.isArray(t)||n!==void 0)throw new Error("Invalid arguments");const D=t||{};D.encoding="base64","commitment"in D||(D.commitment=this.commitment),t&&typeof t=="object"&&"innerInstructions"in t&&(D.innerInstructions=t.innerInstructions);const U=[C,D],L=await this._rpcRequest("simulateTransaction",U),z=G(L,Kh);if("error"in z)throw new Error("failed to simulate transaction: "+z.error.message);return z.result}let i;if(e instanceof In){let T=e;i=new In,i.feePayer=T.feePayer,i.instructions=e.instructions,i.nonceInfo=T.nonceInfo,i.signatures=T.signatures}else i=In.populate(e),i._message=i._json=void 0;if(t!==void 0&&!Array.isArray(t))throw new Error("Invalid arguments");const s=t;if(i.nonceInfo&&s)i.sign(...s);else{let T=this._disableBlockhashCaching;for(;;){const R=await this._blockhashWithExpiryBlockHeight(T);if(i.lastValidBlockHeight=R.lastValidBlockHeight,i.recentBlockhash=R.blockhash,!s)break;if(i.sign(...s),!i.signature)throw new Error("!signature");const C=i.signature.toString("base64");if(!this._blockhashInfo.simulatedSignatures.includes(C)&&!this._blockhashInfo.transactionSignatures.includes(C)){this._blockhashInfo.simulatedSignatures.push(C);break}else T=!0}}const o=i._compile(),a=o.serialize(),u=i._serialize(a).toString("base64"),g={encoding:"base64",commitment:this.commitment};if(n){const T=(Array.isArray(n)?n:o.nonProgramIds()).map(R=>R.toBase58());g.accounts={encoding:"base64",addresses:T}}s&&(g.sigVerify=!0),t&&typeof t=="object"&&"innerInstructions"in t&&(g.innerInstructions=t.innerInstructions);const y=[u,g],v=await this._rpcRequest("simulateTransaction",y),x=G(v,Kh);if("error"in x){let T;if("data"in x.error&&(T=x.error.data.logs,T&&Array.isArray(T))){const R=`
    `,C=R+T.join(R);console.error(x.error.message,C)}throw new $h({action:"simulate",signature:"",transactionMessage:x.error.message,logs:T})}return x.result}async sendTransaction(e,t,n){if("version"in e){if(t&&Array.isArray(t))throw new Error("Invalid arguments");const o=e.serialize();return await this.sendRawTransaction(o,t)}if(t===void 0||!Array.isArray(t))throw new Error("Invalid arguments");const i=t;if(e.nonceInfo)e.sign(...i);else{let o=this._disableBlockhashCaching;for(;;){const a=await this._blockhashWithExpiryBlockHeight(o);if(e.lastValidBlockHeight=a.lastValidBlockHeight,e.recentBlockhash=a.blockhash,e.sign(...i),!e.signature)throw new Error("!signature");const c=e.signature.toString("base64");if(this._blockhashInfo.transactionSignatures.includes(c))o=!0;else{this._blockhashInfo.transactionSignatures.push(c);break}}}const s=e.serialize();return await this.sendRawTransaction(s,n)}async sendRawTransaction(e,t){const n=Nt(e).toString("base64");return await this.sendEncodedTransaction(n,t)}async sendEncodedTransaction(e,t){const n={encoding:"base64"},i=t&&t.skipPreflight,s=i===!0?"processed":t&&t.preflightCommitment||this.commitment;t&&t.maxRetries!=null&&(n.maxRetries=t.maxRetries),t&&t.minContextSlot!=null&&(n.minContextSlot=t.minContextSlot),i&&(n.skipPreflight=i),s&&(n.preflightCommitment=s);const o=[e,n],a=await this._rpcRequest("sendTransaction",o),c=G(a,Bx);if("error"in c){let u;throw"data"in c.error&&(u=c.error.data.logs),new $h({action:i?"send":"simulate",signature:"",transactionMessage:c.error.message,logs:u})}return c.result}_wsOnOpen(){this._rpcWebSocketConnected=!0,this._rpcWebSocketHeartbeat=setInterval(()=>{(async()=>{try{await this._rpcWebSocket.notify("ping")}catch{}})()},5e3),this._updateSubscriptions()}_wsOnError(e){this._rpcWebSocketConnected=!1,console.error("ws error:",e.message)}_wsOnClose(e){if(this._rpcWebSocketConnected=!1,this._rpcWebSocketGeneration=(this._rpcWebSocketGeneration+1)%Number.MAX_SAFE_INTEGER,this._rpcWebSocketIdleTimeout&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null),this._rpcWebSocketHeartbeat&&(clearInterval(this._rpcWebSocketHeartbeat),this._rpcWebSocketHeartbeat=null),e===1e3){this._updateSubscriptions();return}this._subscriptionCallbacksByServerSubscriptionId={},Object.entries(this._subscriptionsByHash).forEach(([t,n])=>{this._setSubscription(t,{...n,state:"pending"})})}_setSubscription(e,t){var i;const n=(i=this._subscriptionsByHash[e])==null?void 0:i.state;if(this._subscriptionsByHash[e]=t,n!==t.state){const s=this._subscriptionStateChangeCallbacksByHash[e];s&&s.forEach(o=>{try{o(t.state)}catch{}})}}_onSubscriptionStateChange(e,t){var s;const n=this._subscriptionHashByClientSubscriptionId[e];if(n==null)return()=>{};const i=(s=this._subscriptionStateChangeCallbacksByHash)[n]||(s[n]=new Set);return i.add(t),()=>{i.delete(t),i.size===0&&delete this._subscriptionStateChangeCallbacksByHash[n]}}async _updateSubscriptions(){if(Object.keys(this._subscriptionsByHash).length===0){this._rpcWebSocketConnected&&(this._rpcWebSocketConnected=!1,this._rpcWebSocketIdleTimeout=setTimeout(()=>{this._rpcWebSocketIdleTimeout=null;try{this._rpcWebSocket.close()}catch(n){n instanceof Error&&console.log(`Error when closing socket connection: ${n.message}`)}},500));return}if(this._rpcWebSocketIdleTimeout!==null&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketConnected=!0),!this._rpcWebSocketConnected){this._rpcWebSocket.connect();return}const e=this._rpcWebSocketGeneration,t=()=>e===this._rpcWebSocketGeneration;await Promise.all(Object.keys(this._subscriptionsByHash).map(async n=>{const i=this._subscriptionsByHash[n];if(i!==void 0)switch(i.state){case"pending":case"unsubscribed":if(i.callbacks.size===0){delete this._subscriptionsByHash[n],i.state==="unsubscribed"&&delete this._subscriptionCallbacksByServerSubscriptionId[i.serverSubscriptionId],await this._updateSubscriptions();return}await(async()=>{const{args:s,method:o}=i;try{this._setSubscription(n,{...i,state:"subscribing"});const a=await this._rpcWebSocket.call(o,s);this._setSubscription(n,{...i,serverSubscriptionId:a,state:"subscribed"}),this._subscriptionCallbacksByServerSubscriptionId[a]=i.callbacks,await this._updateSubscriptions()}catch(a){if(console.error(`Received ${a instanceof Error?"":"JSON-RPC "}error calling \`${o}\``,{args:s,error:a}),!t())return;this._setSubscription(n,{...i,state:"pending"}),await this._updateSubscriptions()}})();break;case"subscribed":i.callbacks.size===0&&await(async()=>{const{serverSubscriptionId:s,unsubscribeMethod:o}=i;if(this._subscriptionsAutoDisposedByRpc.has(s))this._subscriptionsAutoDisposedByRpc.delete(s);else{this._setSubscription(n,{...i,state:"unsubscribing"}),this._setSubscription(n,{...i,state:"unsubscribing"});try{await this._rpcWebSocket.call(o,[s])}catch(a){if(a instanceof Error&&console.error(`${o} error:`,a.message),!t())return;this._setSubscription(n,{...i,state:"subscribed"}),await this._updateSubscriptions();return}}this._setSubscription(n,{...i,state:"unsubscribed"}),await this._updateSubscriptions()})();break}}))}_handleServerNotification(e,t){const n=this._subscriptionCallbacksByServerSubscriptionId[e];n!==void 0&&n.forEach(i=>{try{i(...t)}catch(s){console.error(s)}})}_wsOnAccountNotification(e){const{result:t,subscription:n}=G(e,rx);this._handleServerNotification(n,[t.value,t.context])}_makeSubscription(e,t){const n=this._nextClientSubscriptionId++,i=zh([e.method,t]),s=this._subscriptionsByHash[i];return s===void 0?this._subscriptionsByHash[i]={...e,args:t,callbacks:new Set([e.callback]),state:"pending"}:s.callbacks.add(e.callback),this._subscriptionHashByClientSubscriptionId[n]=i,this._subscriptionDisposeFunctionsByClientSubscriptionId[n]=async()=>{delete this._subscriptionDisposeFunctionsByClientSubscriptionId[n],delete this._subscriptionHashByClientSubscriptionId[n];const o=this._subscriptionsByHash[i];vt(o!==void 0,`Could not find a \`Subscription\` when tearing down client subscription #${n}`),o.callbacks.delete(e.callback),await this._updateSubscriptions()},this._updateSubscriptions(),n}onAccountChange(e,t,n){const{commitment:i,config:s}=Ue(n),o=this._buildArgs([e.toBase58()],i||this._commitment||"finalized","base64",s);return this._makeSubscription({callback:t,method:"accountSubscribe",unsubscribeMethod:"accountUnsubscribe"},o)}async removeAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"account change")}_wsOnProgramAccountNotification(e){const{result:t,subscription:n}=G(e,sx);this._handleServerNotification(n,[{accountId:t.value.pubkey,accountInfo:t.value.account},t.context])}onProgramAccountChange(e,t,n,i){const{commitment:s,config:o}=Ue(n),a=this._buildArgs([e.toBase58()],s||this._commitment||"finalized","base64",o||(i?{filters:jh(i)}:void 0));return this._makeSubscription({callback:t,method:"programSubscribe",unsubscribeMethod:"programUnsubscribe"},a)}async removeProgramAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"program account change")}onLogs(e,t,n){const i=this._buildArgs([typeof e=="object"?{mentions:[e.toString()]}:e],n||this._commitment||"finalized");return this._makeSubscription({callback:t,method:"logsSubscribe",unsubscribeMethod:"logsUnsubscribe"},i)}async removeOnLogsListener(e){await this._unsubscribeClientSubscription(e,"logs")}_wsOnLogsNotification(e){const{result:t,subscription:n}=G(e,Lx);this._handleServerNotification(n,[t.value,t.context])}_wsOnSlotNotification(e){const{result:t,subscription:n}=G(e,ax);this._handleServerNotification(n,[t])}onSlotChange(e){return this._makeSubscription({callback:e,method:"slotSubscribe",unsubscribeMethod:"slotUnsubscribe"},[])}async removeSlotChangeListener(e){await this._unsubscribeClientSubscription(e,"slot change")}_wsOnSlotUpdatesNotification(e){const{result:t,subscription:n}=G(e,lx);this._handleServerNotification(n,[t])}onSlotUpdate(e){return this._makeSubscription({callback:e,method:"slotsUpdatesSubscribe",unsubscribeMethod:"slotsUpdatesUnsubscribe"},[])}async removeSlotUpdateListener(e){await this._unsubscribeClientSubscription(e,"slot update")}async _unsubscribeClientSubscription(e,t){const n=this._subscriptionDisposeFunctionsByClientSubscriptionId[e];n?await n():console.warn(`Ignored unsubscribe request because an active subscription with id \`${e}\` for '${t}' events could not be found.`)}_buildArgs(e,t,n,i){const s=t||this._commitment;if(s||n||i){let o={};n&&(o.encoding=n),s&&(o.commitment=s),i&&(o=Object.assign(o,i)),e.push(o)}return e}_buildArgsAtLeastConfirmed(e,t,n,i){const s=t||this._commitment;if(s&&!["confirmed","finalized"].includes(s))throw new Error("Using Connection with default commitment: `"+this._commitment+"`, but method requires at least `confirmed`");return this._buildArgs(e,t,n,i)}_wsOnSignatureNotification(e){const{result:t,subscription:n}=G(e,ux);t.value!=="receivedSignature"&&this._subscriptionsAutoDisposedByRpc.add(n),this._handleServerNotification(n,t.value==="receivedSignature"?[{type:"received"},t.context]:[{type:"status",result:t.value},t.context])}onSignature(e,t,n){const i=this._buildArgs([e],n||this._commitment||"finalized"),s=this._makeSubscription({callback:(o,a)=>{if(o.type==="status"){t(o.result,a);try{this.removeSignatureListener(s)}catch{}}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},i);return s}onSignatureWithOptions(e,t,n){const{commitment:i,...s}={...n,commitment:n&&n.commitment||this._commitment||"finalized"},o=this._buildArgs([e],i,void 0,s),a=this._makeSubscription({callback:(c,u)=>{t(c,u);try{this.removeSignatureListener(a)}catch{}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},o);return a}async removeSignatureListener(e){await this._unsubscribeClientSubscription(e,"signature result")}_wsOnRootNotification(e){const{result:t,subscription:n}=G(e,hx);this._handleServerNotification(n,[t])}onRootChange(e){return this._makeSubscription({callback:e,method:"rootSubscribe",unsubscribeMethod:"rootUnsubscribe"},[])}async removeRootChangeListener(e){await this._unsubscribeClientSubscription(e,"root change")}}Object.freeze({CreateLookupTable:{index:0,layout:te([ie("instruction"),Ei("recentSlot"),Me("bumpSeed")])},FreezeLookupTable:{index:1,layout:te([ie("instruction")])},ExtendLookupTable:{index:2,layout:te([ie("instruction"),Ei(),qt(Ie(),Rr(ie(),-8),"addresses")])},DeactivateLookupTable:{index:3,layout:te([ie("instruction")])},CloseLookupTable:{index:4,layout:te([ie("instruction")])}});new ae("AddressLookupTab1e1111111111111111111111111");Object.freeze({RequestUnits:{index:0,layout:te([Me("instruction"),ie("units"),ie("additionalFee")])},RequestHeapFrame:{index:1,layout:te([Me("instruction"),ie("bytes")])},SetComputeUnitLimit:{index:2,layout:te([Me("instruction"),ie("units")])},SetComputeUnitPrice:{index:3,layout:te([Me("instruction"),Ei("microLamports")])}});new ae("ComputeBudget111111111111111111111111111111");te([Me("numSignatures"),Me("padding"),on("signatureOffset"),on("signatureInstructionIndex"),on("publicKeyOffset"),on("publicKeyInstructionIndex"),on("messageDataOffset"),on("messageDataSize"),on("messageInstructionIndex")]);new ae("Ed25519SigVerify111111111111111111111111111");VS.utils.isValidPrivateKey;te([Me("numSignatures"),on("signatureOffset"),Me("signatureInstructionIndex"),on("ethAddressOffset"),Me("ethAddressInstructionIndex"),on("messageDataOffset"),on("messageDataSize"),Me("messageInstructionIndex"),Xe(20,"ethAddress"),Xe(64,"signature"),Me("recoveryId")]);new ae("KeccakSecp256k11111111111111111111111111111");var Ng;new ae("StakeConfig11111111111111111111111111111111");class Bg{constructor(e,t,n){this.unixTimestamp=void 0,this.epoch=void 0,this.custodian=void 0,this.unixTimestamp=e,this.epoch=t,this.custodian=n}}Ng=Bg;Bg.default=new Ng(0,0,ae.default);Object.freeze({Initialize:{index:0,layout:te([ie("instruction"),ZS(),XS()])},Authorize:{index:1,layout:te([ie("instruction"),Ie("newAuthorized"),ie("stakeAuthorizationType")])},Delegate:{index:2,layout:te([ie("instruction")])},Split:{index:3,layout:te([ie("instruction"),en("lamports")])},Withdraw:{index:4,layout:te([ie("instruction"),en("lamports")])},Deactivate:{index:5,layout:te([ie("instruction")])},Merge:{index:7,layout:te([ie("instruction")])},AuthorizeWithSeed:{index:8,layout:te([ie("instruction"),Ie("newAuthorized"),ie("stakeAuthorizationType"),ri("authoritySeed"),Ie("authorityOwner")])}});new ae("Stake11111111111111111111111111111111111111");Object.freeze({InitializeAccount:{index:0,layout:te([ie("instruction"),QS()])},Authorize:{index:1,layout:te([ie("instruction"),Ie("newAuthorized"),ie("voteAuthorizationType")])},Withdraw:{index:3,layout:te([ie("instruction"),en("lamports")])},UpdateValidatorIdentity:{index:4,layout:te([ie("instruction")])},AuthorizeWithSeed:{index:10,layout:te([ie("instruction"),eI()])}});new ae("Vote111111111111111111111111111111111111111");new ae("Va1idator1nfo111111111111111111111111111111");W({name:q(),website:se(q()),details:se(q()),iconUrl:se(q()),keybaseUsername:se(q())});new ae("Vote111111111111111111111111111111111111111");te([Ie("nodePubkey"),Ie("authorizedWithdrawer"),Me("commission"),Mt(),qt(te([Mt("slot"),ie("confirmationCount")]),Rr(ie(),-8),"votes"),Me("rootSlotValid"),Mt("rootSlot"),Mt(),qt(te([Mt("epoch"),Ie("authorizedVoter")]),Rr(ie(),-8),"authorizedVoters"),te([qt(te([Ie("authorizedPubkey"),Mt("epochOfLastAuthorizedSwitch"),Mt("targetEpoch")]),32,"buf"),Mt("idx"),Me("isEmpty")],"priorVoters"),Mt(),qt(te([Mt("epoch"),Mt("credits"),Mt("prevCredits")]),Rr(ie(),-8),"epochCredits"),te([Mt("slot"),Mt("timestamp")],"lastTimestamp")]);const Dx=1e9;class Fx{constructor(){this.connection=new Mg(lp),this.wallet=null,this.onConnect=null}async connect(){try{if(!(window.solana&&window.solana.isPhantom)){alert("Please install Phantom wallet to play!"),window.open("https://phantom.app/","_blank");return}const t=await window.solana.connect();console.log("Wallet connected:",t.publicKey.toString()),this.wallet=window.solana;const n=document.getElementById("wallet-address");if(n){const s=t.publicKey.toString(),o=`${s.slice(0,4)}...${s.slice(-4)}`;n.textContent=o}const i=document.getElementById("connect-wallet");i&&(i.textContent="Connected"),this.onConnect&&this.onConnect()}catch(e){throw console.error("Error connecting to wallet:",e),e}}disconnect(){if(this.wallet){this.wallet.disconnect(),this.wallet=null;const e=document.getElementById("wallet-address");e&&(e.textContent="");const t=document.getElementById("connect-wallet");t&&(t.textContent="Connect Wallet")}}isConnected(){return this.wallet!==null}getPublicKey(){return this.wallet?this.wallet.publicKey:null}async payGameEntry(e){try{if(!this.wallet)throw new Error("Wallet not connected");const t=new ae(up),n=.1*Dx,i=new In().add(cs.transfer({fromPubkey:this.wallet.publicKey,toPubkey:t,lamports:n})),{blockhash:s}=await this.connection.getLatestBlockhash();i.recentBlockhash=s,i.feePayer=this.wallet.publicKey;const{signature:o}=await this.wallet.signAndSendTransaction(i);if((await this.connection.confirmTransaction(o,"confirmed")).value.err)throw new Error("Transaction failed to confirm");return console.log("Transaction successful:",o),o}catch(t){throw console.error("Error paying entry fee:",t),t}}}class Ux{constructor(){this.connection=new Mg(lp),this.monitoringIntervals=new Map}async monitorTransaction(e,t,n){try{const i=await this.connection.getSignatureStatus(e);n(this.parseTransactionStatus(i));const s=setInterval(async()=>{try{const o=await this.connection.getSignatureStatus(e),a=this.parseTransactionStatus(o);n(a),(a.status==="confirmed"||a.status==="failed")&&this.stopMonitoring(e)}catch(o){console.error("Error monitoring transaction:",o)}},2e3);this.monitoringIntervals.set(e,s),this.monitorEscrowBalance(t,n)}catch(i){console.error("Error starting transaction monitor:",i),n({status:"error",error:i.message})}}async monitorEscrowBalance(e,t){const n=new ae(e),i=setInterval(async()=>{try{const s=await this.connection.getBalance(n);t({type:"balance",balance:s/1e9})}catch(s){console.error("Error monitoring escrow balance:",s)}},5e3);this.monitoringIntervals.set("escrow-"+e,i)}parseTransactionStatus(e){return!e||!e.value?{status:"pending"}:e.value.err?{status:"failed",error:e.value.err}:e.value.confirmations===null?{status:"confirmed"}:{status:"pending",confirmations:e.value.confirmations}}stopMonitoring(e){const t=this.monitoringIntervals.get(e);t&&(clearInterval(t),this.monitoringIntervals.delete(e));const n=this.monitoringIntervals.get("escrow-"+e);n&&(clearInterval(n),this.monitoringIntervals.delete("escrow-"+e))}stopAllMonitoring(){for(const e of this.monitoringIntervals.values())clearInterval(e);this.monitoringIntervals.clear()}}class Wx{constructor(){this.modalOverlay=null,this.content=null,this.statusElement=null,this.escrowBalanceElement=null,this.refundTimer=null,this.refundTimeout=5*60*1e3}show(e,t){this.modalOverlay&&this.modalOverlay.remove(),this.modalOverlay=document.createElement("div"),this.modalOverlay.className="modal-overlay";const n=document.createElement("div");n.className="modal-content transaction-monitor-modal";const i=document.createElement("h2");i.textContent="Transaction Details",this.content=document.createElement("div"),this.content.className="modal-body";const s=document.createElement("div");s.className="transaction-link",s.innerHTML=`
            <div class="link-container">
                <h3>Transaction Sent!</h3>
                <p>View your transaction on Solscan:</p>
                <a href="https://solscan.io/tx/${e}" 
                   target="_blank" 
                   class="solscan-link win95-button">
                    ${e.slice(0,8)}...${e.slice(-8)}
                </a>
                <div class="transaction-copy">
                    <input type="text" readonly value="${e}" class="tx-signature-input" />
                    <button class="win95-button copy-button">Copy</button>
                </div>
            </div>
        `;const o=s.querySelector(".copy-button"),a=s.querySelector(".tx-signature-input");return o.onclick=()=>{a.select(),document.execCommand("copy"),o.textContent="Copied!",setTimeout(()=>o.textContent="Copy",2e3)},this.statusElement=document.createElement("div"),this.statusElement.className="transaction-status",this.statusElement.innerHTML=`
            <div class="status-item">
                <span>Status:</span>
                <span class="status pending">Pending Confirmation</span>
            </div>
            <div class="loading-spinner"></div>
        `,this.escrowBalanceElement=document.createElement("div"),this.escrowBalanceElement.className="escrow-balance",this.escrowBalanceElement.innerHTML=`
            <div class="balance-item">
                <span>Escrow Address:</span>
                <a href="https://solscan.io/account/${t}" 
                   target="_blank" 
                   class="solscan-link">
                    ${t.slice(0,8)}...${t.slice(-8)}
                </a>
            </div>
            <div class="balance-item">
                <span>Current Balance:</span>
                <span class="balance">Loading...</span>
            </div>
        `,this.timerElement=document.createElement("div"),this.timerElement.className="refund-timer",this.content.appendChild(s),this.content.appendChild(this.statusElement),this.content.appendChild(this.escrowBalanceElement),this.content.appendChild(this.timerElement),n.appendChild(i),n.appendChild(this.content),this.modalOverlay.appendChild(n),document.body.appendChild(this.modalOverlay),this}startRefundTimer(e,t){this.refundTimer&&clearInterval(this.refundTimer);const n=Date.now()+t,i=()=>{const s=Date.now(),o=Math.max(0,n-s);if(o===0)clearInterval(this.refundTimer),this.showRefundButton(e);else{const a=Math.floor(o/6e4),c=Math.floor(o%6e4/1e3);this.timerElement.textContent=`Time until refund available: ${a}:${c.toString().padStart(2,"0")}`}};i(),this.refundTimer=setInterval(i,1e3)}showRefundButton(e){const t=document.createElement("button");t.className="win95-button refund-button",t.textContent="Request Refund",t.onclick=e,this.timerElement.innerHTML="",this.timerElement.appendChild(t)}updateTransactionStatus(e,t={}){const n=this.statusElement.querySelector(".status");if(n.className=`status ${e}`,n.textContent=e.charAt(0).toUpperCase()+e.slice(1),e==="confirmed"&&(this.statusElement.querySelector(".loading-spinner").style.display="none",this.onConfirmed&&this.onConfirmed()),t.error){const i=document.createElement("div");i.className="error-message",i.textContent=t.error,this.statusElement.appendChild(i)}}updateEscrowBalance(e){const t=this.escrowBalanceElement.querySelector(".balance");t.textContent=`${e.toFixed(2)} SOL`}close(){this.refundTimer&&clearInterval(this.refundTimer),this.modalOverlay&&this.modalOverlay.remove()}}class $x{constructor(e,t){this.gameService=e,this.walletManager=t,this.currentLobbyId=null,this.playerCount=0,this.maxPlayers=2,this.paymentRequested=!1,this.transactionMonitor=new Ux,this.monitorModal=null}showGameModeSelection(e,t){const n=`
            <div class="mode-selection">
                <p>Select Game Mode:</p>
                <div class="button-container">
                    <button class="win95-button" id="single-player">Single Player</button>
                    <button class="win95-button" id="multi-player">Multiplayer (0.1 SOL Entry)</button>
                </div>
            </div>
        `,i=document.createElement("div");i.className="modal-overlay";const s=document.createElement("div");s.className="modal-content mode-select-modal";const o=document.createElement("h2");o.textContent="Select Game Mode";const a=document.createElement("div");a.className="modal-body",a.innerHTML=n,s.appendChild(o),s.appendChild(a),i.appendChild(s),document.body.appendChild(i),document.getElementById("single-player").onclick=()=>{i.remove(),e()},document.getElementById("multi-player").onclick=()=>{i.remove(),this.joinMultiplayerLobby(t)}}async joinMultiplayerLobby(e){try{console.log("Starting multiplayer lobby join process..."),this.showSearchingModal(),console.log("Joining or creating lobby...");const t=await this.gameService.joinLobby();this.currentLobbyId=t.lobbyId,console.log("Joined lobby:",this.currentLobbyId),console.log("Setting up lobby listener..."),this.gameService.subscribeLobbyUpdates(this.currentLobbyId,async n=>{console.log("Lobby state updated:",n),this.updateLobbyPlayers(n),n.status==="matched"&&!this.paymentRequested&&(this.paymentRequested=!0,await this.handlePayment(this.currentLobbyId)),n.status==="ready"&&e(n)})}catch(t){console.error("Detailed error in joinMultiplayerLobby:",t),this.hideSearchingModal(),ji.show("Error",()=>{},`Failed to join multiplayer. Error: ${t.message||"Unknown error"}`)}}showSearchingModal(){const e=document.createElement("div");e.className="modal-overlay",e.id="searching-modal";const t=document.createElement("div");t.className="modal-content searching-modal";const n=`
            <div class="lobby-container">
                <div class="lobby-header">
                    Multiplayer Lobby
                </div>
                <div class="lobby-players" id="lobby-players">
                    <div class="player-item current-user">
                        <div class="player-info">
                            <div class="player-address">${this.walletManager.getPublicKey().toString()}</div>
                            <div class="player-status">Searching...</div>
                        </div>
                    </div>
                </div>
                <div class="lobby-status" id="lobby-status">
                    Searching for opponent...
                </div>
                <button class="win95-button" id="cancel-search">Leave Lobby</button>
            </div>
        `;t.innerHTML=`
            <h2>Matchmaking</h2>
            <div class="modal-body">${n}</div>
        `,e.appendChild(t),document.body.appendChild(e),document.getElementById("cancel-search").onclick=()=>{this.leaveLobby(),this.hideSearchingModal()}}hideSearchingModal(){const e=document.getElementById("searching-modal");e&&e.remove()}async leaveLobby(){this.currentLobbyId&&(await this.gameService.leaveLobby(this.currentLobbyId),this.currentLobbyId=null)}updateLobbyPlayers(e){console.log("Updating lobby players:",e);const t=document.getElementById("lobby-players"),n=document.getElementById("lobby-status"),i=this.walletManager.getPublicKey().toString();if(t&&e.players&&(console.log("Current players:",e.players),t.innerHTML=e.players.map(s=>`
                <div class="player-item ${s.id===i?"current-user":""} 
                                        ${e.status==="matched"?"matched":""}">
                    <div class="player-info">
                        <div class="player-address">${this.formatAddress(s.id)}</div>
                        <div class="player-status">
                            ${this.getPlayerStatus(s,e.status)}
                        </div>
                    </div>
                </div>
            `).join(""),n)){const s=this.getLobbyStatus(e);console.log("Setting lobby status:",s),n.textContent=s}}formatAddress(e){return`${e.slice(0,6)}...${e.slice(-4)}`}getPlayerStatus(e,t){return t==="matched"?e.paymentStatus==="paid"?"Ready to Play":"Waiting for Payment":"Searching..."}getLobbyStatus(e){switch(e.status){case"waiting":return"Searching for opponent...";case"matched":return"Match found! Waiting for payments...";case"ready":return"Starting game...";default:return"Searching..."}}async handlePayment(e){let t,n;try{const i=await this.gameService.getTransactions(e);if(Object.values(i.val()||{}).filter(a=>a.walletAddress===this.walletManager.getPublicKey().toString()).some(a=>["pending","success"].includes(a.status)))throw new Error("Payment already submitted");this.ensureLobbyDisplay(),t=ji.showPaymentModal("Payment Required",async()=>{try{n=await this.walletManager.payGameEntry(e),this.monitorModal=new Wx().show(n,this.gameService.getEscrowAddress()),await this.gameService.recordTransaction(e,this.walletManager.getPublicKey().toString(),n);const a=await this.gameService.getFirstTransactionTimestamp(e);if(a){const c=Date.now()-a,u=Math.max(3e5-c,0);this.monitorModal.startRefundTimer(async()=>{try{await this.gameService.requestRefund(e,n),this.monitorModal.updateTransactionStatus("refund-requested")}catch(g){console.error("Error requesting refund:",g),this.monitorModal.updateTransactionStatus("refund-failed",{error:g.message})}},u)}this.transactionMonitor.monitorTransaction(n,this.gameService.getEscrowAddress(),async c=>{try{c.type==="balance"?this.monitorModal.updateEscrowBalance(c.balance):(this.monitorModal.updateTransactionStatus(c.status,c),c.status==="confirmed"&&(await this.gameService.updateTransactionStatus(e,n,"confirmed"),await this.gameService.updateLobbyPaymentStatus(e,this.walletManager.getPublicKey().toString(),"paid")))}catch(u){console.error("Error updating status:",u),this.monitorModal.updateTransactionStatus("error",{error:"Failed to update payment status"})}})}catch(a){console.error("Payment failed:",a),this.monitorModal&&this.monitorModal.updateTransactionStatus("failed",{error:a.message})}}),this.positionModals()}catch(i){console.error("Payment process error:",i),this.monitorModal&&this.monitorModal.updateTransactionStatus("failed",{error:i.message})}}ensureLobbyDisplay(){if(!document.getElementById("lobby-container")){const e=document.createElement("div");e.id="lobby-container",e.className="lobby-container",document.body.appendChild(e)}}positionModals(){const e=document.getElementById("lobby-container");if(!e)return;const t=e.getBoundingClientRect();document.querySelectorAll(".modal-content").forEach((i,s)=>{i.style.position="fixed",i.style.left=`${t.right+20}px`,i.style.top=`${t.top+s*20}px`,i.style.transform="none"})}}document.addEventListener("DOMContentLoaded",async()=>{console.log("DOM Content Loaded");const r=new dp,e=new jv,t=new Fx,n=new $x(r,t),i=document.createElement("div");i.id="wallet-message",i.textContent="Please connect your wallet to start the game",i.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 18px;
        text-align: center;
        background-color: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        z-index: 100;
    `,document.getElementById("game-container").appendChild(i);const s=document.getElementById("connect-wallet");s?s.addEventListener("click",async()=>{try{console.log("Connect wallet button clicked"),await t.connect(),r.setWallet(t)}catch(o){console.error("Error connecting wallet:",o),alert("Failed to connect wallet. Please try again.")}}):console.error("Connect wallet button not found in the DOM"),t.onConnect=async()=>{console.log("Wallet connected"),r.setWallet(t),i.remove(),n.showGameModeSelection(async()=>{try{await e.init()}catch(o){console.error("Error starting single player game:",o)}},async o=>{try{await e.initMultiplayer(o)}catch(a){console.error("Error starting multiplayer game:",a)}})}});
